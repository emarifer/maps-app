var ME=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},gp={exports:{}},$t={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Ux=Object.getOwnPropertySymbols,PE=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable;function DE(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function LE(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},c=0;c<10;c++)o["_"+String.fromCharCode(c)]=c;var _=Object.getOwnPropertyNames(o).map(function(A){return o[A]});if(_.join("")!=="0123456789")return!1;var w={};return"abcdefghijklmnopqrst".split("").forEach(function(A){w[A]=A}),Object.keys(Object.assign({},w)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Nx=LE()?Object.assign:function(i,o){for(var c,_=DE(i),w,A=1;A<arguments.length;A++){c=Object(arguments[A]);for(var L in c)PE.call(c,L)&&(_[L]=c[L]);if(Ux){w=Ux(c);for(var l=0;l<w.length;l++)zE.call(c,w[l])&&(_[w[l]]=c[w[l]])}}return _};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n_=Nx,Ql=60103,Vx=60106;$t.Fragment=60107;$t.StrictMode=60108;$t.Profiler=60114;var jx=60109,$x=60110,Gx=60112;$t.Suspense=60113;var Zx=60115,qx=60116;if(typeof Symbol=="function"&&Symbol.for){var Cr=Symbol.for;Ql=Cr("react.element"),Vx=Cr("react.portal"),$t.Fragment=Cr("react.fragment"),$t.StrictMode=Cr("react.strict_mode"),$t.Profiler=Cr("react.profiler"),jx=Cr("react.provider"),$x=Cr("react.context"),Gx=Cr("react.forward_ref"),$t.Suspense=Cr("react.suspense"),Zx=Cr("react.memo"),qx=Cr("react.lazy")}var Wx=typeof Symbol=="function"&&Symbol.iterator;function BE(i){return i===null||typeof i!="object"?null:(i=Wx&&i[Wx]||i["@@iterator"],typeof i=="function"?i:null)}function ju(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Xx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Hx={};function ec(i,o,c){this.props=i,this.context=o,this.refs=Hx,this.updater=c||Xx}ec.prototype.isReactComponent={};ec.prototype.setState=function(i,o){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error(ju(85));this.updater.enqueueSetState(this,i,o,"setState")};ec.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Yx(){}Yx.prototype=ec.prototype;function i_(i,o,c){this.props=i,this.context=o,this.refs=Hx,this.updater=c||Xx}var r_=i_.prototype=new Yx;r_.constructor=i_;n_(r_,ec.prototype);r_.isPureReactComponent=!0;var o_={current:null},Kx=Object.prototype.hasOwnProperty,Jx={key:!0,ref:!0,__self:!0,__source:!0};function Qx(i,o,c){var _,w={},A=null,L=null;if(o!=null)for(_ in o.ref!==void 0&&(L=o.ref),o.key!==void 0&&(A=""+o.key),o)Kx.call(o,_)&&!Jx.hasOwnProperty(_)&&(w[_]=o[_]);var l=arguments.length-2;if(l===1)w.children=c;else if(1<l){for(var W=Array(l),_e=0;_e<l;_e++)W[_e]=arguments[_e+2];w.children=W}if(i&&i.defaultProps)for(_ in l=i.defaultProps,l)w[_]===void 0&&(w[_]=l[_]);return{$$typeof:Ql,type:i,key:A,ref:L,props:w,_owner:o_.current}}function RE(i,o){return{$$typeof:Ql,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}}function s_(i){return typeof i=="object"&&i!==null&&i.$$typeof===Ql}function FE(i){var o={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(c){return o[c]})}var e0=/\/+/g;function a_(i,o){return typeof i=="object"&&i!==null&&i.key!=null?FE(""+i.key):o.toString(36)}function yp(i,o,c,_,w){var A=typeof i;(A==="undefined"||A==="boolean")&&(i=null);var L=!1;if(i===null)L=!0;else switch(A){case"string":case"number":L=!0;break;case"object":switch(i.$$typeof){case Ql:case Vx:L=!0}}if(L)return L=i,w=w(L),i=_===""?"."+a_(L,0):_,Array.isArray(w)?(c="",i!=null&&(c=i.replace(e0,"$&/")+"/"),yp(w,o,c,"",function(_e){return _e})):w!=null&&(s_(w)&&(w=RE(w,c+(!w.key||L&&L.key===w.key?"":(""+w.key).replace(e0,"$&/")+"/")+i)),o.push(w)),1;if(L=0,_=_===""?".":_+":",Array.isArray(i))for(var l=0;l<i.length;l++){A=i[l];var W=_+a_(A,l);L+=yp(A,o,c,W,w)}else if(W=BE(i),typeof W=="function")for(i=W.call(i),l=0;!(A=i.next()).done;)A=A.value,W=_+a_(A,l++),L+=yp(A,o,c,W,w);else if(A==="object")throw o=""+i,Error(ju(31,o==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":o));return L}function vp(i,o,c){if(i==null)return i;var _=[],w=0;return yp(i,_,"","",function(A){return o.call(c,A,w++)}),_}function OE(i){if(i._status===-1){var o=i._result;o=o(),i._status=0,i._result=o,o.then(function(c){i._status===0&&(c=c.default,i._status=1,i._result=c)},function(c){i._status===0&&(i._status=2,i._result=c)})}if(i._status===1)return i._result;throw i._result}var t0={current:null};function Mo(){var i=t0.current;if(i===null)throw Error(ju(321));return i}var UE={ReactCurrentDispatcher:t0,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:o_,IsSomeRendererActing:{current:!1},assign:n_};$t.Children={map:vp,forEach:function(i,o,c){vp(i,function(){o.apply(this,arguments)},c)},count:function(i){var o=0;return vp(i,function(){o++}),o},toArray:function(i){return vp(i,function(o){return o})||[]},only:function(i){if(!s_(i))throw Error(ju(143));return i}};$t.Component=ec;$t.PureComponent=i_;$t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UE;$t.cloneElement=function(i,o,c){if(i==null)throw Error(ju(267,i));var _=n_({},i.props),w=i.key,A=i.ref,L=i._owner;if(o!=null){if(o.ref!==void 0&&(A=o.ref,L=o_.current),o.key!==void 0&&(w=""+o.key),i.type&&i.type.defaultProps)var l=i.type.defaultProps;for(W in o)Kx.call(o,W)&&!Jx.hasOwnProperty(W)&&(_[W]=o[W]===void 0&&l!==void 0?l[W]:o[W])}var W=arguments.length-2;if(W===1)_.children=c;else if(1<W){l=Array(W);for(var _e=0;_e<W;_e++)l[_e]=arguments[_e+2];_.children=l}return{$$typeof:Ql,type:i.type,key:w,ref:A,props:_,_owner:L}};$t.createContext=function(i,o){return o===void 0&&(o=null),i={$$typeof:$x,_calculateChangedBits:o,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null},i.Provider={$$typeof:jx,_context:i},i.Consumer=i};$t.createElement=Qx;$t.createFactory=function(i){var o=Qx.bind(null,i);return o.type=i,o};$t.createRef=function(){return{current:null}};$t.forwardRef=function(i){return{$$typeof:Gx,render:i}};$t.isValidElement=s_;$t.lazy=function(i){return{$$typeof:qx,_payload:{_status:-1,_result:i},_init:OE}};$t.memo=function(i,o){return{$$typeof:Zx,type:i,compare:o===void 0?null:o}};$t.useCallback=function(i,o){return Mo().useCallback(i,o)};$t.useContext=function(i,o){return Mo().useContext(i,o)};$t.useDebugValue=function(){};$t.useEffect=function(i,o){return Mo().useEffect(i,o)};$t.useImperativeHandle=function(i,o,c){return Mo().useImperativeHandle(i,o,c)};$t.useLayoutEffect=function(i,o){return Mo().useLayoutEffect(i,o)};$t.useMemo=function(i,o){return Mo().useMemo(i,o)};$t.useReducer=function(i,o,c){return Mo().useReducer(i,o,c)};$t.useRef=function(i){return Mo().useRef(i)};$t.useState=function(i){return Mo().useState(i)};$t.version="17.0.2";gp.exports=$t;var Ca=gp.exports,n0={exports:{}},hr={},i0={exports:{}},r0={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){var o,c,_,w;if(typeof performance=="object"&&typeof performance.now=="function"){var A=performance;i.unstable_now=function(){return A.now()}}else{var L=Date,l=L.now();i.unstable_now=function(){return L.now()-l}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var W=null,_e=null,ve=function(){if(W!==null)try{var $e=i.unstable_now();W(!0,$e),W=null}catch(ut){throw setTimeout(ve,0),ut}};o=function($e){W!==null?setTimeout(o,0,$e):(W=$e,setTimeout(ve,0))},c=function($e,ut){_e=setTimeout($e,ut)},_=function(){clearTimeout(_e)},i.unstable_shouldYield=function(){return!1},w=i.unstable_forceFrameRate=function(){}}else{var he=window.setTimeout,ne=window.clearTimeout;if(typeof console!="undefined"){var Me=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof Me!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var tt=!1,nt=null,de=-1,te=5,ae=0;i.unstable_shouldYield=function(){return i.unstable_now()>=ae},w=function(){},i.unstable_forceFrameRate=function($e){0>$e||125<$e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<$e?Math.floor(1e3/$e):5};var De=new MessageChannel,Le=De.port2;De.port1.onmessage=function(){if(nt!==null){var $e=i.unstable_now();ae=$e+te;try{nt(!0,$e)?Le.postMessage(null):(tt=!1,nt=null)}catch(ut){throw Le.postMessage(null),ut}}else tt=!1},o=function($e){nt=$e,tt||(tt=!0,Le.postMessage(null))},c=function($e,ut){de=he(function(){$e(i.unstable_now())},ut)},_=function(){ne(de),de=-1}}function lt($e,ut){var ot=$e.length;$e.push(ut);e:for(;;){var Lt=ot-1>>>1,hn=$e[Lt];if(hn!==void 0&&0<pt(hn,ut))$e[Lt]=ut,$e[ot]=hn,ot=Lt;else break e}}function He($e){return $e=$e[0],$e===void 0?null:$e}function Ke($e){var ut=$e[0];if(ut!==void 0){var ot=$e.pop();if(ot!==ut){$e[0]=ot;e:for(var Lt=0,hn=$e.length;Lt<hn;){var In=2*(Lt+1)-1,Hn=$e[In],Ci=In+1,xt=$e[Ci];if(Hn!==void 0&&0>pt(Hn,ot))xt!==void 0&&0>pt(xt,Hn)?($e[Lt]=xt,$e[Ci]=ot,Lt=Ci):($e[Lt]=Hn,$e[In]=ot,Lt=In);else if(xt!==void 0&&0>pt(xt,ot))$e[Lt]=xt,$e[Ci]=ot,Lt=Ci;else break e}}return ut}return null}function pt($e,ut){var ot=$e.sortIndex-ut.sortIndex;return ot!==0?ot:$e.id-ut.id}var st=[],on=[],tn=1,Un=null,sn=3,rr=!1,mi=!1,Vi=!1;function ji($e){for(var ut=He(on);ut!==null;){if(ut.callback===null)Ke(on);else if(ut.startTime<=$e)Ke(on),ut.sortIndex=ut.expirationTime,lt(st,ut);else break;ut=He(on)}}function $i($e){if(Vi=!1,ji($e),!mi)if(He(st)!==null)mi=!0,o(_i);else{var ut=He(on);ut!==null&&c($i,ut.startTime-$e)}}function _i($e,ut){mi=!1,Vi&&(Vi=!1,_()),rr=!0;var ot=sn;try{for(ji(ut),Un=He(st);Un!==null&&(!(Un.expirationTime>ut)||$e&&!i.unstable_shouldYield());){var Lt=Un.callback;if(typeof Lt=="function"){Un.callback=null,sn=Un.priorityLevel;var hn=Lt(Un.expirationTime<=ut);ut=i.unstable_now(),typeof hn=="function"?Un.callback=hn:Un===He(st)&&Ke(st),ji(ut)}else Ke(st);Un=He(st)}if(Un!==null)var In=!0;else{var Hn=He(on);Hn!==null&&c($i,Hn.startTime-ut),In=!1}return In}finally{Un=null,sn=ot,rr=!1}}var Si=w;i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function($e){$e.callback=null},i.unstable_continueExecution=function(){mi||rr||(mi=!0,o(_i))},i.unstable_getCurrentPriorityLevel=function(){return sn},i.unstable_getFirstCallbackNode=function(){return He(st)},i.unstable_next=function($e){switch(sn){case 1:case 2:case 3:var ut=3;break;default:ut=sn}var ot=sn;sn=ut;try{return $e()}finally{sn=ot}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=Si,i.unstable_runWithPriority=function($e,ut){switch($e){case 1:case 2:case 3:case 4:case 5:break;default:$e=3}var ot=sn;sn=$e;try{return ut()}finally{sn=ot}},i.unstable_scheduleCallback=function($e,ut,ot){var Lt=i.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?Lt+ot:Lt):ot=Lt,$e){case 1:var hn=-1;break;case 2:hn=250;break;case 5:hn=1073741823;break;case 4:hn=1e4;break;default:hn=5e3}return hn=ot+hn,$e={id:tn++,callback:ut,priorityLevel:$e,startTime:ot,expirationTime:hn,sortIndex:-1},ot>Lt?($e.sortIndex=ot,lt(on,$e),He(st)===null&&$e===He(on)&&(Vi?_():Vi=!0,c($i,ot-Lt))):($e.sortIndex=hn,lt(st,$e),mi||rr||(mi=!0,o(_i))),$e},i.unstable_wrapCallback=function($e){var ut=sn;return function(){var ot=sn;sn=ut;try{return $e.apply(this,arguments)}finally{sn=ot}}}})(r0);i0.exports=r0;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xp=gp.exports,fn=Nx,Wn=i0.exports;function Ye(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!xp)throw Error(Ye(227));var o0=new Set,$u={};function Aa(i,o){tc(i,o),tc(i+"Capture",o)}function tc(i,o){for($u[i]=o,i=0;i<o.length;i++)o0.add(o[i])}var Po=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),NE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,s0=Object.prototype.hasOwnProperty,a0={},l0={};function VE(i){return s0.call(l0,i)?!0:s0.call(a0,i)?!1:NE.test(i)?l0[i]=!0:(a0[i]=!0,!1)}function jE(i,o,c,_){if(c!==null&&c.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return _?!1:c!==null?!c.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function $E(i,o,c,_){if(o===null||typeof o=="undefined"||jE(i,o,c,_))return!0;if(_)return!1;if(c!==null)switch(c.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Ti(i,o,c,_,w,A,L){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=_,this.attributeNamespace=w,this.mustUseProperty=c,this.propertyName=i,this.type=o,this.sanitizeURL=A,this.removeEmptyString=L}var ei={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){ei[i]=new Ti(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var o=i[0];ei[o]=new Ti(o,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){ei[i]=new Ti(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){ei[i]=new Ti(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){ei[i]=new Ti(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){ei[i]=new Ti(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){ei[i]=new Ti(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){ei[i]=new Ti(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){ei[i]=new Ti(i,5,!1,i.toLowerCase(),null,!1,!1)});var l_=/[\-:]([a-z])/g;function c_(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var o=i.replace(l_,c_);ei[o]=new Ti(o,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var o=i.replace(l_,c_);ei[o]=new Ti(o,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var o=i.replace(l_,c_);ei[o]=new Ti(o,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){ei[i]=new Ti(i,1,!1,i.toLowerCase(),null,!1,!1)});ei.xlinkHref=new Ti("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){ei[i]=new Ti(i,1,!1,i.toLowerCase(),null,!0,!0)});function u_(i,o,c,_){var w=ei.hasOwnProperty(o)?ei[o]:null,A=w!==null?w.type===0:_?!1:!(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N");A||($E(o,c,w,_)&&(c=null),_||w===null?VE(o)&&(c===null?i.removeAttribute(o):i.setAttribute(o,""+c)):w.mustUseProperty?i[w.propertyName]=c===null?w.type===3?!1:"":c:(o=w.attributeName,_=w.attributeNamespace,c===null?i.removeAttribute(o):(w=w.type,c=w===3||w===4&&c===!0?"":""+c,_?i.setAttributeNS(_,o,c):i.setAttribute(o,c))))}var ka=xp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gu=60103,Ia=60106,ws=60107,h_=60108,Zu=60114,d_=60109,p_=60110,wp=60112,qu=60113,bp=60120,Tp=60115,f_=60116,m_=60121,__=60128,c0=60129,g_=60130,y_=60131;if(typeof Symbol=="function"&&Symbol.for){var Xn=Symbol.for;Gu=Xn("react.element"),Ia=Xn("react.portal"),ws=Xn("react.fragment"),h_=Xn("react.strict_mode"),Zu=Xn("react.profiler"),d_=Xn("react.provider"),p_=Xn("react.context"),wp=Xn("react.forward_ref"),qu=Xn("react.suspense"),bp=Xn("react.suspense_list"),Tp=Xn("react.memo"),f_=Xn("react.lazy"),m_=Xn("react.block"),Xn("react.scope"),__=Xn("react.opaque.id"),c0=Xn("react.debug_trace_mode"),g_=Xn("react.offscreen"),y_=Xn("react.legacy_hidden")}var u0=typeof Symbol=="function"&&Symbol.iterator;function Wu(i){return i===null||typeof i!="object"?null:(i=u0&&i[u0]||i["@@iterator"],typeof i=="function"?i:null)}var v_;function Xu(i){if(v_===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);v_=o&&o[1]||""}return`
`+v_+i}var x_=!1;function Ep(i,o){if(!i||x_)return"";x_=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(W){var _=W}Reflect.construct(i,[],o)}else{try{o.call()}catch(W){_=W}i.call(o.prototype)}else{try{throw Error()}catch(W){_=W}i()}}catch(W){if(W&&_&&typeof W.stack=="string"){for(var w=W.stack.split(`
`),A=_.stack.split(`
`),L=w.length-1,l=A.length-1;1<=L&&0<=l&&w[L]!==A[l];)l--;for(;1<=L&&0<=l;L--,l--)if(w[L]!==A[l]){if(L!==1||l!==1)do if(L--,l--,0>l||w[L]!==A[l])return`
`+w[L].replace(" at new "," at ");while(1<=L&&0<=l);break}}}finally{x_=!1,Error.prepareStackTrace=c}return(i=i?i.displayName||i.name:"")?Xu(i):""}function GE(i){switch(i.tag){case 5:return Xu(i.type);case 16:return Xu("Lazy");case 13:return Xu("Suspense");case 19:return Xu("SuspenseList");case 0:case 2:case 15:return i=Ep(i.type,!1),i;case 11:return i=Ep(i.type.render,!1),i;case 22:return i=Ep(i.type._render,!1),i;case 1:return i=Ep(i.type,!0),i;default:return""}}function nc(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ws:return"Fragment";case Ia:return"Portal";case Zu:return"Profiler";case h_:return"StrictMode";case qu:return"Suspense";case bp:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case p_:return(i.displayName||"Context")+".Consumer";case d_:return(i._context.displayName||"Context")+".Provider";case wp:var o=i.render;return o=o.displayName||o.name||"",i.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case Tp:return nc(i.type);case m_:return nc(i._render);case f_:o=i._payload,i=i._init;try{return nc(i(o))}catch{}}return null}function bs(i){switch(typeof i){case"boolean":case"number":case"object":case"string":case"undefined":return i;default:return""}}function h0(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function ZE(i){var o=h0(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),_=""+i[o];if(!i.hasOwnProperty(o)&&typeof c!="undefined"&&typeof c.get=="function"&&typeof c.set=="function"){var w=c.get,A=c.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return w.call(this)},set:function(L){_=""+L,A.call(this,L)}}),Object.defineProperty(i,o,{enumerable:c.enumerable}),{getValue:function(){return _},setValue:function(L){_=""+L},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function Sp(i){i._valueTracker||(i._valueTracker=ZE(i))}function d0(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var c=o.getValue(),_="";return i&&(_=h0(i)?i.checked?"true":"false":i.value),i=_,i!==c?(o.setValue(i),!0):!1}function Cp(i){if(i=i||(typeof document!="undefined"?document:void 0),typeof i=="undefined")return null;try{return i.activeElement||i.body}catch{return i.body}}function w_(i,o){var c=o.checked;return fn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c!=null?c:i._wrapperState.initialChecked})}function p0(i,o){var c=o.defaultValue==null?"":o.defaultValue,_=o.checked!=null?o.checked:o.defaultChecked;c=bs(o.value!=null?o.value:c),i._wrapperState={initialChecked:_,initialValue:c,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function f0(i,o){o=o.checked,o!=null&&u_(i,"checked",o,!1)}function b_(i,o){f0(i,o);var c=bs(o.value),_=o.type;if(c!=null)_==="number"?(c===0&&i.value===""||i.value!=c)&&(i.value=""+c):i.value!==""+c&&(i.value=""+c);else if(_==="submit"||_==="reset"){i.removeAttribute("value");return}o.hasOwnProperty("value")?T_(i,o.type,c):o.hasOwnProperty("defaultValue")&&T_(i,o.type,bs(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(i.defaultChecked=!!o.defaultChecked)}function m0(i,o,c){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var _=o.type;if(!(_!=="submit"&&_!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+i._wrapperState.initialValue,c||o===i.value||(i.value=o),i.defaultValue=o}c=i.name,c!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,c!==""&&(i.name=c)}function T_(i,o,c){(o!=="number"||Cp(i.ownerDocument)!==i)&&(c==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+c&&(i.defaultValue=""+c))}function qE(i){var o="";return xp.Children.forEach(i,function(c){c!=null&&(o+=c)}),o}function E_(i,o){return i=fn({children:void 0},o),(o=qE(o.children))&&(i.children=o),i}function ic(i,o,c,_){if(i=i.options,o){o={};for(var w=0;w<c.length;w++)o["$"+c[w]]=!0;for(c=0;c<i.length;c++)w=o.hasOwnProperty("$"+i[c].value),i[c].selected!==w&&(i[c].selected=w),w&&_&&(i[c].defaultSelected=!0)}else{for(c=""+bs(c),o=null,w=0;w<i.length;w++){if(i[w].value===c){i[w].selected=!0,_&&(i[w].defaultSelected=!0);return}o!==null||i[w].disabled||(o=i[w])}o!==null&&(o.selected=!0)}}function S_(i,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Ye(91));return fn({},o,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function _0(i,o){var c=o.value;if(c==null){if(c=o.children,o=o.defaultValue,c!=null){if(o!=null)throw Error(Ye(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(Ye(93));c=c[0]}o=c}o==null&&(o=""),c=o}i._wrapperState={initialValue:bs(c)}}function g0(i,o){var c=bs(o.value),_=bs(o.defaultValue);c!=null&&(c=""+c,c!==i.value&&(i.value=c),o.defaultValue==null&&i.defaultValue!==c&&(i.defaultValue=c)),_!=null&&(i.defaultValue=""+_)}function y0(i){var o=i.textContent;o===i._wrapperState.initialValue&&o!==""&&o!==null&&(i.value=o)}var C_={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function v0(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function A_(i,o){return i==null||i==="http://www.w3.org/1999/xhtml"?v0(o):i==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ap,x0=function(i){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(o,c,_,w){MSApp.execUnsafeLocalFunction(function(){return i(o,c,_,w)})}:i}(function(i,o){if(i.namespaceURI!==C_.svg||"innerHTML"in i)i.innerHTML=o;else{for(Ap=Ap||document.createElement("div"),Ap.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Ap.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;o.firstChild;)i.appendChild(o.firstChild)}});function Hu(i,o){if(o){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=o;return}}i.textContent=o}var Yu={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},WE=["Webkit","ms","Moz","O"];Object.keys(Yu).forEach(function(i){WE.forEach(function(o){o=o+i.charAt(0).toUpperCase()+i.substring(1),Yu[o]=Yu[i]})});function w0(i,o,c){return o==null||typeof o=="boolean"||o===""?"":c||typeof o!="number"||o===0||Yu.hasOwnProperty(i)&&Yu[i]?(""+o).trim():o+"px"}function b0(i,o){i=i.style;for(var c in o)if(o.hasOwnProperty(c)){var _=c.indexOf("--")===0,w=w0(c,o[c],_);c==="float"&&(c="cssFloat"),_?i.setProperty(c,w):i[c]=w}}var XE=fn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function k_(i,o){if(o){if(XE[i]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Ye(137,i));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Ye(60));if(!(typeof o.dangerouslySetInnerHTML=="object"&&"__html"in o.dangerouslySetInnerHTML))throw Error(Ye(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Ye(62))}}function I_(i,o){if(i.indexOf("-")===-1)return typeof o.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function M_(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var P_=null,rc=null,oc=null;function T0(i){if(i=mh(i)){if(typeof P_!="function")throw Error(Ye(280));var o=i.stateNode;o&&(o=Zp(o),P_(i.stateNode,i.type,o))}}function E0(i){rc?oc?oc.push(i):oc=[i]:rc=i}function S0(){if(rc){var i=rc,o=oc;if(oc=rc=null,T0(i),o)for(i=0;i<o.length;i++)T0(o[i])}}function z_(i,o){return i(o)}function C0(i,o,c,_,w){return i(o,c,_,w)}function D_(){}var A0=z_,Ma=!1,L_=!1;function B_(){(rc!==null||oc!==null)&&(D_(),S0())}function HE(i,o,c){if(L_)return i(o,c);L_=!0;try{return A0(i,o,c)}finally{L_=!1,B_()}}function Ku(i,o){var c=i.stateNode;if(c===null)return null;var _=Zp(c);if(_===null)return null;c=_[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(i=i.type,_=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!_;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(Ye(231,o,typeof c));return c}var R_=!1;if(Po)try{var Ju={};Object.defineProperty(Ju,"passive",{get:function(){R_=!0}}),window.addEventListener("test",Ju,Ju),window.removeEventListener("test",Ju,Ju)}catch{R_=!1}function YE(i,o,c,_,w,A,L,l,W){var _e=Array.prototype.slice.call(arguments,3);try{o.apply(c,_e)}catch(ve){this.onError(ve)}}var Qu=!1,kp=null,Ip=!1,F_=null,KE={onError:function(i){Qu=!0,kp=i}};function JE(i,o,c,_,w,A,L,l,W){Qu=!1,kp=null,YE.apply(KE,arguments)}function QE(i,o,c,_,w,A,L,l,W){if(JE.apply(this,arguments),Qu){if(Qu){var _e=kp;Qu=!1,kp=null}else throw Error(Ye(198));Ip||(Ip=!0,F_=_e)}}function Pa(i){var o=i,c=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&1026)!=0&&(c=o.return),i=o.return;while(i)}return o.tag===3?c:null}function k0(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function I0(i){if(Pa(i)!==i)throw Error(Ye(188))}function eS(i){var o=i.alternate;if(!o){if(o=Pa(i),o===null)throw Error(Ye(188));return o!==i?null:i}for(var c=i,_=o;;){var w=c.return;if(w===null)break;var A=w.alternate;if(A===null){if(_=w.return,_!==null){c=_;continue}break}if(w.child===A.child){for(A=w.child;A;){if(A===c)return I0(w),i;if(A===_)return I0(w),o;A=A.sibling}throw Error(Ye(188))}if(c.return!==_.return)c=w,_=A;else{for(var L=!1,l=w.child;l;){if(l===c){L=!0,c=w,_=A;break}if(l===_){L=!0,_=w,c=A;break}l=l.sibling}if(!L){for(l=A.child;l;){if(l===c){L=!0,c=A,_=w;break}if(l===_){L=!0,_=A,c=w;break}l=l.sibling}if(!L)throw Error(Ye(189))}}if(c.alternate!==_)throw Error(Ye(190))}if(c.tag!==3)throw Error(Ye(188));return c.stateNode.current===c?i:o}function M0(i){if(i=eS(i),!i)return null;for(var o=i;;){if(o.tag===5||o.tag===6)return o;if(o.child)o.child.return=o,o=o.child;else{if(o===i)break;for(;!o.sibling;){if(!o.return||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}}return null}function P0(i,o){for(var c=i.alternate;o!==null;){if(o===i||o===c)return!0;o=o.return}return!1}var z0,O_,D0,L0,U_=!1,Qr=[],Ts=null,Es=null,Ss=null,eh=new Map,th=new Map,nh=[],B0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function N_(i,o,c,_,w){return{blockedOn:i,domEventName:o,eventSystemFlags:c|16,nativeEvent:w,targetContainers:[_]}}function R0(i,o){switch(i){case"focusin":case"focusout":Ts=null;break;case"dragenter":case"dragleave":Es=null;break;case"mouseover":case"mouseout":Ss=null;break;case"pointerover":case"pointerout":eh.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":th.delete(o.pointerId)}}function ih(i,o,c,_,w,A){return i===null||i.nativeEvent!==A?(i=N_(o,c,_,w,A),o!==null&&(o=mh(o),o!==null&&O_(o)),i):(i.eventSystemFlags|=_,o=i.targetContainers,w!==null&&o.indexOf(w)===-1&&o.push(w),i)}function tS(i,o,c,_,w){switch(o){case"focusin":return Ts=ih(Ts,i,o,c,_,w),!0;case"dragenter":return Es=ih(Es,i,o,c,_,w),!0;case"mouseover":return Ss=ih(Ss,i,o,c,_,w),!0;case"pointerover":var A=w.pointerId;return eh.set(A,ih(eh.get(A)||null,i,o,c,_,w)),!0;case"gotpointercapture":return A=w.pointerId,th.set(A,ih(th.get(A)||null,i,o,c,_,w)),!0}return!1}function nS(i){var o=za(i.target);if(o!==null){var c=Pa(o);if(c!==null){if(o=c.tag,o===13){if(o=k0(c),o!==null){i.blockedOn=o,L0(i.lanePriority,function(){Wn.unstable_runWithPriority(i.priority,function(){D0(c)})});return}}else if(o===3&&c.stateNode.hydrate){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Mp(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var c=q_(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(c!==null)return o=mh(c),o!==null&&O_(o),i.blockedOn=c,!1;o.shift()}return!0}function F0(i,o,c){Mp(i)&&c.delete(o)}function iS(){for(U_=!1;0<Qr.length;){var i=Qr[0];if(i.blockedOn!==null){i=mh(i.blockedOn),i!==null&&z0(i);break}for(var o=i.targetContainers;0<o.length;){var c=q_(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(c!==null){i.blockedOn=c;break}o.shift()}i.blockedOn===null&&Qr.shift()}Ts!==null&&Mp(Ts)&&(Ts=null),Es!==null&&Mp(Es)&&(Es=null),Ss!==null&&Mp(Ss)&&(Ss=null),eh.forEach(F0),th.forEach(F0)}function rh(i,o){i.blockedOn===o&&(i.blockedOn=null,U_||(U_=!0,Wn.unstable_scheduleCallback(Wn.unstable_NormalPriority,iS)))}function O0(i){function o(w){return rh(w,i)}if(0<Qr.length){rh(Qr[0],i);for(var c=1;c<Qr.length;c++){var _=Qr[c];_.blockedOn===i&&(_.blockedOn=null)}}for(Ts!==null&&rh(Ts,i),Es!==null&&rh(Es,i),Ss!==null&&rh(Ss,i),eh.forEach(o),th.forEach(o),c=0;c<nh.length;c++)_=nh[c],_.blockedOn===i&&(_.blockedOn=null);for(;0<nh.length&&(c=nh[0],c.blockedOn===null);)nS(c),c.blockedOn===null&&nh.shift()}function Pp(i,o){var c={};return c[i.toLowerCase()]=o.toLowerCase(),c["Webkit"+i]="webkit"+o,c["Moz"+i]="moz"+o,c}var sc={animationend:Pp("Animation","AnimationEnd"),animationiteration:Pp("Animation","AnimationIteration"),animationstart:Pp("Animation","AnimationStart"),transitionend:Pp("Transition","TransitionEnd")},V_={},U0={};Po&&(U0=document.createElement("div").style,"AnimationEvent"in window||(delete sc.animationend.animation,delete sc.animationiteration.animation,delete sc.animationstart.animation),"TransitionEvent"in window||delete sc.transitionend.transition);function zp(i){if(V_[i])return V_[i];if(!sc[i])return i;var o=sc[i],c;for(c in o)if(o.hasOwnProperty(c)&&c in U0)return V_[i]=o[c];return i}var N0=zp("animationend"),V0=zp("animationiteration"),j0=zp("animationstart"),$0=zp("transitionend"),G0=new Map,j_=new Map,rS=["abort","abort",N0,"animationEnd",V0,"animationIteration",j0,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",$0,"transitionEnd","waiting","waiting"];function $_(i,o){for(var c=0;c<i.length;c+=2){var _=i[c],w=i[c+1];w="on"+(w[0].toUpperCase()+w.slice(1)),j_.set(_,o),G0.set(_,w),Aa(w,[_])}}var oS=Wn.unstable_now;oS();var an=8;function ac(i){if((1&i)!=0)return an=15,1;if((2&i)!=0)return an=14,2;if((4&i)!=0)return an=13,4;var o=24&i;return o!==0?(an=12,o):(i&32)!=0?(an=11,32):(o=192&i,o!==0?(an=10,o):(i&256)!=0?(an=9,256):(o=3584&i,o!==0?(an=8,o):(i&4096)!=0?(an=7,4096):(o=4186112&i,o!==0?(an=6,o):(o=62914560&i,o!==0?(an=5,o):i&67108864?(an=4,67108864):(i&134217728)!=0?(an=3,134217728):(o=805306368&i,o!==0?(an=2,o):(1073741824&i)!=0?(an=1,1073741824):(an=8,i))))))}function sS(i){switch(i){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function aS(i){switch(i){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(Ye(358,i))}}function oh(i,o){var c=i.pendingLanes;if(c===0)return an=0;var _=0,w=0,A=i.expiredLanes,L=i.suspendedLanes,l=i.pingedLanes;if(A!==0)_=A,w=an=15;else if(A=c&134217727,A!==0){var W=A&~L;W!==0?(_=ac(W),w=an):(l&=A,l!==0&&(_=ac(l),w=an))}else A=c&~L,A!==0?(_=ac(A),w=an):l!==0&&(_=ac(l),w=an);if(_===0)return 0;if(_=31-Cs(_),_=c&((0>_?0:1<<_)<<1)-1,o!==0&&o!==_&&(o&L)==0){if(ac(o),w<=an)return o;an=w}if(o=i.entangledLanes,o!==0)for(i=i.entanglements,o&=_;0<o;)c=31-Cs(o),w=1<<c,_|=i[c],o&=~w;return _}function Z0(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Dp(i,o){switch(i){case 15:return 1;case 14:return 2;case 12:return i=lc(24&~o),i===0?Dp(10,o):i;case 10:return i=lc(192&~o),i===0?Dp(8,o):i;case 8:return i=lc(3584&~o),i===0&&(i=lc(4186112&~o),i===0&&(i=512)),i;case 2:return o=lc(805306368&~o),o===0&&(o=268435456),o}throw Error(Ye(358,i))}function lc(i){return i&-i}function G_(i){for(var o=[],c=0;31>c;c++)o.push(i);return o}function Lp(i,o,c){i.pendingLanes|=o;var _=o-1;i.suspendedLanes&=_,i.pingedLanes&=_,i=i.eventTimes,o=31-Cs(o),i[o]=c}var Cs=Math.clz32?Math.clz32:uS,lS=Math.log,cS=Math.LN2;function uS(i){return i===0?32:31-(lS(i)/cS|0)|0}var hS=Wn.unstable_UserBlockingPriority,dS=Wn.unstable_runWithPriority,Bp=!0;function pS(i,o,c,_){Ma||D_();var w=Z_,A=Ma;Ma=!0;try{C0(w,i,o,c,_)}finally{(Ma=A)||B_()}}function fS(i,o,c,_){dS(hS,Z_.bind(null,i,o,c,_))}function Z_(i,o,c,_){if(Bp){var w;if((w=(o&4)==0)&&0<Qr.length&&-1<B0.indexOf(i))i=N_(null,i,o,c,_),Qr.push(i);else{var A=q_(i,o,c,_);if(A===null)w&&R0(i,_);else{if(w){if(-1<B0.indexOf(i)){i=N_(A,i,o,c,_),Qr.push(i);return}if(tS(A,i,o,c,_))return;R0(i,_)}w1(i,o,_,null,c)}}}}function q_(i,o,c,_){var w=M_(_);if(w=za(w),w!==null){var A=Pa(w);if(A===null)w=null;else{var L=A.tag;if(L===13){if(w=k0(A),w!==null)return w;w=null}else if(L===3){if(A.stateNode.hydrate)return A.tag===3?A.stateNode.containerInfo:null;w=null}else A!==w&&(w=null)}}return w1(i,o,_,w,c),null}var As=null,W_=null,Rp=null;function q0(){if(Rp)return Rp;var i,o=W_,c=o.length,_,w="value"in As?As.value:As.textContent,A=w.length;for(i=0;i<c&&o[i]===w[i];i++);var L=c-i;for(_=1;_<=L&&o[c-_]===w[A-_];_++);return Rp=w.slice(i,1<_?1-_:void 0)}function Fp(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function Op(){return!0}function W0(){return!1}function Qi(i){function o(c,_,w,A,L){this._reactName=c,this._targetInst=w,this.type=_,this.nativeEvent=A,this.target=L,this.currentTarget=null;for(var l in i)i.hasOwnProperty(l)&&(c=i[l],this[l]=c?c(A):A[l]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?Op:W0,this.isPropagationStopped=W0,this}return fn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Op)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Op)},persist:function(){},isPersistent:Op}),o}var cc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},X_=Qi(cc),sh=fn({},cc,{view:0,detail:0}),mS=Qi(sh),H_,Y_,ah,Up=fn({},sh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:J_,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ah&&(ah&&i.type==="mousemove"?(H_=i.screenX-ah.screenX,Y_=i.screenY-ah.screenY):Y_=H_=0,ah=i),H_)},movementY:function(i){return"movementY"in i?i.movementY:Y_}}),X0=Qi(Up),_S=fn({},Up,{dataTransfer:0}),gS=Qi(_S),yS=fn({},sh,{relatedTarget:0}),K_=Qi(yS),vS=fn({},cc,{animationName:0,elapsedTime:0,pseudoElement:0}),xS=Qi(vS),wS=fn({},cc,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),bS=Qi(wS),TS=fn({},cc,{data:0}),H0=Qi(TS),ES={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},SS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AS(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=CS[i])?!!o[i]:!1}function J_(){return AS}var kS=fn({},sh,{key:function(i){if(i.key){var o=ES[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=Fp(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?SS[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:J_,charCode:function(i){return i.type==="keypress"?Fp(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Fp(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),IS=Qi(kS),MS=fn({},Up,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Y0=Qi(MS),PS=fn({},sh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:J_}),zS=Qi(PS),DS=fn({},cc,{propertyName:0,elapsedTime:0,pseudoElement:0}),LS=Qi(DS),BS=fn({},Up,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),RS=Qi(BS),FS=[9,13,27,32],Q_=Po&&"CompositionEvent"in window,lh=null;Po&&"documentMode"in document&&(lh=document.documentMode);var OS=Po&&"TextEvent"in window&&!lh,K0=Po&&(!Q_||lh&&8<lh&&11>=lh),J0=String.fromCharCode(32),Q0=!1;function e1(i,o){switch(i){case"keyup":return FS.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function t1(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var uc=!1;function US(i,o){switch(i){case"compositionend":return t1(o);case"keypress":return o.which!==32?null:(Q0=!0,J0);case"textInput":return i=o.data,i===J0&&Q0?null:i;default:return null}}function NS(i,o){if(uc)return i==="compositionend"||!Q_&&e1(i,o)?(i=q0(),Rp=W_=As=null,uc=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return K0&&o.locale!=="ko"?null:o.data;default:return null}}var VS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function n1(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!VS[i.type]:o==="textarea"}function i1(i,o,c,_){E0(_),o=Vp(o,"onChange"),0<o.length&&(c=new X_("onChange","change",null,c,_),i.push({event:c,listeners:o}))}var ch=null,uh=null;function jS(i){_1(i,0)}function Np(i){var o=mc(i);if(d0(o))return i}function $S(i,o){if(i==="change")return o}var r1=!1;if(Po){var eg;if(Po){var tg="oninput"in document;if(!tg){var o1=document.createElement("div");o1.setAttribute("oninput","return;"),tg=typeof o1.oninput=="function"}eg=tg}else eg=!1;r1=eg&&(!document.documentMode||9<document.documentMode)}function s1(){ch&&(ch.detachEvent("onpropertychange",a1),uh=ch=null)}function a1(i){if(i.propertyName==="value"&&Np(uh)){var o=[];if(i1(o,uh,i,M_(i)),i=jS,Ma)i(o);else{Ma=!0;try{z_(i,o)}finally{Ma=!1,B_()}}}}function GS(i,o,c){i==="focusin"?(s1(),ch=o,uh=c,ch.attachEvent("onpropertychange",a1)):i==="focusout"&&s1()}function ZS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Np(uh)}function qS(i,o){if(i==="click")return Np(o)}function WS(i,o){if(i==="input"||i==="change")return Np(o)}function XS(i,o){return i===o&&(i!==0||1/i==1/o)||i!==i&&o!==o}var dr=typeof Object.is=="function"?Object.is:XS,HS=Object.prototype.hasOwnProperty;function hh(i,o){if(dr(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var c=Object.keys(i),_=Object.keys(o);if(c.length!==_.length)return!1;for(_=0;_<c.length;_++)if(!HS.call(o,c[_])||!dr(i[c[_]],o[c[_]]))return!1;return!0}function l1(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function c1(i,o){var c=l1(i);i=0;for(var _;c;){if(c.nodeType===3){if(_=i+c.textContent.length,i<=o&&_>=o)return{node:c,offset:o-i};i=_}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=l1(c)}}function u1(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?u1(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function h1(){for(var i=window,o=Cp();o instanceof i.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)i=o.contentWindow;else break;o=Cp(i.document)}return o}function ng(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var YS=Po&&"documentMode"in document&&11>=document.documentMode,hc=null,ig=null,dh=null,rg=!1;function d1(i,o,c){var _=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;rg||hc==null||hc!==Cp(_)||(_=hc,"selectionStart"in _&&ng(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),dh&&hh(dh,_)||(dh=_,_=Vp(ig,"onSelect"),0<_.length&&(o=new X_("onSelect","select",null,o,c),i.push({event:o,listeners:_}),o.target=hc)))}$_("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);$_("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);$_(rS,2);for(var p1="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),og=0;og<p1.length;og++)j_.set(p1[og],0);tc("onMouseEnter",["mouseout","mouseover"]);tc("onMouseLeave",["mouseout","mouseover"]);tc("onPointerEnter",["pointerout","pointerover"]);tc("onPointerLeave",["pointerout","pointerover"]);Aa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Aa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Aa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Aa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Aa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Aa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ph="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f1=new Set("cancel close invalid load scroll toggle".split(" ").concat(ph));function m1(i,o,c){var _=i.type||"unknown-event";i.currentTarget=c,QE(_,o,void 0,i),i.currentTarget=null}function _1(i,o){o=(o&4)!=0;for(var c=0;c<i.length;c++){var _=i[c],w=_.event;_=_.listeners;e:{var A=void 0;if(o)for(var L=_.length-1;0<=L;L--){var l=_[L],W=l.instance,_e=l.currentTarget;if(l=l.listener,W!==A&&w.isPropagationStopped())break e;m1(w,l,_e),A=W}else for(L=0;L<_.length;L++){if(l=_[L],W=l.instance,_e=l.currentTarget,l=l.listener,W!==A&&w.isPropagationStopped())break e;m1(w,l,_e),A=W}}}if(Ip)throw i=F_,Ip=!1,F_=null,i}function cn(i,o){var c=A1(o),_=i+"__bubble";c.has(_)||(x1(o,i,2,!1),c.add(_))}var g1="_reactListening"+Math.random().toString(36).slice(2);function y1(i){i[g1]||(i[g1]=!0,o0.forEach(function(o){f1.has(o)||v1(o,!1,i,null),v1(o,!0,i,null)}))}function v1(i,o,c,_){var w=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,A=c;if(i==="selectionchange"&&c.nodeType!==9&&(A=c.ownerDocument),_!==null&&!o&&f1.has(i)){if(i!=="scroll")return;w|=2,A=_}var L=A1(A),l=i+"__"+(o?"capture":"bubble");L.has(l)||(o&&(w|=4),x1(A,i,w,o),L.add(l))}function x1(i,o,c,_){var w=j_.get(o);switch(w===void 0?2:w){case 0:w=pS;break;case 1:w=fS;break;default:w=Z_}c=w.bind(null,o,c,i),w=void 0,!R_||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(w=!0),_?w!==void 0?i.addEventListener(o,c,{capture:!0,passive:w}):i.addEventListener(o,c,!0):w!==void 0?i.addEventListener(o,c,{passive:w}):i.addEventListener(o,c,!1)}function w1(i,o,c,_,w){var A=_;if((o&1)==0&&(o&2)==0&&_!==null)e:for(;;){if(_===null)return;var L=_.tag;if(L===3||L===4){var l=_.stateNode.containerInfo;if(l===w||l.nodeType===8&&l.parentNode===w)break;if(L===4)for(L=_.return;L!==null;){var W=L.tag;if((W===3||W===4)&&(W=L.stateNode.containerInfo,W===w||W.nodeType===8&&W.parentNode===w))return;L=L.return}for(;l!==null;){if(L=za(l),L===null)return;if(W=L.tag,W===5||W===6){_=A=L;continue e}l=l.parentNode}}_=_.return}HE(function(){var _e=A,ve=M_(c),he=[];e:{var ne=G0.get(i);if(ne!==void 0){var Me=X_,tt=i;switch(i){case"keypress":if(Fp(c)===0)break e;case"keydown":case"keyup":Me=IS;break;case"focusin":tt="focus",Me=K_;break;case"focusout":tt="blur",Me=K_;break;case"beforeblur":case"afterblur":Me=K_;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Me=X0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Me=gS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Me=zS;break;case N0:case V0:case j0:Me=xS;break;case $0:Me=LS;break;case"scroll":Me=mS;break;case"wheel":Me=RS;break;case"copy":case"cut":case"paste":Me=bS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Me=Y0}var nt=(o&4)!=0,de=!nt&&i==="scroll",te=nt?ne!==null?ne+"Capture":null:ne;nt=[];for(var ae=_e,De;ae!==null;){De=ae;var Le=De.stateNode;if(De.tag===5&&Le!==null&&(De=Le,te!==null&&(Le=Ku(ae,te),Le!=null&&nt.push(fh(ae,Le,De)))),de)break;ae=ae.return}0<nt.length&&(ne=new Me(ne,tt,null,c,ve),he.push({event:ne,listeners:nt}))}}if((o&7)==0){e:{if(ne=i==="mouseover"||i==="pointerover",Me=i==="mouseout"||i==="pointerout",ne&&(o&16)==0&&(tt=c.relatedTarget||c.fromElement)&&(za(tt)||tt[fc]))break e;if((Me||ne)&&(ne=ve.window===ve?ve:(ne=ve.ownerDocument)?ne.defaultView||ne.parentWindow:window,Me?(tt=c.relatedTarget||c.toElement,Me=_e,tt=tt?za(tt):null,tt!==null&&(de=Pa(tt),tt!==de||tt.tag!==5&&tt.tag!==6)&&(tt=null)):(Me=null,tt=_e),Me!==tt)){if(nt=X0,Le="onMouseLeave",te="onMouseEnter",ae="mouse",(i==="pointerout"||i==="pointerover")&&(nt=Y0,Le="onPointerLeave",te="onPointerEnter",ae="pointer"),de=Me==null?ne:mc(Me),De=tt==null?ne:mc(tt),ne=new nt(Le,ae+"leave",Me,c,ve),ne.target=de,ne.relatedTarget=De,Le=null,za(ve)===_e&&(nt=new nt(te,ae+"enter",tt,c,ve),nt.target=De,nt.relatedTarget=de,Le=nt),de=Le,Me&&tt)t:{for(nt=Me,te=tt,ae=0,De=nt;De;De=dc(De))ae++;for(De=0,Le=te;Le;Le=dc(Le))De++;for(;0<ae-De;)nt=dc(nt),ae--;for(;0<De-ae;)te=dc(te),De--;for(;ae--;){if(nt===te||te!==null&&nt===te.alternate)break t;nt=dc(nt),te=dc(te)}nt=null}else nt=null;Me!==null&&b1(he,ne,Me,nt,!1),tt!==null&&de!==null&&b1(he,de,tt,nt,!0)}}e:{if(ne=_e?mc(_e):window,Me=ne.nodeName&&ne.nodeName.toLowerCase(),Me==="select"||Me==="input"&&ne.type==="file")var lt=$S;else if(n1(ne))if(r1)lt=WS;else{lt=ZS;var He=GS}else(Me=ne.nodeName)&&Me.toLowerCase()==="input"&&(ne.type==="checkbox"||ne.type==="radio")&&(lt=qS);if(lt&&(lt=lt(i,_e))){i1(he,lt,c,ve);break e}He&&He(i,ne,_e),i==="focusout"&&(He=ne._wrapperState)&&He.controlled&&ne.type==="number"&&T_(ne,"number",ne.value)}switch(He=_e?mc(_e):window,i){case"focusin":(n1(He)||He.contentEditable==="true")&&(hc=He,ig=_e,dh=null);break;case"focusout":dh=ig=hc=null;break;case"mousedown":rg=!0;break;case"contextmenu":case"mouseup":case"dragend":rg=!1,d1(he,c,ve);break;case"selectionchange":if(YS)break;case"keydown":case"keyup":d1(he,c,ve)}var Ke;if(Q_)e:{switch(i){case"compositionstart":var pt="onCompositionStart";break e;case"compositionend":pt="onCompositionEnd";break e;case"compositionupdate":pt="onCompositionUpdate";break e}pt=void 0}else uc?e1(i,c)&&(pt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(pt="onCompositionStart");pt&&(K0&&c.locale!=="ko"&&(uc||pt!=="onCompositionStart"?pt==="onCompositionEnd"&&uc&&(Ke=q0()):(As=ve,W_="value"in As?As.value:As.textContent,uc=!0)),He=Vp(_e,pt),0<He.length&&(pt=new H0(pt,i,null,c,ve),he.push({event:pt,listeners:He}),Ke?pt.data=Ke:(Ke=t1(c),Ke!==null&&(pt.data=Ke)))),(Ke=OS?US(i,c):NS(i,c))&&(_e=Vp(_e,"onBeforeInput"),0<_e.length&&(ve=new H0("onBeforeInput","beforeinput",null,c,ve),he.push({event:ve,listeners:_e}),ve.data=Ke))}_1(he,o)})}function fh(i,o,c){return{instance:i,listener:o,currentTarget:c}}function Vp(i,o){for(var c=o+"Capture",_=[];i!==null;){var w=i,A=w.stateNode;w.tag===5&&A!==null&&(w=A,A=Ku(i,c),A!=null&&_.unshift(fh(i,A,w)),A=Ku(i,o),A!=null&&_.push(fh(i,A,w))),i=i.return}return _}function dc(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function b1(i,o,c,_,w){for(var A=o._reactName,L=[];c!==null&&c!==_;){var l=c,W=l.alternate,_e=l.stateNode;if(W!==null&&W===_)break;l.tag===5&&_e!==null&&(l=_e,w?(W=Ku(c,A),W!=null&&L.unshift(fh(c,W,l))):w||(W=Ku(c,A),W!=null&&L.push(fh(c,W,l)))),c=c.return}L.length!==0&&i.push({event:o,listeners:L})}function jp(){}var sg=null,ag=null;function T1(i,o){switch(i){case"button":case"input":case"select":case"textarea":return!!o.autoFocus}return!1}function lg(i,o){return i==="textarea"||i==="option"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var E1=typeof setTimeout=="function"?setTimeout:void 0,KS=typeof clearTimeout=="function"?clearTimeout:void 0;function cg(i){i.nodeType===1?i.textContent="":i.nodeType===9&&(i=i.body,i!=null&&(i.textContent=""))}function pc(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break}return i}function S1(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return i;o--}else c==="/$"&&o++}i=i.previousSibling}return null}var ug=0;function JS(i){return{$$typeof:__,toString:i,valueOf:i}}var $p=Math.random().toString(36).slice(2),ks="__reactFiber$"+$p,Gp="__reactProps$"+$p,fc="__reactContainer$"+$p,C1="__reactEvents$"+$p;function za(i){var o=i[ks];if(o)return o;for(var c=i.parentNode;c;){if(o=c[fc]||c[ks]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(i=S1(i);i!==null;){if(c=i[ks])return c;i=S1(i)}return o}i=c,c=i.parentNode}return null}function mh(i){return i=i[ks]||i[fc],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function mc(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Ye(33))}function Zp(i){return i[Gp]||null}function A1(i){var o=i[C1];return o===void 0&&(o=i[C1]=new Set),o}var hg=[],_c=-1;function Is(i){return{current:i}}function un(i){0>_c||(i.current=hg[_c],hg[_c]=null,_c--)}function An(i,o){_c++,hg[_c]=i.current,i.current=o}var Ms={},li=Is(Ms),Bi=Is(!1),Da=Ms;function gc(i,o){var c=i.type.contextTypes;if(!c)return Ms;var _=i.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===o)return _.__reactInternalMemoizedMaskedChildContext;var w={},A;for(A in c)w[A]=o[A];return _&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=w),w}function Ri(i){return i=i.childContextTypes,i!=null}function qp(){un(Bi),un(li)}function k1(i,o,c){if(li.current!==Ms)throw Error(Ye(168));An(li,o),An(Bi,c)}function I1(i,o,c){var _=i.stateNode;if(i=o.childContextTypes,typeof _.getChildContext!="function")return c;_=_.getChildContext();for(var w in _)if(!(w in i))throw Error(Ye(108,nc(o)||"Unknown",w));return fn({},c,_)}function Wp(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Ms,Da=li.current,An(li,i),An(Bi,Bi.current),!0}function M1(i,o,c){var _=i.stateNode;if(!_)throw Error(Ye(169));c?(i=I1(i,o,Da),_.__reactInternalMemoizedMergedChildContext=i,un(Bi),un(li),An(li,i)):un(Bi),An(Bi,c)}var dg=null,La=null,QS=Wn.unstable_runWithPriority,pg=Wn.unstable_scheduleCallback,fg=Wn.unstable_cancelCallback,eC=Wn.unstable_shouldYield,P1=Wn.unstable_requestPaint,mg=Wn.unstable_now,tC=Wn.unstable_getCurrentPriorityLevel,Xp=Wn.unstable_ImmediatePriority,z1=Wn.unstable_UserBlockingPriority,D1=Wn.unstable_NormalPriority,L1=Wn.unstable_LowPriority,B1=Wn.unstable_IdlePriority,_g={},nC=P1!==void 0?P1:function(){},zo=null,Hp=null,gg=!1,R1=mg(),ci=1e4>R1?mg:function(){return mg()-R1};function yc(){switch(tC()){case Xp:return 99;case z1:return 98;case D1:return 97;case L1:return 96;case B1:return 95;default:throw Error(Ye(332))}}function F1(i){switch(i){case 99:return Xp;case 98:return z1;case 97:return D1;case 96:return L1;case 95:return B1;default:throw Error(Ye(332))}}function Ba(i,o){return i=F1(i),QS(i,o)}function _h(i,o,c){return i=F1(i),pg(i,o,c)}function eo(){if(Hp!==null){var i=Hp;Hp=null,fg(i)}O1()}function O1(){if(!gg&&zo!==null){gg=!0;var i=0;try{var o=zo;Ba(99,function(){for(;i<o.length;i++){var c=o[i];do c=c(!0);while(c!==null)}}),zo=null}catch(c){throw zo!==null&&(zo=zo.slice(i+1)),pg(Xp,eo),c}finally{gg=!1}}}var iC=ka.ReactCurrentBatchConfig;function Ar(i,o){if(i&&i.defaultProps){o=fn({},o),i=i.defaultProps;for(var c in i)o[c]===void 0&&(o[c]=i[c]);return o}return o}var Yp=Is(null),Kp=null,vc=null,Jp=null;function yg(){Jp=vc=Kp=null}function vg(i){var o=Yp.current;un(Yp),i.type._context._currentValue=o}function U1(i,o){for(;i!==null;){var c=i.alternate;if((i.childLanes&o)===o){if(c===null||(c.childLanes&o)===o)break;c.childLanes|=o}else i.childLanes|=o,c!==null&&(c.childLanes|=o);i=i.return}}function xc(i,o){Kp=i,Jp=vc=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&o)!=0&&(kr=!0),i.firstContext=null)}function pr(i,o){if(Jp!==i&&o!==!1&&o!==0)if((typeof o!="number"||o===1073741823)&&(Jp=i,o=1073741823),o={context:i,observedBits:o,next:null},vc===null){if(Kp===null)throw Error(Ye(308));vc=o,Kp.dependencies={lanes:0,firstContext:o,responders:null}}else vc=vc.next=o;return i._currentValue}var Ps=!1;function xg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function N1(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function zs(i,o){return{eventTime:i,lane:o,tag:0,payload:null,callback:null,next:null}}function Ds(i,o){if(i=i.updateQueue,i!==null){i=i.shared;var c=i.pending;c===null?o.next=o:(o.next=c.next,c.next=o),i.pending=o}}function V1(i,o){var c=i.updateQueue,_=i.alternate;if(_!==null&&(_=_.updateQueue,c===_)){var w=null,A=null;if(c=c.firstBaseUpdate,c!==null){do{var L={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};A===null?w=A=L:A=A.next=L,c=c.next}while(c!==null);A===null?w=A=o:A=A.next=o}else w=A=o;c={baseState:_.baseState,firstBaseUpdate:w,lastBaseUpdate:A,shared:_.shared,effects:_.effects},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=o:i.next=o,c.lastBaseUpdate=o}function gh(i,o,c,_){var w=i.updateQueue;Ps=!1;var A=w.firstBaseUpdate,L=w.lastBaseUpdate,l=w.shared.pending;if(l!==null){w.shared.pending=null;var W=l,_e=W.next;W.next=null,L===null?A=_e:L.next=_e,L=W;var ve=i.alternate;if(ve!==null){ve=ve.updateQueue;var he=ve.lastBaseUpdate;he!==L&&(he===null?ve.firstBaseUpdate=_e:he.next=_e,ve.lastBaseUpdate=W)}}if(A!==null){he=w.baseState,L=0,ve=_e=W=null;do{l=A.lane;var ne=A.eventTime;if((_&l)===l){ve!==null&&(ve=ve.next={eventTime:ne,lane:0,tag:A.tag,payload:A.payload,callback:A.callback,next:null});e:{var Me=i,tt=A;switch(l=o,ne=c,tt.tag){case 1:if(Me=tt.payload,typeof Me=="function"){he=Me.call(ne,he,l);break e}he=Me;break e;case 3:Me.flags=Me.flags&-4097|64;case 0:if(Me=tt.payload,l=typeof Me=="function"?Me.call(ne,he,l):Me,l==null)break e;he=fn({},he,l);break e;case 2:Ps=!0}}A.callback!==null&&(i.flags|=32,l=w.effects,l===null?w.effects=[A]:l.push(A))}else ne={eventTime:ne,lane:l,tag:A.tag,payload:A.payload,callback:A.callback,next:null},ve===null?(_e=ve=ne,W=he):ve=ve.next=ne,L|=l;if(A=A.next,A===null){if(l=w.shared.pending,l===null)break;A=l.next,l.next=null,w.lastBaseUpdate=l,w.shared.pending=null}}while(1);ve===null&&(W=he),w.baseState=W,w.firstBaseUpdate=_e,w.lastBaseUpdate=ve,Ih|=L,i.lanes=L,i.memoizedState=he}}function j1(i,o,c){if(i=o.effects,o.effects=null,i!==null)for(o=0;o<i.length;o++){var _=i[o],w=_.callback;if(w!==null){if(_.callback=null,_=c,typeof w!="function")throw Error(Ye(191,w));w.call(_)}}}var $1=new xp.Component().refs;function Qp(i,o,c,_){o=i.memoizedState,c=c(_,o),c=c==null?o:fn({},o,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var ef={isMounted:function(i){return(i=i._reactInternals)?Pa(i)===i:!1},enqueueSetState:function(i,o,c){i=i._reactInternals;var _=er(),w=Rs(i),A=zs(_,w);A.payload=o,c!=null&&(A.callback=c),Ds(i,A),Fs(i,w,_)},enqueueReplaceState:function(i,o,c){i=i._reactInternals;var _=er(),w=Rs(i),A=zs(_,w);A.tag=1,A.payload=o,c!=null&&(A.callback=c),Ds(i,A),Fs(i,w,_)},enqueueForceUpdate:function(i,o){i=i._reactInternals;var c=er(),_=Rs(i),w=zs(c,_);w.tag=2,o!=null&&(w.callback=o),Ds(i,w),Fs(i,_,c)}};function G1(i,o,c,_,w,A,L){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(_,A,L):o.prototype&&o.prototype.isPureReactComponent?!hh(c,_)||!hh(w,A):!0}function Z1(i,o,c){var _=!1,w=Ms,A=o.contextType;return typeof A=="object"&&A!==null?A=pr(A):(w=Ri(o)?Da:li.current,_=o.contextTypes,A=(_=_!=null)?gc(i,w):Ms),o=new o(c,A),i.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=ef,i.stateNode=o,o._reactInternals=i,_&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=w,i.__reactInternalMemoizedMaskedChildContext=A),o}function q1(i,o,c,_){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,_),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,_),o.state!==i&&ef.enqueueReplaceState(o,o.state,null)}function wg(i,o,c,_){var w=i.stateNode;w.props=c,w.state=i.memoizedState,w.refs=$1,xg(i);var A=o.contextType;typeof A=="object"&&A!==null?w.context=pr(A):(A=Ri(o)?Da:li.current,w.context=gc(i,A)),gh(i,c,w,_),w.state=i.memoizedState,A=o.getDerivedStateFromProps,typeof A=="function"&&(Qp(i,o,A,c),w.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(o=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),o!==w.state&&ef.enqueueReplaceState(w,w.state,null),gh(i,c,w,_),w.state=i.memoizedState),typeof w.componentDidMount=="function"&&(i.flags|=4)}var tf=Array.isArray;function yh(i,o,c){if(i=c.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(Ye(309));var _=c.stateNode}if(!_)throw Error(Ye(147,i));var w=""+i;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===w?o.ref:(o=function(A){var L=_.refs;L===$1&&(L=_.refs={}),A===null?delete L[w]:L[w]=A},o._stringRef=w,o)}if(typeof i!="string")throw Error(Ye(284));if(!c._owner)throw Error(Ye(290,i))}return i}function nf(i,o){if(i.type!=="textarea")throw Error(Ye(31,Object.prototype.toString.call(o)==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":o))}function W1(i){function o(de,te){if(i){var ae=de.lastEffect;ae!==null?(ae.nextEffect=te,de.lastEffect=te):de.firstEffect=de.lastEffect=te,te.nextEffect=null,te.flags=8}}function c(de,te){if(!i)return null;for(;te!==null;)o(de,te),te=te.sibling;return null}function _(de,te){for(de=new Map;te!==null;)te.key!==null?de.set(te.key,te):de.set(te.index,te),te=te.sibling;return de}function w(de,te){return de=Ns(de,te),de.index=0,de.sibling=null,de}function A(de,te,ae){return de.index=ae,i?(ae=de.alternate,ae!==null?(ae=ae.index,ae<te?(de.flags=2,te):ae):(de.flags=2,te)):te}function L(de){return i&&de.alternate===null&&(de.flags=2),de}function l(de,te,ae,De){return te===null||te.tag!==6?(te=iy(ae,de.mode,De),te.return=de,te):(te=w(te,ae),te.return=de,te)}function W(de,te,ae,De){return te!==null&&te.elementType===ae.type?(De=w(te,ae.props),De.ref=yh(de,te,ae),De.return=de,De):(De=wf(ae.type,ae.key,ae.props,null,de.mode,De),De.ref=yh(de,te,ae),De.return=de,De)}function _e(de,te,ae,De){return te===null||te.tag!==4||te.stateNode.containerInfo!==ae.containerInfo||te.stateNode.implementation!==ae.implementation?(te=ry(ae,de.mode,De),te.return=de,te):(te=w(te,ae.children||[]),te.return=de,te)}function ve(de,te,ae,De,Le){return te===null||te.tag!==7?(te=kc(ae,de.mode,De,Le),te.return=de,te):(te=w(te,ae),te.return=de,te)}function he(de,te,ae){if(typeof te=="string"||typeof te=="number")return te=iy(""+te,de.mode,ae),te.return=de,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case Gu:return ae=wf(te.type,te.key,te.props,null,de.mode,ae),ae.ref=yh(de,null,te),ae.return=de,ae;case Ia:return te=ry(te,de.mode,ae),te.return=de,te}if(tf(te)||Wu(te))return te=kc(te,de.mode,ae,null),te.return=de,te;nf(de,te)}return null}function ne(de,te,ae,De){var Le=te!==null?te.key:null;if(typeof ae=="string"||typeof ae=="number")return Le!==null?null:l(de,te,""+ae,De);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case Gu:return ae.key===Le?ae.type===ws?ve(de,te,ae.props.children,De,Le):W(de,te,ae,De):null;case Ia:return ae.key===Le?_e(de,te,ae,De):null}if(tf(ae)||Wu(ae))return Le!==null?null:ve(de,te,ae,De,null);nf(de,ae)}return null}function Me(de,te,ae,De,Le){if(typeof De=="string"||typeof De=="number")return de=de.get(ae)||null,l(te,de,""+De,Le);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case Gu:return de=de.get(De.key===null?ae:De.key)||null,De.type===ws?ve(te,de,De.props.children,Le,De.key):W(te,de,De,Le);case Ia:return de=de.get(De.key===null?ae:De.key)||null,_e(te,de,De,Le)}if(tf(De)||Wu(De))return de=de.get(ae)||null,ve(te,de,De,Le,null);nf(te,De)}return null}function tt(de,te,ae,De){for(var Le=null,lt=null,He=te,Ke=te=0,pt=null;He!==null&&Ke<ae.length;Ke++){He.index>Ke?(pt=He,He=null):pt=He.sibling;var st=ne(de,He,ae[Ke],De);if(st===null){He===null&&(He=pt);break}i&&He&&st.alternate===null&&o(de,He),te=A(st,te,Ke),lt===null?Le=st:lt.sibling=st,lt=st,He=pt}if(Ke===ae.length)return c(de,He),Le;if(He===null){for(;Ke<ae.length;Ke++)He=he(de,ae[Ke],De),He!==null&&(te=A(He,te,Ke),lt===null?Le=He:lt.sibling=He,lt=He);return Le}for(He=_(de,He);Ke<ae.length;Ke++)pt=Me(He,de,Ke,ae[Ke],De),pt!==null&&(i&&pt.alternate!==null&&He.delete(pt.key===null?Ke:pt.key),te=A(pt,te,Ke),lt===null?Le=pt:lt.sibling=pt,lt=pt);return i&&He.forEach(function(on){return o(de,on)}),Le}function nt(de,te,ae,De){var Le=Wu(ae);if(typeof Le!="function")throw Error(Ye(150));if(ae=Le.call(ae),ae==null)throw Error(Ye(151));for(var lt=Le=null,He=te,Ke=te=0,pt=null,st=ae.next();He!==null&&!st.done;Ke++,st=ae.next()){He.index>Ke?(pt=He,He=null):pt=He.sibling;var on=ne(de,He,st.value,De);if(on===null){He===null&&(He=pt);break}i&&He&&on.alternate===null&&o(de,He),te=A(on,te,Ke),lt===null?Le=on:lt.sibling=on,lt=on,He=pt}if(st.done)return c(de,He),Le;if(He===null){for(;!st.done;Ke++,st=ae.next())st=he(de,st.value,De),st!==null&&(te=A(st,te,Ke),lt===null?Le=st:lt.sibling=st,lt=st);return Le}for(He=_(de,He);!st.done;Ke++,st=ae.next())st=Me(He,de,Ke,st.value,De),st!==null&&(i&&st.alternate!==null&&He.delete(st.key===null?Ke:st.key),te=A(st,te,Ke),lt===null?Le=st:lt.sibling=st,lt=st);return i&&He.forEach(function(tn){return o(de,tn)}),Le}return function(de,te,ae,De){var Le=typeof ae=="object"&&ae!==null&&ae.type===ws&&ae.key===null;Le&&(ae=ae.props.children);var lt=typeof ae=="object"&&ae!==null;if(lt)switch(ae.$$typeof){case Gu:e:{for(lt=ae.key,Le=te;Le!==null;){if(Le.key===lt){switch(Le.tag){case 7:if(ae.type===ws){c(de,Le.sibling),te=w(Le,ae.props.children),te.return=de,de=te;break e}break;default:if(Le.elementType===ae.type){c(de,Le.sibling),te=w(Le,ae.props),te.ref=yh(de,Le,ae),te.return=de,de=te;break e}}c(de,Le);break}else o(de,Le);Le=Le.sibling}ae.type===ws?(te=kc(ae.props.children,de.mode,De,ae.key),te.return=de,de=te):(De=wf(ae.type,ae.key,ae.props,null,de.mode,De),De.ref=yh(de,te,ae),De.return=de,de=De)}return L(de);case Ia:e:{for(Le=ae.key;te!==null;){if(te.key===Le)if(te.tag===4&&te.stateNode.containerInfo===ae.containerInfo&&te.stateNode.implementation===ae.implementation){c(de,te.sibling),te=w(te,ae.children||[]),te.return=de,de=te;break e}else{c(de,te);break}else o(de,te);te=te.sibling}te=ry(ae,de.mode,De),te.return=de,de=te}return L(de)}if(typeof ae=="string"||typeof ae=="number")return ae=""+ae,te!==null&&te.tag===6?(c(de,te.sibling),te=w(te,ae),te.return=de,de=te):(c(de,te),te=iy(ae,de.mode,De),te.return=de,de=te),L(de);if(tf(ae))return tt(de,te,ae,De);if(Wu(ae))return nt(de,te,ae,De);if(lt&&nf(de,ae),typeof ae=="undefined"&&!Le)switch(de.tag){case 1:case 22:case 0:case 11:case 15:throw Error(Ye(152,nc(de.type)||"Component"))}return c(de,te)}}var rf=W1(!0),X1=W1(!1),vh={},to=Is(vh),xh=Is(vh),wh=Is(vh);function Ra(i){if(i===vh)throw Error(Ye(174));return i}function bg(i,o){switch(An(wh,o),An(xh,i),An(to,vh),i=o.nodeType,i){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:A_(null,"");break;default:i=i===8?o.parentNode:o,o=i.namespaceURI||null,i=i.tagName,o=A_(o,i)}un(to),An(to,o)}function wc(){un(to),un(xh),un(wh)}function H1(i){Ra(wh.current);var o=Ra(to.current),c=A_(o,i.type);o!==c&&(An(xh,i),An(to,c))}function Tg(i){xh.current===i&&(un(to),un(xh))}var kn=Is(0);function of(i){for(var o=i;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&64)!=0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Do=null,Ls=null,no=!1;function Y1(i,o){var c=_r(5,null,null,0);c.elementType="DELETED",c.type="DELETED",c.stateNode=o,c.return=i,c.flags=8,i.lastEffect!==null?(i.lastEffect.nextEffect=c,i.lastEffect=c):i.firstEffect=i.lastEffect=c}function K1(i,o){switch(i.tag){case 5:var c=i.type;return o=o.nodeType!==1||c.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(i.stateNode=o,!0):!1;case 6:return o=i.pendingProps===""||o.nodeType!==3?null:o,o!==null?(i.stateNode=o,!0):!1;case 13:return!1;default:return!1}}function Eg(i){if(no){var o=Ls;if(o){var c=o;if(!K1(i,o)){if(o=pc(c.nextSibling),!o||!K1(i,o)){i.flags=i.flags&-1025|2,no=!1,Do=i;return}Y1(Do,c)}Do=i,Ls=pc(o.firstChild)}else i.flags=i.flags&-1025|2,no=!1,Do=i}}function J1(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Do=i}function sf(i){if(i!==Do)return!1;if(!no)return J1(i),no=!0,!1;var o=i.type;if(i.tag!==5||o!=="head"&&o!=="body"&&!lg(o,i.memoizedProps))for(o=Ls;o;)Y1(i,o),o=pc(o.nextSibling);if(J1(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ye(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"){if(o===0){Ls=pc(i.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++}i=i.nextSibling}Ls=null}}else Ls=Do?pc(i.stateNode.nextSibling):null;return!0}function Sg(){Ls=Do=null,no=!1}var bc=[];function Cg(){for(var i=0;i<bc.length;i++)bc[i]._workInProgressVersionPrimary=null;bc.length=0}var bh=ka.ReactCurrentDispatcher,fr=ka.ReactCurrentBatchConfig,Th=0,zn=null,ui=null,ti=null,af=!1,Eh=!1;function Fi(){throw Error(Ye(321))}function Ag(i,o){if(o===null)return!1;for(var c=0;c<o.length&&c<i.length;c++)if(!dr(i[c],o[c]))return!1;return!0}function kg(i,o,c,_,w,A){if(Th=A,zn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,bh.current=i===null||i.memoizedState===null?oC:sC,i=c(_,w),Eh){A=0;do{if(Eh=!1,!(25>A))throw Error(Ye(301));A+=1,ti=ui=null,o.updateQueue=null,bh.current=aC,i=c(_,w)}while(Eh)}if(bh.current=hf,o=ui!==null&&ui.next!==null,Th=0,ti=ui=zn=null,af=!1,o)throw Error(Ye(300));return i}function Fa(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ti===null?zn.memoizedState=ti=i:ti=ti.next=i,ti}function Oa(){if(ui===null){var i=zn.alternate;i=i!==null?i.memoizedState:null}else i=ui.next;var o=ti===null?zn.memoizedState:ti.next;if(o!==null)ti=o,ui=i;else{if(i===null)throw Error(Ye(310));ui=i,i={memoizedState:ui.memoizedState,baseState:ui.baseState,baseQueue:ui.baseQueue,queue:ui.queue,next:null},ti===null?zn.memoizedState=ti=i:ti=ti.next=i}return ti}function io(i,o){return typeof o=="function"?o(i):o}function Sh(i){var o=Oa(),c=o.queue;if(c===null)throw Error(Ye(311));c.lastRenderedReducer=i;var _=ui,w=_.baseQueue,A=c.pending;if(A!==null){if(w!==null){var L=w.next;w.next=A.next,A.next=L}_.baseQueue=w=A,c.pending=null}if(w!==null){w=w.next,_=_.baseState;var l=L=A=null,W=w;do{var _e=W.lane;if((Th&_e)===_e)l!==null&&(l=l.next={lane:0,action:W.action,eagerReducer:W.eagerReducer,eagerState:W.eagerState,next:null}),_=W.eagerReducer===i?W.eagerState:i(_,W.action);else{var ve={lane:_e,action:W.action,eagerReducer:W.eagerReducer,eagerState:W.eagerState,next:null};l===null?(L=l=ve,A=_):l=l.next=ve,zn.lanes|=_e,Ih|=_e}W=W.next}while(W!==null&&W!==w);l===null?A=_:l.next=L,dr(_,o.memoizedState)||(kr=!0),o.memoizedState=_,o.baseState=A,o.baseQueue=l,c.lastRenderedState=_}return[o.memoizedState,c.dispatch]}function Ch(i){var o=Oa(),c=o.queue;if(c===null)throw Error(Ye(311));c.lastRenderedReducer=i;var _=c.dispatch,w=c.pending,A=o.memoizedState;if(w!==null){c.pending=null;var L=w=w.next;do A=i(A,L.action),L=L.next;while(L!==w);dr(A,o.memoizedState)||(kr=!0),o.memoizedState=A,o.baseQueue===null&&(o.baseState=A),c.lastRenderedState=A}return[A,_]}function Q1(i,o,c){var _=o._getVersion;_=_(o._source);var w=o._workInProgressVersionPrimary;if(w!==null?i=w===_:(i=i.mutableReadLanes,(i=(Th&i)===i)&&(o._workInProgressVersionPrimary=_,bc.push(o))),i)return c(o._source);throw bc.push(o),Error(Ye(350))}function ew(i,o,c,_){var w=Ei;if(w===null)throw Error(Ye(349));var A=o._getVersion,L=A(o._source),l=bh.current,W=l.useState(function(){return Q1(w,o,c)}),_e=W[1],ve=W[0];W=ti;var he=i.memoizedState,ne=he.refs,Me=ne.getSnapshot,tt=he.source;he=he.subscribe;var nt=zn;return i.memoizedState={refs:ne,source:o,subscribe:_},l.useEffect(function(){ne.getSnapshot=c,ne.setSnapshot=_e;var de=A(o._source);if(!dr(L,de)){de=c(o._source),dr(ve,de)||(_e(de),de=Rs(nt),w.mutableReadLanes|=de&w.pendingLanes),de=w.mutableReadLanes,w.entangledLanes|=de;for(var te=w.entanglements,ae=de;0<ae;){var De=31-Cs(ae),Le=1<<De;te[De]|=de,ae&=~Le}}},[c,o,_]),l.useEffect(function(){return _(o._source,function(){var de=ne.getSnapshot,te=ne.setSnapshot;try{te(de(o._source));var ae=Rs(nt);w.mutableReadLanes|=ae&w.pendingLanes}catch(De){te(function(){throw De})}})},[o,_]),dr(Me,c)&&dr(tt,o)&&dr(he,_)||(i={pending:null,dispatch:null,lastRenderedReducer:io,lastRenderedState:ve},i.dispatch=_e=zg.bind(null,zn,i),W.queue=i,W.baseQueue=null,ve=Q1(w,o,c),W.memoizedState=W.baseState=ve),ve}function tw(i,o,c){var _=Oa();return ew(_,i,o,c)}function Ah(i){var o=Fa();return typeof i=="function"&&(i=i()),o.memoizedState=o.baseState=i,i=o.queue={pending:null,dispatch:null,lastRenderedReducer:io,lastRenderedState:i},i=i.dispatch=zg.bind(null,zn,i),[o.memoizedState,i]}function lf(i,o,c,_){return i={tag:i,create:o,destroy:c,deps:_,next:null},o=zn.updateQueue,o===null?(o={lastEffect:null},zn.updateQueue=o,o.lastEffect=i.next=i):(c=o.lastEffect,c===null?o.lastEffect=i.next=i:(_=c.next,c.next=i,i.next=_,o.lastEffect=i)),i}function nw(i){var o=Fa();return i={current:i},o.memoizedState=i}function cf(){return Oa().memoizedState}function Ig(i,o,c,_){var w=Fa();zn.flags|=i,w.memoizedState=lf(1|o,c,void 0,_===void 0?null:_)}function Mg(i,o,c,_){var w=Oa();_=_===void 0?null:_;var A=void 0;if(ui!==null){var L=ui.memoizedState;if(A=L.destroy,_!==null&&Ag(_,L.deps)){lf(o,c,A,_);return}}zn.flags|=i,w.memoizedState=lf(1|o,c,A,_)}function iw(i,o){return Ig(516,4,i,o)}function uf(i,o){return Mg(516,4,i,o)}function rw(i,o){return Mg(4,2,i,o)}function ow(i,o){if(typeof o=="function")return i=i(),o(i),function(){o(null)};if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function sw(i,o,c){return c=c!=null?c.concat([i]):null,Mg(4,2,ow.bind(null,o,i),c)}function Pg(){}function aw(i,o){var c=Oa();o=o===void 0?null:o;var _=c.memoizedState;return _!==null&&o!==null&&Ag(o,_[1])?_[0]:(c.memoizedState=[i,o],i)}function lw(i,o){var c=Oa();o=o===void 0?null:o;var _=c.memoizedState;return _!==null&&o!==null&&Ag(o,_[1])?_[0]:(i=i(),c.memoizedState=[i,o],i)}function rC(i,o){var c=yc();Ba(98>c?98:c,function(){i(!0)}),Ba(97<c?97:c,function(){var _=fr.transition;fr.transition=1;try{i(!1),o()}finally{fr.transition=_}})}function zg(i,o,c){var _=er(),w=Rs(i),A={lane:w,action:c,eagerReducer:null,eagerState:null,next:null},L=o.pending;if(L===null?A.next=A:(A.next=L.next,L.next=A),o.pending=A,L=i.alternate,i===zn||L!==null&&L===zn)Eh=af=!0;else{if(i.lanes===0&&(L===null||L.lanes===0)&&(L=o.lastRenderedReducer,L!==null))try{var l=o.lastRenderedState,W=L(l,c);if(A.eagerReducer=L,A.eagerState=W,dr(W,l))return}catch{}finally{}Fs(i,w,_)}}var hf={readContext:pr,useCallback:Fi,useContext:Fi,useEffect:Fi,useImperativeHandle:Fi,useLayoutEffect:Fi,useMemo:Fi,useReducer:Fi,useRef:Fi,useState:Fi,useDebugValue:Fi,useDeferredValue:Fi,useTransition:Fi,useMutableSource:Fi,useOpaqueIdentifier:Fi,unstable_isNewReconciler:!1},oC={readContext:pr,useCallback:function(i,o){return Fa().memoizedState=[i,o===void 0?null:o],i},useContext:pr,useEffect:iw,useImperativeHandle:function(i,o,c){return c=c!=null?c.concat([i]):null,Ig(4,2,ow.bind(null,o,i),c)},useLayoutEffect:function(i,o){return Ig(4,2,i,o)},useMemo:function(i,o){var c=Fa();return o=o===void 0?null:o,i=i(),c.memoizedState=[i,o],i},useReducer:function(i,o,c){var _=Fa();return o=c!==void 0?c(o):o,_.memoizedState=_.baseState=o,i=_.queue={pending:null,dispatch:null,lastRenderedReducer:i,lastRenderedState:o},i=i.dispatch=zg.bind(null,zn,i),[_.memoizedState,i]},useRef:nw,useState:Ah,useDebugValue:Pg,useDeferredValue:function(i){var o=Ah(i),c=o[0],_=o[1];return iw(function(){var w=fr.transition;fr.transition=1;try{_(i)}finally{fr.transition=w}},[i]),c},useTransition:function(){var i=Ah(!1),o=i[0];return i=rC.bind(null,i[1]),nw(i),[i,o]},useMutableSource:function(i,o,c){var _=Fa();return _.memoizedState={refs:{getSnapshot:o,setSnapshot:null},source:i,subscribe:c},ew(_,i,o,c)},useOpaqueIdentifier:function(){if(no){var i=!1,o=JS(function(){throw i||(i=!0,c("r:"+(ug++).toString(36))),Error(Ye(355))}),c=Ah(o)[1];return(zn.mode&2)==0&&(zn.flags|=516,lf(5,function(){c("r:"+(ug++).toString(36))},void 0,null)),o}return o="r:"+(ug++).toString(36),Ah(o),o},unstable_isNewReconciler:!1},sC={readContext:pr,useCallback:aw,useContext:pr,useEffect:uf,useImperativeHandle:sw,useLayoutEffect:rw,useMemo:lw,useReducer:Sh,useRef:cf,useState:function(){return Sh(io)},useDebugValue:Pg,useDeferredValue:function(i){var o=Sh(io),c=o[0],_=o[1];return uf(function(){var w=fr.transition;fr.transition=1;try{_(i)}finally{fr.transition=w}},[i]),c},useTransition:function(){var i=Sh(io)[0];return[cf().current,i]},useMutableSource:tw,useOpaqueIdentifier:function(){return Sh(io)[0]},unstable_isNewReconciler:!1},aC={readContext:pr,useCallback:aw,useContext:pr,useEffect:uf,useImperativeHandle:sw,useLayoutEffect:rw,useMemo:lw,useReducer:Ch,useRef:cf,useState:function(){return Ch(io)},useDebugValue:Pg,useDeferredValue:function(i){var o=Ch(io),c=o[0],_=o[1];return uf(function(){var w=fr.transition;fr.transition=1;try{_(i)}finally{fr.transition=w}},[i]),c},useTransition:function(){var i=Ch(io)[0];return[cf().current,i]},useMutableSource:tw,useOpaqueIdentifier:function(){return Ch(io)[0]},unstable_isNewReconciler:!1},lC=ka.ReactCurrentOwner,kr=!1;function Oi(i,o,c,_){o.child=i===null?X1(o,null,c,_):rf(o,i.child,c,_)}function cw(i,o,c,_,w){c=c.render;var A=o.ref;return xc(o,w),_=kg(i,o,c,_,A,w),i!==null&&!kr?(o.updateQueue=i.updateQueue,o.flags&=-517,i.lanes&=~w,Lo(i,o,w)):(o.flags|=1,Oi(i,o,_,w),o.child)}function uw(i,o,c,_,w,A){if(i===null){var L=c.type;return typeof L=="function"&&!ty(L)&&L.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(o.tag=15,o.type=L,hw(i,o,L,_,w,A)):(i=wf(c.type,null,_,o,o.mode,A),i.ref=o.ref,i.return=o,o.child=i)}return L=i.child,(w&A)==0&&(w=L.memoizedProps,c=c.compare,c=c!==null?c:hh,c(w,_)&&i.ref===o.ref)?Lo(i,o,A):(o.flags|=1,i=Ns(L,_),i.ref=o.ref,i.return=o,o.child=i)}function hw(i,o,c,_,w,A){if(i!==null&&hh(i.memoizedProps,_)&&i.ref===o.ref)if(kr=!1,(A&w)!=0)(i.flags&16384)!=0&&(kr=!0);else return o.lanes=i.lanes,Lo(i,o,A);return Lg(i,o,c,_,A)}function Dg(i,o,c){var _=o.pendingProps,w=_.children,A=i!==null?i.memoizedState:null;if(_.mode==="hidden"||_.mode==="unstable-defer-without-hiding")if((o.mode&4)==0)o.memoizedState={baseLanes:0},xf(o,c);else if((c&1073741824)!=0)o.memoizedState={baseLanes:0},xf(o,A!==null?A.baseLanes:c);else return i=A!==null?A.baseLanes|c:c,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:i},xf(o,i),null;else A!==null?(_=A.baseLanes|c,o.memoizedState=null):_=c,xf(o,_);return Oi(i,o,w,c),o.child}function dw(i,o){var c=o.ref;(i===null&&c!==null||i!==null&&i.ref!==c)&&(o.flags|=128)}function Lg(i,o,c,_,w){var A=Ri(c)?Da:li.current;return A=gc(o,A),xc(o,w),c=kg(i,o,c,_,A,w),i!==null&&!kr?(o.updateQueue=i.updateQueue,o.flags&=-517,i.lanes&=~w,Lo(i,o,w)):(o.flags|=1,Oi(i,o,c,w),o.child)}function pw(i,o,c,_,w){if(Ri(c)){var A=!0;Wp(o)}else A=!1;if(xc(o,w),o.stateNode===null)i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2),Z1(o,c,_),wg(o,c,_,w),_=!0;else if(i===null){var L=o.stateNode,l=o.memoizedProps;L.props=l;var W=L.context,_e=c.contextType;typeof _e=="object"&&_e!==null?_e=pr(_e):(_e=Ri(c)?Da:li.current,_e=gc(o,_e));var ve=c.getDerivedStateFromProps,he=typeof ve=="function"||typeof L.getSnapshotBeforeUpdate=="function";he||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(l!==_||W!==_e)&&q1(o,L,_,_e),Ps=!1;var ne=o.memoizedState;L.state=ne,gh(o,_,L,w),W=o.memoizedState,l!==_||ne!==W||Bi.current||Ps?(typeof ve=="function"&&(Qp(o,c,ve,_),W=o.memoizedState),(l=Ps||G1(o,c,l,_,ne,W,_e))?(he||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(o.flags|=4)):(typeof L.componentDidMount=="function"&&(o.flags|=4),o.memoizedProps=_,o.memoizedState=W),L.props=_,L.state=W,L.context=_e,_=l):(typeof L.componentDidMount=="function"&&(o.flags|=4),_=!1)}else{L=o.stateNode,N1(i,o),l=o.memoizedProps,_e=o.type===o.elementType?l:Ar(o.type,l),L.props=_e,he=o.pendingProps,ne=L.context,W=c.contextType,typeof W=="object"&&W!==null?W=pr(W):(W=Ri(c)?Da:li.current,W=gc(o,W));var Me=c.getDerivedStateFromProps;(ve=typeof Me=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(l!==he||ne!==W)&&q1(o,L,_,W),Ps=!1,ne=o.memoizedState,L.state=ne,gh(o,_,L,w);var tt=o.memoizedState;l!==he||ne!==tt||Bi.current||Ps?(typeof Me=="function"&&(Qp(o,c,Me,_),tt=o.memoizedState),(_e=Ps||G1(o,c,_e,_,ne,tt,W))?(ve||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(_,tt,W),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(_,tt,W)),typeof L.componentDidUpdate=="function"&&(o.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(o.flags|=256)):(typeof L.componentDidUpdate!="function"||l===i.memoizedProps&&ne===i.memoizedState||(o.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&ne===i.memoizedState||(o.flags|=256),o.memoizedProps=_,o.memoizedState=tt),L.props=_,L.state=tt,L.context=W,_=_e):(typeof L.componentDidUpdate!="function"||l===i.memoizedProps&&ne===i.memoizedState||(o.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&ne===i.memoizedState||(o.flags|=256),_=!1)}return Bg(i,o,c,_,A,w)}function Bg(i,o,c,_,w,A){dw(i,o);var L=(o.flags&64)!=0;if(!_&&!L)return w&&M1(o,c,!1),Lo(i,o,A);_=o.stateNode,lC.current=o;var l=L&&typeof c.getDerivedStateFromError!="function"?null:_.render();return o.flags|=1,i!==null&&L?(o.child=rf(o,i.child,null,A),o.child=rf(o,null,l,A)):Oi(i,o,l,A),o.memoizedState=_.state,w&&M1(o,c,!0),o.child}function fw(i){var o=i.stateNode;o.pendingContext?k1(i,o.pendingContext,o.pendingContext!==o.context):o.context&&k1(i,o.context,!1),bg(i,o.containerInfo)}var df={dehydrated:null,retryLane:0};function mw(i,o,c){var _=o.pendingProps,w=kn.current,A=!1,L;return(L=(o.flags&64)!=0)||(L=i!==null&&i.memoizedState===null?!1:(w&2)!=0),L?(A=!0,o.flags&=-65):i!==null&&i.memoizedState===null||_.fallback===void 0||_.unstable_avoidThisFallback===!0||(w|=1),An(kn,w&1),i===null?(_.fallback!==void 0&&Eg(o),i=_.children,w=_.fallback,A?(i=_w(o,i,w,c),o.child.memoizedState={baseLanes:c},o.memoizedState=df,i):typeof _.unstable_expectedLoadTime=="number"?(i=_w(o,i,w,c),o.child.memoizedState={baseLanes:c},o.memoizedState=df,o.lanes=33554432,i):(c=ny({mode:"visible",children:i},o.mode,c,null),c.return=o,o.child=c)):i.memoizedState!==null?A?(_=yw(i,o,_.children,_.fallback,c),A=o.child,w=i.child.memoizedState,A.memoizedState=w===null?{baseLanes:c}:{baseLanes:w.baseLanes|c},A.childLanes=i.childLanes&~c,o.memoizedState=df,_):(c=gw(i,o,_.children,c),o.memoizedState=null,c):A?(_=yw(i,o,_.children,_.fallback,c),A=o.child,w=i.child.memoizedState,A.memoizedState=w===null?{baseLanes:c}:{baseLanes:w.baseLanes|c},A.childLanes=i.childLanes&~c,o.memoizedState=df,_):(c=gw(i,o,_.children,c),o.memoizedState=null,c)}function _w(i,o,c,_){var w=i.mode,A=i.child;return o={mode:"hidden",children:o},(w&2)==0&&A!==null?(A.childLanes=0,A.pendingProps=o):A=ny(o,w,0,null),c=kc(c,w,_,null),A.return=i,c.return=i,A.sibling=c,i.child=A,c}function gw(i,o,c,_){var w=i.child;return i=w.sibling,c=Ns(w,{mode:"visible",children:c}),(o.mode&2)==0&&(c.lanes=_),c.return=o,c.sibling=null,i!==null&&(i.nextEffect=null,i.flags=8,o.firstEffect=o.lastEffect=i),o.child=c}function yw(i,o,c,_,w){var A=o.mode,L=i.child;i=L.sibling;var l={mode:"hidden",children:c};return(A&2)==0&&o.child!==L?(c=o.child,c.childLanes=0,c.pendingProps=l,L=c.lastEffect,L!==null?(o.firstEffect=c.firstEffect,o.lastEffect=L,L.nextEffect=null):o.firstEffect=o.lastEffect=null):c=Ns(L,l),i!==null?_=Ns(i,_):(_=kc(_,A,w,null),_.flags|=2),_.return=o,c.return=o,c.sibling=_,o.child=c,_}function vw(i,o){i.lanes|=o;var c=i.alternate;c!==null&&(c.lanes|=o),U1(i.return,o)}function Rg(i,o,c,_,w,A){var L=i.memoizedState;L===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:_,tail:c,tailMode:w,lastEffect:A}:(L.isBackwards=o,L.rendering=null,L.renderingStartTime=0,L.last=_,L.tail=c,L.tailMode=w,L.lastEffect=A)}function xw(i,o,c){var _=o.pendingProps,w=_.revealOrder,A=_.tail;if(Oi(i,o,_.children,c),_=kn.current,(_&2)!=0)_=_&1|2,o.flags|=64;else{if(i!==null&&(i.flags&64)!=0)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&vw(i,c);else if(i.tag===19)vw(i,c);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}_&=1}if(An(kn,_),(o.mode&2)==0)o.memoizedState=null;else switch(w){case"forwards":for(c=o.child,w=null;c!==null;)i=c.alternate,i!==null&&of(i)===null&&(w=c),c=c.sibling;c=w,c===null?(w=o.child,o.child=null):(w=c.sibling,c.sibling=null),Rg(o,!1,w,c,A,o.lastEffect);break;case"backwards":for(c=null,w=o.child,o.child=null;w!==null;){if(i=w.alternate,i!==null&&of(i)===null){o.child=w;break}i=w.sibling,w.sibling=c,c=w,w=i}Rg(o,!0,c,null,A,o.lastEffect);break;case"together":Rg(o,!1,null,null,void 0,o.lastEffect);break;default:o.memoizedState=null}return o.child}function Lo(i,o,c){if(i!==null&&(o.dependencies=i.dependencies),Ih|=o.lanes,(c&o.childLanes)!=0){if(i!==null&&o.child!==i.child)throw Error(Ye(153));if(o.child!==null){for(i=o.child,c=Ns(i,i.pendingProps),o.child=c,c.return=o;i.sibling!==null;)i=i.sibling,c=c.sibling=Ns(i,i.pendingProps),c.return=o;c.sibling=null}return o.child}return null}var ww,Fg,bw,Tw;ww=function(i,o){for(var c=o.child;c!==null;){if(c.tag===5||c.tag===6)i.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};Fg=function(){};bw=function(i,o,c,_){var w=i.memoizedProps;if(w!==_){i=o.stateNode,Ra(to.current);var A=null;switch(c){case"input":w=w_(i,w),_=w_(i,_),A=[];break;case"option":w=E_(i,w),_=E_(i,_),A=[];break;case"select":w=fn({},w,{value:void 0}),_=fn({},_,{value:void 0}),A=[];break;case"textarea":w=S_(i,w),_=S_(i,_),A=[];break;default:typeof w.onClick!="function"&&typeof _.onClick=="function"&&(i.onclick=jp)}k_(c,_);var L;c=null;for(_e in w)if(!_.hasOwnProperty(_e)&&w.hasOwnProperty(_e)&&w[_e]!=null)if(_e==="style"){var l=w[_e];for(L in l)l.hasOwnProperty(L)&&(c||(c={}),c[L]="")}else _e!=="dangerouslySetInnerHTML"&&_e!=="children"&&_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&_e!=="autoFocus"&&($u.hasOwnProperty(_e)?A||(A=[]):(A=A||[]).push(_e,null));for(_e in _){var W=_[_e];if(l=w!=null?w[_e]:void 0,_.hasOwnProperty(_e)&&W!==l&&(W!=null||l!=null))if(_e==="style")if(l){for(L in l)!l.hasOwnProperty(L)||W&&W.hasOwnProperty(L)||(c||(c={}),c[L]="");for(L in W)W.hasOwnProperty(L)&&l[L]!==W[L]&&(c||(c={}),c[L]=W[L])}else c||(A||(A=[]),A.push(_e,c)),c=W;else _e==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,l=l?l.__html:void 0,W!=null&&l!==W&&(A=A||[]).push(_e,W)):_e==="children"?typeof W!="string"&&typeof W!="number"||(A=A||[]).push(_e,""+W):_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&($u.hasOwnProperty(_e)?(W!=null&&_e==="onScroll"&&cn("scroll",i),A||l===W||(A=[])):typeof W=="object"&&W!==null&&W.$$typeof===__?W.toString():(A=A||[]).push(_e,W))}c&&(A=A||[]).push("style",c);var _e=A;(o.updateQueue=_e)&&(o.flags|=4)}};Tw=function(i,o,c,_){c!==_&&(o.flags|=4)};function kh(i,o){if(!no)switch(i.tailMode){case"hidden":o=i.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var _=null;c!==null;)c.alternate!==null&&(_=c),c=c.sibling;_===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:_.sibling=null}}function cC(i,o,c){var _=o.pendingProps;switch(o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Ri(o.type)&&qp(),null;case 3:return wc(),un(Bi),un(li),Cg(),_=o.stateNode,_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(i===null||i.child===null)&&(sf(o)?o.flags|=4:_.hydrate||(o.flags|=256)),Fg(o),null;case 5:Tg(o);var w=Ra(wh.current);if(c=o.type,i!==null&&o.stateNode!=null)bw(i,o,c,_,w),i.ref!==o.ref&&(o.flags|=128);else{if(!_){if(o.stateNode===null)throw Error(Ye(166));return null}if(i=Ra(to.current),sf(o)){_=o.stateNode,c=o.type;var A=o.memoizedProps;switch(_[ks]=o,_[Gp]=A,c){case"dialog":cn("cancel",_),cn("close",_);break;case"iframe":case"object":case"embed":cn("load",_);break;case"video":case"audio":for(i=0;i<ph.length;i++)cn(ph[i],_);break;case"source":cn("error",_);break;case"img":case"image":case"link":cn("error",_),cn("load",_);break;case"details":cn("toggle",_);break;case"input":p0(_,A),cn("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!A.multiple},cn("invalid",_);break;case"textarea":_0(_,A),cn("invalid",_)}k_(c,A),i=null;for(var L in A)A.hasOwnProperty(L)&&(w=A[L],L==="children"?typeof w=="string"?_.textContent!==w&&(i=["children",w]):typeof w=="number"&&_.textContent!==""+w&&(i=["children",""+w]):$u.hasOwnProperty(L)&&w!=null&&L==="onScroll"&&cn("scroll",_));switch(c){case"input":Sp(_),m0(_,A,!0);break;case"textarea":Sp(_),y0(_);break;case"select":case"option":break;default:typeof A.onClick=="function"&&(_.onclick=jp)}_=i,o.updateQueue=_,_!==null&&(o.flags|=4)}else{switch(L=w.nodeType===9?w:w.ownerDocument,i===C_.html&&(i=v0(c)),i===C_.html?c==="script"?(i=L.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof _.is=="string"?i=L.createElement(c,{is:_.is}):(i=L.createElement(c),c==="select"&&(L=i,_.multiple?L.multiple=!0:_.size&&(L.size=_.size))):i=L.createElementNS(i,c),i[ks]=o,i[Gp]=_,ww(i,o,!1,!1),o.stateNode=i,L=I_(c,_),c){case"dialog":cn("cancel",i),cn("close",i),w=_;break;case"iframe":case"object":case"embed":cn("load",i),w=_;break;case"video":case"audio":for(w=0;w<ph.length;w++)cn(ph[w],i);w=_;break;case"source":cn("error",i),w=_;break;case"img":case"image":case"link":cn("error",i),cn("load",i),w=_;break;case"details":cn("toggle",i),w=_;break;case"input":p0(i,_),w=w_(i,_),cn("invalid",i);break;case"option":w=E_(i,_);break;case"select":i._wrapperState={wasMultiple:!!_.multiple},w=fn({},_,{value:void 0}),cn("invalid",i);break;case"textarea":_0(i,_),w=S_(i,_),cn("invalid",i);break;default:w=_}k_(c,w);var l=w;for(A in l)if(l.hasOwnProperty(A)){var W=l[A];A==="style"?b0(i,W):A==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,W!=null&&x0(i,W)):A==="children"?typeof W=="string"?(c!=="textarea"||W!=="")&&Hu(i,W):typeof W=="number"&&Hu(i,""+W):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&($u.hasOwnProperty(A)?W!=null&&A==="onScroll"&&cn("scroll",i):W!=null&&u_(i,A,W,L))}switch(c){case"input":Sp(i),m0(i,_,!1);break;case"textarea":Sp(i),y0(i);break;case"option":_.value!=null&&i.setAttribute("value",""+bs(_.value));break;case"select":i.multiple=!!_.multiple,A=_.value,A!=null?ic(i,!!_.multiple,A,!1):_.defaultValue!=null&&ic(i,!!_.multiple,_.defaultValue,!0);break;default:typeof w.onClick=="function"&&(i.onclick=jp)}T1(c,_)&&(o.flags|=4)}o.ref!==null&&(o.flags|=128)}return null;case 6:if(i&&o.stateNode!=null)Tw(i,o,i.memoizedProps,_);else{if(typeof _!="string"&&o.stateNode===null)throw Error(Ye(166));c=Ra(wh.current),Ra(to.current),sf(o)?(_=o.stateNode,c=o.memoizedProps,_[ks]=o,_.nodeValue!==c&&(o.flags|=4)):(_=(c.nodeType===9?c:c.ownerDocument).createTextNode(_),_[ks]=o,o.stateNode=_)}return null;case 13:return un(kn),_=o.memoizedState,(o.flags&64)!=0?(o.lanes=c,o):(_=_!==null,c=!1,i===null?o.memoizedProps.fallback!==void 0&&sf(o):c=i.memoizedState!==null,_&&!c&&(o.mode&2)!=0&&(i===null&&o.memoizedProps.unstable_avoidThisFallback!==!0||(kn.current&1)!=0?ni===0&&(ni=3):((ni===0||ni===3)&&(ni=4),Ei===null||(Ih&134217727)==0&&(Ec&134217727)==0||Cc(Ei,hi))),(_||c)&&(o.flags|=4),null);case 4:return wc(),Fg(o),i===null&&y1(o.stateNode.containerInfo),null;case 10:return vg(o),null;case 17:return Ri(o.type)&&qp(),null;case 19:if(un(kn),_=o.memoizedState,_===null)return null;if(A=(o.flags&64)!=0,L=_.rendering,L===null)if(A)kh(_,!1);else{if(ni!==0||i!==null&&(i.flags&64)!=0)for(i=o.child;i!==null;){if(L=of(i),L!==null){for(o.flags|=64,kh(_,!1),A=L.updateQueue,A!==null&&(o.updateQueue=A,o.flags|=4),_.lastEffect===null&&(o.firstEffect=null),o.lastEffect=_.lastEffect,_=c,c=o.child;c!==null;)A=c,i=_,A.flags&=2,A.nextEffect=null,A.firstEffect=null,A.lastEffect=null,L=A.alternate,L===null?(A.childLanes=0,A.lanes=i,A.child=null,A.memoizedProps=null,A.memoizedState=null,A.updateQueue=null,A.dependencies=null,A.stateNode=null):(A.childLanes=L.childLanes,A.lanes=L.lanes,A.child=L.child,A.memoizedProps=L.memoizedProps,A.memoizedState=L.memoizedState,A.updateQueue=L.updateQueue,A.type=L.type,i=L.dependencies,A.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),c=c.sibling;return An(kn,kn.current&1|2),o.child}i=i.sibling}_.tail!==null&&ci()>Xg&&(o.flags|=64,A=!0,kh(_,!1),o.lanes=33554432)}else{if(!A)if(i=of(L),i!==null){if(o.flags|=64,A=!0,c=i.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),kh(_,!0),_.tail===null&&_.tailMode==="hidden"&&!L.alternate&&!no)return o=o.lastEffect=_.lastEffect,o!==null&&(o.nextEffect=null),null}else 2*ci()-_.renderingStartTime>Xg&&c!==1073741824&&(o.flags|=64,A=!0,kh(_,!1),o.lanes=33554432);_.isBackwards?(L.sibling=o.child,o.child=L):(c=_.last,c!==null?c.sibling=L:o.child=L,_.last=L)}return _.tail!==null?(c=_.tail,_.rendering=c,_.tail=c.sibling,_.lastEffect=o.lastEffect,_.renderingStartTime=ci(),c.sibling=null,o=kn.current,An(kn,A?o&1|2:o&1),c):null;case 23:case 24:return ey(),i!==null&&i.memoizedState!==null!=(o.memoizedState!==null)&&_.mode!=="unstable-defer-without-hiding"&&(o.flags|=4),null}throw Error(Ye(156,o.tag))}function uC(i){switch(i.tag){case 1:Ri(i.type)&&qp();var o=i.flags;return o&4096?(i.flags=o&-4097|64,i):null;case 3:if(wc(),un(Bi),un(li),Cg(),o=i.flags,(o&64)!=0)throw Error(Ye(285));return i.flags=o&-4097|64,i;case 5:return Tg(i),null;case 13:return un(kn),o=i.flags,o&4096?(i.flags=o&-4097|64,i):null;case 19:return un(kn),null;case 4:return wc(),null;case 10:return vg(i),null;case 23:case 24:return ey(),null;default:return null}}function Og(i,o){try{var c="",_=o;do c+=GE(_),_=_.return;while(_);var w=c}catch(A){w=`
Error generating stack: `+A.message+`
`+A.stack}return{value:i,source:o,stack:w}}function Ug(i,o){try{console.error(o.value)}catch(c){setTimeout(function(){throw c})}}var hC=typeof WeakMap=="function"?WeakMap:Map;function Ew(i,o,c){c=zs(-1,c),c.tag=3,c.payload={element:null};var _=o.value;return c.callback=function(){mf||(mf=!0,Hg=_),Ug(i,o)},c}function Sw(i,o,c){c=zs(-1,c),c.tag=3;var _=i.type.getDerivedStateFromError;if(typeof _=="function"){var w=o.value;c.payload=function(){return Ug(i,o),_(w)}}var A=i.stateNode;return A!==null&&typeof A.componentDidCatch=="function"&&(c.callback=function(){typeof _!="function"&&(ro===null?ro=new Set([this]):ro.add(this),Ug(i,o));var L=o.stack;this.componentDidCatch(o.value,{componentStack:L!==null?L:""})}),c}var dC=typeof WeakSet=="function"?WeakSet:Set;function Cw(i){var o=i.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(c){Us(i,c)}else o.current=null}function pC(i,o){switch(o.tag){case 0:case 11:case 15:case 22:return;case 1:if(o.flags&256&&i!==null){var c=i.memoizedProps,_=i.memoizedState;i=o.stateNode,o=i.getSnapshotBeforeUpdate(o.elementType===o.type?c:Ar(o.type,c),_),i.__reactInternalSnapshotBeforeUpdate=o}return;case 3:o.flags&256&&cg(o.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(Ye(163))}function fC(i,o,c){switch(c.tag){case 0:case 11:case 15:case 22:if(o=c.updateQueue,o=o!==null?o.lastEffect:null,o!==null){i=o=o.next;do{if((i.tag&3)==3){var _=i.create;i.destroy=_()}i=i.next}while(i!==o)}if(o=c.updateQueue,o=o!==null?o.lastEffect:null,o!==null){i=o=o.next;do{var w=i;_=w.next,w=w.tag,(w&4)!=0&&(w&1)!=0&&(Vw(c,i),bC(c,i)),i=_}while(i!==o)}return;case 1:i=c.stateNode,c.flags&4&&(o===null?i.componentDidMount():(_=c.elementType===c.type?o.memoizedProps:Ar(c.type,o.memoizedProps),i.componentDidUpdate(_,o.memoizedState,i.__reactInternalSnapshotBeforeUpdate))),o=c.updateQueue,o!==null&&j1(c,o,i);return;case 3:if(o=c.updateQueue,o!==null){if(i=null,c.child!==null)switch(c.child.tag){case 5:i=c.child.stateNode;break;case 1:i=c.child.stateNode}j1(c,o,i)}return;case 5:i=c.stateNode,o===null&&c.flags&4&&T1(c.type,c.memoizedProps)&&i.focus();return;case 6:return;case 4:return;case 12:return;case 13:c.memoizedState===null&&(c=c.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&O0(c))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(Ye(163))}function Aw(i,o){for(var c=i;;){if(c.tag===5){var _=c.stateNode;if(o)_=_.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{_=c.stateNode;var w=c.memoizedProps.style;w=w!=null&&w.hasOwnProperty("display")?w.display:null,_.style.display=w0("display",w)}}else if(c.tag===6)c.stateNode.nodeValue=o?"":c.memoizedProps;else if((c.tag!==23&&c.tag!==24||c.memoizedState===null||c===i)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break;for(;c.sibling===null;){if(c.return===null||c.return===i)return;c=c.return}c.sibling.return=c.return,c=c.sibling}}function kw(i,o){if(La&&typeof La.onCommitFiberUnmount=="function")try{La.onCommitFiberUnmount(dg,o)}catch{}switch(o.tag){case 0:case 11:case 14:case 15:case 22:if(i=o.updateQueue,i!==null&&(i=i.lastEffect,i!==null)){var c=i=i.next;do{var _=c,w=_.destroy;if(_=_.tag,w!==void 0)if((_&4)!=0)Vw(o,c);else{_=o;try{w()}catch(A){Us(_,A)}}c=c.next}while(c!==i)}break;case 1:if(Cw(o),i=o.stateNode,typeof i.componentWillUnmount=="function")try{i.props=o.memoizedProps,i.state=o.memoizedState,i.componentWillUnmount()}catch(A){Us(o,A)}break;case 5:Cw(o);break;case 4:zw(i,o)}}function Iw(i){i.alternate=null,i.child=null,i.dependencies=null,i.firstEffect=null,i.lastEffect=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.return=null,i.updateQueue=null}function Mw(i){return i.tag===5||i.tag===3||i.tag===4}function Pw(i){e:{for(var o=i.return;o!==null;){if(Mw(o))break e;o=o.return}throw Error(Ye(160))}var c=o;switch(o=c.stateNode,c.tag){case 5:var _=!1;break;case 3:o=o.containerInfo,_=!0;break;case 4:o=o.containerInfo,_=!0;break;default:throw Error(Ye(161))}c.flags&16&&(Hu(o,""),c.flags&=-17);e:t:for(c=i;;){for(;c.sibling===null;){if(c.return===null||Mw(c.return)){c=null;break e}c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue t;c.child.return=c,c=c.child}if(!(c.flags&2)){c=c.stateNode;break e}}_?Ng(i,c,o):Vg(i,c,o)}function Ng(i,o,c){var _=i.tag,w=_===5||_===6;if(w)i=w?i.stateNode:i.stateNode.instance,o?c.nodeType===8?c.parentNode.insertBefore(i,o):c.insertBefore(i,o):(c.nodeType===8?(o=c.parentNode,o.insertBefore(i,c)):(o=c,o.appendChild(i)),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=jp));else if(_!==4&&(i=i.child,i!==null))for(Ng(i,o,c),i=i.sibling;i!==null;)Ng(i,o,c),i=i.sibling}function Vg(i,o,c){var _=i.tag,w=_===5||_===6;if(w)i=w?i.stateNode:i.stateNode.instance,o?c.insertBefore(i,o):c.appendChild(i);else if(_!==4&&(i=i.child,i!==null))for(Vg(i,o,c),i=i.sibling;i!==null;)Vg(i,o,c),i=i.sibling}function zw(i,o){for(var c=o,_=!1,w,A;;){if(!_){_=c.return;e:for(;;){if(_===null)throw Error(Ye(160));switch(w=_.stateNode,_.tag){case 5:A=!1;break e;case 3:w=w.containerInfo,A=!0;break e;case 4:w=w.containerInfo,A=!0;break e}_=_.return}_=!0}if(c.tag===5||c.tag===6){e:for(var L=i,l=c,W=l;;)if(kw(L,W),W.child!==null&&W.tag!==4)W.child.return=W,W=W.child;else{if(W===l)break e;for(;W.sibling===null;){if(W.return===null||W.return===l)break e;W=W.return}W.sibling.return=W.return,W=W.sibling}A?(L=w,l=c.stateNode,L.nodeType===8?L.parentNode.removeChild(l):L.removeChild(l)):w.removeChild(c.stateNode)}else if(c.tag===4){if(c.child!==null){w=c.stateNode.containerInfo,A=!0,c.child.return=c,c=c.child;continue}}else if(kw(i,c),c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return,c.tag===4&&(_=!1)}c.sibling.return=c.return,c=c.sibling}}function jg(i,o){switch(o.tag){case 0:case 11:case 14:case 15:case 22:var c=o.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var _=c=c.next;do(_.tag&3)==3&&(i=_.destroy,_.destroy=void 0,i!==void 0&&i()),_=_.next;while(_!==c)}return;case 1:return;case 5:if(c=o.stateNode,c!=null){_=o.memoizedProps;var w=i!==null?i.memoizedProps:_;i=o.type;var A=o.updateQueue;if(o.updateQueue=null,A!==null){for(c[Gp]=_,i==="input"&&_.type==="radio"&&_.name!=null&&f0(c,_),I_(i,w),o=I_(i,_),w=0;w<A.length;w+=2){var L=A[w],l=A[w+1];L==="style"?b0(c,l):L==="dangerouslySetInnerHTML"?x0(c,l):L==="children"?Hu(c,l):u_(c,L,l,o)}switch(i){case"input":b_(c,_);break;case"textarea":g0(c,_);break;case"select":i=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!_.multiple,A=_.value,A!=null?ic(c,!!_.multiple,A,!1):i!==!!_.multiple&&(_.defaultValue!=null?ic(c,!!_.multiple,_.defaultValue,!0):ic(c,!!_.multiple,_.multiple?[]:"",!1))}}}return;case 6:if(o.stateNode===null)throw Error(Ye(162));o.stateNode.nodeValue=o.memoizedProps;return;case 3:c=o.stateNode,c.hydrate&&(c.hydrate=!1,O0(c.containerInfo));return;case 12:return;case 13:o.memoizedState!==null&&(Wg=ci(),Aw(o.child,!0)),Dw(o);return;case 19:Dw(o);return;case 17:return;case 23:case 24:Aw(o,o.memoizedState!==null);return}throw Error(Ye(163))}function Dw(i){var o=i.updateQueue;if(o!==null){i.updateQueue=null;var c=i.stateNode;c===null&&(c=i.stateNode=new dC),o.forEach(function(_){var w=SC.bind(null,i,_);c.has(_)||(c.add(_),_.then(w,w))})}}function mC(i,o){return i!==null&&(i=i.memoizedState,i===null||i.dehydrated!==null)?(o=o.memoizedState,o!==null&&o.dehydrated===null):!1}var _C=Math.ceil,pf=ka.ReactCurrentDispatcher,$g=ka.ReactCurrentOwner,vt=0,Ei=null,On=null,hi=0,Ua=0,Gg=Is(0),ni=0,ff=null,Tc=0,Ih=0,Ec=0,Zg=0,qg=null,Wg=0,Xg=1/0;function Sc(){Xg=ci()+500}var rt=null,mf=!1,Hg=null,ro=null,Bs=!1,Mh=null,Ph=90,Yg=[],Kg=[],Bo=null,zh=0,Jg=null,_f=-1,Ro=0,gf=0,Dh=null,yf=!1;function er(){return(vt&48)!=0?ci():_f!==-1?_f:_f=ci()}function Rs(i){if(i=i.mode,(i&2)==0)return 1;if((i&4)==0)return yc()===99?1:2;if(Ro===0&&(Ro=Tc),iC.transition!==0){gf!==0&&(gf=qg!==null?qg.pendingLanes:0),i=Ro;var o=4186112&~gf;return o&=-o,o===0&&(i=4186112&~i,o=i&-i,o===0&&(o=8192)),o}return i=yc(),(vt&4)!=0&&i===98?i=Dp(12,Ro):(i=sS(i),i=Dp(i,Ro)),i}function Fs(i,o,c){if(50<zh)throw zh=0,Jg=null,Error(Ye(185));if(i=vf(i,o),i===null)return null;Lp(i,o,c),i===Ei&&(Ec|=o,ni===4&&Cc(i,hi));var _=yc();o===1?(vt&8)!=0&&(vt&48)==0?Qg(i):(mr(i,c),vt===0&&(Sc(),eo())):((vt&4)==0||_!==98&&_!==99||(Bo===null?Bo=new Set([i]):Bo.add(i)),mr(i,c)),qg=i}function vf(i,o){i.lanes|=o;var c=i.alternate;for(c!==null&&(c.lanes|=o),c=i,i=i.return;i!==null;)i.childLanes|=o,c=i.alternate,c!==null&&(c.childLanes|=o),c=i,i=i.return;return c.tag===3?c.stateNode:null}function mr(i,o){for(var c=i.callbackNode,_=i.suspendedLanes,w=i.pingedLanes,A=i.expirationTimes,L=i.pendingLanes;0<L;){var l=31-Cs(L),W=1<<l,_e=A[l];if(_e===-1){if((W&_)==0||(W&w)!=0){_e=o,ac(W);var ve=an;A[l]=10<=ve?_e+250:6<=ve?_e+5e3:-1}}else _e<=o&&(i.expiredLanes|=W);L&=~W}if(_=oh(i,i===Ei?hi:0),o=an,_===0)c!==null&&(c!==_g&&fg(c),i.callbackNode=null,i.callbackPriority=0);else{if(c!==null){if(i.callbackPriority===o)return;c!==_g&&fg(c)}o===15?(c=Qg.bind(null,i),zo===null?(zo=[c],Hp=pg(Xp,O1)):zo.push(c),c=_g):o===14?c=_h(99,Qg.bind(null,i)):(c=aS(o),c=_h(c,Lw.bind(null,i))),i.callbackPriority=o,i.callbackNode=c}}function Lw(i){if(_f=-1,gf=Ro=0,(vt&48)!=0)throw Error(Ye(327));var o=i.callbackNode;if(Os()&&i.callbackNode!==o)return null;var c=oh(i,i===Ei?hi:0);if(c===0)return null;var _=c,w=vt;vt|=16;var A=Ow();(Ei!==i||hi!==_)&&(Sc(),Ac(i,_));do try{vC();break}catch(l){Fw(i,l)}while(1);if(yg(),pf.current=A,vt=w,On!==null?_=0:(Ei=null,hi=0,_=ni),(Tc&Ec)!=0)Ac(i,0);else if(_!==0){if(_===2&&(vt|=64,i.hydrate&&(i.hydrate=!1,cg(i.containerInfo)),c=Z0(i),c!==0&&(_=Lh(i,c))),_===1)throw o=ff,Ac(i,0),Cc(i,c),mr(i,ci()),o;switch(i.finishedWork=i.current.alternate,i.finishedLanes=c,_){case 0:case 1:throw Error(Ye(345));case 2:Na(i);break;case 3:if(Cc(i,c),(c&62914560)===c&&(_=Wg+500-ci(),10<_)){if(oh(i,0)!==0)break;if(w=i.suspendedLanes,(w&c)!==c){er(),i.pingedLanes|=i.suspendedLanes&w;break}i.timeoutHandle=E1(Na.bind(null,i),_);break}Na(i);break;case 4:if(Cc(i,c),(c&4186112)===c)break;for(_=i.eventTimes,w=-1;0<c;){var L=31-Cs(c);A=1<<L,L=_[L],L>w&&(w=L),c&=~A}if(c=w,c=ci()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*_C(c/1960))-c,10<c){i.timeoutHandle=E1(Na.bind(null,i),c);break}Na(i);break;case 5:Na(i);break;default:throw Error(Ye(329))}}return mr(i,ci()),i.callbackNode===o?Lw.bind(null,i):null}function Cc(i,o){for(o&=~Zg,o&=~Ec,i.suspendedLanes|=o,i.pingedLanes&=~o,i=i.expirationTimes;0<o;){var c=31-Cs(o),_=1<<c;i[c]=-1,o&=~_}}function Qg(i){if((vt&48)!=0)throw Error(Ye(327));if(Os(),i===Ei&&(i.expiredLanes&hi)!=0){var o=hi,c=Lh(i,o);(Tc&Ec)!=0&&(o=oh(i,o),c=Lh(i,o))}else o=oh(i,0),c=Lh(i,o);if(i.tag!==0&&c===2&&(vt|=64,i.hydrate&&(i.hydrate=!1,cg(i.containerInfo)),o=Z0(i),o!==0&&(c=Lh(i,o))),c===1)throw c=ff,Ac(i,0),Cc(i,o),mr(i,ci()),c;return i.finishedWork=i.current.alternate,i.finishedLanes=o,Na(i),mr(i,ci()),null}function gC(){if(Bo!==null){var i=Bo;Bo=null,i.forEach(function(o){o.expiredLanes|=24&o.pendingLanes,mr(o,ci())})}eo()}function Bw(i,o){var c=vt;vt|=1;try{return i(o)}finally{vt=c,vt===0&&(Sc(),eo())}}function Rw(i,o){var c=vt;vt&=-2,vt|=8;try{return i(o)}finally{vt=c,vt===0&&(Sc(),eo())}}function xf(i,o){An(Gg,Ua),Ua|=o,Tc|=o}function ey(){Ua=Gg.current,un(Gg)}function Ac(i,o){i.finishedWork=null,i.finishedLanes=0;var c=i.timeoutHandle;if(c!==-1&&(i.timeoutHandle=-1,KS(c)),On!==null)for(c=On.return;c!==null;){var _=c;switch(_.tag){case 1:_=_.type.childContextTypes,_!=null&&qp();break;case 3:wc(),un(Bi),un(li),Cg();break;case 5:Tg(_);break;case 4:wc();break;case 13:un(kn);break;case 19:un(kn);break;case 10:vg(_);break;case 23:case 24:ey()}c=c.return}Ei=i,On=Ns(i.current,null),hi=Ua=Tc=o,ni=0,ff=null,Zg=Ec=Ih=0}function Fw(i,o){do{var c=On;try{if(yg(),bh.current=hf,af){for(var _=zn.memoizedState;_!==null;){var w=_.queue;w!==null&&(w.pending=null),_=_.next}af=!1}if(Th=0,ti=ui=zn=null,Eh=!1,$g.current=null,c===null||c.return===null){ni=1,ff=o,On=null;break}e:{var A=i,L=c.return,l=c,W=o;if(o=hi,l.flags|=2048,l.firstEffect=l.lastEffect=null,W!==null&&typeof W=="object"&&typeof W.then=="function"){var _e=W;if((l.mode&2)==0){var ve=l.alternate;ve?(l.updateQueue=ve.updateQueue,l.memoizedState=ve.memoizedState,l.lanes=ve.lanes):(l.updateQueue=null,l.memoizedState=null)}var he=(kn.current&1)!=0,ne=L;do{var Me;if(Me=ne.tag===13){var tt=ne.memoizedState;if(tt!==null)Me=tt.dehydrated!==null;else{var nt=ne.memoizedProps;Me=nt.fallback===void 0?!1:nt.unstable_avoidThisFallback!==!0?!0:!he}}if(Me){var de=ne.updateQueue;if(de===null){var te=new Set;te.add(_e),ne.updateQueue=te}else de.add(_e);if((ne.mode&2)==0){if(ne.flags|=64,l.flags|=16384,l.flags&=-2981,l.tag===1)if(l.alternate===null)l.tag=17;else{var ae=zs(-1,1);ae.tag=2,Ds(l,ae)}l.lanes|=1;break e}W=void 0,l=o;var De=A.pingCache;if(De===null?(De=A.pingCache=new hC,W=new Set,De.set(_e,W)):(W=De.get(_e),W===void 0&&(W=new Set,De.set(_e,W))),!W.has(l)){W.add(l);var Le=EC.bind(null,A,_e,l);_e.then(Le,Le)}ne.flags|=4096,ne.lanes=o;break e}ne=ne.return}while(ne!==null);W=Error((nc(l.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}ni!==5&&(ni=2),W=Og(W,l),ne=L;do{switch(ne.tag){case 3:A=W,ne.flags|=4096,o&=-o,ne.lanes|=o;var lt=Ew(ne,A,o);V1(ne,lt);break e;case 1:A=W;var He=ne.type,Ke=ne.stateNode;if((ne.flags&64)==0&&(typeof He.getDerivedStateFromError=="function"||Ke!==null&&typeof Ke.componentDidCatch=="function"&&(ro===null||!ro.has(Ke)))){ne.flags|=4096,o&=-o,ne.lanes|=o;var pt=Sw(ne,A,o);V1(ne,pt);break e}}ne=ne.return}while(ne!==null)}Nw(c)}catch(st){o=st,On===c&&c!==null&&(On=c=c.return);continue}break}while(1)}function Ow(){var i=pf.current;return pf.current=hf,i===null?hf:i}function Lh(i,o){var c=vt;vt|=16;var _=Ow();Ei===i&&hi===o||Ac(i,o);do try{yC();break}catch(w){Fw(i,w)}while(1);if(yg(),vt=c,pf.current=_,On!==null)throw Error(Ye(261));return Ei=null,hi=0,ni}function yC(){for(;On!==null;)Uw(On)}function vC(){for(;On!==null&&!eC();)Uw(On)}function Uw(i){var o=$w(i.alternate,i,Ua);i.memoizedProps=i.pendingProps,o===null?Nw(i):On=o,$g.current=null}function Nw(i){var o=i;do{var c=o.alternate;if(i=o.return,(o.flags&2048)==0){if(c=cC(c,o,Ua),c!==null){On=c;return}if(c=o,c.tag!==24&&c.tag!==23||c.memoizedState===null||(Ua&1073741824)!=0||(c.mode&4)==0){for(var _=0,w=c.child;w!==null;)_|=w.lanes|w.childLanes,w=w.sibling;c.childLanes=_}i!==null&&(i.flags&2048)==0&&(i.firstEffect===null&&(i.firstEffect=o.firstEffect),o.lastEffect!==null&&(i.lastEffect!==null&&(i.lastEffect.nextEffect=o.firstEffect),i.lastEffect=o.lastEffect),1<o.flags&&(i.lastEffect!==null?i.lastEffect.nextEffect=o:i.firstEffect=o,i.lastEffect=o))}else{if(c=uC(o),c!==null){c.flags&=2047,On=c;return}i!==null&&(i.firstEffect=i.lastEffect=null,i.flags|=2048)}if(o=o.sibling,o!==null){On=o;return}On=o=i}while(o!==null);ni===0&&(ni=5)}function Na(i){var o=yc();return Ba(99,xC.bind(null,i,o)),null}function xC(i,o){do Os();while(Mh!==null);if((vt&48)!=0)throw Error(Ye(327));var c=i.finishedWork;if(c===null)return null;if(i.finishedWork=null,i.finishedLanes=0,c===i.current)throw Error(Ye(177));i.callbackNode=null;var _=c.lanes|c.childLanes,w=_,A=i.pendingLanes&~w;i.pendingLanes=w,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=w,i.mutableReadLanes&=w,i.entangledLanes&=w,w=i.entanglements;for(var L=i.eventTimes,l=i.expirationTimes;0<A;){var W=31-Cs(A),_e=1<<W;w[W]=0,L[W]=-1,l[W]=-1,A&=~_e}if(Bo!==null&&(_&24)==0&&Bo.has(i)&&Bo.delete(i),i===Ei&&(On=Ei=null,hi=0),1<c.flags?c.lastEffect!==null?(c.lastEffect.nextEffect=c,_=c.firstEffect):_=c:_=c.firstEffect,_!==null){if(w=vt,vt|=32,$g.current=null,sg=Bp,L=h1(),ng(L)){if("selectionStart"in L)l={start:L.selectionStart,end:L.selectionEnd};else e:if(l=(l=L.ownerDocument)&&l.defaultView||window,(_e=l.getSelection&&l.getSelection())&&_e.rangeCount!==0){l=_e.anchorNode,A=_e.anchorOffset,W=_e.focusNode,_e=_e.focusOffset;try{l.nodeType,W.nodeType}catch{l=null;break e}var ve=0,he=-1,ne=-1,Me=0,tt=0,nt=L,de=null;t:for(;;){for(var te;nt!==l||A!==0&&nt.nodeType!==3||(he=ve+A),nt!==W||_e!==0&&nt.nodeType!==3||(ne=ve+_e),nt.nodeType===3&&(ve+=nt.nodeValue.length),(te=nt.firstChild)!==null;)de=nt,nt=te;for(;;){if(nt===L)break t;if(de===l&&++Me===A&&(he=ve),de===W&&++tt===_e&&(ne=ve),(te=nt.nextSibling)!==null)break;nt=de,de=nt.parentNode}nt=te}l=he===-1||ne===-1?null:{start:he,end:ne}}else l=null;l=l||{start:0,end:0}}else l=null;ag={focusedElem:L,selectionRange:l},Bp=!1,Dh=null,yf=!1,rt=_;do try{wC()}catch(st){if(rt===null)throw Error(Ye(330));Us(rt,st),rt=rt.nextEffect}while(rt!==null);Dh=null,rt=_;do try{for(L=i;rt!==null;){var ae=rt.flags;if(ae&16&&Hu(rt.stateNode,""),ae&128){var De=rt.alternate;if(De!==null){var Le=De.ref;Le!==null&&(typeof Le=="function"?Le(null):Le.current=null)}}switch(ae&1038){case 2:Pw(rt),rt.flags&=-3;break;case 6:Pw(rt),rt.flags&=-3,jg(rt.alternate,rt);break;case 1024:rt.flags&=-1025;break;case 1028:rt.flags&=-1025,jg(rt.alternate,rt);break;case 4:jg(rt.alternate,rt);break;case 8:l=rt,zw(L,l);var lt=l.alternate;Iw(l),lt!==null&&Iw(lt)}rt=rt.nextEffect}}catch(st){if(rt===null)throw Error(Ye(330));Us(rt,st),rt=rt.nextEffect}while(rt!==null);if(Le=ag,De=h1(),ae=Le.focusedElem,L=Le.selectionRange,De!==ae&&ae&&ae.ownerDocument&&u1(ae.ownerDocument.documentElement,ae)){for(L!==null&&ng(ae)&&(De=L.start,Le=L.end,Le===void 0&&(Le=De),"selectionStart"in ae?(ae.selectionStart=De,ae.selectionEnd=Math.min(Le,ae.value.length)):(Le=(De=ae.ownerDocument||document)&&De.defaultView||window,Le.getSelection&&(Le=Le.getSelection(),l=ae.textContent.length,lt=Math.min(L.start,l),L=L.end===void 0?lt:Math.min(L.end,l),!Le.extend&&lt>L&&(l=L,L=lt,lt=l),l=c1(ae,lt),A=c1(ae,L),l&&A&&(Le.rangeCount!==1||Le.anchorNode!==l.node||Le.anchorOffset!==l.offset||Le.focusNode!==A.node||Le.focusOffset!==A.offset)&&(De=De.createRange(),De.setStart(l.node,l.offset),Le.removeAllRanges(),lt>L?(Le.addRange(De),Le.extend(A.node,A.offset)):(De.setEnd(A.node,A.offset),Le.addRange(De)))))),De=[],Le=ae;Le=Le.parentNode;)Le.nodeType===1&&De.push({element:Le,left:Le.scrollLeft,top:Le.scrollTop});for(typeof ae.focus=="function"&&ae.focus(),ae=0;ae<De.length;ae++)Le=De[ae],Le.element.scrollLeft=Le.left,Le.element.scrollTop=Le.top}Bp=!!sg,ag=sg=null,i.current=c,rt=_;do try{for(ae=i;rt!==null;){var He=rt.flags;if(He&36&&fC(ae,rt.alternate,rt),He&128){De=void 0;var Ke=rt.ref;if(Ke!==null){var pt=rt.stateNode;switch(rt.tag){case 5:De=pt;break;default:De=pt}typeof Ke=="function"?Ke(De):Ke.current=De}}rt=rt.nextEffect}}catch(st){if(rt===null)throw Error(Ye(330));Us(rt,st),rt=rt.nextEffect}while(rt!==null);rt=null,nC(),vt=w}else i.current=c;if(Bs)Bs=!1,Mh=i,Ph=o;else for(rt=_;rt!==null;)o=rt.nextEffect,rt.nextEffect=null,rt.flags&8&&(He=rt,He.sibling=null,He.stateNode=null),rt=o;if(_=i.pendingLanes,_===0&&(ro=null),_===1?i===Jg?zh++:(zh=0,Jg=i):zh=0,c=c.stateNode,La&&typeof La.onCommitFiberRoot=="function")try{La.onCommitFiberRoot(dg,c,void 0,(c.current.flags&64)==64)}catch{}if(mr(i,ci()),mf)throw mf=!1,i=Hg,Hg=null,i;return(vt&8)!=0||eo(),null}function wC(){for(;rt!==null;){var i=rt.alternate;yf||Dh===null||((rt.flags&8)!=0?P0(rt,Dh)&&(yf=!0):rt.tag===13&&mC(i,rt)&&P0(rt,Dh)&&(yf=!0));var o=rt.flags;(o&256)!=0&&pC(i,rt),(o&512)==0||Bs||(Bs=!0,_h(97,function(){return Os(),null})),rt=rt.nextEffect}}function Os(){if(Ph!==90){var i=97<Ph?97:Ph;return Ph=90,Ba(i,TC)}return!1}function bC(i,o){Yg.push(o,i),Bs||(Bs=!0,_h(97,function(){return Os(),null}))}function Vw(i,o){Kg.push(o,i),Bs||(Bs=!0,_h(97,function(){return Os(),null}))}function TC(){if(Mh===null)return!1;var i=Mh;if(Mh=null,(vt&48)!=0)throw Error(Ye(331));var o=vt;vt|=32;var c=Kg;Kg=[];for(var _=0;_<c.length;_+=2){var w=c[_],A=c[_+1],L=w.destroy;if(w.destroy=void 0,typeof L=="function")try{L()}catch(W){if(A===null)throw Error(Ye(330));Us(A,W)}}for(c=Yg,Yg=[],_=0;_<c.length;_+=2){w=c[_],A=c[_+1];try{var l=w.create;w.destroy=l()}catch(W){if(A===null)throw Error(Ye(330));Us(A,W)}}for(l=i.current.firstEffect;l!==null;)i=l.nextEffect,l.nextEffect=null,l.flags&8&&(l.sibling=null,l.stateNode=null),l=i;return vt=o,eo(),!0}function jw(i,o,c){o=Og(c,o),o=Ew(i,o,1),Ds(i,o),o=er(),i=vf(i,1),i!==null&&(Lp(i,1,o),mr(i,o))}function Us(i,o){if(i.tag===3)jw(i,i,o);else for(var c=i.return;c!==null;){if(c.tag===3){jw(c,i,o);break}else if(c.tag===1){var _=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(ro===null||!ro.has(_))){i=Og(o,i);var w=Sw(c,i,1);if(Ds(c,w),w=er(),c=vf(c,1),c!==null)Lp(c,1,w),mr(c,w);else if(typeof _.componentDidCatch=="function"&&(ro===null||!ro.has(_)))try{_.componentDidCatch(o,i)}catch{}break}}c=c.return}}function EC(i,o,c){var _=i.pingCache;_!==null&&_.delete(o),o=er(),i.pingedLanes|=i.suspendedLanes&c,Ei===i&&(hi&c)===c&&(ni===4||ni===3&&(hi&62914560)===hi&&500>ci()-Wg?Ac(i,0):Zg|=c),mr(i,o)}function SC(i,o){var c=i.stateNode;c!==null&&c.delete(o),o=0,o===0&&(o=i.mode,(o&2)==0?o=1:(o&4)==0?o=yc()===99?1:2:(Ro===0&&(Ro=Tc),o=lc(62914560&~Ro),o===0&&(o=4194304))),c=er(),i=vf(i,o),i!==null&&(Lp(i,o,c),mr(i,c))}var $w;$w=function(i,o,c){var _=o.lanes;if(i!==null)if(i.memoizedProps!==o.pendingProps||Bi.current)kr=!0;else if((c&_)!=0)kr=(i.flags&16384)!=0;else{switch(kr=!1,o.tag){case 3:fw(o),Sg();break;case 5:H1(o);break;case 1:Ri(o.type)&&Wp(o);break;case 4:bg(o,o.stateNode.containerInfo);break;case 10:_=o.memoizedProps.value;var w=o.type._context;An(Yp,w._currentValue),w._currentValue=_;break;case 13:if(o.memoizedState!==null)return(c&o.child.childLanes)!=0?mw(i,o,c):(An(kn,kn.current&1),o=Lo(i,o,c),o!==null?o.sibling:null);An(kn,kn.current&1);break;case 19:if(_=(c&o.childLanes)!=0,(i.flags&64)!=0){if(_)return xw(i,o,c);o.flags|=64}if(w=o.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),An(kn,kn.current),_)break;return null;case 23:case 24:return o.lanes=0,Dg(i,o,c)}return Lo(i,o,c)}else kr=!1;switch(o.lanes=0,o.tag){case 2:if(_=o.type,i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2),i=o.pendingProps,w=gc(o,li.current),xc(o,c),w=kg(null,o,_,i,w,c),o.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0){if(o.tag=1,o.memoizedState=null,o.updateQueue=null,Ri(_)){var A=!0;Wp(o)}else A=!1;o.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,xg(o);var L=_.getDerivedStateFromProps;typeof L=="function"&&Qp(o,_,L,i),w.updater=ef,o.stateNode=w,w._reactInternals=o,wg(o,_,i,c),o=Bg(null,o,_,!0,A,c)}else o.tag=0,Oi(null,o,w,c),o=o.child;return o;case 16:w=o.elementType;e:{switch(i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2),i=o.pendingProps,A=w._init,w=A(w._payload),o.type=w,A=o.tag=AC(w),i=Ar(w,i),A){case 0:o=Lg(null,o,w,i,c);break e;case 1:o=pw(null,o,w,i,c);break e;case 11:o=cw(null,o,w,i,c);break e;case 14:o=uw(null,o,w,Ar(w.type,i),_,c);break e}throw Error(Ye(306,w,""))}return o;case 0:return _=o.type,w=o.pendingProps,w=o.elementType===_?w:Ar(_,w),Lg(i,o,_,w,c);case 1:return _=o.type,w=o.pendingProps,w=o.elementType===_?w:Ar(_,w),pw(i,o,_,w,c);case 3:if(fw(o),_=o.updateQueue,i===null||_===null)throw Error(Ye(282));if(_=o.pendingProps,w=o.memoizedState,w=w!==null?w.element:null,N1(i,o),gh(o,_,null,c),_=o.memoizedState.element,_===w)Sg(),o=Lo(i,o,c);else{if(w=o.stateNode,(A=w.hydrate)&&(Ls=pc(o.stateNode.containerInfo.firstChild),Do=o,A=no=!0),A){if(i=w.mutableSourceEagerHydrationData,i!=null)for(w=0;w<i.length;w+=2)A=i[w],A._workInProgressVersionPrimary=i[w+1],bc.push(A);for(c=X1(o,null,_,c),o.child=c;c;)c.flags=c.flags&-3|1024,c=c.sibling}else Oi(i,o,_,c),Sg();o=o.child}return o;case 5:return H1(o),i===null&&Eg(o),_=o.type,w=o.pendingProps,A=i!==null?i.memoizedProps:null,L=w.children,lg(_,w)?L=null:A!==null&&lg(_,A)&&(o.flags|=16),dw(i,o),Oi(i,o,L,c),o.child;case 6:return i===null&&Eg(o),null;case 13:return mw(i,o,c);case 4:return bg(o,o.stateNode.containerInfo),_=o.pendingProps,i===null?o.child=rf(o,null,_,c):Oi(i,o,_,c),o.child;case 11:return _=o.type,w=o.pendingProps,w=o.elementType===_?w:Ar(_,w),cw(i,o,_,w,c);case 7:return Oi(i,o,o.pendingProps,c),o.child;case 8:return Oi(i,o,o.pendingProps.children,c),o.child;case 12:return Oi(i,o,o.pendingProps.children,c),o.child;case 10:e:{_=o.type._context,w=o.pendingProps,L=o.memoizedProps,A=w.value;var l=o.type._context;if(An(Yp,l._currentValue),l._currentValue=A,L!==null)if(l=L.value,A=dr(l,A)?0:(typeof _._calculateChangedBits=="function"?_._calculateChangedBits(l,A):1073741823)|0,A===0){if(L.children===w.children&&!Bi.current){o=Lo(i,o,c);break e}}else for(l=o.child,l!==null&&(l.return=o);l!==null;){var W=l.dependencies;if(W!==null){L=l.child;for(var _e=W.firstContext;_e!==null;){if(_e.context===_&&(_e.observedBits&A)!=0){l.tag===1&&(_e=zs(-1,c&-c),_e.tag=2,Ds(l,_e)),l.lanes|=c,_e=l.alternate,_e!==null&&(_e.lanes|=c),U1(l.return,c),W.lanes|=c;break}_e=_e.next}}else L=l.tag===10&&l.type===o.type?null:l.child;if(L!==null)L.return=l;else for(L=l;L!==null;){if(L===o){L=null;break}if(l=L.sibling,l!==null){l.return=L.return,L=l;break}L=L.return}l=L}Oi(i,o,w.children,c),o=o.child}return o;case 9:return w=o.type,A=o.pendingProps,_=A.children,xc(o,c),w=pr(w,A.unstable_observedBits),_=_(w),o.flags|=1,Oi(i,o,_,c),o.child;case 14:return w=o.type,A=Ar(w,o.pendingProps),A=Ar(w.type,A),uw(i,o,w,A,_,c);case 15:return hw(i,o,o.type,o.pendingProps,_,c);case 17:return _=o.type,w=o.pendingProps,w=o.elementType===_?w:Ar(_,w),i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2),o.tag=1,Ri(_)?(i=!0,Wp(o)):i=!1,xc(o,c),Z1(o,_,w),wg(o,_,w,c),Bg(null,o,_,!0,i,c);case 19:return xw(i,o,c);case 23:return Dg(i,o,c);case 24:return Dg(i,o,c)}throw Error(Ye(156,o.tag))};function CC(i,o,c,_){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function _r(i,o,c,_){return new CC(i,o,c,_)}function ty(i){return i=i.prototype,!(!i||!i.isReactComponent)}function AC(i){if(typeof i=="function")return ty(i)?1:0;if(i!=null){if(i=i.$$typeof,i===wp)return 11;if(i===Tp)return 14}return 2}function Ns(i,o){var c=i.alternate;return c===null?(c=_r(i.tag,o,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=o,c.type=i.type,c.flags=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null),c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,o=i.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c}function wf(i,o,c,_,w,A){var L=2;if(_=i,typeof i=="function")ty(i)&&(L=1);else if(typeof i=="string")L=5;else e:switch(i){case ws:return kc(c.children,w,A,o);case c0:L=8,w|=16;break;case h_:L=8,w|=1;break;case Zu:return i=_r(12,c,o,w|8),i.elementType=Zu,i.type=Zu,i.lanes=A,i;case qu:return i=_r(13,c,o,w),i.type=qu,i.elementType=qu,i.lanes=A,i;case bp:return i=_r(19,c,o,w),i.elementType=bp,i.lanes=A,i;case g_:return ny(c,w,A,o);case y_:return i=_r(24,c,o,w),i.elementType=y_,i.lanes=A,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case d_:L=10;break e;case p_:L=9;break e;case wp:L=11;break e;case Tp:L=14;break e;case f_:L=16,_=null;break e;case m_:L=22;break e}throw Error(Ye(130,i==null?i:typeof i,""))}return o=_r(L,c,o,w),o.elementType=i,o.type=_,o.lanes=A,o}function kc(i,o,c,_){return i=_r(7,i,_,o),i.lanes=c,i}function ny(i,o,c,_){return i=_r(23,i,_,o),i.elementType=g_,i.lanes=c,i}function iy(i,o,c){return i=_r(6,i,null,o),i.lanes=c,i}function ry(i,o,c){return o=_r(4,i.children!==null?i.children:[],i.key,o),o.lanes=c,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}function kC(i,o,c){this.tag=o,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=c,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=G_(0),this.expirationTimes=G_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=G_(0),this.mutableSourceEagerHydrationData=null}function IC(i,o,c){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ia,key:_==null?null:""+_,children:i,containerInfo:o,implementation:c}}function bf(i,o,c,_){var w=o.current,A=er(),L=Rs(w);e:if(c){c=c._reactInternals;t:{if(Pa(c)!==c||c.tag!==1)throw Error(Ye(170));var l=c;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(Ri(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(l!==null);throw Error(Ye(171))}if(c.tag===1){var W=c.type;if(Ri(W)){c=I1(c,W,l);break e}}c=l}else c=Ms;return o.context===null?o.context=c:o.pendingContext=c,o=zs(A,L),o.payload={element:i},_=_===void 0?null:_,_!==null&&(o.callback=_),Ds(w,o),Fs(w,L,A),L}function oy(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Gw(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<o?c:o}}function sy(i,o){Gw(i,o),(i=i.alternate)&&Gw(i,o)}function MC(){return null}function ay(i,o,c){var _=c!=null&&c.hydrationOptions!=null&&c.hydrationOptions.mutableSources||null;if(c=new kC(i,o,c!=null&&c.hydrate===!0),o=_r(3,null,null,o===2?7:o===1?3:0),c.current=o,o.stateNode=c,xg(o),i[fc]=c.current,y1(i.nodeType===8?i.parentNode:i),_)for(i=0;i<_.length;i++){o=_[i];var w=o._getVersion;w=w(o._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[o,w]:c.mutableSourceEagerHydrationData.push(o,w)}this._internalRoot=c}ay.prototype.render=function(i){bf(i,this._internalRoot,null,null)};ay.prototype.unmount=function(){var i=this._internalRoot,o=i.containerInfo;bf(null,i,null,function(){o[fc]=null})};function Bh(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function PC(i,o){if(o||(o=i?i.nodeType===9?i.documentElement:i.firstChild:null,o=!(!o||o.nodeType!==1||!o.hasAttribute("data-reactroot"))),!o)for(var c;c=i.lastChild;)i.removeChild(c);return new ay(i,0,o?{hydrate:!0}:void 0)}function Tf(i,o,c,_,w){var A=c._reactRootContainer;if(A){var L=A._internalRoot;if(typeof w=="function"){var l=w;w=function(){var _e=oy(L);l.call(_e)}}bf(o,L,i,w)}else{if(A=c._reactRootContainer=PC(c,_),L=A._internalRoot,typeof w=="function"){var W=w;w=function(){var _e=oy(L);W.call(_e)}}Rw(function(){bf(o,L,i,w)})}return oy(L)}z0=function(i){if(i.tag===13){var o=er();Fs(i,4,o),sy(i,4)}};O_=function(i){if(i.tag===13){var o=er();Fs(i,67108864,o),sy(i,67108864)}};D0=function(i){if(i.tag===13){var o=er(),c=Rs(i);Fs(i,c,o),sy(i,c)}};L0=function(i,o){return o()};P_=function(i,o,c){switch(o){case"input":if(b_(i,c),o=c.name,c.type==="radio"&&o!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<c.length;o++){var _=c[o];if(_!==i&&_.form===i.form){var w=Zp(_);if(!w)throw Error(Ye(90));d0(_),b_(_,w)}}}break;case"textarea":g0(i,c);break;case"select":o=c.value,o!=null&&ic(i,!!c.multiple,o,!1)}};z_=Bw;C0=function(i,o,c,_,w){var A=vt;vt|=4;try{return Ba(98,i.bind(null,o,c,_,w))}finally{vt=A,vt===0&&(Sc(),eo())}};D_=function(){(vt&49)==0&&(gC(),Os())};A0=function(i,o){var c=vt;vt|=2;try{return i(o)}finally{vt=c,vt===0&&(Sc(),eo())}};function Zw(i,o){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bh(o))throw Error(Ye(200));return IC(i,o,null,c)}var zC={Events:[mh,mc,Zp,E0,S0,Os,{current:!1}]},Rh={findFiberByHostInstance:za,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},DC={bundleType:Rh.bundleType,version:Rh.version,rendererPackageName:Rh.rendererPackageName,rendererConfig:Rh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ka.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=M0(i),i===null?null:i.stateNode},findFiberByHostInstance:Rh.findFiberByHostInstance||MC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Ef=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ef.isDisabled&&Ef.supportsFiber)try{dg=Ef.inject(DC),La=Ef}catch{}}hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zC;hr.createPortal=Zw;hr.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(Ye(188)):Error(Ye(268,Object.keys(i)));return i=M0(o),i=i===null?null:i.stateNode,i};hr.flushSync=function(i,o){var c=vt;if((c&48)!=0)return i(o);vt|=1;try{if(i)return Ba(99,i.bind(null,o))}finally{vt=c,eo()}};hr.hydrate=function(i,o,c){if(!Bh(o))throw Error(Ye(200));return Tf(null,i,o,!0,c)};hr.render=function(i,o,c){if(!Bh(o))throw Error(Ye(200));return Tf(null,i,o,!1,c)};hr.unmountComponentAtNode=function(i){if(!Bh(i))throw Error(Ye(40));return i._reactRootContainer?(Rw(function(){Tf(null,null,i,!1,function(){i._reactRootContainer=null,i[fc]=null})}),!0):!1};hr.unstable_batchedUpdates=Bw;hr.unstable_createPortal=function(i,o){return Zw(i,o,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};hr.unstable_renderSubtreeIntoContainer=function(i,o,c,_){if(!Bh(c))throw Error(Ye(200));if(i==null||i._reactInternals===void 0)throw Error(Ye(38));return Tf(i,o,c,!1,_)};hr.version="17.0.2";function qw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(qw)}catch(i){console.error(i)}}qw(),n0.exports=hr;var FM=n0.exports,ly={exports:{}},Ww=function(o,c){return function(){for(var w=new Array(arguments.length),A=0;A<w.length;A++)w[A]=arguments[A];return o.apply(c,w)}},LC=Ww,Va=Object.prototype.toString;function cy(i){return Va.call(i)==="[object Array]"}function uy(i){return typeof i=="undefined"}function BC(i){return i!==null&&!uy(i)&&i.constructor!==null&&!uy(i.constructor)&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function RC(i){return Va.call(i)==="[object ArrayBuffer]"}function FC(i){return typeof FormData!="undefined"&&i instanceof FormData}function OC(i){var o;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?o=ArrayBuffer.isView(i):o=i&&i.buffer&&i.buffer instanceof ArrayBuffer,o}function UC(i){return typeof i=="string"}function NC(i){return typeof i=="number"}function Xw(i){return i!==null&&typeof i=="object"}function Sf(i){if(Va.call(i)!=="[object Object]")return!1;var o=Object.getPrototypeOf(i);return o===null||o===Object.prototype}function VC(i){return Va.call(i)==="[object Date]"}function jC(i){return Va.call(i)==="[object File]"}function $C(i){return Va.call(i)==="[object Blob]"}function Hw(i){return Va.call(i)==="[object Function]"}function GC(i){return Xw(i)&&Hw(i.pipe)}function ZC(i){return typeof URLSearchParams!="undefined"&&i instanceof URLSearchParams}function qC(i){return i.trim?i.trim():i.replace(/^\s+|\s+$/g,"")}function WC(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function hy(i,o){if(!(i===null||typeof i=="undefined"))if(typeof i!="object"&&(i=[i]),cy(i))for(var c=0,_=i.length;c<_;c++)o.call(null,i[c],c,i);else for(var w in i)Object.prototype.hasOwnProperty.call(i,w)&&o.call(null,i[w],w,i)}function dy(){var i={};function o(w,A){Sf(i[A])&&Sf(w)?i[A]=dy(i[A],w):Sf(w)?i[A]=dy({},w):cy(w)?i[A]=w.slice():i[A]=w}for(var c=0,_=arguments.length;c<_;c++)hy(arguments[c],o);return i}function XC(i,o,c){return hy(o,function(w,A){c&&typeof w=="function"?i[A]=LC(w,c):i[A]=w}),i}function HC(i){return i.charCodeAt(0)===65279&&(i=i.slice(1)),i}var tr={isArray:cy,isArrayBuffer:RC,isBuffer:BC,isFormData:FC,isArrayBufferView:OC,isString:UC,isNumber:NC,isObject:Xw,isPlainObject:Sf,isUndefined:uy,isDate:VC,isFile:jC,isBlob:$C,isFunction:Hw,isStream:GC,isURLSearchParams:ZC,isStandardBrowserEnv:WC,forEach:hy,merge:dy,extend:XC,trim:qC,stripBOM:HC},Ic=tr;function Yw(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Kw=function(o,c,_){if(!c)return o;var w;if(_)w=_(c);else if(Ic.isURLSearchParams(c))w=c.toString();else{var A=[];Ic.forEach(c,function(W,_e){W===null||typeof W=="undefined"||(Ic.isArray(W)?_e=_e+"[]":W=[W],Ic.forEach(W,function(he){Ic.isDate(he)?he=he.toISOString():Ic.isObject(he)&&(he=JSON.stringify(he)),A.push(Yw(_e)+"="+Yw(he))}))}),w=A.join("&")}if(w){var L=o.indexOf("#");L!==-1&&(o=o.slice(0,L)),o+=(o.indexOf("?")===-1?"?":"&")+w}return o},YC=tr;function Cf(){this.handlers=[]}Cf.prototype.use=function(o,c,_){return this.handlers.push({fulfilled:o,rejected:c,synchronous:_?_.synchronous:!1,runWhen:_?_.runWhen:null}),this.handlers.length-1};Cf.prototype.eject=function(o){this.handlers[o]&&(this.handlers[o]=null)};Cf.prototype.forEach=function(o){YC.forEach(this.handlers,function(_){_!==null&&o(_)})};var KC=Cf,JC=tr,QC=function(o,c){JC.forEach(o,function(w,A){A!==c&&A.toUpperCase()===c.toUpperCase()&&(o[c]=w,delete o[A])})},Jw=function(o,c,_,w,A){return o.config=c,_&&(o.code=_),o.request=w,o.response=A,o.isAxiosError=!0,o.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},o},eA=Jw,Qw=function(o,c,_,w,A){var L=new Error(o);return eA(L,c,_,w,A)},tA=Qw,nA=function(o,c,_){var w=_.config.validateStatus;!_.status||!w||w(_.status)?o(_):c(tA("Request failed with status code "+_.status,_.config,null,_.request,_))},Af=tr,iA=Af.isStandardBrowserEnv()?function(){return{write:function(c,_,w,A,L,l){var W=[];W.push(c+"="+encodeURIComponent(_)),Af.isNumber(w)&&W.push("expires="+new Date(w).toGMTString()),Af.isString(A)&&W.push("path="+A),Af.isString(L)&&W.push("domain="+L),l===!0&&W.push("secure"),document.cookie=W.join("; ")},read:function(c){var _=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return _?decodeURIComponent(_[3]):null},remove:function(c){this.write(c,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),rA=function(o){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(o)},oA=function(o,c){return c?o.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):o},sA=rA,aA=oA,lA=function(o,c){return o&&!sA(c)?aA(o,c):c},py=tr,cA=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],uA=function(o){var c={},_,w,A;return o&&py.forEach(o.split(`
`),function(l){if(A=l.indexOf(":"),_=py.trim(l.substr(0,A)).toLowerCase(),w=py.trim(l.substr(A+1)),_){if(c[_]&&cA.indexOf(_)>=0)return;_==="set-cookie"?c[_]=(c[_]?c[_]:[]).concat([w]):c[_]=c[_]?c[_]+", "+w:w}}),c},eb=tr,hA=eb.isStandardBrowserEnv()?function(){var o=/(msie|trident)/i.test(navigator.userAgent),c=document.createElement("a"),_;function w(A){var L=A;return o&&(c.setAttribute("href",L),L=c.href),c.setAttribute("href",L),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:c.pathname.charAt(0)==="/"?c.pathname:"/"+c.pathname}}return _=w(window.location.href),function(L){var l=eb.isString(L)?w(L):L;return l.protocol===_.protocol&&l.host===_.host}}():function(){return function(){return!0}}();function fy(i){this.message=i}fy.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};fy.prototype.__CANCEL__=!0;var kf=fy,If=tr,dA=nA,pA=iA,fA=Kw,mA=lA,_A=uA,gA=hA,my=Qw,yA=Pf,vA=kf,tb=function(o){return new Promise(function(_,w){var A=o.data,L=o.headers,l=o.responseType,W;function _e(){o.cancelToken&&o.cancelToken.unsubscribe(W),o.signal&&o.signal.removeEventListener("abort",W)}If.isFormData(A)&&delete L["Content-Type"];var ve=new XMLHttpRequest;if(o.auth){var he=o.auth.username||"",ne=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";L.Authorization="Basic "+btoa(he+":"+ne)}var Me=mA(o.baseURL,o.url);ve.open(o.method.toUpperCase(),fA(Me,o.params,o.paramsSerializer),!0),ve.timeout=o.timeout;function tt(){if(!!ve){var de="getAllResponseHeaders"in ve?_A(ve.getAllResponseHeaders()):null,te=!l||l==="text"||l==="json"?ve.responseText:ve.response,ae={data:te,status:ve.status,statusText:ve.statusText,headers:de,config:o,request:ve};dA(function(Le){_(Le),_e()},function(Le){w(Le),_e()},ae),ve=null}}if("onloadend"in ve?ve.onloadend=tt:ve.onreadystatechange=function(){!ve||ve.readyState!==4||ve.status===0&&!(ve.responseURL&&ve.responseURL.indexOf("file:")===0)||setTimeout(tt)},ve.onabort=function(){!ve||(w(my("Request aborted",o,"ECONNABORTED",ve)),ve=null)},ve.onerror=function(){w(my("Network Error",o,null,ve)),ve=null},ve.ontimeout=function(){var te=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded",ae=o.transitional||yA.transitional;o.timeoutErrorMessage&&(te=o.timeoutErrorMessage),w(my(te,o,ae.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",ve)),ve=null},If.isStandardBrowserEnv()){var nt=(o.withCredentials||gA(Me))&&o.xsrfCookieName?pA.read(o.xsrfCookieName):void 0;nt&&(L[o.xsrfHeaderName]=nt)}"setRequestHeader"in ve&&If.forEach(L,function(te,ae){typeof A=="undefined"&&ae.toLowerCase()==="content-type"?delete L[ae]:ve.setRequestHeader(ae,te)}),If.isUndefined(o.withCredentials)||(ve.withCredentials=!!o.withCredentials),l&&l!=="json"&&(ve.responseType=o.responseType),typeof o.onDownloadProgress=="function"&&ve.addEventListener("progress",o.onDownloadProgress),typeof o.onUploadProgress=="function"&&ve.upload&&ve.upload.addEventListener("progress",o.onUploadProgress),(o.cancelToken||o.signal)&&(W=function(de){!ve||(w(!de||de&&de.type?new vA("canceled"):de),ve.abort(),ve=null)},o.cancelToken&&o.cancelToken.subscribe(W),o.signal&&(o.signal.aborted?W():o.signal.addEventListener("abort",W))),A||(A=null),ve.send(A)})},ii=tr,nb=QC,xA=Jw,wA={"Content-Type":"application/x-www-form-urlencoded"};function ib(i,o){!ii.isUndefined(i)&&ii.isUndefined(i["Content-Type"])&&(i["Content-Type"]=o)}function bA(){var i;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(i=tb),i}function TA(i,o,c){if(ii.isString(i))try{return(o||JSON.parse)(i),ii.trim(i)}catch(_){if(_.name!=="SyntaxError")throw _}return(c||JSON.stringify)(i)}var Mf={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:bA(),transformRequest:[function(o,c){return nb(c,"Accept"),nb(c,"Content-Type"),ii.isFormData(o)||ii.isArrayBuffer(o)||ii.isBuffer(o)||ii.isStream(o)||ii.isFile(o)||ii.isBlob(o)?o:ii.isArrayBufferView(o)?o.buffer:ii.isURLSearchParams(o)?(ib(c,"application/x-www-form-urlencoded;charset=utf-8"),o.toString()):ii.isObject(o)||c&&c["Content-Type"]==="application/json"?(ib(c,"application/json"),TA(o)):o}],transformResponse:[function(o){var c=this.transitional||Mf.transitional,_=c&&c.silentJSONParsing,w=c&&c.forcedJSONParsing,A=!_&&this.responseType==="json";if(A||w&&ii.isString(o)&&o.length)try{return JSON.parse(o)}catch(L){if(A)throw L.name==="SyntaxError"?xA(L,this,"E_JSON_PARSE"):L}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ii.forEach(["delete","get","head"],function(o){Mf.headers[o]={}});ii.forEach(["post","put","patch"],function(o){Mf.headers[o]=ii.merge(wA)});var Pf=Mf,EA=tr,SA=Pf,CA=function(o,c,_){var w=this||SA;return EA.forEach(_,function(L){o=L.call(w,o,c)}),o},rb=function(o){return!!(o&&o.__CANCEL__)},ob=tr,_y=CA,AA=rb,kA=Pf,IA=kf;function gy(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new IA("canceled")}var MA=function(o){gy(o),o.headers=o.headers||{},o.data=_y.call(o,o.data,o.headers,o.transformRequest),o.headers=ob.merge(o.headers.common||{},o.headers[o.method]||{},o.headers),ob.forEach(["delete","get","head","post","put","patch","common"],function(w){delete o.headers[w]});var c=o.adapter||kA.adapter;return c(o).then(function(w){return gy(o),w.data=_y.call(o,w.data,w.headers,o.transformResponse),w},function(w){return AA(w)||(gy(o),w&&w.response&&(w.response.data=_y.call(o,w.response.data,w.response.headers,o.transformResponse))),Promise.reject(w)})},nr=tr,sb=function(o,c){c=c||{};var _={};function w(ve,he){return nr.isPlainObject(ve)&&nr.isPlainObject(he)?nr.merge(ve,he):nr.isPlainObject(he)?nr.merge({},he):nr.isArray(he)?he.slice():he}function A(ve){if(nr.isUndefined(c[ve])){if(!nr.isUndefined(o[ve]))return w(void 0,o[ve])}else return w(o[ve],c[ve])}function L(ve){if(!nr.isUndefined(c[ve]))return w(void 0,c[ve])}function l(ve){if(nr.isUndefined(c[ve])){if(!nr.isUndefined(o[ve]))return w(void 0,o[ve])}else return w(void 0,c[ve])}function W(ve){if(ve in c)return w(o[ve],c[ve]);if(ve in o)return w(void 0,o[ve])}var _e={url:L,method:L,data:L,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:W};return nr.forEach(Object.keys(o).concat(Object.keys(c)),function(he){var ne=_e[he]||A,Me=ne(he);nr.isUndefined(Me)&&ne!==W||(_[he]=Me)}),_},ab={version:"0.24.0"},PA=ab.version,yy={};["object","boolean","number","function","string","symbol"].forEach(function(i,o){yy[i]=function(_){return typeof _===i||"a"+(o<1?"n ":" ")+i}});var lb={};yy.transitional=function(o,c,_){function w(A,L){return"[Axios v"+PA+"] Transitional option '"+A+"'"+L+(_?". "+_:"")}return function(A,L,l){if(o===!1)throw new Error(w(L," has been removed"+(c?" in "+c:"")));return c&&!lb[L]&&(lb[L]=!0,console.warn(w(L," has been deprecated since v"+c+" and will be removed in the near future"))),o?o(A,L,l):!0}};function zA(i,o,c){if(typeof i!="object")throw new TypeError("options must be an object");for(var _=Object.keys(i),w=_.length;w-- >0;){var A=_[w],L=o[A];if(L){var l=i[A],W=l===void 0||L(l,A,i);if(W!==!0)throw new TypeError("option "+A+" must be "+W);continue}if(c!==!0)throw Error("Unknown option "+A)}}var DA={assertOptions:zA,validators:yy},cb=tr,LA=Kw,ub=KC,hb=MA,zf=sb,db=DA,Mc=db.validators;function Fh(i){this.defaults=i,this.interceptors={request:new ub,response:new ub}}Fh.prototype.request=function(o){typeof o=="string"?(o=arguments[1]||{},o.url=arguments[0]):o=o||{},o=zf(this.defaults,o),o.method?o.method=o.method.toLowerCase():this.defaults.method?o.method=this.defaults.method.toLowerCase():o.method="get";var c=o.transitional;c!==void 0&&db.assertOptions(c,{silentJSONParsing:Mc.transitional(Mc.boolean),forcedJSONParsing:Mc.transitional(Mc.boolean),clarifyTimeoutError:Mc.transitional(Mc.boolean)},!1);var _=[],w=!0;this.interceptors.request.forEach(function(ne){typeof ne.runWhen=="function"&&ne.runWhen(o)===!1||(w=w&&ne.synchronous,_.unshift(ne.fulfilled,ne.rejected))});var A=[];this.interceptors.response.forEach(function(ne){A.push(ne.fulfilled,ne.rejected)});var L;if(!w){var l=[hb,void 0];for(Array.prototype.unshift.apply(l,_),l=l.concat(A),L=Promise.resolve(o);l.length;)L=L.then(l.shift(),l.shift());return L}for(var W=o;_.length;){var _e=_.shift(),ve=_.shift();try{W=_e(W)}catch(he){ve(he);break}}try{L=hb(W)}catch(he){return Promise.reject(he)}for(;A.length;)L=L.then(A.shift(),A.shift());return L};Fh.prototype.getUri=function(o){return o=zf(this.defaults,o),LA(o.url,o.params,o.paramsSerializer).replace(/^\?/,"")};cb.forEach(["delete","get","head","options"],function(o){Fh.prototype[o]=function(c,_){return this.request(zf(_||{},{method:o,url:c,data:(_||{}).data}))}});cb.forEach(["post","put","patch"],function(o){Fh.prototype[o]=function(c,_,w){return this.request(zf(w||{},{method:o,url:c,data:_}))}});var BA=Fh,RA=kf;function Pc(i){if(typeof i!="function")throw new TypeError("executor must be a function.");var o;this.promise=new Promise(function(w){o=w});var c=this;this.promise.then(function(_){if(!!c._listeners){var w,A=c._listeners.length;for(w=0;w<A;w++)c._listeners[w](_);c._listeners=null}}),this.promise.then=function(_){var w,A=new Promise(function(L){c.subscribe(L),w=L}).then(_);return A.cancel=function(){c.unsubscribe(w)},A},i(function(w){c.reason||(c.reason=new RA(w),o(c.reason))})}Pc.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};Pc.prototype.subscribe=function(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]};Pc.prototype.unsubscribe=function(o){if(!!this._listeners){var c=this._listeners.indexOf(o);c!==-1&&this._listeners.splice(c,1)}};Pc.source=function(){var o,c=new Pc(function(w){o=w});return{token:c,cancel:o}};var FA=Pc,OA=function(o){return function(_){return o.apply(null,_)}},UA=function(o){return typeof o=="object"&&o.isAxiosError===!0},pb=tr,NA=Ww,Df=BA,VA=sb,jA=Pf;function fb(i){var o=new Df(i),c=NA(Df.prototype.request,o);return pb.extend(c,Df.prototype,o),pb.extend(c,o),c.create=function(w){return fb(VA(i,w))},c}var oo=fb(jA);oo.Axios=Df;oo.Cancel=kf;oo.CancelToken=FA;oo.isCancel=rb;oo.VERSION=ab.version;oo.all=function(o){return Promise.all(o)};oo.spread=OA;oo.isAxiosError=UA;ly.exports=oo;ly.exports.default=oo;var OM=ly.exports,$A={exports:{}},Oh={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GA=gp.exports,mb=60103;Oh.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var _b=Symbol.for;mb=_b("react.element"),Oh.Fragment=_b("react.fragment")}var ZA=GA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qA=Object.prototype.hasOwnProperty,WA={key:!0,ref:!0,__self:!0,__source:!0};function gb(i,o,c){var _,w={},A=null,L=null;c!==void 0&&(A=""+c),o.key!==void 0&&(A=""+o.key),o.ref!==void 0&&(L=o.ref);for(_ in o)qA.call(o,_)&&!WA.hasOwnProperty(_)&&(w[_]=o[_]);if(i&&i.defaultProps)for(_ in o=i.defaultProps,o)w[_]===void 0&&(w[_]=o[_]);return{$$typeof:mb,type:i,key:A,ref:L,props:w,_owner:ZA.current}}Oh.jsx=gb;Oh.jsxs=gb;$A.exports=Oh;var yb={exports:{}};(function(i,o){(function(c,_){i.exports=_()})(ME,function(){var c,_,w;function A(l,W){if(!c)c=W;else if(!_)_=W;else{var _e="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+_+")(sharedChunk); self.onerror = null;",ve={};c(ve),w=W(ve),typeof window!="undefined"&&(w.workerUrl=window.URL.createObjectURL(new Blob([_e],{type:"text/javascript"})))}}A(["exports"],function(l){var W="2.6.1",_e=ve;function ve(n,e,r,s){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=r,this.p2y=s}ve.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},ve.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},ve.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},ve.prototype.solveCurveX=function(n,e){var r,s,u,d,f;for(e===void 0&&(e=1e-6),u=n,f=0;f<8;f++){if(d=this.sampleCurveX(u)-n,Math.abs(d)<e)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=d/y}if((u=n)<(r=0))return r;if(u>(s=1))return s;for(;r<s;){if(d=this.sampleCurveX(u),Math.abs(d-n)<e)return u;n>d?r=u:s=u,u=.5*(s-r)+r}return u},ve.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var he=ne;function ne(n,e){this.x=n,this.y=e}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(n,e){var r=Math.cos(n),s=Math.sin(n),u=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(n){return n instanceof ne?n:Array.isArray(n)?new ne(n[0],n[1]):n};var Me=typeof self!="undefined"?self:{};const tt=Math.pow(2,53)-1,nt=Math.PI/180,de=180/Math.PI;function te(n){return n*nt}function ae(n){return n*de}const De=[[0,0],[1,0],[1,1],[0,1]];function Le(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function lt(n,e,r,s){const u=new _e(n,e,r,s);return function(d){return u.solve(d)}}const He=lt(.25,.1,.25,1);function Ke(n,e,r){return Math.min(r,Math.max(e,n))}function pt(n,e,r){const s=r-e,u=((n-e)%s+s)%s+e;return u===e?r:u}function st(n,e,r){if(!n.length)return r(null,[]);let s=n.length;const u=new Array(n.length);let d=null;n.forEach((f,y)=>{e(f,(v,b)=>{v&&(d=v),u[y]=b,--s==0&&r(d,u)})})}function on(n){const e=[];for(const r in n)e.push(n[r]);return e}function tn(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}let Un=1;function sn(){return Un++}function rr(){return function n(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function mi(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Vi(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function ji(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function $i(n,e){return n.indexOf(e,n.length-e.length)!==-1}function _i(n,e,r){const s={};for(const u in n)s[u]=e.call(r||this,n[u],u,n);return s}function Si(n,e,r){const s={};for(const u in n)e.call(r||this,n[u],u,n)&&(s[u]=n[u]);return s}function $e(n){return Array.isArray(n)?n.map($e):typeof n=="object"&&n?_i(n,$e):n}const ut={};function ot(n){ut[n]||(typeof console!="undefined"&&console.warn(n),ut[n]=!0)}function Lt(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function hn(n){let e=0;for(let r,s,u=0,d=n.length,f=d-1;u<d;f=u++)r=n[u],s=n[f],e+=(s.x-r.x)*(r.y+s.y);return e}function In(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Hn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,u,d)=>{const f=u||d;return e[s]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Ci,xt,Fo,Oo=null;function Zs(n){if(Oo==null){const e=n.navigator?n.navigator.userAgent:null;Oo=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Oo}function ao(n){try{const e=Me[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const gi={now:()=>Fo!==void 0?Fo:Me.performance.now(),setNow(n){Fo=n},restoreNow(){Fo=void 0},frame(n){const e=Me.requestAnimationFrame(n);return{cancel:()=>Me.cancelAnimationFrame(e)}},getImageData(n,e=0){const r=Me.document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return r.width=n.width,r.height=n.height,s.drawImage(n,0,0,n.width,n.height),s.getImageData(-e,-e,n.width+2*e,n.height+2*e)},resolveURL:n=>(Ci||(Ci=Me.document.createElement("a")),Ci.href=n,Ci.href),get devicePixelRatio(){return Me.devicePixelRatio},get prefersReducedMotion(){return!!Me.matchMedia&&(xt==null&&(xt=Me.matchMedia("(prefers-reduced-motion: reduce)")),xt.matches)}};let Uo;const Ct={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Uo==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Uo={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):n}catch{Uo=n}}return Uo},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},lo={supported:!1,testSupport:function(n){!qs&&or&&(zr?No(n):Pr=n)}};let Pr,or,qs=!1,zr=!1;function No(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,or),n.isContextLost())return;lo.supported=!0}catch{}n.deleteTexture(e),qs=!0}Me.document&&(or=Me.document.createElement("img"),or.onload=function(){Pr&&No(Pr),Pr=null,zr=!0},or.onerror=function(){qs=!0,Pr=null},or.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Vo="01",jo="NO_ACCESS_TOKEN";function Ai(n){return n.indexOf("mapbox:")===0}function Dr(n){return Ct.API_URL_REGEX.test(n)}const Za=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ki(n){const e=n.match(Za);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Yn(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function qa(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(Me.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class $o{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=qa(Ct.ACCESS_TOKEN);let s="";return s=r&&r.u?Me.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(Number("0x"+d)))):Ct.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=ao("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=Me.localStorage.getItem(r);u&&(this.eventData=JSON.parse(u));const d=Me.localStorage.getItem(s);d&&(this.anonId=d)}catch{ot("Unable to read from LocalStorage")}}saveEventData(){const e=ao("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Me.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Me.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{ot("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,u){if(!Ct.EVENTS_URL)return;const d=ki(Ct.EVENTS_URL);d.params.push(`access_token=${u||Ct.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:W,skuId:Vo,userId:this.anonId},y=r?tn(f,r):f,v={url:Yn(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=G(v,b=>{this.pendingRequest=null,s(b),this.saveEventData(),this.processRequests(u)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Ws=new class extends $o{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){Ct.EVENTS_URL&&Ct.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>Ai(r)||Dr(r))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=qa(Ct.ACCESS_TOKEN),r=e?e.u:Ct.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;Vi(this.anonId)||(this.anonId=rr(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),f=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||d.getDate()!==f.getDate()}else s=!0;if(!s)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=r)},n)}},Xs=Ws.postTurnstileEvent.bind(Ws),Go=new class extends $o{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,r,s){this.skuToken=e,this.errorCb=s,Ct.EVENTS_URL&&(r||Ct.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(jo)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Vi(this.anonId)||(this.anonId=rr()),this.postEvent(r,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},Uc=Go.postMapLoadEvent.bind(Go),Wa=new class extends $o{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,r,s){if(!Ct.API_URL||!Ct.SESSION_PATH)return;const u=ki(Ct.API_URL+Ct.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||Ct.ACCESS_TOKEN||""}`);const d={url:Yn(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Y(d,f=>{this.pendingRequest=null,r(f),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,e,r,s){this.skuToken=e,this.errorCb=s,Ct.SESSION_PATH&&Ct.API_URL&&(r||Ct.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(jo)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},Xa=Wa.getSessionAPI.bind(Wa),Lr=new Set,Hs="mapbox-tiles";let Ii,co,Ha=500,uo=50;function vr(){Me.caches&&!Ii&&(Ii=Me.caches.open(Hs))}function Zo(n){const e=n.indexOf("?");return e<0?n:n.slice(0,e)}let Ys=1/0;const ho={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ho);class po extends Error{constructor(e,r,s){r===401&&Dr(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const q=In()?()=>self.worker&&self.worker.referrer:()=>(Me.location.protocol==="blob:"?Me.parent:Me).location.href,z=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(q())&&!/^\w+:/.test(r))){if(Me.fetch&&Me.Request&&Me.AbortController&&Me.Request.prototype.hasOwnProperty("signal"))return function(s,u){const d=new Me.AbortController,f=new Me.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:q(),signal:d.signal});let y=!1,v=!1;const b=(E=f.url).indexOf("sku=")>0&&Dr(E);var E;s.type==="json"&&f.headers.set("Accept","application/json");const S=(D,B,O)=>{if(v)return;if(D&&D.message!=="SecurityError"&&ot(D),B&&O)return k(B);const Z=Date.now();Me.fetch(f).then(K=>{if(K.ok){const ee=b?K.clone():null;return k(K,ee,Z)}return u(new po(K.statusText,K.status,s.url))}).catch(K=>{K.code!==20&&u(new Error(K.message))})},k=(D,B,O)=>{(s.type==="arrayBuffer"?D.arrayBuffer():s.type==="json"?D.json():D.text()).then(Z=>{v||(B&&O&&function(K,ee,se){if(vr(),!Ii)return;const ue={status:ee.status,statusText:ee.statusText,headers:new Me.Headers};ee.headers.forEach((pe,Ae)=>ue.headers.set(Ae,pe));const le=Hn(ee.headers.get("Cache-Control")||"");le["no-store"]||(le["max-age"]&&ue.headers.set("Expires",new Date(se+1e3*le["max-age"]).toUTCString()),new Date(ue.headers.get("Expires")).getTime()-se<42e4||function(pe,Ae){if(co===void 0)try{new Response(new ReadableStream),co=!0}catch{co=!1}co?Ae(pe.body):pe.blob().then(Ae)}(ee,pe=>{const Ae=new Me.Response(pe,ue);vr(),Ii&&Ii.then(be=>be.put(Zo(K.url),Ae)).catch(be=>ot(be.message))}))}(f,B,O),y=!0,u(null,Z,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(Z=>{v||u(new Error(Z.message))})};return b?function(D,B){if(vr(),!Ii)return B(null);const O=Zo(D.url);Ii.then(Z=>{Z.match(O).then(K=>{const ee=function(se){if(!se)return!1;const ue=new Date(se.headers.get("Expires")||0),le=Hn(se.headers.get("Cache-Control")||"");return ue>Date.now()&&!le["no-cache"]}(K);Z.delete(O),ee&&Z.put(O,K.clone()),B(null,K,ee)}).catch(B)}).catch(B)}(f,S):S(null,null),{cancel:()=>{v=!0,y||d.abort()}}}(n,e);if(In()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(s,u){const d=new Me.XMLHttpRequest;d.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in s.headers)d.setRequestHeader(f,s.headers[f]);return s.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=s.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(s.type==="json")try{f=JSON.parse(d.response)}catch(y){return u(y)}u(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new po(d.statusText,d.status,s.url))},d.send(s.body),{cancel:()=>d.abort()}}(n,e)},R=function(n,e){return z(tn(n,{type:"arrayBuffer"}),e)},G=function(n,e){return z(tn(n,{method:"POST"}),e)},Y=function(n,e){return z(tn(n,{method:"GET"}),e)};function ie(n){const e=Me.document.createElement("a");return e.href=n,e.protocol===Me.document.location.protocol&&e.host===Me.document.location.host}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let fe,oe;fe=[],oe=0;const ge=function(n,e){if(lo.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),oe>=Ct.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return fe.push(d),d}oe++;let r=!1;const s=()=>{if(!r)for(r=!0,oe--;fe.length&&oe<Ct.MAX_PARALLEL_IMAGE_REQUESTS;){const d=fe.shift(),{requestParameters:f,callback:y,cancelled:v}=d;v||(d.cancel=ge(f,y).cancel)}},u=R(n,(d,f,y,v)=>{s(),d?e(d):f&&(Me.createImageBitmap?function(b,E){const S=new Me.Blob([new Uint8Array(b)],{type:"image/png"});Me.createImageBitmap(S).then(k=>{E(null,k)}).catch(k=>{E(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,E)=>e(b,E,y,v)):function(b,E){const S=new Me.Image,k=Me.URL;S.onload=()=>{E(null,S),k.revokeObjectURL(S.src),S.onload=null,Me.requestAnimationFrame(()=>{S.src=me})},S.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Me.Blob([new Uint8Array(b)],{type:"image/png"});S.src=b.byteLength?k.createObjectURL(D):me}(f,(b,E)=>e(b,E,y,v)))});return{cancel:()=>{u.cancel(),s()}}};function Pe(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function Ge(n,e,r){if(r&&r[n]){const s=r[n].indexOf(e);s!==-1&&r[n].splice(s,1)}}class Be{constructor(e,r={}){tn(this,r),this.type=e}}class it extends Be{constructor(e,r={}){super("error",tn({error:e},r))}}class je{on(e,r){return this._listeners=this._listeners||{},Pe(e,r,this._listeners),this}off(e,r){return Ge(e,r,this._listeners),Ge(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Pe(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new Be(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of u)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of d)Ge(s,y,this._oneTimeListeners),y.call(this,e);const f=this._eventedParent;f&&(tn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof it&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ce=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Te{constructor(e,r,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function St(n){const e=n.value;return e?[new Te(n.key,e,"constants have been deprecated as of v8")]:[]}function Ot(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}function _t(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function At(n){if(Array.isArray(n))return n.map(At);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=At(n[r]);return e}return _t(n)}class zt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class fo{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,u]of r)this.bindings[s]=u}concat(e){return new fo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const sr={kind:"null"},Ze={kind:"number"},Et={kind:"string"},wt={kind:"boolean"},mn={kind:"color"},mo={kind:"object"},bt={kind:"value"},Ya={kind:"collator"},qo={kind:"formatted"},Wo={kind:"resolvedImage"};function yi(n,e){return{kind:"array",itemType:n,N:e}}function nn(n){if(n.kind==="array"){const e=nn(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Wh=[sr,Ze,Et,wt,mn,qo,mo,yi(bt),Wo];function Br(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Br(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of Wh)if(!Br(r,e))return null}}return`Expected ${nn(n)} but found ${nn(e)} instead.`}function Nc(n,e){return e.some(r=>r.kind===n.kind)}function Gi(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Ka(n){var e={exports:{}};return n(e,e.exports),e.exports}var Zi=Ka(function(n,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(y){return(y=Math.round(y))<0?0:y>255?255:y}function u(y){return s(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function d(y){return(v=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:v>1?1:v;var v}function f(y,v,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?y+(v-y)*b*6:2*b<1?v:3*b<2?y+(v-y)*(2/3-b)*6:y}try{e.parseCSSColor=function(y){var v,b=y.replace(/ /g,"").toLowerCase();if(b in r)return r[b].slice();if(b[0]==="#")return b.length===4?(v=parseInt(b.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:b.length===7&&(v=parseInt(b.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var E=b.indexOf("("),S=b.indexOf(")");if(E!==-1&&S+1===b.length){var k=b.substr(0,E),D=b.substr(E+1,S-(E+1)).split(","),B=1;switch(k){case"rgba":if(D.length!==4)return null;B=d(D.pop());case"rgb":return D.length!==3?null:[u(D[0]),u(D[1]),u(D[2]),B];case"hsla":if(D.length!==4)return null;B=d(D.pop());case"hsl":if(D.length!==3)return null;var O=(parseFloat(D[0])%360+360)%360/360,Z=d(D[1]),K=d(D[2]),ee=K<=.5?K*(Z+1):K+Z-K*Z,se=2*K-ee;return[s(255*f(se,ee,O+1/3)),s(255*f(se,ee,O)),s(255*f(se,ee,O-1/3)),B];default:return null}}return null}}catch{}});class Dt{constructor(e,r,s,u=1){this.r=e,this.g=r,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Dt)return e;if(typeof e!="string")return;const r=Zi.parseCSSColor(e);return r?new Dt(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${u})`}toArray(){const{r:e,g:r,b:s,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*s/u,u]}}Dt.black=new Dt(0,0,0,1),Dt.white=new Dt(1,1,1,1),Dt.transparent=new Dt(0,0,0,0),Dt.red=new Dt(1,0,0,1),Dt.blue=new Dt(0,0,1,1);class Ja{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _o{constructor(e,r,s,u,d){this.text=e,this.image=r,this.scale=s,this.fontStack=u,this.textColor=d}}class Nn{constructor(e){this.sections=e}static fromString(e){return new Nn([new _o(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Nn?e:Nn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class Mi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Mi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Xh(n,e,r,s){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,e,r,s]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qa(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Dt||n instanceof Ja||n instanceof Nn||n instanceof Mi)return!0;if(Array.isArray(n)){for(const e of n)if(!Qa(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Qa(n[e]))return!1;return!0}return!1}function _n(n){if(n===null)return sr;if(typeof n=="string")return Et;if(typeof n=="boolean")return wt;if(typeof n=="number")return Ze;if(n instanceof Dt)return mn;if(n instanceof Ja)return Ya;if(n instanceof Nn)return qo;if(n instanceof Mi)return Wo;if(Array.isArray(n)){const e=n.length;let r;for(const s of n){const u=_n(s);if(r){if(r===u)continue;r=bt;break}r=u}return yi(r||bt,e)}return mo}function go(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Dt||n instanceof Nn||n instanceof Mi?n.toString():JSON.stringify(n)}class yo{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Qa(e[1]))return r.error("invalid value");const s=e[1];let u=_n(s);const d=r.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new yo(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Dt?["rgba"].concat(this.value.toArray()):this.value instanceof Nn?this.value.serialize():this.value}}class vn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Vc={string:Et,number:Ze,boolean:wt,object:mo};class qi{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,u=1;const d=e[0];if(d==="array"){let y,v;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in Vc)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Vc[b],u++}else y=bt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],u++}s=yi(y,v)}else s=Vc[d];const f=[];for(;u<e.length;u++){const y=r.parse(e[u],u,bt);if(!y)return null;f.push(y)}return new qi(s,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!Br(this.type,_n(s)))return s;if(r===this.args.length-1)throw new vn(`Expected value to be of type ${nn(this.type)}, but found ${nn(_n(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){r.push(s.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(s=>s.serialize()))}}class Ks{constructor(e){this.type=qo,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const u=[];let d=!1;for(let f=1;f<=e.length-1;++f){const y=e[f];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let v=null;if(y["font-scale"]&&(v=r.parse(y["font-scale"],1,Ze),!v))return null;let b=null;if(y["text-font"]&&(b=r.parse(y["text-font"],1,yi(Et)),!b))return null;let E=null;if(y["text-color"]&&(E=r.parse(y["text-color"],1,mn),!E))return null;const S=u[u.length-1];S.scale=v,S.font=b,S.textColor=E}else{const v=r.parse(e[f],1,bt);if(!v)return null;const b=v.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:v,scale:null,font:null,textColor:null})}}return new Ks(u)}evaluate(e){return new Nn(this.sections.map(r=>{const s=r.content.evaluate(e);return _n(s)===Wo?new _o("",s,null,null,null):new _o(go(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class el{constructor(e){this.type=Wo,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Et);return s?new el(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Mi.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const jf={"to-boolean":wt,"to-color":mn,"to-number":Ze,"to-string":Et};class Rr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=jf[s],d=[];for(let f=1;f<e.length;f++){const y=r.parse(e[f],f,bt);if(!y)return null;d.push(y)}return new Rr(u,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,s;for(const u of this.args){if(r=u.evaluate(e),s=null,r instanceof Dt)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Xh(r[0],r[1],r[2],r[3]),!s))return new Dt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new vn(s||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new vn(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Nn.fromString(go(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Mi.fromString(go(this.args[0].evaluate(e))):go(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ks([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new el(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const $f=["Unknown","Point","LineString","Polygon"];class jc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$f[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Dt.parse(e)),r}}class Vn{constructor(e,r,s,u){this.name=e,this.type=r,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],u=Vn.definitions[s];if(!u)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=f.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let v=null;for(const[b,E]of y){v=new al(r.registry,r.path,null,r.scope);const S=[];let k=!1;for(let D=1;D<e.length;D++){const B=e[D],O=Array.isArray(b)?b[D-1]:b.type,Z=v.parse(B,1+S.length,O);if(!Z){k=!0;break}S.push(Z)}if(!k)if(Array.isArray(b)&&b.length!==S.length)v.error(`Expected ${b.length} arguments, but found ${S.length} instead.`);else{for(let D=0;D<S.length;D++){const B=Array.isArray(b)?b[D]:b.type,O=S[D];v.concat(D+1).checkSubtype(B,O.type)}if(v.errors.length===0)return new Vn(s,d,E,S)}}if(y.length===1)r.errors.push(...v.errors);else{const b=(y.length?y:f).map(([S])=>{return k=S,Array.isArray(k)?`(${k.map(nn).join(", ")})`:`(${nn(k.type)}...)`;var k}).join(" | "),E=[];for(let S=1;S<e.length;S++){const k=r.parse(e[S],1+E.length);if(!k)return null;E.push(nn(k.type))}r.error(`Expected arguments of type ${b}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){Vn.definitions=r;for(const s in r)e[s]=Vn}}class tl{constructor(e,r,s){this.type=Ya,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const u=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,wt);if(!u)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,wt);if(!d)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,Et),!f)?null:new tl(u,d,f)}evaluate(e){return new Ja(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Fr=8192;function $c(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function nl(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Gf(n,e){const r=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Fr),Math.round(s*u*Fr)]}function Zf(n,e,r){const s=n[0]-e[0],u=n[1]-e[1],d=n[0]-r[0],f=n[1]-r[1];return s*f-d*u==0&&s*d<=0&&u*f<=0}function il(n,e){let r=!1;for(let f=0,y=e.length;f<y;f++){const v=e[f];for(let b=0,E=v.length;b<E-1;b++){if(Zf(n,v[b],v[b+1]))return!1;(u=v[b])[1]>(s=n)[1]!=(d=v[b+1])[1]>s[1]&&s[0]<(d[0]-u[0])*(s[1]-u[1])/(d[1]-u[1])+u[0]&&(r=!r)}}var s,u,d;return r}function rl(n,e){for(let r=0;r<e.length;r++)if(il(n,e[r]))return!0;return!1}function Hh(n,e,r,s){const u=s[0]-r[0],d=s[1]-r[1],f=(n[0]-r[0])*d-u*(n[1]-r[1]),y=(e[0]-r[0])*d-u*(e[1]-r[1]);return f>0&&y<0||f<0&&y>0}function qf(n,e,r){for(const b of r)for(let E=0;E<b.length-1;++E)if((y=[(f=b[E+1])[0]-(d=b[E])[0],f[1]-d[1]])[0]*(v=[(u=e)[0]-(s=n)[0],u[1]-s[1]])[1]-y[1]*v[0]!=0&&Hh(s,u,d,f)&&Hh(d,f,s,u))return!0;var s,u,d,f,y,v;return!1}function Yh(n,e){for(let r=0;r<n.length;++r)if(!il(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(qf(n[r],n[r+1],e))return!1;return!0}function Wf(n,e){for(let r=0;r<e.length;r++)if(Yh(n,e[r]))return!0;return!1}function Pi(n,e,r){const s=[];for(let u=0;u<n.length;u++){const d=[];for(let f=0;f<n[u].length;f++){const y=Gf(n[u][f],r);$c(e,y),d.push(y)}s.push(d)}return s}function Gc(n,e,r){const s=[];for(let u=0;u<n.length;u++){const d=Pi(n[u],e,r);s.push(d)}return s}function Zc(n,e,r,s){if(n[0]<r[0]||n[0]>r[2]){const u=.5*s;let d=n[0]-r[0]>u?-s:r[0]-n[0]>u?s:0;d===0&&(d=n[0]-r[2]>u?-s:r[2]-n[0]>u?s:0),n[0]+=d}$c(e,n)}function Js(n,e,r,s){const u=Math.pow(2,s.z)*Fr,d=[s.x*Fr,s.y*Fr],f=[];for(const y of n)for(const v of y){const b=[v.x+d[0],v.y+d[1]];Zc(b,e,r,u),f.push(b)}return f}function Xo(n,e,r,s){const u=Math.pow(2,s.z)*Fr,d=[s.x*Fr,s.y*Fr],f=[];for(const v of n){const b=[];for(const E of v){const S=[E.x+d[0],E.y+d[1]];$c(e,S),b.push(S)}f.push(b)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const v of f)for(const b of v)Zc(b,e,r,u)}var y;return f}class Or{constructor(e,r){this.type=wt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qa(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let u=0;u<s.features.length;++u){const d=s.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Or(s,s.features[u].geometry)}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Or(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Or(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const y=Pi(s.coordinates,d,f),v=Js(r.geometry(),u,d,f);if(!nl(u,d))return!1;for(const b of v)if(!il(b,y))return!1}if(s.type==="MultiPolygon"){const y=Gc(s.coordinates,d,f),v=Js(r.geometry(),u,d,f);if(!nl(u,d))return!1;for(const b of v)if(!rl(b,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const y=Pi(s.coordinates,d,f),v=Xo(r.geometry(),u,d,f);if(!nl(u,d))return!1;for(const b of v)if(!Yh(b,y))return!1}if(s.type==="MultiPolygon"){const y=Gc(s.coordinates,d,f),v=Xo(r.geometry(),u,d,f);if(!nl(u,d))return!1;for(const b of v)if(!Wf(b,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ho(n){if(n instanceof Vn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Or)return!1;let e=!0;return n.eachChild(r=>{e&&!Ho(r)&&(e=!1)}),e}function ol(n){if(n instanceof Vn&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!ol(r)&&(e=!1)}),e}function kt(n,e){if(n instanceof Vn&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(s=>{r&&!kt(s,e)&&(r=!1)}),r}class sl{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new sl(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class al{constructor(e,r=[],s,u=new fo,d=[]){this.registry=e,this.path=r,this.key=r.map(f=>`[${f}]`).join(""),this.scope=u,this.errors=d,this.expectedType=s}parse(e,r,s,u,d={}){return r?this.concat(r,s,u)._parse(e,d):this._parse(e,d)}_parse(e,r){function s(u,d,f){return f==="assert"?new qi(d,[u]):f==="coerce"?new Rr(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let f=d.parse(e,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,v=f.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||v.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(y,v))return null}else f=s(f,y,r.typeAnnotation||"coerce");else f=s(f,y,r.typeAnnotation||"assert")}if(!(f instanceof yo)&&f.type.kind!=="resolvedImage"&&qc(f)){const y=new jc;try{f=new yo(f.type,f.evaluate(y))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const u=typeof e=="number"?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new al(this.registry,u,r||null,d,this.errors)}error(e,...r){const s=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new zt(s,e))}checkSubtype(e,r){const s=Br(e,r);return s&&this.error(s),s}}function qc(n){if(n instanceof sl)return qc(n.boundExpression);if(n instanceof Vn&&n.name==="error"||n instanceof tl||n instanceof Or)return!1;const e=n instanceof Rr||n instanceof qi;let r=!0;return n.eachChild(s=>{r=e?r&&qc(s):r&&s instanceof yo}),!!r&&Ho(n)&&kt(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Qs(n,e){const r=n.length-1;let s,u,d=0,f=r,y=0;for(;d<=f;)if(y=Math.floor((d+f)/2),s=n[y],u=n[y+1],s<=e){if(y===r||e<u)return y;d=y+1}else{if(!(s>e))throw new vn("Input is not a number.");f=y-1}return 0}class ea{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,d]of s)this.labels.push(u),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Ze);if(!s)return null;const u=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<e.length;f+=2){const y=f===1?-1/0:e[f],v=e[f+1],b=f,E=f+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const S=r.parse(v,E,d);if(!S)return null;d=d||S.type,u.push([y,S])}return new ea(d,s,u)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return s[0].evaluate(e);const d=r.length;return u>=r[d-1]?s[d-1].evaluate(e):s[Qs(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function Bt(n,e,r){return n*(1-r)+e*r}var ta=Object.freeze({__proto__:null,number:Bt,color:function(n,e,r){return new Dt(Bt(n.r,e.r,r),Bt(n.g,e.g,r),Bt(n.b,e.b,r),Bt(n.a,e.a,r))},array:function(n,e,r){return n.map((s,u)=>Bt(s,e[u],r))}});const ll=.95047,Wc=1.08883,Kh=4/29,na=6/29,Xc=3*na*na,Xf=Math.PI/180,Jh=180/Math.PI;function Hc(n){return n>.008856451679035631?Math.pow(n,1/3):n/Xc+Kh}function cl(n){return n>na?n*n*n:Xc*(n-Kh)}function ul(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function hl(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Yc(n){const e=hl(n.r),r=hl(n.g),s=hl(n.b),u=Hc((.4124564*e+.3575761*r+.1804375*s)/ll),d=Hc((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-Hc((.0193339*e+.119192*r+.9503041*s)/Wc)),alpha:n.a}}function Qh(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*cl(e),r=ll*cl(r),s=Wc*cl(s),new Dt(ul(3.2404542*r-1.5371385*e-.4985314*s),ul(-.969266*r+1.8760108*e+.041556*s),ul(.0556434*r-.2040259*e+1.0572252*s),n.alpha)}function ed(n,e,r){const s=e-n;return n+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const Yo={forward:Yc,reverse:Qh,interpolate:function(n,e,r){return{l:Bt(n.l,e.l,r),a:Bt(n.a,e.a,r),b:Bt(n.b,e.b,r),alpha:Bt(n.alpha,e.alpha,r)}}},ia={forward:function(n){const{l:e,a:r,b:s}=Yc(n),u=Math.atan2(s,r)*Jh;return{h:u<0?u+360:u,c:Math.sqrt(r*r+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Xf,r=n.c;return Qh({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:ed(n.h,e.h,r),c:Bt(n.c,e.c,r),l:Bt(n.l,e.l,r),alpha:Bt(n.alpha,e.alpha,r)}}};var td=Object.freeze({__proto__:null,lab:Yo,hcl:ia});class vi{constructor(e,r,s,u,d){this.type=e,this.operator=r,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[f,y]of d)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(e,r,s,u){let d=0;if(e.name==="exponential")d=Kc(r,e.base,s,u);else if(e.name==="linear")d=Kc(r,1,s,u);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new _e(f[0],f[1],f[2],f[3]).solve(Kc(r,1,s,u))}return d}static parse(e,r){let[s,u,d,...f]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const b=u[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:b}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const b=u.slice(1);if(b.length!==4||b.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Ze),!d)return null;const y=[];let v=null;s==="interpolate-hcl"||s==="interpolate-lab"?v=mn:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let b=0;b<f.length;b+=2){const E=f[b],S=f[b+1],k=b+3,D=b+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const B=r.parse(S,D,v);if(!B)return null;v=v||B.type,y.push([E,B])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new vi(v,s,u,d,y):r.error(`Type ${nn(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return s[0].evaluate(e);const d=r.length;if(u>=r[d-1])return s[d-1].evaluate(e);const f=Qs(r,u),y=vi.interpolationFactor(this.interpolation,u,r[f],r[f+1]),v=s[f].evaluate(e),b=s[f+1].evaluate(e);return this.operator==="interpolate"?ta[this.type.kind.toLowerCase()](v,b,y):this.operator==="interpolate-hcl"?ia.reverse(ia.interpolate(ia.forward(v),ia.forward(b),y)):Yo.reverse(Yo.interpolate(Yo.forward(v),Yo.forward(b),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function Kc(n,e,r,s){const u=s-r,d=n-r;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}class dl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const u=r.expectedType;u&&u.kind!=="value"&&(s=u);const d=[];for(const y of e.slice(1)){const v=r.parse(y,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!v)return null;s=s||v.type,d.push(v)}const f=u&&d.some(y=>Br(u,y.type));return new dl(f?bt:s,d)}evaluate(e){let r,s=null,u=0;for(const d of this.args)if(u++,s=d.evaluate(e),s&&s instanceof Mi&&!s.available&&(r||(r=s.name),s=null,u===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ra{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=r.parse(e[d+1],d+1);if(!y)return null;s.push([f,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return u?new ra(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}class Jc{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Ze),u=r.parse(e[2],2,yi(r.expectedType||bt));return s&&u?new Jc(u.type.itemType,s,u):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new vn(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new vn(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new vn(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Qc{constructor(e,r){this.type=wt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,bt),u=r.parse(e[2],2,bt);return s&&u?Nc(s.type,[wt,Et,Ze,sr,bt])?new Qc(s,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${nn(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!Gi(r,["boolean","string","number","null"]))throw new vn(`Expected first argument to be of type boolean, string, number or null, but found ${nn(_n(r))} instead.`);if(!Gi(s,["string","array"]))throw new vn(`Expected second argument to be of type array or string, but found ${nn(_n(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pl{constructor(e,r,s){this.type=Ze,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,bt),u=r.parse(e[2],2,bt);if(!s||!u)return null;if(!Nc(s.type,[wt,Et,Ze,sr,bt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${nn(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Ze);return d?new pl(s,u,d):null}return new pl(s,u)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Gi(r,["boolean","string","number","null"]))throw new vn(`Expected first argument to be of type boolean, string, number or null, but found ${nn(_n(r))} instead.`);if(!Gi(s,["string","array"]))throw new vn(`Expected second argument to be of type array or string, but found ${nn(_n(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(r,u)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fl{constructor(e,r,s,u,d,f){this.inputType=e,this.type=r,this.input=s,this.cases=u,this.outputs=d,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const d={},f=[];for(let b=2;b<e.length-1;b+=2){let E=e[b];const S=e[b+1];Array.isArray(E)||(E=[E]);const k=r.concat(b);if(E.length===0)return k.error("Expected at least one branch label.");for(const B of E){if(typeof B!="number"&&typeof B!="string")return k.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,_n(B)))return null}else s=_n(B);if(d[String(B)]!==void 0)return k.error("Branch labels must be unique.");d[String(B)]=f.length}const D=r.parse(S,b,u);if(!D)return null;u=u||D.type,f.push(D)}const y=r.parse(e[1],1,bt);if(!y)return null;const v=r.parse(e[e.length-1],e.length-1,u);return v?y.type.kind!=="value"&&r.concat(1).checkSubtype(s,y.type)?null:new fl(s,u,y,d,f,v):null}evaluate(e){const r=this.input.evaluate(e);return(_n(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],u={};for(const f of r){const y=u[this.cases[f]];y===void 0?(u[this.cases[f]]=s.length,s.push([this.cases[f],[f]])):s[y][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,y]of s)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class ml{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const u=[];for(let f=1;f<e.length-1;f+=2){const y=r.parse(e[f],f,wt);if(!y)return null;const v=r.parse(e[f+1],f+1,s);if(!v)return null;u.push([y,v]),s=s||v.type}const d=r.parse(e[e.length-1],e.length-1,s);return d?new ml(s,u,d):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class _l{constructor(e,r,s,u){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,bt),u=r.parse(e[2],2,Ze);if(!s||!u)return null;if(!Nc(s.type,[yi(bt),Et,bt]))return r.error(`Expected first argument to be of type array or string, but found ${nn(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Ze);return d?new _l(s.type,s,u,d):null}return new _l(s.type,s,u)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Gi(r,["string","array"]))throw new vn(`Expected first argument to be of type array or string, but found ${nn(_n(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(s,u)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function eu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function nd(n,e,r,s){return s.compare(e,r)===0}function Ko(n,e,r){const s=n!=="=="&&n!=="!=";return class vb{constructor(d,f,y){this.type=wt,this.lhs=d,this.rhs=f,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const y=d[0];let v=f.parse(d[1],1,bt);if(!v)return null;if(!eu(y,v.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${nn(v.type)}'.`);let b=f.parse(d[2],2,bt);if(!b)return null;if(!eu(y,b.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${nn(b.type)}'.`);if(v.type.kind!==b.type.kind&&v.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${nn(v.type)}' and '${nn(b.type)}'.`);s&&(v.type.kind==="value"&&b.type.kind!=="value"?v=new qi(b.type,[v]):v.type.kind!=="value"&&b.type.kind==="value"&&(b=new qi(v.type,[b])));let E=null;if(d.length===4){if(v.type.kind!=="string"&&b.type.kind!=="string"&&v.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(E=f.parse(d[3],3,Ya),!E)return null}return new vb(v,b,E)}evaluate(d){const f=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const v=_n(f),b=_n(y);if(v.kind!==b.kind||v.kind!=="string"&&v.kind!=="number")throw new vn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${v.kind}, ${b.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const v=_n(f),b=_n(y);if(v.kind!=="string"||b.kind!=="string")return e(d,f,y)}return this.collator?r(d,f,y,this.collator.evaluate(d)):e(d,f,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const id=Ko("==",function(n,e,r){return e===r},nd),rd=Ko("!=",function(n,e,r){return e!==r},function(n,e,r,s){return!nd(0,e,r,s)}),Hf=Ko("<",function(n,e,r){return e<r},function(n,e,r,s){return s.compare(e,r)<0}),Yf=Ko(">",function(n,e,r){return e>r},function(n,e,r,s){return s.compare(e,r)>0}),Kf=Ko("<=",function(n,e,r){return e<=r},function(n,e,r,s){return s.compare(e,r)<=0}),Jf=Ko(">=",function(n,e,r){return e>=r},function(n,e,r,s){return s.compare(e,r)>=0});class Jo{constructor(e,r,s,u,d){this.type=Et,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Ze);if(!s)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=r.parse(u.locale,1,Et),!d))return null;let f=null;if(u.currency&&(f=r.parse(u.currency,1,Et),!f))return null;let y=null;if(u["min-fraction-digits"]&&(y=r.parse(u["min-fraction-digits"],1,Ze),!y))return null;let v=null;return u["max-fraction-digits"]&&(v=r.parse(u["max-fraction-digits"],1,Ze),!v)?null:new Jo(s,d,f,y,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gl{constructor(e){this.type=Ze,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${nn(s.type)} instead.`):new gl(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new vn(`Expected value to be of type string or array, but found ${nn(_n(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const vo={"==":id,"!=":rd,">":Yf,"<":Hf,">=":Jf,"<=":Kf,array:qi,at:Jc,boolean:qi,case:ml,coalesce:dl,collator:tl,format:Ks,image:el,in:Qc,"index-of":pl,interpolate:vi,"interpolate-hcl":vi,"interpolate-lab":vi,length:gl,let:ra,literal:yo,match:fl,number:qi,"number-format":Jo,object:qi,slice:_l,step:ea,string:qi,"to-boolean":Rr,"to-color":Rr,"to-number":Rr,"to-string":Rr,var:sl,within:Or};function od(n,[e,r,s,u]){e=e.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const d=u?u.evaluate(n):1,f=Xh(e,r,s,d);if(f)throw new vn(f);return new Dt(e/255*d,r/255*d,s/255*d,d)}function sd(n,e){return n in e}function tu(n,e){const r=e[n];return r===void 0?null:r}function Ur(n){return{type:n}}function nu(n){return{result:"success",value:n}}function xo(n){return{result:"error",value:n}}function Nr(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function ad(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function iu(n){return!!n.expression&&n.expression.interpolated}function Rt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function yl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Qf(n){return n}function ld(n,e){const r=e.type==="color",s=n.stops&&typeof n.stops[0][0]=="object",u=s||!(s||n.property!==void 0),d=n.type||(iu(e)?"exponential":"interval");if(r&&((n=Ot({},n)).stops&&(n.stops=n.stops.map(b=>[b[0],Dt.parse(b[1])])),n.default=Dt.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!td[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,y,v;if(d==="exponential")f=ud;else if(d==="interval")f=vl;else if(d==="categorical"){f=cd,y=Object.create(null);for(const b of n.stops)y[b[0]]=b[1];v=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=em}if(s){const b={},E=[];for(let D=0;D<n.stops.length;D++){const B=n.stops[D],O=B[0].zoom;b[O]===void 0&&(b[O]={zoom:O,type:n.type,property:n.property,default:n.default,stops:[]},E.push(O)),b[O].stops.push([B[0].value,B[1]])}const S=[];for(const D of E)S.push([b[D].zoom,ld(b[D],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:vi.interpolationFactor.bind(void 0,k),zoomStops:S.map(D=>D[0]),evaluate:({zoom:D},B)=>ud({stops:S,base:n.base},e,D).evaluate(D,B)}}if(u){const b=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:vi.interpolationFactor.bind(void 0,b),zoomStops:n.stops.map(E=>E[0]),evaluate:({zoom:E})=>f(n,e,E,y,v)}}return{kind:"source",evaluate(b,E){const S=E&&E.properties?E.properties[n.property]:void 0;return S===void 0?Qo(n.default,e.default):f(n,e,S,y,v)}}}function Qo(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function cd(n,e,r,s,u){return Qo(typeof r===u?s[r]:void 0,n.default,e.default)}function vl(n,e,r){if(Rt(r)!=="number")return Qo(n.default,e.default);const s=n.stops.length;if(s===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[s-1][0])return n.stops[s-1][1];const u=Qs(n.stops.map(d=>d[0]),r);return n.stops[u][1]}function ud(n,e,r){const s=n.base!==void 0?n.base:1;if(Rt(r)!=="number")return Qo(n.default,e.default);const u=n.stops.length;if(u===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[u-1][0])return n.stops[u-1][1];const d=Qs(n.stops.map(E=>E[0]),r),f=function(E,S,k,D){const B=D-k,O=E-k;return B===0?0:S===1?O/B:(Math.pow(S,O)-1)/(Math.pow(S,B)-1)}(r,s,n.stops[d][0],n.stops[d+1][0]),y=n.stops[d][1],v=n.stops[d+1][1];let b=ta[e.type]||Qf;if(n.colorSpace&&n.colorSpace!=="rgb"){const E=td[n.colorSpace];b=(S,k)=>E.reverse(E.interpolate(E.forward(S),E.forward(k),f))}return typeof y.evaluate=="function"?{evaluate(...E){const S=y.evaluate.apply(void 0,E),k=v.evaluate.apply(void 0,E);if(S!==void 0&&k!==void 0)return b(S,k,f)}}:b(y,v,f)}function em(n,e,r){return e.type==="color"?r=Dt.parse(r):e.type==="formatted"?r=Nn.fromString(r.toString()):e.type==="resolvedImage"?r=Mi.fromString(r.toString()):Rt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Qo(r,n.default,e.default)}Vn.register(vo,{error:[{kind:"error"},[Et],(n,[e])=>{throw new vn(e.evaluate(n))}],typeof:[Et,[bt],(n,[e])=>nn(_n(e.evaluate(n)))],"to-rgba":[yi(Ze,4),[mn],(n,[e])=>e.evaluate(n).toArray()],rgb:[mn,[Ze,Ze,Ze],od],rgba:[mn,[Ze,Ze,Ze,Ze],od],has:{type:wt,overloads:[[[Et],(n,[e])=>sd(e.evaluate(n),n.properties())],[[Et,mo],(n,[e,r])=>sd(e.evaluate(n),r.evaluate(n))]]},get:{type:bt,overloads:[[[Et],(n,[e])=>tu(e.evaluate(n),n.properties())],[[Et,mo],(n,[e,r])=>tu(e.evaluate(n),r.evaluate(n))]]},"feature-state":[bt,[Et],(n,[e])=>tu(e.evaluate(n),n.featureState||{})],properties:[mo,[],n=>n.properties()],"geometry-type":[Et,[],n=>n.geometryType()],id:[bt,[],n=>n.id()],zoom:[Ze,[],n=>n.globals.zoom],pitch:[Ze,[],n=>n.globals.pitch||0],"distance-from-center":[Ze,[],n=>n.distanceFromCenter()],"heatmap-density":[Ze,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ze,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Ze,[],n=>n.globals.skyRadialProgress||0],accumulated:[bt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ze,Ur(Ze),(n,e)=>{let r=0;for(const s of e)r+=s.evaluate(n);return r}],"*":[Ze,Ur(Ze),(n,e)=>{let r=1;for(const s of e)r*=s.evaluate(n);return r}],"-":{type:Ze,overloads:[[[Ze,Ze],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[Ze],(n,[e])=>-e.evaluate(n)]]},"/":[Ze,[Ze,Ze],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[Ze,[Ze,Ze],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[Ze,[],()=>Math.LN2],pi:[Ze,[],()=>Math.PI],e:[Ze,[],()=>Math.E],"^":[Ze,[Ze,Ze],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[Ze,[Ze],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Ze,[Ze],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Ze,[Ze],(n,[e])=>Math.log(e.evaluate(n))],log2:[Ze,[Ze],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Ze,[Ze],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Ze,[Ze],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Ze,[Ze],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Ze,[Ze],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Ze,[Ze],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Ze,[Ze],(n,[e])=>Math.atan(e.evaluate(n))],min:[Ze,Ur(Ze),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[Ze,Ur(Ze),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[Ze,[Ze],(n,[e])=>Math.abs(e.evaluate(n))],round:[Ze,[Ze],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ze,[Ze],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Ze,[Ze],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[wt,[Et,bt],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[wt,[bt],(n,[e])=>n.id()===e.value],"filter-type-==":[wt,[Et],(n,[e])=>n.geometryType()===e.value],"filter-<":[wt,[Et,bt],(n,[e,r])=>{const s=n.properties()[e.value],u=r.value;return typeof s==typeof u&&s<u}],"filter-id-<":[wt,[bt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[wt,[Et,bt],(n,[e,r])=>{const s=n.properties()[e.value],u=r.value;return typeof s==typeof u&&s>u}],"filter-id->":[wt,[bt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[wt,[Et,bt],(n,[e,r])=>{const s=n.properties()[e.value],u=r.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[wt,[bt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[wt,[Et,bt],(n,[e,r])=>{const s=n.properties()[e.value],u=r.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[wt,[bt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[wt,[bt],(n,[e])=>e.value in n.properties()],"filter-has-id":[wt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[wt,[yi(Et)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[wt,[yi(bt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[wt,[Et,yi(bt)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[wt,[Et,yi(bt)],(n,[e,r])=>function(s,u,d,f){for(;d<=f;){const y=d+f>>1;if(u[y]===s)return!0;u[y]>s?f=y-1:d=y+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:wt,overloads:[[[wt,wt],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[Ur(wt),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:wt,overloads:[[[wt,wt],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[Ur(wt),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[wt,[wt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[wt,[Et],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[Et,[Et],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Et,[Et],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Et,Ur(bt),(n,e)=>e.map(r=>go(r.evaluate(n))).join("")],"resolved-locale":[Et,[Ya],(n,[e])=>e.evaluate(n).resolvedLocale()]});class ru{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new jc,this._defaultValue=r?function(s){return s.type==="color"&&yl(s.default)?new Dt(0,0,0,0):s.type==="color"?Dt.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,u,d,f,y,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,u,d,f,y,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new vn(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console!="undefined"&&console.warn(b.message)),this._defaultValue}}}function Wi(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in vo}function es(n,e){const r=new al(vo,[],e?function(u){const d={color:mn,string:Et,number:Ze,enum:Et,boolean:wt,formatted:qo,resolvedImage:Wo};return u.type==="array"?yi(d[u.value]||bt,u.length):d[u.type]}(e):void 0),s=r.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?nu(new ru(s,e)):xo(r.errors)}class Vr{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ol(r.expression)}evaluateWithoutErrorHandling(e,r,s,u,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,u,d,f)}evaluate(e,r,s,u,d,f){return this._styleExpression.evaluate(e,r,s,u,d,f)}}class xl{constructor(e,r,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ol(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,s,u,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,u,d,f)}evaluate(e,r,s,u,d,f){return this._styleExpression.evaluate(e,r,s,u,d,f)}interpolationFactor(e,r,s){return this.interpolationType?vi.interpolationFactor(this.interpolationType,e,r,s):0}}function hd(n,e){if((n=es(n,e)).result==="error")return n;const r=n.value.expression,s=Ho(r);if(!s&&!Nr(e))return xo([new zt("","data expressions not supported")]);const u=kt(r,["zoom","pitch","distance-from-center"]);if(!u&&!ad(e))return xo([new zt("","zoom expressions not supported")]);const d=jr(r);return d||u?d instanceof zt?xo([d]):d instanceof vi&&!iu(e)?xo([new zt("",'"interpolate" expressions cannot be used with this property')]):nu(d?new xl(s?"camera":"composite",n.value,d.labels,d instanceof vi?d.interpolation:void 0):new Vr(s?"constant":"source",n.value)):xo([new zt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ts{constructor(e,r){this._parameters=e,this._specification=r,Ot(this,ld(this._parameters,this._specification))}static deserialize(e){return new ts(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jr(n){let e=null;if(n instanceof ra)e=jr(n.result);else if(n instanceof dl){for(const r of n.args)if(e=jr(r),e)break}else(n instanceof ea||n instanceof vi)&&n.input instanceof Vn&&n.input.name==="zoom"&&(e=n);return e instanceof zt||n.eachChild(r=>{const s=jr(r);s instanceof zt?e=s:!e&&s?e=new zt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new zt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function zi(n){const e=n.key,r=n.value,s=n.valueSpec||{},u=n.objectElementValidators||{},d=n.style,f=n.styleSpec;let y=[];const v=Rt(r);if(v!=="object")return[new Te(e,r,`object expected, ${v} found`)];for(const b in r){const E=b.split(".")[0],S=s[E]||s["*"];let k;if(u[E])k=u[E];else if(s[E])k=jn;else if(u["*"])k=u["*"];else{if(!s["*"]){y.push(new Te(e,r[b],`unknown property "${b}"`));continue}k=jn}y=y.concat(k({key:(e&&`${e}.`)+b,value:r[b],valueSpec:S,style:d,styleSpec:f,object:r,objectKey:b},r))}for(const b in s)u[b]||s[b].required&&s[b].default===void 0&&r[b]===void 0&&y.push(new Te(e,r,`missing required property "${b}"`));return y}function wl(n){const e=n.value,r=n.valueSpec,s=n.style,u=n.styleSpec,d=n.key,f=n.arrayElementValidator||jn;if(Rt(e)!=="array")return[new Te(d,e,`array expected, ${Rt(e)} found`)];if(r.length&&e.length!==r.length)return[new Te(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Te(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};u.$version<7&&(y.function=r.function),Rt(r.value)==="object"&&(y=r.value);let v=[];for(let b=0;b<e.length;b++)v=v.concat(f({array:e,arrayIndex:b,value:e[b],valueSpec:y,style:s,styleSpec:u,key:`${d}[${b}]`}));return v}function ou(n){const e=n.key,r=n.value,s=n.valueSpec;let u=Rt(r);if(u==="number"&&r!=r&&(u="NaN"),u!=="number")return[new Te(e,r,`number expected, ${u} found`)];if("minimum"in s){let d=s.minimum;if(Rt(s.minimum)==="array"&&(d=s.minimum[n.arrayIndex]),r<d)return[new Te(e,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in s){let d=s.maximum;if(Rt(s.maximum)==="array"&&(d=s.maximum[n.arrayIndex]),r>d)return[new Te(e,r,`${r} is greater than the maximum value ${d}`)]}return[]}function bl(n){const e=n.valueSpec,r=_t(n.value.type);let s,u,d,f={};const y=r!=="categorical"&&n.value.property===void 0,v=!y,b=Rt(n.value.stops)==="array"&&Rt(n.value.stops[0])==="array"&&Rt(n.value.stops[0][0])==="object",E=zi({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(D){if(r==="identity")return[new Te(D.key,D.value,'identity function may not have a "stops" property')];let B=[];const O=D.value;return B=B.concat(wl({key:D.key,value:O,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:S})),Rt(O)==="array"&&O.length===0&&B.push(new Te(D.key,O,"array must have at least one stop")),B},default:function(D){return jn({key:D.key,value:D.value,valueSpec:e,style:D.style,styleSpec:D.styleSpec})}}});return r==="identity"&&y&&E.push(new Te(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||E.push(new Te(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!iu(n.valueSpec)&&E.push(new Te(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(v&&!Nr(n.valueSpec)?E.push(new Te(n.key,n.value,"property functions not supported")):y&&!ad(n.valueSpec)&&E.push(new Te(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!b||n.value.property!==void 0||E.push(new Te(n.key,n.value,'"property" property is required')),E;function S(D){let B=[];const O=D.value,Z=D.key;if(Rt(O)!=="array")return[new Te(Z,O,`array expected, ${Rt(O)} found`)];if(O.length!==2)return[new Te(Z,O,`array length 2 expected, length ${O.length} found`)];if(b){if(Rt(O[0])!=="object")return[new Te(Z,O,`object expected, ${Rt(O[0])} found`)];if(O[0].zoom===void 0)return[new Te(Z,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Te(Z,O,"object stop key must have value")];if(d&&d>_t(O[0].zoom))return[new Te(Z,O[0].zoom,"stop zoom values must appear in ascending order")];_t(O[0].zoom)!==d&&(d=_t(O[0].zoom),u=void 0,f={}),B=B.concat(zi({key:`${Z}[0]`,value:O[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:ou,value:k}}))}else B=B.concat(k({key:`${Z}[0]`,value:O[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},O));return Wi(At(O[1]))?B.concat([new Te(`${Z}[1]`,O[1],"expressions are not allowed in function stops.")]):B.concat(jn({key:`${Z}[1]`,value:O[1],valueSpec:e,style:D.style,styleSpec:D.styleSpec}))}function k(D,B){const O=Rt(D.value),Z=_t(D.value),K=D.value!==null?D.value:B;if(s){if(O!==s)return[new Te(D.key,K,`${O} stop domain type must match previous stop domain type ${s}`)]}else s=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Te(D.key,K,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&r!=="categorical"){let ee=`number expected, ${O} found`;return Nr(e)&&r===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(D.key,K,ee)]}return r!=="categorical"||O!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&O==="number"&&u!==void 0&&Z<u?[new Te(D.key,K,"stop domain values must appear in ascending order")]:(u=Z,r==="categorical"&&Z in f?[new Te(D.key,K,"stop domain values must be unique")]:(f[Z]=!0,[])):[new Te(D.key,K,`integer expected, found ${Z}`)]}}function $r(n){const e=(n.expressionContext==="property"?hd:es)(At(n.value),n.valueSpec);if(e.result==="error")return e.value.map(s=>new Te(`${n.key}${s.key}`,n.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Te(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ol(r))return[new Te(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return su(r,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!kt(r,["zoom","feature-state"]))return[new Te(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ho(r))return[new Te(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function su(n,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)r.delete(u);if(r.size===0)return[];const s=[];return n instanceof Vn&&r.has(n.name)?[new Te(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{s.push(...su(u,e))}),s)}function ns(n){const e=n.key,r=n.value,s=n.valueSpec,u=[];return Array.isArray(s.values)?s.values.indexOf(_t(r))===-1&&u.push(new Te(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(_t(r))===-1&&u.push(new Te(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function Tl(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Tl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function oa(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Tl(n)||(n=El(n));const r=n;let s=!0;try{s=function(b){if(!bo(b))return b;let E=At(b);return wo(E),E=au(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const u=ce[`filter_${e}`],d=es(s,u);let f=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));f=(b,E,S)=>d.value.evaluate(b,E,{},S);let y=null,v=null;if(s!==r){const b=es(r,u);if(b.result==="error")throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,S,k,D,B)=>b.value.evaluate(E,S,{},k,void 0,void 0,D,B),v=!Ho(b.value.expression)}return f=f,{filter:f,dynamicFilter:y||void 0,needGeometry:cu(s),needFeature:!!v}}function au(n){if(!Array.isArray(n))return n;const e=function(r){if(dd.has(r[0])){for(let s=1;s<r.length;s++)if(bo(r[s]))return!0}return r}(n);return e===!0?e:e.map(r=>au(r))}function wo(n){let e=!1;const r=[];if(n[0]==="case"){for(let s=1;s<n.length-1;s+=2)e=e||bo(n[s]),r.push(n[s+1]);r.push(n[n.length-1])}else if(n[0]==="match"){e=e||bo(n[1]);for(let s=2;s<n.length-1;s+=2)r.push(n[s+1]);r.push(n[n.length-1])}else if(n[0]==="step"){e=e||bo(n[1]);for(let s=1;s<n.length-1;s+=2)r.push(n[s+1])}e&&(n.length=0,n.push("any",...r));for(let s=1;s<n.length;s++)wo(n[s])}function bo(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<n.length;r++)if(bo(n[r]))return!0;return!1}const dd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function lu(n,e){return n<e?-1:n>e?1:0}function cu(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(cu(n[e]))return!0;return!1}function El(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?is(n[1],n[2],"=="):e==="!="?Sl(is(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?is(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(El))):e==="all"?["all"].concat(n.slice(1).map(El)):e==="none"?["all"].concat(n.slice(1).map(El).map(Sl)):e==="in"?pd(n[1],n.slice(2)):e==="!in"?Sl(pd(n[1],n.slice(2))):e==="has"?fd(n[1]):e==="!has"?Sl(fd(n[1])):e!=="within"||n;var r}function is(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function pd(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(lu)]]:["filter-in-small",n,["literal",e]]}}function fd(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Sl(n){return["!",n]}function uu(n){if(Tl(At(n.value))){const e=At(n.layerType);return $r(Ot({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${e||"fill"}`]}))}return md(n)}function md(n){const e=n.value,r=n.key;if(Rt(e)!=="array")return[new Te(r,e,`array expected, ${Rt(e)} found`)];const s=n.styleSpec;let u,d=[];if(e.length<1)return[new Te(r,e,"filter array must have at least 1 element")];switch(d=d.concat(ns({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),_t(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&_t(e[1])==="$type"&&d.push(new Te(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Te(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Rt(e[1]),u!=="string"&&d.push(new Te(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let f=2;f<e.length;f++)u=Rt(e[f]),_t(e[1])==="$type"?d=d.concat(ns({key:`${r}[${f}]`,value:e[f],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new Te(`${r}[${f}]`,e[f],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)d=d.concat(md({key:`${r}[${f}]`,value:e[f],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Rt(e[1]),e.length!==2?d.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new Te(`${r}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Rt(e[1]),e.length!==2?d.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&d.push(new Te(`${r}[1]`,e[1],`object expected, ${u} found`))}return d}function sa(n,e){const r=n.key,s=n.style,u=n.styleSpec,d=n.value,f=n.objectKey,y=u[`${e}_${n.layerType}`];if(!y)return[];const v=f.match(/^(.*)-transition$/);if(e==="paint"&&v&&y[v[1]]&&y[v[1]].transition)return jn({key:r,value:d,valueSpec:u.transition,style:s,styleSpec:u});const b=n.valueSpec||y[f];if(!b)return[new Te(r,d,`unknown property "${f}"`)];let E;if(Rt(d)==="string"&&Nr(b)&&!b.tokens&&(E=/^{([^}]+)}$/.exec(d)))return[new Te(r,d,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const S=[];return n.layerType==="symbol"&&(f==="text-field"&&s&&!s.glyphs&&S.push(new Te(r,d,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&yl(At(d))&&_t(d.type)==="identity"&&S.push(new Te(r,d,'"text-font" does not support identity functions'))),S.concat(jn({key:n.key,value:d,valueSpec:b,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:f}))}function aa(n){return sa(n,"paint")}function oi(n){return sa(n,"layout")}function la(n){let e=[];const r=n.value,s=n.key,u=n.style,d=n.styleSpec;r.type||r.ref||e.push(new Te(s,r,'either "type" or "ref" is required'));let f=_t(r.type);const y=_t(r.ref);if(r.id){const v=_t(r.id);for(let b=0;b<n.arrayIndex;b++){const E=u.layers[b];_t(E.id)===v&&e.push(new Te(s,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&e.push(new Te(s,r[b],`"${b}" is prohibited for ref layers`))}),u.layers.forEach(b=>{_t(b.id)===y&&(v=b)}),v?v.ref?e.push(new Te(s,r.ref,"ref cannot reference another ref layer")):f=_t(v.type):e.push(new Te(s,r.ref,`ref layer "${y}" not found`))}else if(f!=="background"&&f!=="sky")if(r.source){const v=u.sources&&u.sources[r.source],b=v&&_t(v.type);v?b==="vector"&&f==="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a raster source`)):b==="raster"&&f!=="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&f!=="hillshade"?e.push(new Te(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||b==="geojson"&&v.lineMetrics||e.push(new Te(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Te(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Te(s,r.source,`source "${r.source}" not found`))}else e.push(new Te(s,r,'missing required property "source"'));return e=e.concat(zi({key:s,value:r,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>jn({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:v=>uu(Ot({layerType:f},v)),layout:v=>zi({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>oi(Ot({layerType:f},b))}}),paint:v=>zi({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>aa(Ot({layerType:f},b))}})}})),e}function rs(n){const e=n.value,r=n.key,s=Rt(e);return s!=="string"?[new Te(r,e,`string expected, ${s} found`)]:[]}const _d={promoteId:function({key:n,value:e}){if(Rt(e)==="string")return rs({key:n,value:e});{const r=[];for(const s in e)r.push(...rs({key:`${n}.${s}`,value:e[s]}));return r}}};function gd(n){const e=n.value,r=n.key,s=n.styleSpec,u=n.style;if(!e.type)return[new Te(r,e,'"type" is required')];const d=_t(e.type);let f;switch(d){case"vector":case"raster":case"raster-dem":return f=zi({key:r,value:e,valueSpec:s[`source_${d.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:_d}),f;case"geojson":if(f=zi({key:r,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:_d}),e.cluster)for(const y in e.clusterProperties){const[v,b]=e.clusterProperties[y],E=typeof v=="string"?[v,["accumulated"],["get",y]]:v;f.push(...$r({key:`${r}.${y}.map`,value:b,expressionContext:"cluster-map"})),f.push(...$r({key:`${r}.${y}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return f;case"video":return zi({key:r,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return zi({key:r,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new Te(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ns({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:s})}}function yd(n){const e=n.value,r=n.styleSpec,s=r.light,u=n.style;let d=[];const f=Rt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new Te("light",e,`object expected, ${f} found`)]),d;for(const y in e){const v=y.match(/^(.*)-transition$/);d=d.concat(v&&s[v[1]]&&s[v[1]].transition?jn({key:y,value:e[y],valueSpec:r.transition,style:u,styleSpec:r}):s[y]?jn({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:r}):[new Te(y,e[y],`unknown property "${y}"`)])}return d}function Cl(n){const e=n.value,r=n.key,s=n.style,u=n.styleSpec,d=u.terrain;let f=[];const y=Rt(e);if(e===void 0)return f;if(y!=="object")return f=f.concat([new Te("terrain",e,`object expected, ${y} found`)]),f;for(const v in e){const b=v.match(/^(.*)-transition$/);f=f.concat(b&&d[b[1]]&&d[b[1]].transition?jn({key:v,value:e[v],valueSpec:u.transition,style:s,styleSpec:u}):d[v]?jn({key:v,value:e[v],valueSpec:d[v],style:s,styleSpec:u}):[new Te(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=s.sources&&s.sources[e.source],b=v&&_t(v.type);v?b!=="raster-dem"&&f.push(new Te(r,e.source,`terrain cannot be used with a source of type ${b}, it only be used with a "raster-dem" source type`)):f.push(new Te(r,e.source,`source "${e.source}" not found`))}else f.push(new Te(r,e,'terrain is missing required property "source"'));return f}function vd(n){const e=n.value,r=n.style,s=n.styleSpec,u=s.fog;let d=[];const f=Rt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new Te("fog",e,`object expected, ${f} found`)]),d;for(const y in e){const v=y.match(/^(.*)-transition$/);d=d.concat(v&&u[v[1]]&&u[v[1]].transition?jn({key:y,value:e[y],valueSpec:s.transition,style:r,styleSpec:s}):u[y]?jn({key:y,value:e[y],valueSpec:u[y],style:r,styleSpec:s}):[new Te(y,e[y],`unknown property "${y}"`)])}return d}const Al={"*":()=>[],array:wl,boolean:function(n){const e=n.value,r=n.key,s=Rt(e);return s!=="boolean"?[new Te(r,e,`boolean expected, ${s} found`)]:[]},number:ou,color:function(n){const e=n.key,r=n.value,s=Rt(r);return s!=="string"?[new Te(e,r,`color expected, ${s} found`)]:Zi.parseCSSColor(r)===null?[new Te(e,r,`color expected, "${r}" found`)]:[]},constants:St,enum:ns,filter:uu,function:bl,layer:la,object:zi,source:gd,light:yd,terrain:Cl,fog:vd,string:rs,formatted:function(n){return rs(n).length===0?[]:$r(n)},resolvedImage:function(n){return rs(n).length===0?[]:$r(n)},projection:function(n){const e=n.value,r=n.styleSpec,s=r.projection,u=n.style;let d=[];const f=Rt(e);if(f==="object")for(const y in e)d=d.concat(jn({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:r}));else f!=="string"&&(d=d.concat([new Te("projection",e,`object or string expected, ${f} found`)]));return d}};function jn(n){const e=n.value,r=n.valueSpec,s=n.styleSpec;return r.expression&&yl(_t(e))?bl(n):r.expression&&Wi(At(e))?$r(n):r.type&&Al[r.type]?Al[r.type](n):zi(Ot({},n,{valueSpec:r.type?s[r.type]:r}))}function tm(n){const e=n.value,r=n.key,s=rs(n);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{range}" token'))),s}function Xi(n,e=ce){let r=[];return r=r.concat(jn({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:tm,"*":()=>[]}})),n.constants&&(r=r.concat(St({key:"constants",value:n.constants,style:n,styleSpec:e}))),xd(r)}function xd(n){return[].concat(n).sort((e,r)=>e.line-r.line)}function xr(n){return function(...e){return xd(n.apply(this,e))}}Xi.source=xr(gd),Xi.light=xr(yd),Xi.terrain=xr(Cl),Xi.fog=xr(vd),Xi.layer=xr(la),Xi.filter=xr(uu),Xi.paintProperty=xr(aa),Xi.layoutProperty=xr(oi);const To=Xi,nm=To.light,hu=To.fog,kl=To.paintProperty,wd=To.layoutProperty;function bd(n,e){let r=!1;if(e&&e.length)for(const s of e)n.fire(new it(new Error(s.message))),r=!0;return r}var os=ar;function ar(n,e,r){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var d=0;d<this.d*this.d;d++){var f=u[3+d],y=u[3+d+1];s.push(f===y?null:u.subarray(f,y))}var v=u[3+s.length+1];this.keys=u.subarray(u[3+s.length],v),this.bboxes=u.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var b=0;b<this.d*this.d;b++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=r,this.scale=e/n,this.uid=0;var E=r/e*n;this.min=-E,this.max=n+E}ar.prototype.insert=function(n,e,r,s,u){this._forEachCell(e,r,s,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(u)},ar.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ar.prototype._insertCell=function(n,e,r,s,u,d){this.cells[u].push(d)},ar.prototype.query=function(n,e,r,s,u){var d=this.min,f=this.max;if(n<=d&&e<=d&&f<=r&&f<=s&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,r,s,this._queryCell,y,{},u),y},ar.prototype._queryCell=function(n,e,r,s,u,d,f,y){var v=this.cells[u];if(v!==null)for(var b=this.keys,E=this.bboxes,S=0;S<v.length;S++){var k=v[S];if(f[k]===void 0){var D=4*k;(y?y(E[D+0],E[D+1],E[D+2],E[D+3]):n<=E[D+2]&&e<=E[D+3]&&r>=E[D+0]&&s>=E[D+1])?(f[k]=!0,d.push(b[k])):f[k]=!1}}},ar.prototype._forEachCell=function(n,e,r,s,u,d,f,y){for(var v=this._convertToCellCoord(n),b=this._convertToCellCoord(e),E=this._convertToCellCoord(r),S=this._convertToCellCoord(s),k=v;k<=E;k++)for(var D=b;D<=S;D++){var B=this.d*D+k;if((!y||y(this._convertFromCellCoord(k),this._convertFromCellCoord(D),this._convertFromCellCoord(k+1),this._convertFromCellCoord(D+1)))&&u.call(this,n,e,r,s,B,d,f,y))return}},ar.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},ar.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},ar.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,f=0;f<n.length;f++){var y=n[f];u[3+f]=d,u.set(y,d),d+=y.length}return u[3+n.length]=d,u.set(this.keys,d),u[3+n.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};const{ImageData:Il,ImageBitmap:Td}=Me,ca={};function Qe(n,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),ca[n]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Qe("Object",Object),os.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.push(r),{buffer:r}},os.deserialize=function(n){return new os(n.buffer)},Qe("Grid",os),Qe("Color",Dt),Qe("Error",Error),Qe("ResolvedImage",Mi),Qe("StylePropertyFunction",ts),Qe("StyleExpression",ru,{omit:["_evaluator"]}),Qe("ZoomDependentExpression",xl),Qe("ZoomConstantExpression",Vr),Qe("CompoundExpression",Vn,{omit:["_evaluate"]});for(const n in vo)vo[n]._classRegistryKey||Qe(`Expression_${n}`,vo[n]);function Ed(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function du(n){return Td&&n instanceof Td}function ua(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Ed(n)||du(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return e&&e.push(r.buffer),r}if(n instanceof Il)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const s of n)r.push(ua(s,e));return r}if(typeof n=="object"){const r=n.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");const u=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const d in n){if(!n.hasOwnProperty(d)||ca[s].omit.indexOf(d)>=0)continue;const f=n[d];u[d]=ca[s].shallow.indexOf(d)>=0?f:ua(f,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof n)}function ha(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Ed(n)||du(n)||ArrayBuffer.isView(n)||n instanceof Il)return n;if(Array.isArray(n))return n.map(ha);if(typeof n=="object"){const e=n.$name||"Object",{klass:r}=ca[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const s=Object.create(r.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const d=n[u];s[u]=ca[e].shallow.indexOf(u)>=0?d:ha(d)}return s}throw new Error("can't deserialize object of type "+typeof n)}class Sd{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Cd=n=>n>=1536&&n<=1791,Ad=n=>n>=1872&&n<=1919,kd=n=>n>=2208&&n<=2303,Id=n=>n>=11904&&n<=12031,da=n=>n>=12032&&n<=12255,Md=n=>n>=12272&&n<=12287,Ml=n=>n>=12288&&n<=12351,ss=n=>n>=12352&&n<=12447,Pl=n=>n>=12448&&n<=12543,pu=n=>n>=12544&&n<=12591,Pd=n=>n>=12704&&n<=12735,fu=n=>n>=12736&&n<=12783,mu=n=>n>=12784&&n<=12799,_u=n=>n>=12800&&n<=13055,gu=n=>n>=13056&&n<=13311,zl=n=>n>=13312&&n<=19903,pa=n=>n>=19968&&n<=40959,zd=n=>n>=40960&&n<=42127,Dd=n=>n>=42128&&n<=42191,fa=n=>n>=44032&&n<=55215,Ld=n=>n>=63744&&n<=64255,Gr=n=>n>=64336&&n<=65023,Bd=n=>n>=65040&&n<=65055,ma=n=>n>=65072&&n<=65103,Rd=n=>n>=65104&&n<=65135,yu=n=>n>=65136&&n<=65279,vu=n=>n>=65280&&n<=65519;function Zr(n){for(const e of n)if(xu(e.charCodeAt(0)))return!0;return!1}function Dl(n){for(const e of n)if(!_a(e.charCodeAt(0)))return!1;return!0}function _a(n){return!(Cd(n)||Ad(n)||kd(n)||Gr(n)||yu(n))}function xu(n){return!(n!==746&&n!==747&&(n<4352||!(Pd(n)||pu(n)||ma(n)&&!(n>=65097&&n<=65103)||Ld(n)||gu(n)||Id(n)||fu(n)||!(!Ml(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||zl(n)||pa(n)||_u(n)||(e=>e>=12592&&e<=12687)(n)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||fa(n)||ss(n)||Md(n)||(e=>e>=12688&&e<=12703)(n)||da(n)||mu(n)||Pl(n)&&n!==12540||!(!vu(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Rd(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||Bd(n)||(e=>e>=19904&&e<=19967)(n)||zd(n)||Dd(n))))}function wu(n){return!(xu(n)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ml(e)||Pl(e)||(r=>r>=57344&&r<=63743)(e)||ma(e)||Rd(e)||vu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function as(n){return n>=1424&&n<=2303||Gr(n)||yu(n)}function im(n,e){return!(!e&&as(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(r=>r>=6016&&r<=6143)(n))}function rm(n){for(const e of n)if(as(e.charCodeAt(0)))return!0;return!1}const ls="deferred",h="loading",t="loaded";let a=null,p="unavailable",m=null;const g=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(p="error"),a&&a(n)};function x(){T.fire(new Be("pluginStateChange",{pluginStatus:p,pluginURL:m}))}const T=new je,C=function(){return p},I=function(){if(p!==ls||!m)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");p=h,x(),m&&R({url:m},n=>{n?g(n):(p=t,x())})},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>p===t||M.applyArabicShaping!=null,isLoading:()=>p===h,setState(n){p=n.pluginStatus,m=n.pluginURL},isParsed:()=>M.applyArabicShaping!=null&&M.processBidirectionalText!=null&&M.processStyledBidirectionalText!=null,getPluginURL:()=>m};class P{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sd,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,s){for(const u of r)if(!im(u.charCodeAt(0),s))return!1;return!0}(e,M.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class F{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,u){if(yl(s))return new ts(s,u);if(Wi(s)){const d=hd(s,u);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return typeof s=="string"&&u.type==="color"&&(d=Dt.parse(s)),{kind:"constant",evaluate:()=>d}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class V{constructor(e){this.property=e,this.value=new F(e,void 0)}transitioned(e,r){return new U(this.property,this.value,r,tn({},e.transition,this.transition),e.now)}untransitioned(){return new U(this.property,this.value,null,{},0)}}class ${constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $e(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new V(this._values[e].property)),this._values[e].value=new F(this._values[e].property,r===null?void 0:$e(r))}getTransition(e){return $e(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new V(this._values[e].property)),this._values[e].transition=$e(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const s=new X(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,r._values[u]);return s}untransitioned(){const e=new X(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class U{constructor(e,r,s,u,d){const f=u.delay||0,y=u.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+f,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const u=e.now||0,d=this.value.possiblyEvaluate(e,r,s),f=this.prior;if(f){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return f.possiblyEvaluate(e,r,s);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,s),d,Le(y))}}return d}}class X{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const u=new J(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class N{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return $e(this._values[e].value)}setValue(e,r){this._values[e]=new F(this._values[e].property,r===null?void 0:$e(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const u=new J(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,s);return u}}class H{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,u){return this.property.evaluate(this.value,this.parameters,e,r,s,u)}}class J{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class j{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const u=ta[this.specification.type];return u?u(e,r,s):e}}class Q{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,u){return new H(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,u)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new H(this,{kind:"constant",value:void 0},e.parameters);const u=ta[this.specification.type];return u?new H(this,{kind:"constant",value:u(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,u,d,f){return e.kind==="constant"?e.value:e.evaluate(r,s,u,d,f)}}class re extends Q{possiblyEvaluate(e,r,s,u){if(e.value===void 0)return new H(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,u),f=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(f,f,f,r);return new H(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new H(this,{kind:"constant",value:d},r)}return new H(this,e.expression,r)}evaluate(e,r,s,u,d,f){if(e.kind==="source"){const y=e.evaluate(r,s,u,d,f);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,u),e.evaluate({zoom:Math.floor(r.zoom)},s,u),e.evaluate({zoom:Math.floor(r.zoom)+1},s,u),r):e.value}_calculate(e,r,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r,other:s}:{from:s,to:r,other:e}}interpolate(e){return e}}class we{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,u);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new P(Math.floor(r.zoom-1),r)),e.expression.evaluate(new P(Math.floor(r.zoom),r)),e.expression.evaluate(new P(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class xe{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,u){return!!e.expression.evaluate(r,null,{},s,u)}interpolate(){return!1}}class Se{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new F(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new V(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}function Ce(n,e){return 256*(n=Ke(Math.floor(n),0,255))+Ke(Math.floor(e),0,255)}Qe("DataDrivenProperty",Q),Qe("DataConstantProperty",j),Qe("CrossFadedDataDrivenProperty",re),Qe("CrossFadedProperty",we),Qe("ColorRampProperty",xe);const Ue={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ee{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ne{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ye(n,e=1){let r=0,s=0;return{members:n.map(u=>{const d=Ue[u.type].BYTES_PER_ELEMENT,f=r=Ve(r,Math.max(e,d)),y=u.components||1;return s=Math.max(s,d),r+=d*y,{name:u.name,type:u.type,components:y,offset:f}}),size:Ve(r,Math.max(s,e)),alignment:e}}function Ve(n,e){return Math.ceil(n/e)*e}class et extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=s,e}}et.prototype.bytesPerElement=4,Qe("StructArrayLayout2i4",et);class ct extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u)}emplace(e,r,s,u,d){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=u,this.int16[f+3]=d,e}}ct.prototype.bytesPerElement=8,Qe("StructArrayLayout4i8",ct);class ht extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,u,d,f,y)}emplace(e,r,s,u,d,f,y,v){const b=6*e,E=12*e,S=3*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.uint8[E+4]=u,this.uint8[E+5]=d,this.uint8[E+6]=f,this.uint8[E+7]=y,this.float32[S+2]=v,e}}ht.prototype.bytesPerElement=12,Qe("StructArrayLayout2i4ub1f12",ht);class ft extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=u,e}}ft.prototype.bytesPerElement=12,Qe("StructArrayLayout3f12",ft);class mt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y,v,b,E){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,s,u,d,f,y,v,b,E)}emplace(e,r,s,u,d,f,y,v,b,E,S){const k=10*e;return this.uint16[k+0]=r,this.uint16[k+1]=s,this.uint16[k+2]=u,this.uint16[k+3]=d,this.uint16[k+4]=f,this.uint16[k+5]=y,this.uint16[k+6]=v,this.uint16[k+7]=b,this.uint16[k+8]=E,this.uint16[k+9]=S,e}}mt.prototype.bytesPerElement=20,Qe("StructArrayLayout10ui20",mt);class at extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,u,d,f,y,v)}emplace(e,r,s,u,d,f,y,v,b){const E=8*e;return this.uint16[E+0]=r,this.uint16[E+1]=s,this.uint16[E+2]=u,this.uint16[E+3]=d,this.uint16[E+4]=f,this.uint16[E+5]=y,this.uint16[E+6]=v,this.uint16[E+7]=b,e}}at.prototype.bytesPerElement=16,Qe("StructArrayLayout8ui16",at);class gt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z){const K=this.length;return this.resize(K+1),this.emplace(K,e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z)}emplace(e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z,K){const ee=16*e;return this.int16[ee+0]=r,this.int16[ee+1]=s,this.int16[ee+2]=u,this.int16[ee+3]=d,this.uint16[ee+4]=f,this.uint16[ee+5]=y,this.uint16[ee+6]=v,this.uint16[ee+7]=b,this.int16[ee+8]=E,this.int16[ee+9]=S,this.int16[ee+10]=k,this.int16[ee+11]=D,this.int16[ee+12]=B,this.int16[ee+13]=O,this.int16[ee+14]=Z,this.int16[ee+15]=K,e}}gt.prototype.bytesPerElement=32,Qe("StructArrayLayout4i4ui4i4i32",gt);class Ut extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Ut.prototype.bytesPerElement=4,Qe("StructArrayLayout1ul4",Ut);class xn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y,v,b,E,S,k,D){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,s,u,d,f,y,v,b,E,S,k,D)}emplace(e,r,s,u,d,f,y,v,b,E,S,k,D,B){const O=20*e,Z=10*e;return this.int16[O+0]=r,this.int16[O+1]=s,this.int16[O+2]=u,this.int16[O+3]=d,this.int16[O+4]=f,this.float32[Z+3]=y,this.float32[Z+4]=v,this.float32[Z+5]=b,this.float32[Z+6]=E,this.int16[O+14]=S,this.uint32[Z+8]=k,this.uint16[O+18]=D,this.uint16[O+19]=B,e}}xn.prototype.bytesPerElement=40,Qe("StructArrayLayout5i4f1i1ul2ui40",xn);class Ln extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,u,d,f,y)}emplace(e,r,s,u,d,f,y,v){const b=8*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=u,this.int16[b+4]=d,this.int16[b+5]=f,this.int16[b+6]=y,this.int16[b+7]=v,e}}Ln.prototype.bytesPerElement=16,Qe("StructArrayLayout3i2i2i16",Ln);class $n extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,u,d)}emplace(e,r,s,u,d,f){const y=4*e,v=8*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=u,this.int16[v+6]=d,this.int16[v+7]=f,e}}$n.prototype.bytesPerElement=16,Qe("StructArrayLayout2f1f2i16",$n);class Kn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u)}emplace(e,r,s,u,d){const f=12*e,y=3*e;return this.uint8[f+0]=r,this.uint8[f+1]=s,this.float32[y+1]=u,this.float32[y+2]=d,e}}Kn.prototype.bytesPerElement=12,Qe("StructArrayLayout2ub2f12",Kn);class wn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=u,e}}wn.prototype.bytesPerElement=6,Qe("StructArrayLayout3ui6",wn);class wr extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z,K,ee,se,ue,le){const pe=this.length;return this.resize(pe+1),this.emplace(pe,e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z,K,ee,se,ue,le)}emplace(e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z,K,ee,se,ue,le,pe){const Ae=30*e,be=15*e,qe=60*e;return this.int16[Ae+0]=r,this.int16[Ae+1]=s,this.int16[Ae+2]=u,this.float32[be+2]=d,this.float32[be+3]=f,this.uint16[Ae+8]=y,this.uint16[Ae+9]=v,this.uint32[be+5]=b,this.uint32[be+6]=E,this.uint32[be+7]=S,this.uint16[Ae+16]=k,this.uint16[Ae+17]=D,this.uint16[Ae+18]=B,this.float32[be+10]=O,this.float32[be+11]=Z,this.uint8[qe+48]=K,this.uint8[qe+49]=ee,this.uint8[qe+50]=se,this.uint32[be+13]=ue,this.int16[Ae+28]=le,this.uint8[qe+58]=pe,e}}wr.prototype.bytesPerElement=60,Qe("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",wr);class lr extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z,K,ee,se,ue,le,pe,Ae,be,qe,Re,ke,Fe,Oe,ze){const We=this.length;return this.resize(We+1),this.emplace(We,e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z,K,ee,se,ue,le,pe,Ae,be,qe,Re,ke,Fe,Oe,ze)}emplace(e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z,K,ee,se,ue,le,pe,Ae,be,qe,Re,ke,Fe,Oe,ze,We){const Je=38*e,yt=19*e;return this.int16[Je+0]=r,this.int16[Je+1]=s,this.int16[Je+2]=u,this.float32[yt+2]=d,this.float32[yt+3]=f,this.int16[Je+8]=y,this.int16[Je+9]=v,this.int16[Je+10]=b,this.int16[Je+11]=E,this.int16[Je+12]=S,this.int16[Je+13]=k,this.uint16[Je+14]=D,this.uint16[Je+15]=B,this.uint16[Je+16]=O,this.uint16[Je+17]=Z,this.uint16[Je+18]=K,this.uint16[Je+19]=ee,this.uint16[Je+20]=se,this.uint16[Je+21]=ue,this.uint16[Je+22]=le,this.uint16[Je+23]=pe,this.uint16[Je+24]=Ae,this.uint16[Je+25]=be,this.uint16[Je+26]=qe,this.uint16[Je+27]=Re,this.uint16[Je+28]=ke,this.uint32[yt+15]=Fe,this.float32[yt+16]=Oe,this.float32[yt+17]=ze,this.float32[yt+18]=We,e}}lr.prototype.bytesPerElement=76,Qe("StructArrayLayout3i2f6i15ui1ul3f76",lr);class Jt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Jt.prototype.bytesPerElement=4,Qe("StructArrayLayout1f4",Jt);class dn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=u,e}}dn.prototype.bytesPerElement=6,Qe("StructArrayLayout3i6",dn);class Mt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u)}emplace(e,r,s,u,d){const f=6*e;return this.uint32[3*e+0]=r,this.uint16[f+2]=s,this.uint16[f+3]=u,this.uint16[f+4]=d,e}}Mt.prototype.bytesPerElement=12,Qe("StructArrayLayout1ul3ui12",Mt);class en extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=s,e}}en.prototype.bytesPerElement=4,Qe("StructArrayLayout2ui4",en);class Bn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Bn.prototype.bytesPerElement=2,Qe("StructArrayLayout1ui2",Bn);class Qt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=s,e}}Qt.prototype.bytesPerElement=8,Qe("StructArrayLayout2f8",Qt);class xi extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u)}emplace(e,r,s,u,d){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=u,this.float32[f+3]=d,e}}xi.prototype.bytesPerElement=16,Qe("StructArrayLayout4f16",xi);class ga extends Ee{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ga.prototype.size=40;class si extends xn{get(e){return new ga(this,e)}}Qe("CollisionBoxArray",si);class qr extends Ee{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}qr.prototype.size=60;class Fd extends wr{get(e){return new qr(this,e)}}Qe("PlacedSymbolArray",Fd);class Ll extends Ee{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ll.prototype.size=76;class cs extends lr{get(e){return new Ll(this,e)}}Qe("SymbolInstanceArray",cs);class Od extends Jt{getoffsetX(e){return this.float32[1*e+0]}}Qe("GlyphOffsetArray",Od);class ya extends dn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Qe("SymbolLineVertexArray",ya);class Bl extends Ee{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bl.prototype.size=12;class Uy extends Mt{get(e){return new Bl(this,e)}}Qe("FeatureIndexArray",Uy);class Ny extends Ee{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Ny.prototype.size=4;class Vy extends en{get(e){return new Ny(this,e)}}Qe("FillExtrusionCentroidArray",Vy);const p2=ye([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),f2=ye([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var jy=Ka(function(n){n.exports=function(e,r){var s,u,d,f,y,v,b,E;for(u=e.length-(s=3&e.length),d=r,y=3432918353,v=461845907,E=0;E<u;)b=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,d=27492+(65535&(f=5*(65535&(d=(d^=b=(65535&(b=(b=(65535&b)*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(b=0,s){case 3:b^=(255&e.charCodeAt(E+2))<<16;case 2:b^=(255&e.charCodeAt(E+1))<<8;case 1:d^=b=(65535&(b=(b=(65535&(b^=255&e.charCodeAt(E)))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),m2=Ka(function(n){n.exports=function(e,r){for(var s,u=e.length,d=r^u,f=0;u>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++f;switch(u){case 3:d^=(255&e.charCodeAt(f+2))<<16;case 2:d^=(255&e.charCodeAt(f+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(f)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),bu=jy,_2=m2;bu.murmur3=jy,bu.murmur2=_2;class Ud{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,u){this.ids.push($y(e)),this.positions.push(r,s,u)}getPositions(e){const r=$y(e);let s=0,u=this.ids.length-1;for(;s<u;){const f=s+u>>1;this.ids[f]>=r?u=f:s=f+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,r){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return om(s,u,0,s.length-1),r&&r.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const r=new Ud;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function $y(n){const e=+n;return!isNaN(e)&&e<=tt?e:bu(String(n))}function om(n,e,r,s){for(;r<s;){const u=n[r+s>>1];let d=r-1,f=s+1;for(;;){do d++;while(n[d]<u);do f--;while(n[f]>u);if(d>=f)break;Nd(n,d,f),Nd(e,3*d,3*f),Nd(e,3*d+1,3*f+1),Nd(e,3*d+2,3*f+2)}f-r<s-f?(om(n,e,r,f),r=f+1):(om(n,e,f+1,s),s=f)}}function Nd(n,e,r){const s=n[e];n[e]=n[r],n[r]=s}Qe("FeaturePositionMap",Ud);class Eo{constructor(e,r){this.gl=e.gl,this.location=r}}class Vd extends Eo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Gy extends Eo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Zy extends Eo{constructor(e,r){super(e,r),this.current=Dt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const g2=new Float32Array(16),y2=new Float32Array(9),v2=new Float32Array(4);function sm(n){return[Ce(255*n.r,255*n.g),Ce(255*n.b,255*n.a)]}class Tu{constructor(e,r,s){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new Zy(e,r):new Vd(e,r)}}class Rl{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,s,u){const d=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,r,s){return s==="u_pattern_from"||s==="u_pattern_to"||s==="u_dash_from"||s==="u_dash_to"?new Gy(e,r):new Vd(e,r)}}class So{constructor(e,r,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,s,u,d,f){const y=this.paintVertexArray.length,v=this.expression.evaluate(new P(0),r,{},d,u,f);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,r,s,u,d){const f=this.expression.evaluate({zoom:0},s,u,void 0,d);this._setPaintValue(e,r,f)}_setPaintValue(e,r,s){if(this.type==="color"){const u=sm(s);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class br{constructor(e,r,s,u,d,f){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,s,u,d,f){const y=this.expression.evaluate(new P(this.zoom),r,{},d,u,f),v=this.expression.evaluate(new P(this.zoom+1),r,{},d,u,f),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,v)}updatePaintArray(e,r,s,u,d){const f=this.expression.evaluate({zoom:this.zoom},s,u,void 0,d),y=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,d);this._setPaintValue(e,r,f,y)}_setPaintValue(e,r,s,u){if(this.type==="color"){const d=sm(s),f=sm(u);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],f[0],f[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=Ke(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,s){return new Vd(e,r)}}class us{constructor(e,r,s,u,d,f,y){this.expression=e,this.type=s,this.useIntegerZoom=u,this.zoom=d,this.layerId=y,this.paintVertexAttributes=(s==="array"?f2:p2).members;for(let v=0;v<r.length;++v);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,r,s){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,u,d,f){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(e,r,s,u){if(!u||!s)return;const{min:d,mid:f,max:y}=s,v=u[d],b=u[f],E=u[y];if(v&&b&&E)for(let S=e;S<r;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,b,v),this._setPaintValue(this.zoomOutPaintVertexArray,S,b,E)}_setPaintValue(e,r,s,u){e.emplace(r,s.tl[0],s.tl[1],s.br[0],s.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],s.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Co{constructor(e,r,s=()=>!0){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){if(!s(d))continue;const f=e.paint.get(d);if(!(f instanceof H&&Nr(f.property.specification)))continue;const y=w2(d,e.type),v=f.value,b=f.property.specification.type,E=f.property.useIntegerZoom,S=f.property.specification["property-type"],k=S==="cross-faded"||S==="cross-faded-data-driven",D=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||D)if(v.kind==="source"||D||k){const B=qy(d,b,"source");this.binders[d]=k?new us(v,y,b,E,r,B,e.id):new So(v,y,b,B),u.push(`/a_${d}`)}else{const B=qy(d,b,"composite");this.binders[d]=new br(v,y,b,E,r,B),u.push(`/z_${d}`)}else this.binders[d]=k?new Rl(v.value,y):new Tu(v.value,y,b),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof So||r instanceof br?r.maxValue:0}populatePaintArrays(e,r,s,u,d,f){for(const y in this.binders){const v=this.binders[y];(v instanceof So||v instanceof br||v instanceof us)&&v.populatePaintArray(e,r,s,u,d,f)}}setConstantPatternPositions(e,r){for(const s in this.binders){const u=this.binders[s];u instanceof Rl&&u.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,u,d,f){let y=!1;for(const v in e){const b=r.getPositions(v);for(const E of b){const S=s.feature(E.index);for(const k in this.binders){const D=this.binders[k];if((D instanceof So||D instanceof br||D instanceof us)&&D.expression.isStateDependent===!0){const B=u.paint.get(k);D.expression=B.value,D.updatePaintArray(E.start,E.end,S,e[v],d,f),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Tu||s instanceof Rl)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof So||s instanceof br||s instanceof us)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Tu||s instanceof Rl||s instanceof br)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Tu||d instanceof Rl||d instanceof br){for(const f of d.uniformNames)if(r[f]){const y=d.getBinding(e,r[f],f);s.push({name:f,property:u,binding:y})}}}return s}setUniforms(e,r,s,u){for(const{name:d,property:f,binding:y}of r)this.binders[f].setUniform(y,u,s.get(f),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof us){const u=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(s instanceof So||s instanceof br)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof So||s instanceof br||s instanceof us)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof So||r instanceof br||r instanceof us)&&r.destroy()}}}class va{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Co(u,r,s);this.needsUpload=!1,this._featureMap=new Ud,this._bufferOffset=0}populatePaintArrays(e,r,s,u,d,f,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,u,d,f,y);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,u,d){for(const f of s)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,r,f,u,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const x2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function w2(n,e){return x2[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const b2={"line-pattern":{source:mt,composite:mt},"fill-pattern":{source:mt,composite:mt},"fill-extrusion-pattern":{source:mt,composite:mt},"line-dasharray":{source:at,composite:at}},T2={color:{source:Qt,composite:xi},number:{source:Jt,composite:Qt}};function qy(n,e,r){const s=b2[n];return s&&s[r]||T2[e][r]}Qe("ConstantBinder",Tu),Qe("CrossFadedConstantBinder",Rl),Qe("SourceExpressionBinder",So),Qe("CrossFadedCompositeBinder",us),Qe("CompositeExpressionBinder",br),Qe("ProgramConfiguration",Co,{omit:["_buffers"]}),Qe("ProgramConfigurationSet",va);const jd="-transition";class Tr extends je{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new N(r.layout)),r.paint)){this._transitionablePaint=new $(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new J(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(wd,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return $i(e,jd)?this._transitionablePaint.getTransition(e.slice(0,-jd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(kl,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if($i(e,jd))return this._transitionablePaint.setTransition(e.slice(0,-jd.length),r||void 0),!1;{const u=this._transitionablePaint._values[e],d=u.property.specification["property-type"]==="cross-faded-data-driven",f=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(e,y,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Si(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,u,d={}){return(!d||d.validate!==!1)&&bd(this,e.call(To,{key:r,layerType:this.type,objectKey:s,value:u,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof H&&Nr(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=oa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const E2=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:S2}=E2;class Rn{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,u){let d=this.segments[this.segments.length-1];return e>Rn.MAX_VERTEX_ARRAY_LENGTH&&ot(`Max vertices per segment is ${Rn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Rn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,u){return new Rn([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}Rn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qe("SegmentVector",Rn);var Pt=8192;class xa{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Gt?new Gt(e.lng,e.lat):Gt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Gt?new Gt(e.lng,e.lat):Gt.convert(e),this}extend(e){const r=this._sw,s=this._ne;let u,d;if(e instanceof Gt)u=e,d=e;else{if(!(e instanceof xa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xa.convert(e)):this.extend(Gt.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return r||s?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new Gt(u.lng,u.lat),this._ne=new Gt(d.lng,d.lat)),this}getCenter(){return new Gt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Gt(this.getWest(),this.getNorth())}getSouthEast(){return new Gt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Gt.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof xa?e:new xa(e)}}const Wy=63710088e-1;class Gt{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gt(pt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,u=e.lat*r,d=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return Wy*Math.acos(Math.min(d,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new xa(new Gt(this.lng-s,this.lat-r),new Gt(this.lng+s,this.lat+r))}static convert(e){if(e instanceof Gt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Gt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Gt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Xy=2*Math.PI*Wy;function Hy(n){return Xy*Math.cos(n*Math.PI/180)}function am(n){return(180+n)/360}function lm(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function cm(n,e){return n/Hy(e)}function wa(n){return 360*n-180}function Wr(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function um(n,e){return n*Hy(Wr(e))}const hs=85.051129;class $d{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Gt.convert(e);return new $d(am(s.lng),lm(s.lat),cm(r,s.lat))}toLngLat(){return new Gt(wa(this.x),Wr(this.y))}toAltitude(){return um(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Xy*(e=Wr(this.y),1/Math.cos(e*Math.PI/180));var e}}function hm(n,e,r,s,u,d,f,y,v){const b=(e+s)/2,E=(r+u)/2,S=new he(b,E);y(S),function(k,D,B,O,Z,K){const ee=B-Z,se=O-K;return Math.abs((O-D)*ee-(B-k)*se)/Math.hypot(ee,se)}(S.x,S.y,d.x,d.y,f.x,f.y)>=v?(hm(n,e,r,b,E,d,S,y,v),hm(n,b,E,s,u,S,f,y,v)):n.push(f)}function C2(n,e,r){const s=[];let u,d,f;for(const y of n){const{x:v,y:b}=y;e(y),f?hm(s,u,d,v,b,f,y,e,r):s.push(y),u=v,d=b,f=y}return s}const dm=Math.pow(2,14)-1,Yy=-dm-1;function A2(n,e){const r=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=Ke(r,Yy,dm),n.y=Ke(s,Yy,dm),(r<n.x||r>n.x+1||s<n.y||s>n.y+1)&&ot("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Ao(n,e,r){const s=n.loadGeometry(),u=n.extent,d=Pt/u;if(e&&r&&r.projection.name!=="mercator"){const f=1<<e.z,{scale:y,x:v,y:b,projection:E}=r,S=k=>{const D=wa((e.x+k.x/u)/f),B=Wr((e.y+k.y/u)/f),O=E.project(D,B);k.x=(O.x*y-v)*u,k.y=(O.y*y-b)*u};for(let k=0;k<s.length;k++)if(n.type!==1)s[k]=C2(s[k],S,1);else{const D=[];for(const B of s[k])B.x<0||B.x>=u||B.y<0||B.y>=u||(S(B),D.push(B));s[k]=D}}for(const f of s)for(const y of f)A2(y,d);return s}function ba(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Ao(n):[]}}function Gd(n,e,r,s,u){n.emplaceBack(2*e+(s+1)/2,2*r+(u+1)/2)}class pm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new et,this.indexArray=new wn,this.segments=new Rn,this.programConfigurations=new va(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,u){const d=this.layers[0],f=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:v,id:b,index:E,sourceLayerIndex:S}of e){const k=this.layers[0]._featureFilter.needGeometry,D=ba(v,k);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),D,s))continue;const B=y?y.evaluate(D,{},s):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:S,index:E,geometry:k?D.geometry:Ao(v,s,u),patterns:{},sortKey:B};f.push(O)}y&&f.sort((v,b)=>v.sortKey-b.sortKey);for(const v of f){const{geometry:b,index:E,sourceLayerIndex:S}=v,k=e[E].feature;this.addFeature(v,b,E,r.availableImages,s),r.featureIndex.insert(k,b,E,S,this.index)}}update(e,r,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,u,d){for(const f of r)for(const y of f){const v=y.x,b=y.y;if(v<0||v>=Pt||b<0||b>=Pt)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=E.vertexLength;Gd(this.layoutVertexArray,v,b,-1,-1),Gd(this.layoutVertexArray,v,b,1,-1),Gd(this.layoutVertexArray,v,b,1,1),Gd(this.layoutVertexArray,v,b,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,d)}}function Ky(n,e){for(let r=0;r<n.length;r++)if(Fl(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Fl(n,e[r]))return!0;return!!fm(n,e)}function k2(n,e,r){return!!Fl(n,e)||!!mm(e,n,r)}function Jy(n,e){if(n.length===1)return ev(e,n[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let u=0;u<s.length;u++)if(Fl(n,s[u]))return!0}for(let r=0;r<n.length;r++)if(ev(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(fm(n,e[r]))return!0;return!1}function I2(n,e,r){if(n.length>1){if(fm(n,e))return!0;for(let s=0;s<e.length;s++)if(mm(e[s],n,r))return!0}for(let s=0;s<n.length;s++)if(mm(n[s],e,r))return!0;return!1}function fm(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const s=n[r],u=n[r+1];for(let d=0;d<e.length-1;d++)if(M2(s,u,e[d],e[d+1]))return!0}return!1}function M2(n,e,r,s){return Lt(n,r,s)!==Lt(e,r,s)&&Lt(n,e,r)!==Lt(n,e,s)}function mm(n,e,r){const s=r*r;if(e.length===1)return n.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Qy(n,e[u-1],e[u])<s)return!0;return!1}function Qy(n,e,r){const s=e.distSqr(r);if(s===0)return n.distSqr(e);const u=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/s;return n.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function ev(n,e){let r,s,u,d=!1;for(let f=0;f<n.length;f++){r=n[f];for(let y=0,v=r.length-1;y<r.length;v=y++)s=r[y],u=r[v],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(d=!d)}return d}function Fl(n,e){let r=!1;for(let s=0,u=n.length-1;s<n.length;u=s++){const d=n[s],f=n[u];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function tv(n,e,r,s,u){for(const f of n)if(e<=f.x&&r<=f.y&&s>=f.x&&u>=f.y)return!0;const d=[new he(e,r),new he(e,u),new he(s,u),new he(s,r)];if(n.length>2){for(const f of d)if(Fl(n,f))return!0}for(let f=0;f<n.length-1;f++)if(P2(n[f],n[f+1],d))return!0;return!1}function P2(n,e,r){const s=r[0],u=r[2];if(n.x<s.x&&e.x<s.x||n.x>u.x&&e.x>u.x||n.y<s.y&&e.y<s.y||n.y>u.y&&e.y>u.y)return!1;const d=Lt(n,e,r[0]);return d!==Lt(n,e,r[1])||d!==Lt(n,e,r[2])||d!==Lt(n,e,r[3])}function Ol(n,e,r){const s=e.paint.get(n).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(n)}function Zd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function nv(n,e,r,s,u){if(!e[0]&&!e[1])return n;const d=he.convert(e)._mult(u);r==="viewport"&&d._rotate(-s);const f=[];for(let y=0;y<n.length;y++)f.push(n[y].sub(d));return f}function iv(n,e,r,s){const u=he.convert(n)._mult(s);return e==="viewport"&&u._rotate(-r),u}Qe("CircleBucket",pm,{omit:["layers"]});const z2=new Se({"circle-sort-key":new Q(ce.layout_circle["circle-sort-key"])});var D2={paint:new Se({"circle-radius":new Q(ce.paint_circle["circle-radius"]),"circle-color":new Q(ce.paint_circle["circle-color"]),"circle-blur":new Q(ce.paint_circle["circle-blur"]),"circle-opacity":new Q(ce.paint_circle["circle-opacity"]),"circle-translate":new j(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new j(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new j(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new j(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Q(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Q(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Q(ce.paint_circle["circle-stroke-opacity"])}),layout:z2},ai=typeof Float32Array!="undefined"?Float32Array:Array;function rv(){var n=new ai(9);return ai!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function _m(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ov(n,e,r){var s=e[0],u=e[1],d=e[2],f=e[3],y=e[4],v=e[5],b=e[6],E=e[7],S=e[8],k=e[9],D=e[10],B=e[11],O=e[12],Z=e[13],K=e[14],ee=e[15],se=r[0],ue=r[1],le=r[2],pe=r[3];return n[0]=se*s+ue*y+le*S+pe*O,n[1]=se*u+ue*v+le*k+pe*Z,n[2]=se*d+ue*b+le*D+pe*K,n[3]=se*f+ue*E+le*B+pe*ee,n[4]=(se=r[4])*s+(ue=r[5])*y+(le=r[6])*S+(pe=r[7])*O,n[5]=se*u+ue*v+le*k+pe*Z,n[6]=se*d+ue*b+le*D+pe*K,n[7]=se*f+ue*E+le*B+pe*ee,n[8]=(se=r[8])*s+(ue=r[9])*y+(le=r[10])*S+(pe=r[11])*O,n[9]=se*u+ue*v+le*k+pe*Z,n[10]=se*d+ue*b+le*D+pe*K,n[11]=se*f+ue*E+le*B+pe*ee,n[12]=(se=r[12])*s+(ue=r[13])*y+(le=r[14])*S+(pe=r[15])*O,n[13]=se*u+ue*v+le*k+pe*Z,n[14]=se*d+ue*b+le*D+pe*K,n[15]=se*f+ue*E+le*B+pe*ee,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var L2=ov;function qd(){var n=new ai(3);return ai!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function sv(n){return Math.hypot(n[0],n[1],n[2])}function Ul(n,e,r){var s=new ai(3);return s[0]=n,s[1]=e,s[2]=r,s}function av(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function lv(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function cv(n,e,r,s){return n[0]=e[0]+r[0]*s,n[1]=e[1]+r[1]*s,n[2]=e[2]+r[2]*s,n}function uv(n,e){var r=e[0],s=e[1],u=e[2],d=r*r+s*s+u*u;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function hv(n,e,r){var s=r[0],u=r[1],d=r[2],f=e[0],y=e[1],v=e[2],b=u*v-d*y,E=d*f-s*v,S=s*y-u*f,k=u*S-d*E,D=d*b-s*S,B=s*E-u*b,O=2*r[3];return E*=O,S*=O,D*=2,B*=2,n[0]=f+(b*=O)+(k*=2),n[1]=y+E+D,n[2]=v+S+B,n}var Eu,B2=av,R2=lv,F2=sv;function Su(n,e,r){var s=e[0],u=e[1],d=e[2],f=e[3];return n[0]=r[0]*s+r[4]*u+r[8]*d+r[12]*f,n[1]=r[1]*s+r[5]*u+r[9]*d+r[13]*f,n[2]=r[2]*s+r[6]*u+r[10]*d+r[14]*f,n[3]=r[3]*s+r[7]*u+r[11]*d+r[15]*f,n}function gm(){var n=new ai(4);return ai!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function dv(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function pv(n,e,r){r*=.5;var s=e[0],u=e[1],d=e[2],f=e[3],y=Math.sin(r),v=Math.cos(r);return n[0]=s*v+f*y,n[1]=u*v+d*y,n[2]=d*v-u*y,n[3]=f*v-s*y,n}function fv(n,e){return n[0]===e[0]&&n[1]===e[1]}function mv(n,e,r,s,u,d,f,y,v){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(v*=n.pixelToTileUnitsFactor);for(const b of e)for(const E of b){const S=E.add(y),k=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(S.x,S.y,!0):0,D=d?S:O2(S,k,s),B=d?n.tilespaceRays.map(Z=>N2(Z,k)):n.queryGeometry.screenGeometry,O=Su([],[E.x,E.y,k,1],s);if(!f&&d?v*=O[3]/r.cameraToCenterDistance:f&&!d&&(v*=r.cameraToCenterDistance/O[3]),k2(B,D,v))return!0}return!1}function O2(n,e,r){const s=Su([],[n.x,n.y,e,1],r);return new he(s[0]/s[3],s[1]/s[3])}qd(),Eu=new ai(4),ai!=Float32Array&&(Eu[0]=0,Eu[1]=0,Eu[2]=0,Eu[3]=0),qd(),Ul(1,0,0),Ul(0,1,0),gm(),gm(),rv(),function(){var n;n=new ai(2),ai!=Float32Array&&(n[0]=0,n[1]=0)}();const _v=Ul(0,0,0),U2=Ul(0,0,1);function N2(n,e){const r=qd();return _v[2]=e,n.intersectsPlane(_v,U2,r),new he(r[0],r[1])}class gv extends pm{}function ym(n,{width:e,height:r},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*s);return n.width=e,n.height=r,n.data=u,n}function yv(n,{width:e,height:r},s){if(e===n.width&&r===n.height)return;const u=ym({},{width:e,height:r},s);vm(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,r)},s),n.width=e,n.height=r,n.data=u.data}function vm(n,e,r,s,u,d){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||r.x>n.width-u.width||r.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const f=n.data,y=e.data;for(let v=0;v<u.height;v++){const b=((r.y+v)*n.width+r.x)*d,E=((s.y+v)*e.width+s.x)*d;for(let S=0;S<u.width*d;S++)y[E+S]=f[b+S]}return e}Qe("HeatmapBucket",gv,{omit:["layers"]});class ds{constructor(e,r){ym(this,e,1,r)}resize(e){yv(this,e,1)}clone(){return new ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,u,d){vm(e,r,s,u,d,1)}}class Hi{constructor(e,r){ym(this,e,4,r)}resize(e){yv(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,u,d){vm(e,r,s,u,d,4)}}Qe("AlphaImage",ds),Qe("RGBAImage",Hi);var V2={paint:new Se({"heatmap-radius":new Q(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Q(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new j(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xe(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new j(ce.paint_heatmap["heatmap-opacity"])})};function xm(n){const e={},r=n.resolution||256,s=n.clips?n.clips.length:1,u=n.image||new Hi({width:r,height:s}),d=(f,y,v)=>{e[n.evaluationKey]=v;const b=n.expression.evaluate(e);u.data[f+y+0]=Math.floor(255*b.r/b.a),u.data[f+y+1]=Math.floor(255*b.g/b.a),u.data[f+y+2]=Math.floor(255*b.b/b.a),u.data[f+y+3]=Math.floor(255*b.a)};if(n.clips)for(let f=0,y=0;f<s;++f,y+=4*r)for(let v=0,b=0;v<r;v++,b+=4){const E=v/(r-1),{start:S,end:k}=n.clips[f];d(y,b,S*(1-E)+k*E)}else for(let f=0,y=0;f<r;f++,y+=4)d(0,y,f/(r-1));return u}var j2={paint:new Se({"hillshade-illumination-direction":new j(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new j(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new j(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new j(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new j(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new j(ce.paint_hillshade["hillshade-accent-color"])})};const $2=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:G2}=$2;var Wd=Xd,Z2=Xd;function Xd(n,e,r){r=r||2;var s,u,d,f,y,v,b,E=e&&e.length,S=E?e[0]*r:n.length,k=vv(n,0,S,r,!0),D=[];if(!k||k.next===k.prev)return D;if(E&&(k=function(O,Z,K,ee){var se,ue,le,pe=[];for(se=0,ue=Z.length;se<ue;se++)(le=vv(O,Z[se]*ee,se<ue-1?Z[se+1]*ee:O.length,ee,!1))===le.next&&(le.steiner=!0),pe.push(Q2(le));for(pe.sort(Y2),se=0;se<pe.length;se++)K=ps(K=K2(pe[se],K),K.next);return K}(n,e,k,r)),n.length>80*r){s=d=n[0],u=f=n[1];for(var B=r;B<S;B+=r)(y=n[B])<s&&(s=y),(v=n[B+1])<u&&(u=v),y>d&&(d=y),v>f&&(f=v);b=(b=Math.max(d-s,f-u))!==0?1/b:0}return Cu(k,D,r,s,u,b),D}function vv(n,e,r,s,u){var d,f;if(u===Tm(n,e,r,s)>0)for(d=e;d<r;d+=s)f=bv(d,n[d],n[d+1],f);else for(d=r-s;d>=e;d-=s)f=bv(d,n[d],n[d+1],f);return f&&Hd(f,f.next)&&(ku(f),f=f.next),f}function ps(n,e){if(!n)return n;e||(e=n);var r,s=n;do if(r=!1,s.steiner||!Hd(s,s.next)&&gn(s.prev,s,s.next)!==0)s=s.next;else{if(ku(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Cu(n,e,r,s,u,d,f){if(n){!f&&d&&function(E,S,k,D){var B=E;do B.z===null&&(B.z=wm(B.x,B.y,S,k,D)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==E);B.prevZ.nextZ=null,B.prevZ=null,function(O){var Z,K,ee,se,ue,le,pe,Ae,be=1;do{for(K=O,O=null,ue=null,le=0;K;){for(le++,ee=K,pe=0,Z=0;Z<be&&(pe++,ee=ee.nextZ);Z++);for(Ae=be;pe>0||Ae>0&&ee;)pe!==0&&(Ae===0||!ee||K.z<=ee.z)?(se=K,K=K.nextZ,pe--):(se=ee,ee=ee.nextZ,Ae--),ue?ue.nextZ=se:O=se,se.prevZ=ue,ue=se;K=ee}ue.nextZ=null,be*=2}while(le>1)}(B)}(n,s,u,d);for(var y,v,b=n;n.prev!==n.next;)if(y=n.prev,v=n.next,d?W2(n,s,u,d):q2(n))e.push(y.i/r),e.push(n.i/r),e.push(v.i/r),ku(n),n=v.next,b=v.next;else if((n=v)===b){f?f===1?Cu(n=X2(ps(n),e,r),e,r,s,u,d,2):f===2&&H2(n,e,r,s,u,d):Cu(ps(n),e,r,s,u,d,1);break}}}function q2(n){var e=n.prev,r=n,s=n.next;if(gn(e,r,s)>=0)return!1;for(var u=n.next.next;u!==n.prev;){if(Nl(e.x,e.y,r.x,r.y,s.x,s.y,u.x,u.y)&&gn(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function W2(n,e,r,s){var u=n.prev,d=n,f=n.next;if(gn(u,d,f)>=0)return!1;for(var y=u.x>d.x?u.x>f.x?u.x:f.x:d.x>f.x?d.x:f.x,v=u.y>d.y?u.y>f.y?u.y:f.y:d.y>f.y?d.y:f.y,b=wm(u.x<d.x?u.x<f.x?u.x:f.x:d.x<f.x?d.x:f.x,u.y<d.y?u.y<f.y?u.y:f.y:d.y<f.y?d.y:f.y,e,r,s),E=wm(y,v,e,r,s),S=n.prevZ,k=n.nextZ;S&&S.z>=b&&k&&k.z<=E;){if(S!==n.prev&&S!==n.next&&Nl(u.x,u.y,d.x,d.y,f.x,f.y,S.x,S.y)&&gn(S.prev,S,S.next)>=0||(S=S.prevZ,k!==n.prev&&k!==n.next&&Nl(u.x,u.y,d.x,d.y,f.x,f.y,k.x,k.y)&&gn(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;S&&S.z>=b;){if(S!==n.prev&&S!==n.next&&Nl(u.x,u.y,d.x,d.y,f.x,f.y,S.x,S.y)&&gn(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;k&&k.z<=E;){if(k!==n.prev&&k!==n.next&&Nl(u.x,u.y,d.x,d.y,f.x,f.y,k.x,k.y)&&gn(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function X2(n,e,r){var s=n;do{var u=s.prev,d=s.next.next;!Hd(u,d)&&xv(u,s,s.next,d)&&Au(u,d)&&Au(d,u)&&(e.push(u.i/r),e.push(s.i/r),e.push(d.i/r),ku(s),ku(s.next),s=n=d),s=s.next}while(s!==n);return ps(s)}function H2(n,e,r,s,u,d){var f=n;do{for(var y=f.next.next;y!==f.prev;){if(f.i!==y.i&&eT(f,y)){var v=wv(f,y);return f=ps(f,f.next),v=ps(v,v.next),Cu(f,e,r,s,u,d),void Cu(v,e,r,s,u,d)}y=y.next}f=f.next}while(f!==n)}function Y2(n,e){return n.x-e.x}function K2(n,e){var r=function(d,f){var y,v=f,b=d.x,E=d.y,S=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var k=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(k<=b&&k>S){if(S=k,k===b){if(E===v.y)return v;if(E===v.next.y)return v.next}y=v.x<v.next.x?v:v.next}}v=v.next}while(v!==f);if(!y)return null;if(b===S)return y;var D,B=y,O=y.x,Z=y.y,K=1/0;v=y;do b>=v.x&&v.x>=O&&b!==v.x&&Nl(E<Z?b:S,E,O,Z,E<Z?S:b,E,v.x,v.y)&&(D=Math.abs(E-v.y)/(b-v.x),Au(v,d)&&(D<K||D===K&&(v.x>y.x||v.x===y.x&&J2(y,v)))&&(y=v,K=D)),v=v.next;while(v!==B);return y}(n,e);if(!r)return e;var s=wv(r,n),u=ps(r,r.next);return ps(s,s.next),e===r?u:e}function J2(n,e){return gn(n.prev,n,e.prev)<0&&gn(e.next,n,n.next)<0}function wm(n,e,r,s,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*u)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Q2(n){var e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function Nl(n,e,r,s,u,d,f,y){return(u-f)*(e-y)-(n-f)*(d-y)>=0&&(n-f)*(s-y)-(r-f)*(e-y)>=0&&(r-f)*(d-y)-(u-f)*(s-y)>=0}function eT(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,s){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==s.i&&u.next.i!==s.i&&xv(u,u.next,r,s))return!0;u=u.next}while(u!==r);return!1}(n,e)&&(Au(n,e)&&Au(e,n)&&function(r,s){var u=r,d=!1,f=(r.x+s.x)/2,y=(r.y+s.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&f<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==r);return d}(n,e)&&(gn(n.prev,n,e.prev)||gn(n,e.prev,e))||Hd(n,e)&&gn(n.prev,n,n.next)>0&&gn(e.prev,e,e.next)>0)}function gn(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Hd(n,e){return n.x===e.x&&n.y===e.y}function xv(n,e,r,s){var u=Kd(gn(n,e,r)),d=Kd(gn(n,e,s)),f=Kd(gn(r,s,n)),y=Kd(gn(r,s,e));return u!==d&&f!==y||!(u!==0||!Yd(n,r,e))||!(d!==0||!Yd(n,s,e))||!(f!==0||!Yd(r,n,s))||!(y!==0||!Yd(r,e,s))}function Yd(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Kd(n){return n>0?1:n<0?-1:0}function Au(n,e){return gn(n.prev,n,n.next)<0?gn(n,e,n.next)>=0&&gn(n,n.prev,e)>=0:gn(n,e,n.prev)<0||gn(n,n.next,e)<0}function wv(n,e){var r=new bm(n.i,n.x,n.y),s=new bm(e.i,e.x,e.y),u=n.next,d=e.prev;return n.next=e,e.prev=n,r.next=u,u.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function bv(n,e,r,s){var u=new bm(n,e,r);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function ku(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function bm(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tm(n,e,r,s){for(var u=0,d=e,f=r-s;d<r;d+=s)u+=(n[f]-n[d])*(n[d+1]+n[f+1]),f=d;return u}function tT(n,e,r,s,u){Tv(n,e,r||0,s||n.length-1,u||nT)}function Tv(n,e,r,s,u){for(;s>r;){if(s-r>600){var d=s-r+1,f=e-r+1,y=Math.log(d),v=.5*Math.exp(2*y/3),b=.5*Math.sqrt(y*v*(d-v)/d)*(f-d/2<0?-1:1);Tv(n,e,Math.max(r,Math.floor(e-f*v/d+b)),Math.min(s,Math.floor(e+(d-f)*v/d+b)),u)}var E=n[e],S=r,k=s;for(Iu(n,r,e),u(n[s],E)>0&&Iu(n,r,s);S<k;){for(Iu(n,S,k),S++,k--;u(n[S],E)<0;)S++;for(;u(n[k],E)>0;)k--}u(n[r],E)===0?Iu(n,r,k):Iu(n,++k,s),k<=e&&(r=k+1),e<=k&&(s=k-1)}}function Iu(n,e,r){var s=n[e];n[e]=n[r],n[r]=s}function nT(n,e){return n<e?-1:n>e?1:0}function Em(n,e){const r=n.length;if(r<=1)return[n];const s=[];let u,d;for(let f=0;f<r;f++){const y=hn(n[f]);y!==0&&(n[f].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(u&&s.push(u),u=[n[f]]):u.push(n[f]))}if(u&&s.push(u),e>1)for(let f=0;f<s.length;f++)s[f].length<=e||(tT(s[f],e,1,s[f].length-1,iT),s[f]=s[f].slice(0,e));return s}function iT(n,e){return e.area-n.area}function Sm(n,e,r){const s=r.patternDependencies;let u=!1;for(const d of e){const f=d.paint.get(`${n}-pattern`);f.isConstant()||(u=!0);const y=f.constantOr(null);y&&(u=!0,s[y.to]=!0,s[y.from]=!0)}return u}function Cm(n,e,r,s,u){const d=u.patternDependencies;for(const f of e){const y=f.paint.get(`${n}-pattern`).value;if(y.kind!=="constant"){let v=y.evaluate({zoom:s-1},r,{},u.availableImages),b=y.evaluate({zoom:s},r,{},u.availableImages),E=y.evaluate({zoom:s+1},r,{},u.availableImages);v=v&&v.name?v.name:v,b=b&&b.name?b.name:b,E=E&&E.name?E.name:E,d[v]=!0,d[b]=!0,d[E]=!0,r.patterns[f.id]={min:v,mid:b,max:E}}}return r}Xd.deviation=function(n,e,r,s){var u=e&&e.length,d=Math.abs(Tm(n,0,u?e[0]*r:n.length,r));if(u)for(var f=0,y=e.length;f<y;f++)d-=Math.abs(Tm(n,e[f]*r,f<y-1?e[f+1]*r:n.length,r));var v=0;for(f=0;f<s.length;f+=3){var b=s[f]*r,E=s[f+1]*r,S=s[f+2]*r;v+=Math.abs((n[b]-n[S])*(n[E+1]-n[b+1])-(n[b]-n[E])*(n[S+1]-n[b+1]))}return d===0&&v===0?0:Math.abs((v-d)/d)},Xd.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,u=0;u<n.length;u++){for(var d=0;d<n[u].length;d++)for(var f=0;f<e;f++)r.vertices.push(n[u][d][f]);u>0&&r.holes.push(s+=n[u-1].length)}return r},Wd.default=Z2;class Jd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new et,this.indexArray=new wn,this.indexArray2=new en,this.programConfigurations=new va(e.layers,e.zoom),this.segments=new Rn,this.segments2=new Rn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,u){this.hasPattern=Sm("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:y,id:v,index:b,sourceLayerIndex:E}of e){const S=this.layers[0]._featureFilter.needGeometry,k=ba(y,S);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),k,s))continue;const D=d?d.evaluate(k,{},s,r.availableImages):void 0,B={id:v,properties:y.properties,type:y.type,sourceLayerIndex:E,index:b,geometry:S?k.geometry:Ao(y,s,u),patterns:{},sortKey:D};f.push(B)}d&&f.sort((y,v)=>y.sortKey-v.sortKey);for(const y of f){const{geometry:v,index:b,sourceLayerIndex:E}=y;if(this.hasPattern){const S=Cm("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(y,v,b,s,{},r.availableImages);r.featureIndex.insert(e[b].feature,v,b,E,this.index)}}update(e,r,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,u)}addFeatures(e,r,s,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,G2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,u,d,f=[]){for(const y of Em(r,500)){let v=0;for(const B of y)v+=B.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),E=b.vertexLength,S=[],k=[];for(const B of y){if(B.length===0)continue;B!==y[0]&&k.push(S.length/2);const O=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Z=O.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Z+B.length-1,Z),S.push(B[0].x),S.push(B[0].y);for(let K=1;K<B.length;K++)this.layoutVertexArray.emplaceBack(B[K].x,B[K].y),this.indexArray2.emplaceBack(Z+K-1,Z+K),S.push(B[K].x),S.push(B[K].y);O.vertexLength+=B.length,O.primitiveLength+=B.length}const D=Wd(S,k);for(let B=0;B<D.length;B+=3)this.indexArray.emplaceBack(E+D[B],E+D[B+1],E+D[B+2]);b.vertexLength+=v,b.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,u)}}Qe("FillBucket",Jd,{omit:["layers","patternFeatures"]});const rT=new Se({"fill-sort-key":new Q(ce.layout_fill["fill-sort-key"])});var oT={paint:new Se({"fill-antialias":new j(ce.paint_fill["fill-antialias"]),"fill-opacity":new Q(ce.paint_fill["fill-opacity"]),"fill-color":new Q(ce.paint_fill["fill-color"]),"fill-outline-color":new Q(ce.paint_fill["fill-outline-color"]),"fill-translate":new j(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new j(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new re(ce.paint_fill["fill-pattern"])}),layout:rT};const sT=ye([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),aT=ye([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:lT}=sT;var Ev=Vl;function Vl(n,e,r,s,u){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=u,n.readFields(cT,this,e)}function cT(n,e,r){n==1?e.id=r.readVarint():n==2?function(s,u){for(var d=s.readVarint()+s.pos;s.pos<d;){var f=u._keys[s.readVarint()],y=u._values[s.readVarint()];u.properties[f]=y}}(r,e):n==3?e.type=r.readVarint():n==4&&(e._geometry=r.pos)}function uT(n){for(var e,r,s=0,u=0,d=n.length,f=d-1;u<d;f=u++)s+=((r=n[f]).x-(e=n[u]).x)*(e.y+r.y);return s}Vl.types=["Unknown","Point","LineString","Polygon"],Vl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,s=1,u=0,d=0,f=0,y=[];n.pos<r;){if(u<=0){var v=n.readVarint();s=7&v,u=v>>3}if(u--,s===1||s===2)d+=n.readSVarint(),f+=n.readSVarint(),s===1&&(e&&y.push(e),e=[]),e.push(new he(d,f));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Vl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,s=0,u=0,d=0,f=1/0,y=-1/0,v=1/0,b=-1/0;n.pos<e;){if(s<=0){var E=n.readVarint();r=7&E,s=E>>3}if(s--,r===1||r===2)(u+=n.readSVarint())<f&&(f=u),u>y&&(y=u),(d+=n.readSVarint())<v&&(v=d),d>b&&(b=d);else if(r!==7)throw new Error("unknown command "+r)}return[f,v,y,b]},Vl.prototype.toGeoJSON=function(n,e,r){var s,u,d=this.extent*Math.pow(2,r),f=this.extent*n,y=this.extent*e,v=this.loadGeometry(),b=Vl.types[this.type];function E(D){for(var B=0;B<D.length;B++){var O=D[B];D[B]=[360*(O.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(s=0;s<v.length;s++)S[s]=v[s][0];E(v=S);break;case 2:for(s=0;s<v.length;s++)E(v[s]);break;case 3:for(v=function(D){var B=D.length;if(B<=1)return[D];for(var O,Z,K=[],ee=0;ee<B;ee++){var se=uT(D[ee]);se!==0&&(Z===void 0&&(Z=se<0),Z===se<0?(O&&K.push(O),O=[D[ee]]):O.push(D[ee]))}return O&&K.push(O),K}(v),s=0;s<v.length;s++)for(u=0;u<v[s].length;u++)E(v[s][u])}v.length===1?v=v[0]:b="Multi"+b;var k={type:"Feature",geometry:{type:b,coordinates:v},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Sv=Cv;function Cv(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(hT,this,e),this.length=this._features.length}function hT(n,e,r){n===15?e.version=r.readVarint():n===1?e.name=r.readString():n===5?e.extent=r.readVarint():n===2?e._features.push(r.pos):n===3?e._keys.push(r.readString()):n===4&&e._values.push(function(s){for(var u=null,d=s.readVarint()+s.pos;s.pos<d;){var f=s.readVarint()>>3;u=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return u}(r))}function dT(n,e,r){if(n===3){var s=new Sv(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}Cv.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Ev(this._pbf,e,this.extent,this._keys,this._values)};var Ta={VectorTile:function(n,e){this.layers=n.readFields(dT,{},e)},VectorTileFeature:Ev,VectorTileLayer:Sv};const pT=Ta.VectorTileFeature.types,fT=Math.pow(2,13);function Mu(n,e,r,s,u,d,f,y){n.emplaceBack((e<<1)+f,(r<<1)+d,(Math.floor(s*fT)<<1)+u,Math.round(y))}class Av{constructor(){this.acc=new he(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new he(e.x,e.y),this.max=new he(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let s=!!this.borders;const u=this.min,d=this.max;e.x<u.x?(u.x=e.x,s=!0):e.x>d.x&&(d.x=e.x,s=!0),e.y<u.y?(u.y=e.y,s=!0):e.y>d.y&&(d.y=e.y,s=!0),((e.x===0||e.x===Pt)&&e.x===r.x)!=((e.y===0||e.y===Pt)&&e.y===r.y)&&this.processBorderOverlap(e,r),s&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Bt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Pt!=e.x>Pt&&this.addBorderIntersection(1,Bt(r.y,e.y,(Pt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Bt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Pt!=e.y>Pt&&this.addBorderIntersection(3,Bt(r.x,e.x,(Pt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((r,s)=>r+s.edges,0);return e!==0?this.acc.div(e)._round():new he(0,0)}span(){return new he(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Am{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ct,this.centroidVertexArray=new Vy,this.indexArray=new wn,this.programConfigurations=new va(e.layers,e.zoom),this.segments=new Rn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,s,u){this.features=[],this.hasPattern=Sm("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(d){const f=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*f/(f*f+1)/Pt/(1<<d.z)}(s);for(const{feature:d,id:f,index:y,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,E=ba(d,b);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),E,s))continue;const S={id:f,sourceLayerIndex:v,index:y,geometry:b?E.geometry:Ao(d,s,u),properties:d.properties,type:d.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Cm("fill-extrusion",this.layers,S,this.zoom,r)):this.addFeature(S,S.geometry,y,s,{},r.availableImages),r.featureIndex.insert(d,S.geometry,y,v,this.index,k)}this.sortBorders()}addFeatures(e,r,s,u){for(const d of this.features){const{geometry:f}=d;this.addFeature(d,f,d.index,r,s,u)}this.sortBorders()}update(e,r,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,aT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,u,d,f){const y=this.enableTerrain?new Av:null;for(const b of Em(r,500)){let E=0,S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(b.length===0||(v=b[0]).every(Z=>Z.x<=0)||v.every(Z=>Z.x>=Pt)||v.every(Z=>Z.y<=0)||v.every(Z=>Z.y>=Pt))continue;for(let Z=0;Z<b.length;Z++){const K=b[Z];if(K.length===0)continue;E+=K.length;let ee=0;y&&y.startRing(K[0]);for(let se=0;se<K.length;se++){const ue=K[se];if(se>=1){const le=K[se-1];if(!mT(ue,le)){y&&y.append(ue,le),S.vertexLength+4>Rn.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=ue.sub(le)._perp(),Ae=pe.x/(Math.abs(pe.x)+Math.abs(pe.y)),be=pe.y>0?1:0,qe=le.dist(ue);ee+qe>32768&&(ee=0),Mu(this.layoutVertexArray,ue.x,ue.y,Ae,be,0,0,ee),Mu(this.layoutVertexArray,ue.x,ue.y,Ae,be,0,1,ee),ee+=qe,Mu(this.layoutVertexArray,le.x,le.y,Ae,be,0,0,ee),Mu(this.layoutVertexArray,le.x,le.y,Ae,be,0,1,ee);const Re=S.vertexLength;this.indexArray.emplaceBack(Re,Re+2,Re+1),this.indexArray.emplaceBack(Re+1,Re+2,Re+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+E>Rn.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray)),pT[e.type]!=="Polygon")continue;const k=[],D=[],B=S.vertexLength;for(let Z=0;Z<b.length;Z++){const K=b[Z];if(K.length!==0){K!==b[0]&&D.push(k.length/2);for(let ee=0;ee<K.length;ee++){const se=K[ee];Mu(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),k.push(se.x),k.push(se.y),y&&y.currentPolyCount.top++}}}const O=Wd(k,D);for(let Z=0;Z<O.length;Z+=3)this.indexArray.emplaceBack(B+O[Z],B+O[Z+2],B+O[Z+1]);S.primitiveLength+=O.length/3,S.vertexLength+=E}var v;if(y&&y.polyCount.length>0){if(y.borders){y.vertexArrayOffset=this.centroidVertexArray.length;const b=y.borders,E=this.featuresOnBorder.push(y)-1;for(let S=0;S<4;S++)b[S][0]!==Number.MAX_VALUE&&this.borders[S].push(E)}this.encodeCentroid(y.borders?void 0:y.centroid(),y)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,r,s=!0){let u,d;if(e)if(e.y!==0){const y=r.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(e.x+450)),d=0;else u=0,d=+s;let f=s?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let v=0;v<2*y.edges;v++)this.centroidVertexArray.emplace(f++,0,d),this.centroidVertexArray.emplace(f++,u,d);for(let v=0;v<y.top;v++)this.centroidVertexArray.emplace(f++,u,d)}}}function mT(n,e){return n.x===e.x&&(n.x<0||n.x>Pt)||n.y===e.y&&(n.y<0||n.y>Pt)}Qe("FillExtrusionBucket",Am,{omit:["layers","features"]}),Qe("PartMetadata",Av);var _T={paint:new Se({"fill-extrusion-opacity":new j(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Q(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new j(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new j(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new re(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Q(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Q(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new j(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Pu(n,e){return n.x*e.x+n.y*e.y}function kv(n,e){if(n.length===1){let r=0;const s=e[r++];let u;for(;!u||s.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const d=e[r],f=n[0],y=u.sub(s),v=d.sub(s),b=f.sub(s),E=Pu(y,y),S=Pu(y,v),k=Pu(v,v),D=Pu(b,y),B=Pu(b,v),O=E*k-S*S,Z=(k*D-S*B)/O,K=(E*B-S*D)/O,ee=s.z*(1-Z-K)+u.z*Z+d.z*K;if(isFinite(ee))return ee}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function Iv(n){const e=new he(n[0],n[1]);return e.z=n[2],e}function gT(n,e,r,s,u,d,f,y){const v=f*u.getElevationAt(n,e,!0,!0),b=d[0]!==0,E=b?d[1]===0?f*(d[0]/7-450):f*function(S,k,D){const B=Math.floor(k[0]/8),O=Math.floor(k[1]/8),Z=10*(k[0]-8*B),K=10*(k[1]-8*O),ee=S.getElevationAt(B,O,!0,!0),se=S.getMeterToDEM(D),ue=Math.floor(.5*(Z*se-1)),le=Math.floor(.5*(K*se-1)),pe=S.tileCoordToPixel(B,O),Ae=2*ue+1,be=2*le+1,qe=function(We,Je,yt,Wt,dt){return[We.getElevationAtPixel(Je,yt,!0),We.getElevationAtPixel(Je+dt,yt,!0),We.getElevationAtPixel(Je,yt+dt,!0),We.getElevationAtPixel(Je+Wt,yt+dt,!0)]}(S,pe.x-ue,pe.y-le,Ae,be),Re=Math.abs(qe[0]-qe[1]),ke=Math.abs(qe[2]-qe[3]),Fe=Math.abs(qe[0]-qe[2])+Math.abs(qe[1]-qe[3]),Oe=Math.min(.25,.5*se*(Re+ke)/Ae),ze=Math.min(.25,.5*se*Fe/be);return ee+Math.max(Oe*Z,ze*K)}(u,d,y):v;return{base:v+(r===0)?-1:r,top:b?Math.max(E+s,v+r+2):v+s}}const yT=ye([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:vT}=yT,xT=ye([{name:"a_packed",components:3,type:"Float32"}]),{members:wT}=xT,bT=Ta.VectorTileFeature.types,TT=Math.cos(Math.PI/180*37.5);class Qd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ht,this.layoutVertexArray2=new ft,this.indexArray=new wn,this.programConfigurations=new va(e.layers,e.zoom),this.segments=new Rn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,u){this.hasPattern=Sm("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:E,id:S,index:k,sourceLayerIndex:D}of e){const B=this.layers[0]._featureFilter.needGeometry,O=ba(E,B);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),O,s))continue;const Z=d?d.evaluate(O,{},s):void 0,K={id:S,properties:E.properties,type:E.type,sourceLayerIndex:D,index:k,geometry:B?O.geometry:Ao(E,s,u),patterns:{},sortKey:Z};f.push(K)}d&&f.sort((E,S)=>E.sortKey-S.sortKey);const{lineAtlas:y,featureIndex:v}=r,b=this.addConstantDashes(y);for(const E of f){const{geometry:S,index:k,sourceLayerIndex:D}=E;if(b&&this.addFeatureDashes(E,y),this.hasPattern){const B=Cm("line",this.layers,E,this.zoom,r);this.patternFeatures.push(B)}else this.addFeature(E,S,k,s,y.positions,r.availableImages);v.insert(e[k].feature,S,k,D,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")r=!0;else{const f=d.value,y=u.value;if(!y)continue;e.addDash(y.from,f),e.addDash(y.to,f),y.other&&e.addDash(y.other,f)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,f=u.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let y,v,b,E,S,k;if(d.kind==="constant"){const Z=d.value;if(!Z)continue;y=Z.other||Z.to,v=Z.to,b=Z.from}else y=d.evaluate({zoom:s-1},e),v=d.evaluate({zoom:s},e),b=d.evaluate({zoom:s+1},e);f.kind==="constant"?E=S=k=f.value:(E=f.evaluate({zoom:s-1},e),S=f.evaluate({zoom:s},e),k=f.evaluate({zoom:s+1},e)),r.addDash(y,E),r.addDash(v,S),r.addDash(b,k);const D=r.getKey(y,E),B=r.getKey(v,S),O=r.getKey(b,k);e.patterns[u.id]={min:D,mid:B,max:O}}}update(e,r,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,u)}addFeatures(e,r,s,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,wT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,u,d,f){const y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),b=y.get("line-cap").evaluate(e,{}),E=y.get("line-miter-limit"),S=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of r)this.addLine(k,e,v,b,E,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,u)}addLine(e,r,s,u,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<e.length-1;K++)this.totalDistance+=e[K].dist(e[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=bT[r.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let b=0;for(;b<v-1&&e[b].equals(e[b+1]);)b++;if(v<(y?3:2))return;s==="bevel"&&(d=1.05);const E=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let k,D,B,O,Z;this.e1=this.e2=-1,y&&(k=e[v-2],Z=e[b].sub(k)._unit()._perp());for(let K=b;K<v;K++){if(B=K===v-1?y?e[b+1]:void 0:e[K+1],B&&e[K].equals(B))continue;Z&&(O=Z),k&&(D=k),k=e[K],Z=B?B.sub(k)._unit()._perp():O,O=O||Z;let ee=O.add(Z);ee.x===0&&ee.y===0||ee._unit();const se=O.x*Z.x+O.y*Z.y,ue=ee.x*Z.x+ee.y*Z.y,le=ue!==0?1/ue:1/0,pe=2*Math.sqrt(2-2*ue),Ae=ue<TT&&D&&B,be=O.x*Z.y-O.y*Z.x>0;if(Ae&&K>b){const ke=k.dist(D);if(ke>2*E){const Fe=k.sub(k.sub(D)._mult(E/ke)._round());this.updateDistance(D,Fe),this.addCurrentVertex(Fe,O,0,0,S),D=Fe}}const qe=D&&B;let Re=qe?s:y?"butt":u;if(qe&&Re==="round"&&(le<f?Re="miter":le<=2&&(Re="fakeround")),Re==="miter"&&le>d&&(Re="bevel"),Re==="bevel"&&(le>2&&(Re="flipbevel"),le<d&&(Re="miter")),D&&this.updateDistance(D,k),Re==="miter")ee._mult(le),this.addCurrentVertex(k,ee,0,0,S);else if(Re==="flipbevel"){if(le>100)ee=Z.mult(-1);else{const ke=le*O.add(Z).mag()/O.sub(Z).mag();ee._perp()._mult(ke*(be?-1:1))}this.addCurrentVertex(k,ee,0,0,S),this.addCurrentVertex(k,ee.mult(-1),0,0,S)}else if(Re==="bevel"||Re==="fakeround"){const ke=-Math.sqrt(le*le-1),Fe=be?ke:0,Oe=be?0:ke;if(D&&this.addCurrentVertex(k,O,Fe,Oe,S),Re==="fakeround"){const ze=Math.round(180*pe/Math.PI/20);for(let We=1;We<ze;We++){let Je=We/ze;if(Je!==.5){const Wt=Je-.5;Je+=Je*Wt*(Je-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*Wt*Wt+(.848013+se*(.215638*se-1.06021)))}const yt=Z.sub(O)._mult(Je)._add(O)._unit()._mult(be?-1:1);this.addHalfVertex(k,yt.x,yt.y,!1,be,0,S)}}B&&this.addCurrentVertex(k,Z,-Fe,-Oe,S)}else if(Re==="butt")this.addCurrentVertex(k,ee,0,0,S);else if(Re==="square"){const ke=D?1:-1;D||this.addCurrentVertex(k,ee,ke,ke,S),this.addCurrentVertex(k,ee,0,0,S),D&&this.addCurrentVertex(k,ee,ke,ke,S)}else Re==="round"&&(D&&(this.addCurrentVertex(k,O,0,0,S),this.addCurrentVertex(k,O,1,1,S,!0)),B&&(this.addCurrentVertex(k,Z,-1,-1,S,!0),this.addCurrentVertex(k,Z,0,0,S)));if(Ae&&K<v-1){const ke=k.dist(B);if(ke>2*E){const Fe=k.add(B.sub(k)._mult(E/ke)._round());this.updateDistance(k,Fe),this.addCurrentVertex(Fe,Z,0,0,S),k=Fe}}}}addCurrentVertex(e,r,s,u,d,f=!1){const y=r.y*u-r.x,v=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,f,!1,s,d),this.addHalfVertex(e,y,v,f,!0,-u,d)}addHalfVertex({x:e,y:r},s,u,d,f,y,v){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const b=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),v.primitiveLength++),f?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Qe("LineBucket",Qd,{omit:["layers","patternFeatures"]});const ET=new Se({"line-cap":new Q(ce.layout_line["line-cap"]),"line-join":new Q(ce.layout_line["line-join"]),"line-miter-limit":new j(ce.layout_line["line-miter-limit"]),"line-round-limit":new j(ce.layout_line["line-round-limit"]),"line-sort-key":new Q(ce.layout_line["line-sort-key"])});var Mv={paint:new Se({"line-opacity":new Q(ce.paint_line["line-opacity"]),"line-color":new Q(ce.paint_line["line-color"]),"line-translate":new j(ce.paint_line["line-translate"]),"line-translate-anchor":new j(ce.paint_line["line-translate-anchor"]),"line-width":new Q(ce.paint_line["line-width"]),"line-gap-width":new Q(ce.paint_line["line-gap-width"]),"line-offset":new Q(ce.paint_line["line-offset"]),"line-blur":new Q(ce.paint_line["line-blur"]),"line-dasharray":new re(ce.paint_line["line-dasharray"]),"line-pattern":new re(ce.paint_line["line-pattern"]),"line-gradient":new xe(ce.paint_line["line-gradient"])}),layout:ET};const Pv=new class extends Q{possiblyEvaluate(n,e){return e=new P(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,r,s){return e=tn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,r,s)}}(Mv.paint.properties["line-width"].specification);function zv(n,e){return e>0?e+2*n:n}Pv.useIntegerZoom=!0;const ST=ye([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),CT=ye([{name:"a_projected_pos",components:3,type:"Float32"}],4);ye([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const AT=ye([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),kT=ye([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Dv=ye([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),IT=ye([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ye([{name:"triangle",components:3,type:"Uint16"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ye([{type:"Float32",name:"offsetX"}]),ye([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Gn=24;const Xr=128;function km(n,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new P(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:u}=r;let d=0;for(;d<s.length&&s[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<n+1;)f++;f=Math.min(s.length-1,f);const y=s[d],v=s[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:v,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:v,minSize:r.evaluate(new P(y)),maxSize:r.evaluate(new P(v)),interpolationType:u}}}function ep(n,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:u}){return n.kind==="source"?s/Xr:n.kind==="composite"?Bt(s/Xr,u/Xr,r):e}function jl(n,e){let r=0,s=0;if(n.kind==="constant")s=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:f}=n,y=u?Ke(vi.interpolationFactor(u,e,d,f),0,1):0;n.kind==="camera"?s=Bt(n.minSize,n.maxSize,y):r=y}return{uSizeT:r,uSize:s}}var MT=Object.freeze({__proto__:null,getSizeData:km,evaluateSizeForFeature:ep,evaluateSizeForZoom:jl,SIZE_PACK_FACTOR:Xr});function PT(n,e,r){return n.sections.forEach(s=>{s.text=function(u,d,f){const y=d.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),M.applyArabicShaping&&(u=M.applyArabicShaping(u)),u}(s.text,e,r)}),n}const zu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function zT(n){return n==="\uFE36"||n==="\uFE48"||n==="\uFE38"||n==="\uFE44"||n==="\uFE42"||n==="\uFE3E"||n==="\uFE3C"||n==="\uFE3A"||n==="\uFE18"||n==="\uFE40"||n==="\uFE10"||n==="\uFE13"||n==="\uFE14"||n==="\uFF40"||n==="\uFFE3"||n==="\uFE11"||n==="\uFE12"}function DT(n){return n==="\uFE35"||n==="\uFE47"||n==="\uFE37"||n==="\uFE43"||n==="\uFE41"||n==="\uFE3D"||n==="\uFE3B"||n==="\uFE39"||n==="\uFE17"||n==="\uFE3F"}var Lv=function(n,e,r,s,u){var d,f,y=8*u-s-1,v=(1<<y)-1,b=v>>1,E=-7,S=r?u-1:0,k=r?-1:1,D=n[e+S];for(S+=k,d=D&(1<<-E)-1,D>>=-E,E+=y;E>0;d=256*d+n[e+S],S+=k,E-=8);for(f=d&(1<<-E)-1,d>>=-E,E+=s;E>0;f=256*f+n[e+S],S+=k,E-=8);if(d===0)d=1-b;else{if(d===v)return f?NaN:1/0*(D?-1:1);f+=Math.pow(2,s),d-=b}return(D?-1:1)*f*Math.pow(2,d-s)},Bv=function(n,e,r,s,u,d){var f,y,v,b=8*d-u-1,E=(1<<b)-1,S=E>>1,k=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=s?0:d-1,B=s?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,f=E):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+S>=1?k/v:k*Math.pow(2,1-S))*v>=2&&(f++,v/=2),f+S>=E?(y=0,f=E):f+S>=1?(y=(e*v-1)*Math.pow(2,u),f+=S):(y=e*Math.pow(2,S-1)*Math.pow(2,u),f=0));u>=8;n[r+D]=255&y,D+=B,y/=256,u-=8);for(f=f<<u|y,b+=u;b>0;n[r+D]=255&f,D+=B,f/=256,b-=8);n[r+D-B]|=128*O},Du=qt;function qt(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}qt.Varint=0,qt.Fixed64=1,qt.Bytes=2,qt.Fixed32=5;var Im=4294967296,Rv=1/Im,Fv=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function ko(n){return n.type===qt.Bytes?n.readVarint()+n.pos:n.pos+1}function $l(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Ov(n,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var u=r.pos-1;u>=n;u--)r.buf[u+s]=r.buf[u]}function LT(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function BT(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function RT(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function FT(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function OT(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function UT(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function NT(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function VT(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function jT(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function tp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Gl(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function Uv(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function $T(n,e,r){e.glyphs=[],n===1&&r.readMessage(GT,e)}function GT(n,e,r){if(n===3){const{id:s,bitmap:u,width:d,height:f,left:y,top:v,advance:b}=r.readMessage(ZT,{});e.glyphs.push({id:s,bitmap:new ds({width:d+6,height:f+6},u),metrics:{width:d,height:f,left:y,top:v,advance:b}})}else n===4?e.ascender=r.readSVarint():n===5&&(e.descender=r.readSVarint())}function ZT(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}function Mm(n){let e=0,r=0;for(const f of n)e+=f.w*f.h,r=Math.max(r,f.w);n.sort((f,y)=>y.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,d=0;for(const f of n)for(let y=s.length-1;y>=0;y--){const v=s[y];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,d=Math.max(d,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===v.w&&f.h===v.h){const b=s.pop();y<s.length&&(s[y]=b)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(s.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}qt.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),u=s>>3,d=this.pos;this.type=7&s,n(u,e,this),this.pos===d&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=tp(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Uv(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=tp(this.buf,this.pos)+tp(this.buf,this.pos+4)*Im;return this.pos+=8,n},readSFixed64:function(){var n=tp(this.buf,this.pos)+Uv(this.buf,this.pos+4)*Im;return this.pos+=8,n},readFloat:function(){var n=Lv(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Lv(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(u,d,f){var y,v,b=f.buf;if(y=(112&(v=b[f.pos++]))>>4,v<128||(y|=(127&(v=b[f.pos++]))<<3,v<128)||(y|=(127&(v=b[f.pos++]))<<10,v<128)||(y|=(127&(v=b[f.pos++]))<<17,v<128)||(y|=(127&(v=b[f.pos++]))<<24,v<128)||(y|=(1&(v=b[f.pos++]))<<31,v<128))return $l(u,y,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Fv?function(r,s,u){return Fv.decode(r.subarray(s,u))}(this.buf,e,n):function(r,s,u){for(var d="",f=s;f<u;){var y,v,b,E=r[f],S=null,k=E>239?4:E>223?3:E>191?2:1;if(f+k>u)break;k===1?E<128&&(S=E):k===2?(192&(y=r[f+1]))==128&&(S=(31&E)<<6|63&y)<=127&&(S=null):k===3?(v=r[f+2],(192&(y=r[f+1]))==128&&(192&v)==128&&((S=(15&E)<<12|(63&y)<<6|63&v)<=2047||S>=55296&&S<=57343)&&(S=null)):k===4&&(v=r[f+2],b=r[f+3],(192&(y=r[f+1]))==128&&(192&v)==128&&(192&b)==128&&((S=(15&E)<<18|(63&y)<<12|(63&v)<<6|63&b)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,k=1):S>65535&&(S-=65536,d+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),d+=String.fromCharCode(S),f+=k}return d}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==qt.Bytes)return n.push(this.readVarint(e));var r=ko(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==qt.Bytes)return n.push(this.readSVarint());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==qt.Bytes)return n.push(this.readBoolean());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==qt.Bytes)return n.push(this.readFloat());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==qt.Bytes)return n.push(this.readDouble());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==qt.Bytes)return n.push(this.readFixed32());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==qt.Bytes)return n.push(this.readSFixed32());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==qt.Bytes)return n.push(this.readFixed64());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==qt.Bytes)return n.push(this.readSFixed64());var e=ko(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===qt.Varint)for(;this.buf[this.pos++]>127;);else if(e===qt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===qt.Fixed32)this.pos+=4;else{if(e!==qt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Gl(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Gl(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Gl(this.buf,-1&n,this.pos),Gl(this.buf,Math.floor(n*Rv),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Gl(this.buf,-1&n,this.pos),Gl(this.buf,Math.floor(n*Rv),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var s,u;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,f,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(s,0,r),function(d,f){var y=(7&d)<<4;f.buf[f.pos++]|=y|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(u,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,u,d){for(var f,y,v=0;v<u.length;v++){if((f=u.charCodeAt(v))>55295&&f<57344){if(!y){f>56319||v+1===u.length?(s[d++]=239,s[d++]=191,s[d++]=189):y=f;continue}if(f<56320){s[d++]=239,s[d++]=191,s[d++]=189,y=f;continue}f=y-55296<<10|f-56320|65536,y=null}else y&&(s[d++]=239,s[d++]=191,s[d++]=189,y=null);f<128?s[d++]=f:(f<2048?s[d++]=f>>6|192:(f<65536?s[d++]=f>>12|224:(s[d++]=f>>18|240,s[d++]=f>>12&63|128),s[d++]=f>>6&63|128),s[d++]=63&f|128)}return d}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&Ov(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Bv(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Bv(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var s=this.pos-r;s>=128&&Ov(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,r){this.writeTag(n,qt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,LT,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,BT,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,OT,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,RT,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,FT,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,UT,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,NT,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,VT,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,jT,e)},writeBytesField:function(n,e){this.writeTag(n,qt.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,qt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,qt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,qt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,qt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,qt.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,qt.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,qt.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,qt.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,qt.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class Pm{constructor(e,{pixelRatio:r,version:s,stretchX:u,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=d,this.content=f,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Nv{constructor(e,r){const s={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(r,u,d);const{w:f,h:y}=Mm(d),v=new Hi({width:f||1,height:y||1});for(const b in e){const E=e[b],S=s[b].paddedRect;Hi.copy(E.data,v,{x:0,y:0},{x:S.x+1,y:S.y+1},E.data)}for(const b in r){const E=r[b],S=u[b].paddedRect,k=S.x+1,D=S.y+1,B=E.data.width,O=E.data.height;Hi.copy(E.data,v,{x:0,y:0},{x:k,y:D},E.data),Hi.copy(E.data,v,{x:0,y:O-1},{x:k,y:D-1},{width:B,height:1}),Hi.copy(E.data,v,{x:0,y:0},{x:k,y:D+O},{width:B,height:1}),Hi.copy(E.data,v,{x:B-1,y:0},{x:k-1,y:D},{width:1,height:O}),Hi.copy(E.data,v,{x:0,y:0},{x:k+B,y:D},{width:1,height:O})}this.image=v,this.iconPositions=s,this.patternPositions=u}addImages(e,r,s){for(const u in e){const d=e[u],f={x:0,y:0,w:d.data.width+2,h:d.data.height+2};s.push(f),r[u]=new Pm(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,d]=e.tl;s.update(r.data,void 0,{x:u,y:d})}}Qe("ImagePosition",Pm),Qe("ImageAtlas",Nv);const Yi={horizontal:1,vertical:2,horizontalOnly:3};class Lu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Lu;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Lu;return r.imageName=e,r}}class Zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Zl;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,s){let u="";for(let d=0;d<r.length;d++){const f=r.charCodeAt(d+1)||null,y=r.charCodeAt(d-1)||null;u+=!s&&(f&&wu(f)&&!zu[r[d+1]]||y&&wu(y)&&!zu[r[d-1]])||!zu[r[d]]?r[d]:zu[r[d]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&np[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&np[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Zl;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Lu.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void ot("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Lu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zm(n,e,r,s,u,d,f,y,v,b,E,S,k,D,B,O){const Z=Zl.fromFeature(n,u);let K;S===Yi.vertical&&Z.verticalizePunctuation(k);const{processBidirectionalText:ee,processStyledBidirectionalText:se}=M;if(ee&&Z.sections.length===1){K=[];const pe=ee(Z.toString(),Dm(Z,b,d,e,s,D,B));for(const Ae of pe){const be=new Zl;be.text=Ae,be.sections=Z.sections;for(let qe=0;qe<Ae.length;qe++)be.sectionIndex.push(0);K.push(be)}}else if(se){K=[];const pe=se(Z.text,Z.sectionIndex,Dm(Z,b,d,e,s,D,B));for(const Ae of pe){const be=new Zl;be.text=Ae[0],be.sectionIndex=Ae[1],be.sections=Z.sections,K.push(be)}}else K=function(pe,Ae){const be=[],qe=pe.text;let Re=0;for(const ke of Ae)be.push(pe.substring(Re,ke)),Re=ke;return Re<qe.length&&be.push(pe.substring(Re,qe.length)),be}(Z,Dm(Z,b,d,e,s,D,B));const ue=[],le={positionedLines:ue,text:Z.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(pe,Ae,be,qe,Re,ke,Fe,Oe,ze,We,Je,yt){let Wt=0,dt=0,Nt=0;const Xe=Oe==="right"?1:Oe==="left"?0:.5;let Xt=!1;for(const Zt of Re){const Vt=Zt.getSections();for(const rn of Vt){if(rn.imageName)continue;const Zn=Ae[rn.fontStack];if(Zn&&(Xt=Zn.ascender!==void 0&&Zn.descender!==void 0,!Xt))break}if(!Xt)break}let Ft=0;for(const Zt of Re){Zt.trim();const Vt=Zt.getMaxScale(),rn=(Vt-1)*Gn,Zn={positionedGlyphs:[],lineOffset:0};pe.positionedLines[Ft]=Zn;const En=Zn.positionedGlyphs;let Dn=0;if(!Zt.length()){dt+=ke,++Ft;continue}let qn=0,ln=0;for(let Ht=0;Ht<Zt.length();Ht++){const Sn=Zt.getSection(Ht),Cn=Zt.getSectionIndex(Ht),yn=Zt.getCharCode(Ht);let pn=Sn.scale,Pn=null,Yt=null,Jn=null,Sr=Gn,Ki=0;const ur=!(ze===Yi.horizontal||!Je&&!xu(yn)||Je&&(np[yn]||(bn=yn,Cd(bn)||Ad(bn)||kd(bn)||Gr(bn)||yu(bn))));if(Sn.imageName){const Ji=qe[Sn.imageName];if(!Ji)continue;Jn=Sn.imageName,pe.iconsInText=pe.iconsInText||!0,Yt=Ji.paddedRect;const Qn=Ji.displaySize;pn=pn*Gn/yt,Pn={width:Qn[0],height:Qn[1],left:1,top:-3,advance:ur?Qn[1]:Qn[0],localGlyph:!1},Ki=Xt?-Pn.height*pn:Vt*Gn-17-Qn[1]*pn,Sr=Pn.advance;const Io=(ur?Qn[0]:Qn[1])*pn-Gn*Vt;Io>0&&Io>Dn&&(Dn=Io)}else{const Ji=be[Sn.fontStack];if(!Ji)continue;Ji[yn]&&(Yt=Ji[yn]);const Qn=Ae[Sn.fontStack];if(!Qn)continue;const Io=Qn.glyphs[yn];if(!Io)continue;if(Pn=Io.metrics,Sr=yn!==8203?Gn:0,Xt){const Yl=Qn.ascender!==void 0?Math.abs(Qn.ascender):0,Kl=Qn.descender!==void 0?Math.abs(Qn.descender):0,Jl=(Yl+Kl)*pn;qn<Jl&&(qn=Jl,ln=(Yl-Kl)/2*pn),Ki=-Yl*pn}else Ki=(Vt-pn)*Gn-17}ur?(pe.verticalizable=!0,En.push({glyph:yn,imageName:Jn,x:Wt,y:dt+Ki,vertical:ur,scale:pn,localGlyph:Pn.localGlyph,fontStack:Sn.fontStack,sectionIndex:Cn,metrics:Pn,rect:Yt}),Wt+=Sr*pn+We):(En.push({glyph:yn,imageName:Jn,x:Wt,y:dt+Ki,vertical:ur,scale:pn,localGlyph:Pn.localGlyph,fontStack:Sn.fontStack,sectionIndex:Cn,metrics:Pn,rect:Yt}),Wt+=Pn.advance*pn+We)}En.length!==0&&(Nt=Math.max(Wt-We,Nt),Xt?Zv(En,Xe,Dn,ln,ke*Vt/2):Zv(En,Xe,Dn,0,ke/2)),Wt=0;const bi=ke*Vt+Dn;Zn.lineOffset=Math.max(Dn,rn),dt+=bi,++Ft}var bn;const Tn=dt,{horizontalAlign:Mn,verticalAlign:Fn}=Lm(Fe);(function(Zt,Vt,rn,Zn,En,Dn){const qn=(Vt-rn)*En,ln=-Dn*Zn;for(const bi of Zt)for(const Ht of bi.positionedGlyphs)Ht.x+=qn,Ht.y+=ln})(pe.positionedLines,Xe,Mn,Fn,Nt,Tn),pe.top+=-Fn*Tn,pe.bottom=pe.top+Tn,pe.left+=-Mn*Nt,pe.right=pe.left+Nt,pe.hasBaseline=Xt}(le,e,r,s,K,f,y,v,S,b,k,O),!function(pe){for(const Ae of pe)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(ue)&&le}const np={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Vv(n,e,r,s,u,d){if(e.imageName){const f=s[e.imageName];return f?f.displaySize[0]*e.scale*Gn/d+u:0}{const f=r[e.fontStack],y=f&&f.glyphs[n];return y?y.metrics.advance*e.scale+u:0}}function jv(n,e,r,s){const u=Math.pow(n-e,2);return s?n<e?u/2:2*u:u+Math.abs(r)*r}function WT(n,e,r){let s=0;return n===10&&(s-=1e4),r&&(s+=150),n!==40&&n!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function $v(n,e,r,s,u,d){let f=null,y=jv(e,r,u,d);for(const v of s){const b=jv(e-v.x,r,u,d)+v.badness;b<=y&&(f=v,y=b)}return{index:n,x:e,priorBreak:f,badness:y}}function Gv(n){return n?Gv(n.priorBreak).concat(n.index):[]}function Dm(n,e,r,s,u,d,f){if(d!=="point")return[];if(!n)return[];const y=[],v=function(k,D,B,O,Z,K){let ee=0;for(let se=0;se<k.length();se++){const ue=k.getSection(se);ee+=Vv(k.getCharCode(se),ue,O,Z,D,K)}return ee/Math.max(1,Math.ceil(ee/B))}(n,e,r,s,u,f),b=n.text.indexOf("\u200B")>=0;let E=0;for(let k=0;k<n.length();k++){const D=n.getSection(k),B=n.getCharCode(k);if(np[B]||(E+=Vv(B,D,s,u,e,f)),k<n.length()-1){const O=!((S=B)<11904||!(Pd(S)||pu(S)||ma(S)||Ld(S)||gu(S)||Id(S)||fu(S)||Ml(S)||zl(S)||pa(S)||_u(S)||vu(S)||ss(S)||Md(S)||da(S)||mu(S)||Pl(S)||Bd(S)||Dd(S)||zd(S)));(qT[B]||O||D.imageName)&&y.push($v(k+1,E,v,y,WT(B,n.getCharCode(k+1),O&&b),!1))}}var S;return Gv($v(n.length(),E,v,y,0,!0))}function Lm(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Zv(n,e,r,s,u){if(!(e||r||s||u))return;const d=n.length-1,f=n[d],y=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=d;v++)n[v].x-=y,n[v].y+=r+s+u}function XT(n,e,r){const{horizontalAlign:s,verticalAlign:u}=Lm(r),d=e[0]-n.displaySize[0]*s,f=e[1]-n.displaySize[1]*u;return{image:n,top:f,bottom:f+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function qv(n,e,r,s,u,d){const f=n.image;let y;if(f.content){const Z=f.content,K=f.pixelRatio||1;y=[Z[0]/K,Z[1]/K,f.displaySize[0]-Z[2]/K,f.displaySize[1]-Z[3]/K]}const v=e.left*d,b=e.right*d;let E,S,k,D;r==="width"||r==="both"?(D=u[0]+v-s[3],S=u[0]+b+s[1]):(D=u[0]+(v+b-f.displaySize[0])/2,S=D+f.displaySize[0]);const B=e.top*d,O=e.bottom*d;return r==="height"||r==="both"?(E=u[1]+B-s[0],k=u[1]+O+s[2]):(E=u[1]+(B+O-f.displaySize[1])/2,k=E+f.displaySize[1]),{image:f,top:E,right:S,bottom:k,left:D,collisionPadding:y}}class fs extends he{constructor(e,r,s,u,d){super(e,r),this.angle=u,this.z=s,d!==void 0&&(this.segment=d)}clone(){return new fs(this.x,this.y,this.z,this.angle,this.segment)}}function Wv(n,e,r,s,u){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,y=0;for(;y>-r/2;){if(f--,f<0)return!1;y-=n[f].dist(d),d=n[f]}y+=n[f].dist(n[f+1]),f++;const v=[];let b=0;for(;y<r/2;){const E=n[f],S=n[f+1];if(!S)return!1;let k=n[f-1].angleTo(E)-E.angleTo(S);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:y,angleDelta:k}),b+=k;y-v[0].distance>s;)b-=v.shift().angleDelta;if(b>u)return!1;f++,y+=E.dist(S)}return!0}function Xv(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function Hv(n,e,r){return n?.6*e*r:0}function Yv(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function HT(n,e,r,s,u,d){const f=Hv(r,u,d),y=Yv(r,s)*d;let v=0;const b=Xv(n)/2;for(let E=0;E<n.length-1;E++){const S=n[E],k=n[E+1],D=S.dist(k);if(v+D>b){const B=(b-v)/D,O=Bt(S.x,k.x,B),Z=Bt(S.y,k.y,B),K=new fs(O,Z,0,k.angleTo(S),E);return!f||Wv(n,K,y,f,e)?K:void 0}v+=D}}function YT(n,e,r,s,u,d,f,y,v){const b=Hv(s,d,f),E=Yv(s,u),S=E*f,k=n[0].x===0||n[0].x===v||n[0].y===0||n[0].y===v;return e-S<e/4&&(e=S+e/4),Kv(n,k?e/2*y%e:(E/2+2*d)*f*y%e,e,b,r,S,k,!1,v)}function Kv(n,e,r,s,u,d,f,y,v){const b=d/2,E=Xv(n);let S=0,k=e-r,D=[];for(let B=0;B<n.length-1;B++){const O=n[B],Z=n[B+1],K=O.dist(Z),ee=Z.angleTo(O);for(;k+r<S+K;){k+=r;const se=(k-S)/K,ue=Bt(O.x,Z.x,se),le=Bt(O.y,Z.y,se);if(ue>=0&&ue<v&&le>=0&&le<v&&k-b>=0&&k+b<=E){const pe=new fs(ue,le,0,ee,B);pe._round(),s&&!Wv(n,pe,d,s,u)||D.push(pe)}}S+=K}return y||D.length||f||(D=Kv(n,S/2,r,s,u,d,f,!0,v)),D}function Jv(n,e,r,s,u){const d=[];for(let f=0;f<n.length;f++){const y=n[f];let v;for(let b=0;b<y.length-1;b++){let E=y[b],S=y[b+1];E.x<e&&S.x<e||(E.x<e?E=new he(e,E.y+(e-E.x)/(S.x-E.x)*(S.y-E.y))._round():S.x<e&&(S=new he(e,E.y+(e-E.x)/(S.x-E.x)*(S.y-E.y))._round()),E.y<r&&S.y<r||(E.y<r?E=new he(E.x+(r-E.y)/(S.y-E.y)*(S.x-E.x),r)._round():S.y<r&&(S=new he(E.x+(r-E.y)/(S.y-E.y)*(S.x-E.x),r)._round()),E.x>=s&&S.x>=s||(E.x>=s?E=new he(s,E.y+(s-E.x)/(S.x-E.x)*(S.y-E.y))._round():S.x>=s&&(S=new he(s,E.y+(s-E.x)/(S.x-E.x)*(S.y-E.y))._round()),E.y>=u&&S.y>=u||(E.y>=u?E=new he(E.x+(u-E.y)/(S.y-E.y)*(S.x-E.x),u)._round():S.y>=u&&(S=new he(E.x+(u-E.y)/(S.y-E.y)*(S.x-E.x),u)._round()),v&&E.equals(v[v.length-1])||(v=[E],d.push(v)),v.push(S)))))}}return d}Qe("Anchor",fs);const Bu=1e20;function Qv(n,e,r,s,u,d,f,y,v){for(let b=e;b<e+s;b++)ex(n,r*d+b,d,u,f,y,v);for(let b=r;b<r+u;b++)ex(n,b*d+e,1,s,f,y,v)}function ex(n,e,r,s,u,d,f){d[0]=0,f[0]=-Bu,f[1]=Bu,u[0]=n[e];for(let y=1,v=0,b=0;y<s;y++){u[y]=n[e+y*r];const E=y*y;do{const S=d[v];b=(u[y]-u[S]+E-S*S)/(y-S)/2}while(b<=f[v]&&--v>-1);v++,d[v]=y,f[v]=b,f[v+1]=Bu}for(let y=0,v=0;y<s;y++){for(;f[v+1]<y;)v++;const b=d[v],E=y-b;n[e+y*r]=u[b]+E*E}}const Bm={none:0,ideographs:1,all:2};class ql{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const s=[];for(const u in e)for(const d of e[u])s.push({stack:u,id:d});st(s,({stack:u,id:d},f)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=y.glyphs[d];if(v!==void 0)return void f(null,{stack:u,id:d,glyph:v});if(v=this._tinySDF(y,u,d),v)return y.glyphs[d]=v,void f(null,{stack:u,id:d,glyph:v});const b=Math.floor(d/256);if(256*b>65535)return void f(new Error("glyphs > 65535 not supported"));if(y.ranges[b])return void f(null,{stack:u,id:d,glyph:v});let E=y.requests[b];E||(E=y.requests[b]=[],ql.loadGlyphRange(u,b,this.url,this.requestManager,(S,k)=>{if(k){y.ascender=k.ascender,y.descender=k.descender;for(const D in k.glyphs)this._doesCharSupportLocalGlyph(+D)||(y.glyphs[+D]=k.glyphs[+D]);y.ranges[b]=!0}for(const D of E)D(S,k);delete y.requests[b]})),E.push((S,k)=>{S?f(S):k&&f(null,{stack:u,id:d,glyph:k.glyphs[d]||null})})},(u,d)=>{if(u)r(u);else if(d){const f={};for(const{stack:y,id:v,glyph:b}of d)f[y]===void 0&&(f[y]={}),f[y].glyphs===void 0&&(f[y].glyphs={}),f[y].glyphs[v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},f[y].ascender=this.entries[y].ascender,f[y].descender=this.entries[y].descender;r(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Bm.none&&(this.localGlyphMode===Bm.all?!!this.localFontFamily:!!this.localFontFamily&&(pa(e)||fa(e)||ss(e)||Pl(e))||Ml(e))}_tinySDF(e,r,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let O="400";/bold/i.test(r)?O="900":/medium/i.test(r)?O="500":/light/i.test(r)&&(O="200"),d=e.tinySDF=new ql.TinySDF({fontFamily:u,fontWeight:O,fontSize:48,buffer:6,radius:16}),d.fontWeight=O}if(this.localGlyphs[d.fontWeight][s])return this.localGlyphs[d.fontWeight][s];const f=String.fromCharCode(s),{data:y,width:v,height:b,glyphWidth:E,glyphHeight:S,glyphLeft:k,glyphTop:D,glyphAdvance:B}=d.draw(f);return this.localGlyphs[d.fontWeight][s]={id:s,bitmap:new ds({width:v,height:b},y),metrics:{width:E/2,height:S/2,left:k/2,top:D/2-27,advance:B/2,localGlyph:!0}}}}function tx(n,e,r,s){const u=[],d=n.image,f=d.pixelRatio,y=d.paddedRect.w-2,v=d.paddedRect.h-2,b=n.right-n.left,E=n.bottom-n.top,S=d.stretchX||[[0,y]],k=d.stretchY||[[0,v]],D=(ke,Fe)=>ke+Fe[1]-Fe[0],B=S.reduce(D,0),O=k.reduce(D,0),Z=y-B,K=v-O;let ee=0,se=B,ue=0,le=O,pe=0,Ae=Z,be=0,qe=K;if(d.content&&s){const ke=d.content;ee=ip(S,0,ke[0]),ue=ip(k,0,ke[1]),se=ip(S,ke[0],ke[2]),le=ip(k,ke[1],ke[3]),pe=ke[0]-ee,be=ke[1]-ue,Ae=ke[2]-ke[0]-se,qe=ke[3]-ke[1]-le}const Re=(ke,Fe,Oe,ze)=>{const We=rp(ke.stretch-ee,se,b,n.left),Je=op(ke.fixed-pe,Ae,ke.stretch,B),yt=rp(Fe.stretch-ue,le,E,n.top),Wt=op(Fe.fixed-be,qe,Fe.stretch,O),dt=rp(Oe.stretch-ee,se,b,n.left),Nt=op(Oe.fixed-pe,Ae,Oe.stretch,B),Xe=rp(ze.stretch-ue,le,E,n.top),Xt=op(ze.fixed-be,qe,ze.stretch,O),Ft=new he(We,yt),bn=new he(dt,yt),Tn=new he(dt,Xe),Mn=new he(We,Xe),Fn=new he(Je/f,Wt/f),Zt=new he(Nt/f,Xt/f),Vt=e*Math.PI/180;if(Vt){const En=Math.sin(Vt),Dn=Math.cos(Vt),qn=[Dn,-En,En,Dn];Ft._matMult(qn),bn._matMult(qn),Mn._matMult(qn),Tn._matMult(qn)}const rn=ke.stretch+ke.fixed,Zn=Fe.stretch+Fe.fixed;return{tl:Ft,tr:bn,bl:Mn,br:Tn,tex:{x:d.paddedRect.x+1+rn,y:d.paddedRect.y+1+Zn,w:Oe.stretch+Oe.fixed-rn,h:ze.stretch+ze.fixed-Zn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fn,pixelOffsetBR:Zt,minFontScaleX:Ae/f/b,minFontScaleY:qe/f/E,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const ke=nx(S,Z,B),Fe=nx(k,K,O);for(let Oe=0;Oe<ke.length-1;Oe++){const ze=ke[Oe],We=ke[Oe+1];for(let Je=0;Je<Fe.length-1;Je++)u.push(Re(ze,Fe[Je],We,Fe[Je+1]))}}else u.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:v+1}));return u}function ip(n,e,r){let s=0;for(const u of n)s+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return s}function nx(n,e,r){const s=[{fixed:-1,stretch:0}];for(const[u,d]of n){const f=s[s.length-1];s.push({fixed:u-f.stretch,stretch:f.stretch}),s.push({fixed:u-f.stretch,stretch:f.stretch+(d-u)})}return s.push({fixed:e+1,stretch:r}),s}function rp(n,e,r,s){return n/e*r+s}function op(n,e,r,s){return n-e*r/s}function KT(n,e,r,s){const u=e+n.positionedLines[s].lineOffset;return s===0?r+u/2:r+(u+(e+n.positionedLines[s-1].lineOffset))/2}ql.loadGlyphRange=function(n,e,r,s,u){const d=256*e,f=d+255,y=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${d}-${f}`),ho.Glyphs);R(y,(v,b)=>{if(v)u(v);else if(b){const E={},S=function(k){return new Du(k).readFields($T,{})}(b);for(const k of S.glyphs)E[k.id]=k;u(null,{glyphs:E,ascender:S.ascender,descender:S.descender})}})},ql.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}){this.buffer=e,this.cutoff=s,this.radius=r;const y=this.size=n+4*e,v=this._createCanvas(y),b=this.ctx=v.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${d} ${n}px ${u}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(n),f=Math.floor(r),y=Math.min(this.size-this.buffer,Math.ceil(d-u)),v=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(s)),b=y+2*this.buffer,E=v+2*this.buffer,S=b*E,k=new Uint8ClampedArray(S),D={data:k,width:b,height:E,glyphWidth:y,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(y===0||v===0)return D;const{ctx:B,buffer:O,gridInner:Z,gridOuter:K}=this;B.clearRect(O,O,y,v),B.fillText(n,O,O+f+1);const ee=B.getImageData(O,O,y,v);K.fill(Bu,0,S),Z.fill(0,0,S);for(let se=0;se<v;se++)for(let ue=0;ue<y;ue++){const le=ee.data[4*(se*y+ue)+3]/255;if(le===0)continue;const pe=(se+O)*b+ue+O;if(le===1)K[pe]=0,Z[pe]=Bu;else{const Ae=.5-le;K[pe]=Ae>0?Ae*Ae:0,Z[pe]=Ae<0?Ae*Ae:0}}Qv(K,0,0,b,E,b,this.f,this.v,this.z),Qv(Z,O,O,y,v,b,this.f,this.v,this.z);for(let se=0;se<S;se++){const ue=Math.sqrt(K[se])-Math.sqrt(Z[se]);k[se]=Math.round(255-255*(ue/this.radius+this.cutoff))}return D}};class JT{constructor(e=[],r=QT){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,u=r[e];for(;e>0;){const d=e-1>>1,f=r[d];if(s(u,f)>=0)break;r[e]=f,e=d}r[e]=u}_down(e){const{data:r,compare:s}=this,u=this.length>>1,d=r[e];for(;e<u;){let f=1+(e<<1),y=r[f];const v=f+1;if(v<this.length&&s(r[v],y)<0&&(f=v,y=r[v]),s(y,d)>=0)break;r[e]=y,e=f}r[e]=d}}function QT(n,e){return n<e?-1:n>e?1:0}function eE(n,e=1,r=!1){let s=1/0,u=1/0,d=-1/0,f=-1/0;const y=n[0];for(let D=0;D<y.length;D++){const B=y[D];(!D||B.x<s)&&(s=B.x),(!D||B.y<u)&&(u=B.y),(!D||B.x>d)&&(d=B.x),(!D||B.y>f)&&(f=B.y)}const v=Math.min(d-s,f-u);let b=v/2;const E=new JT([],tE);if(v===0)return new he(s,u);for(let D=s;D<d;D+=v)for(let B=u;B<f;B+=v)E.push(new Wl(D+b,B+b,b,n));let S=function(D){let B=0,O=0,Z=0;const K=D[0];for(let ee=0,se=K.length,ue=se-1;ee<se;ue=ee++){const le=K[ee],pe=K[ue],Ae=le.x*pe.y-pe.x*le.y;O+=(le.x+pe.x)*Ae,Z+=(le.y+pe.y)*Ae,B+=3*Ae}return new Wl(O/B,Z/B,0,D)}(n),k=E.length;for(;E.length;){const D=E.pop();(D.d>S.d||!S.d)&&(S=D,r&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,k)),D.max-S.d<=e||(b=D.h/2,E.push(new Wl(D.p.x-b,D.p.y-b,b,n)),E.push(new Wl(D.p.x+b,D.p.y-b,b,n)),E.push(new Wl(D.p.x-b,D.p.y+b,b,n)),E.push(new Wl(D.p.x+b,D.p.y+b,b,n)),k+=4)}return r&&(console.log(`num probes: ${k}`),console.log(`best distance: ${S.d}`)),S.p}function tE(n,e){return e.max-n.max}function Wl(n,e,r,s){this.p=new he(n,e),this.h=r,this.d=function(u,d){let f=!1,y=1/0;for(let v=0;v<d.length;v++){const b=d[v];for(let E=0,S=b.length,k=S-1;E<S;k=E++){const D=b[E],B=b[k];D.y>u.y!=B.y>u.y&&u.x<(B.x-D.x)*(u.y-D.y)/(B.y-D.y)+D.x&&(f=!f),y=Math.min(y,Qy(u,D,B))}}return(f?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Rm=Number.POSITIVE_INFINITY,nE=Math.sqrt(2);function ix(n,e){return e[1]!==Rm?function(r,s,u){let d=0,f=0;switch(s=Math.abs(s),u=Math.abs(u),r){case"top-right":case"top-left":case"top":f=u-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-u}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,f]}(n,e[0],e[1]):function(r,s){let u=0,d=0;s<0&&(s=0);const f=s/nE;switch(r){case"top-right":case"top-left":d=f-7;break;case"bottom-right":case"bottom-left":d=7-f;break;case"bottom":d=7-s;break;case"top":d=s-7}switch(r){case"top-right":case"bottom-right":u=-f;break;case"top-left":case"bottom-left":u=f;break;case"left":u=s;break;case"right":u=-s}return[u,d]}(n,e[0])}function iE(n,e,r,s,u,d,f,y,v){n.createArrays(),n.tilePixelRatio=Pt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const b=n.layers[0].layout,E=n.layers[0]._unevaluatedLayout._values,S={};if(n.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:O}=n.textSizeData;S.compositeTextSizes=[E["text-size"].possiblyEvaluate(new P(B),y),E["text-size"].possiblyEvaluate(new P(O),y)]}if(n.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:O}=n.iconSizeData;S.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new P(B),y),E["icon-size"].possiblyEvaluate(new P(O),y)]}S.layoutTextSize=E["text-size"].possiblyEvaluate(new P(v+1),y),S.layoutIconSize=E["icon-size"].possiblyEvaluate(new P(v+1),y),S.textMaxSize=E["text-size"].possiblyEvaluate(new P(18),y);const k=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point",D=b.get("text-size");for(const B of n.features){const O=b.get("text-font").evaluate(B,{},y).join(","),Z=D.evaluate(B,{},y),K=S.layoutTextSize.evaluate(B,{},y),ee=(S.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),se=B.text;let ue,le=[0,0];if(se){const be=se.toString(),qe=b.get("text-letter-spacing").evaluate(B,{},y)*Gn,Re=b.get("text-line-height").evaluate(B,{},y)*Gn,ke=Dl(be)?qe:0,Fe=b.get("text-anchor").evaluate(B,{},y),Oe=b.get("text-variable-anchor");if(!Oe){const dt=b.get("text-radial-offset").evaluate(B,{},y);le=dt?ix(Fe,[dt*Gn,Rm]):b.get("text-offset").evaluate(B,{},y).map(Nt=>Nt*Gn)}let ze=k?"center":b.get("text-justify").evaluate(B,{},y);const We=b.get("symbol-placement"),Je=We==="point",yt=We==="point"?b.get("text-max-width").evaluate(B,{},y)*Gn:0,Wt=dt=>{n.allowVerticalPlacement&&Zr(be)&&(ee.vertical=zm(se,e,r,u,O,yt,Re,Fe,dt,ke,le,Yi.vertical,!0,We,K,Z))};if(!k&&Oe){const dt=ze==="auto"?Oe.map(Xe=>Fm(Xe)):[ze];let Nt=!1;for(let Xe=0;Xe<dt.length;Xe++){const Xt=dt[Xe];if(!ee.horizontal[Xt])if(Nt)ee.horizontal[Xt]=ee.horizontal[0];else{const Ft=zm(se,e,r,u,O,yt,Re,"center",Xt,ke,le,Yi.horizontal,!1,We,K,Z);Ft&&(ee.horizontal[Xt]=Ft,Nt=Ft.positionedLines.length===1)}}Wt("left")}else{if(ze==="auto"&&(ze=Fm(Fe)),Je||b.get("text-writing-mode").indexOf("horizontal")>=0||!Zr(be)){const dt=zm(se,e,r,u,O,yt,Re,Fe,ze,ke,le,Yi.horizontal,!1,We,K,Z);dt&&(ee.horizontal[ze]=dt)}Wt(We==="point"?"left":ze)}}let pe=!1;if(B.icon&&B.icon.name){const be=s[B.icon.name];be&&(ue=XT(u[B.icon.name],b.get("icon-offset").evaluate(B,{},y),b.get("icon-anchor").evaluate(B,{},y)),pe=be.sdf,n.sdfIcons===void 0?n.sdfIcons=be.sdf:n.sdfIcons!==be.sdf&&ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==n.pixelRatio||b.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Ae=ox(ee.horizontal)||ee.vertical;n.iconsInText||(n.iconsInText=!!Ae&&Ae.iconsInText),(Ae||ue)&&rE(n,B,ee,ue,s,S,K,0,le,pe,f,y)}d&&n.generateCollisionDebugBuffers(v,n.collisionBoxArray)}function Fm(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rE(n,e,r,s,u,d,f,y,v,b,E,S){let k=d.textMaxSize.evaluate(e,{},S);k===void 0&&(k=f);const D=n.layers[0].layout,B=D.get("icon-offset").evaluate(e,{},S),O=ox(r.horizontal)||r.vertical,Z=f/24,K=n.tilePixelRatio*k/24,ee=n.tilePixelRatio*D.get("symbol-spacing"),se=D.get("text-padding")*n.tilePixelRatio,ue=D.get("icon-padding")*n.tilePixelRatio,le=te(D.get("text-max-angle")),pe=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Ae=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",be=D.get("symbol-placement"),qe=ee/2,Re=D.get("icon-text-fit");let ke;s&&Re!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(ke=qv(s,r.vertical,Re,D.get("icon-text-fit-padding"),B,Z)),O&&(s=qv(s,O,Re,D.get("icon-text-fit-padding"),B,Z)));const Fe=(Oe,ze)=>{ze.x<0||ze.x>=Pt||ze.y<0||ze.y>=Pt||function(We,Je,yt,Wt,dt,Nt,Xe,Xt,Ft,bn,Tn,Mn,Fn,Zt,Vt,rn,Zn,En,Dn,qn,ln,bi,Ht,Sn,Cn){const yn=We.addToLineVertexArray(Je,Wt);let pn,Pn,Yt,Jn,Sr,Ki,ur,Ji=0,Qn=0,Io=0,Yl=0,Kl=-1,Jl=-1;const Jr={};let Fx=bu(""),Jm=0,Qm=0;if(Ft._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Jm,Qm]=Ft.layout.get("text-offset").evaluate(ln,{},Cn).map(Di=>Di*Gn):(Jm=Ft.layout.get("text-radial-offset").evaluate(ln,{},Cn)*Gn,Qm=Rm),We.allowVerticalPlacement&&dt.vertical){const Di=dt.vertical;if(Vt)Ki=Om(Di),Xt&&(ur=Om(Xt));else{const Li=Ft.layout.get("text-rotate").evaluate(ln,{},Cn)+90;Yt=sp(bn,yt,Je,Tn,Mn,Fn,Di,Zt,Li,rn),Xt&&(Jn=sp(bn,yt,Je,Tn,Mn,Fn,Xt,En,Li))}}if(Nt){const Di=Ft.layout.get("icon-rotate").evaluate(ln,{},Cn),Li=Ft.layout.get("icon-text-fit")!=="none",Vu=tx(Nt,Di,Ht,Li),t_=Xt?tx(Xt,Di,Ht,Li):void 0;Pn=sp(bn,yt,Je,Tn,Mn,Fn,Nt,En,Di),Ji=4*Vu.length;const Ox=We.iconSizeData;let Sa=null;Ox.kind==="source"?(Sa=[Xr*Ft.layout.get("icon-size").evaluate(ln,{},Cn)],Sa[0]>ms&&ot(`${We.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ox.kind==="composite"&&(Sa=[Xr*bi.compositeIconSizes[0].evaluate(ln,{},Cn),Xr*bi.compositeIconSizes[1].evaluate(ln,{},Cn)],(Sa[0]>ms||Sa[1]>ms)&&ot(`${We.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),We.addSymbols(We.icon,Vu,Sa,qn,Dn,ln,!1,yt,Je,yn.lineStartIndex,yn.lineLength,-1,Sn,Cn),Kl=We.icon.placedSymbolArray.length-1,t_&&(Qn=4*t_.length,We.addSymbols(We.icon,t_,Sa,qn,Dn,ln,Yi.vertical,yt,Je,yn.lineStartIndex,yn.lineLength,-1,Sn,Cn),Jl=We.icon.placedSymbolArray.length-1)}for(const Di in dt.horizontal){const Li=dt.horizontal[Di];pn||(Fx=bu(Li.text),Vt?Sr=Om(Li):pn=sp(bn,yt,Je,Tn,Mn,Fn,Li,Zt,Ft.layout.get("text-rotate").evaluate(ln,{},Cn),rn));const Vu=Li.positionedLines.length===1;if(Io+=rx(We,yt,Je,Li,Xe,Ft,Vt,ln,rn,yn,dt.vertical?Yi.horizontal:Yi.horizontalOnly,Vu?Object.keys(dt.horizontal):[Di],Jr,Kl,bi,Sn,Cn),Vu)break}dt.vertical&&(Yl+=rx(We,yt,Je,dt.vertical,Xe,Ft,Vt,ln,rn,yn,Yi.vertical,["vertical"],Jr,Jl,bi,Sn,Cn));let xs=-1;const e_=(Di,Li)=>Di?Math.max(Di,Li):Li;xs=e_(Sr,xs),xs=e_(Ki,xs),xs=e_(ur,xs);const IE=xs>-1?1:0;We.glyphOffsetArray.length>=_s.MAX_GLYPHS&&ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ln.sortKey!==void 0&&We.addToSortKeyRanges(We.symbolInstances.length,ln.sortKey),We.symbolInstances.emplaceBack(yt.x,yt.y,yt.z,Je.x,Je.y,Jr.right>=0?Jr.right:-1,Jr.center>=0?Jr.center:-1,Jr.left>=0?Jr.left:-1,Jr.vertical>=0?Jr.vertical:-1,Kl,Jl,Fx,pn!==void 0?pn:We.collisionBoxArray.length,pn!==void 0?pn+1:We.collisionBoxArray.length,Yt!==void 0?Yt:We.collisionBoxArray.length,Yt!==void 0?Yt+1:We.collisionBoxArray.length,Pn!==void 0?Pn:We.collisionBoxArray.length,Pn!==void 0?Pn+1:We.collisionBoxArray.length,Jn||We.collisionBoxArray.length,Jn?Jn+1:We.collisionBoxArray.length,Tn,Io,Yl,Ji,Qn,IE,0,Jm,Qm,xs)}(n,ze,ze,Oe,r,s,u,ke,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,se,pe,v,0,ue,Ae,B,e,d,b,E,S)};if(be==="line")for(const Oe of Jv(e.geometry,0,0,Pt,Pt)){const ze=YT(Oe,ee,le,r.vertical||O,s,24,K,n.overscaling,Pt);for(const We of ze){const Je=O;Je&&oE(n,Je.text,qe,We)||Fe(Oe,We)}}else if(be==="line-center"){for(const Oe of e.geometry)if(Oe.length>1){const ze=HT(Oe,le,r.vertical||O,s,24,K);ze&&Fe(Oe,ze)}}else if(e.type==="Polygon")for(const Oe of Em(e.geometry,0)){const ze=eE(Oe,16);Fe(Oe[0],new fs(ze.x,ze.y,0,0,void 0))}else if(e.type==="LineString")for(const Oe of e.geometry)Fe(Oe,new fs(Oe[0].x,Oe[0].y,0,0,void 0));else if(e.type==="Point")for(const Oe of e.geometry)for(const ze of Oe)Fe([ze],new fs(ze.x,ze.y,0,0,void 0))}const ms=32640;function rx(n,e,r,s,u,d,f,y,v,b,E,S,k,D,B,O,Z){const K=function(ue,le,pe,Ae,be,qe,Re,ke){const Fe=[];if(le.positionedLines.length===0)return Fe;const Oe=Ae.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,ze=function(dt){const Nt=dt[0],Xe=dt[1],Xt=Nt*Xe;return Xt>0?[Nt,-Xe]:Xt<0?[-Nt,Xe]:Nt===0?[Xe,Nt]:[Xe,-Nt]}(pe);let We=Math.abs(le.top-le.bottom);for(const dt of le.positionedLines)We-=dt.lineOffset;const Je=le.positionedLines.length,yt=We/Je;let Wt=le.top-pe[1];for(let dt=0;dt<Je;++dt){const Nt=le.positionedLines[dt];Wt=KT(le,yt,Wt,dt);for(const Xe of Nt.positionedGlyphs){if(!Xe.rect)continue;const Xt=Xe.rect||{};let Ft=4,bn=!0,Tn=1,Mn=0;if(Xe.imageName){const Yt=Re[Xe.imageName];if(!Yt)continue;if(Yt.sdf){ot("SDF images are not supported in formatted text and will be ignored.");continue}bn=!1,Tn=Yt.pixelRatio,Ft=1/Tn}const Fn=(be||ke)&&Xe.vertical,Zt=Xe.metrics.advance*Xe.scale/2,Vt=Xe.metrics,rn=Xe.rect;if(rn===null)continue;ke&&le.verticalizable&&(Mn=Xe.imageName?Zt-Xe.metrics.width*Xe.scale/2:0);const Zn=be?[Xe.x+Zt,Xe.y]:[0,0];let En=[0,0],Dn=[0,0],qn=!1;be||(Fn?(Dn=[Xe.x+Zt+ze[0],Xe.y+ze[1]-Mn],qn=!0):En=[Xe.x+Zt+pe[0],Xe.y+pe[1]-Mn]);const ln=rn.w*Xe.scale/(Tn*(Xe.localGlyph?2:1)),bi=rn.h*Xe.scale/(Tn*(Xe.localGlyph?2:1));let Ht,Sn,Cn,yn;if(Fn){const Yt=Xe.y-Wt,Jn=new he(-Zt,Zt-Yt),Sr=-Math.PI/2,Ki=new he(...Dn);Ht=new he(-Zt+En[0],En[1]),Ht._rotateAround(Sr,Jn)._add(Ki),Ht.x+=-Yt+Zt,Ht.y-=(Vt.left-Ft)*Xe.scale;const ur=Xe.imageName?Vt.advance*Xe.scale:Gn*Xe.scale,Ji=String.fromCharCode(Xe.glyph);zT(Ji)?Ht.x+=(1-Ft)*Xe.scale:DT(Ji)?Ht.x+=ur-Vt.height*Xe.scale+(-Ft-1)*Xe.scale:Ht.x+=Xe.imageName||Vt.width+2*Ft===rn.w&&Vt.height+2*Ft===rn.h?(ur-bi)/2:(ur-(Vt.height+2*Ft)*Xe.scale)/2,Sn=new he(Ht.x,Ht.y-ln),Cn=new he(Ht.x+bi,Ht.y),yn=new he(Ht.x+bi,Ht.y-ln)}else{const Yt=(Vt.left-Ft)*Xe.scale-Zt+En[0],Jn=(-Vt.top-Ft)*Xe.scale+En[1],Sr=Yt+ln,Ki=Jn+bi;Ht=new he(Yt,Jn),Sn=new he(Sr,Jn),Cn=new he(Yt,Ki),yn=new he(Sr,Ki)}if(Oe){let Yt;Yt=be?new he(0,0):qn?new he(ze[0],ze[1]):new he(pe[0],pe[1]),Ht._rotateAround(Oe,Yt),Sn._rotateAround(Oe,Yt),Cn._rotateAround(Oe,Yt),yn._rotateAround(Oe,Yt)}const pn=new he(0,0),Pn=new he(0,0);Fe.push({tl:Ht,tr:Sn,bl:Cn,br:yn,tex:Xt,writingMode:le.writingMode,glyphOffset:Zn,sectionIndex:Xe.sectionIndex,isSDF:bn,pixelOffsetTL:pn,pixelOffsetBR:Pn,minFontScaleX:0,minFontScaleY:0})}}return Fe}(0,s,v,d,f,y,u,n.allowVerticalPlacement),ee=n.textSizeData;let se=null;ee.kind==="source"?(se=[Xr*d.layout.get("text-size").evaluate(y,{},Z)],se[0]>ms&&ot(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(se=[Xr*B.compositeTextSizes[0].evaluate(y,{},Z),Xr*B.compositeTextSizes[1].evaluate(y,{},Z)],(se[0]>ms||se[1]>ms)&&ot(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,K,se,v,f,y,E,e,r,b.lineStartIndex,b.lineLength,D,O,Z);for(const ue of S)k[ue]=n.text.placedSymbolArray.length-1;return 4*K.length}function ox(n){for(const e in n)return n[e];return null}function sp(n,e,r,s,u,d,f,y,v,b){let E=f.top,S=f.bottom,k=f.left,D=f.right;const B=f.collisionPadding;if(B&&(k-=B[0],E-=B[1],D+=B[2],S+=B[3]),v){const O=new he(k,E),Z=new he(D,E),K=new he(k,S),ee=new he(D,S),se=te(v);let ue=new he(0,0);b&&(ue=new he(b[0],b[1])),O._rotateAround(se,ue),Z._rotateAround(se,ue),K._rotateAround(se,ue),ee._rotateAround(se,ue),k=Math.min(O.x,Z.x,K.x,ee.x),D=Math.max(O.x,Z.x,K.x,ee.x),E=Math.min(O.y,Z.y,K.y,ee.y),S=Math.max(O.y,Z.y,K.y,ee.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,k,E,D,S,y,s,u,d),n.length-1}function Om(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function oE(n,e,r,s){const u=n.compareText;if(e in u){const d=u[e];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<r)return!0}else u[e]=[];return u[e].push(s),!1}const sE=Ta.VectorTileFeature.types,aE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ap(n,e,r,s,u,d,f,y,v,b,E,S,k,D,B,O){const Z=E?Math.min(ms,Math.round(E[0])):0,K=E?Math.min(ms,Math.round(E[1])):0;n.emplaceBack(e,r,Math.round(32*f),Math.round(32*y),v,b,(Z<<1)+(S?1:0),K,16*k,16*D,256*B,256*O,s,u,d,0)}function Um(n,e,r){n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r)}function lE(n){for(const e of n.sections)if(rm(e.text))return!0;return!1}class Nm{constructor(e){this.layoutVertexArray=new gt,this.indexArray=new wn,this.programConfigurations=e,this.segments=new Rn,this.dynamicLayoutVertexArray=new ft,this.opacityVertexArray=new Ut,this.placedSymbolArray=new Fd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ST.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,CT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,aE,!0),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qe("SymbolBuffers",Nm);class Vm{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Rn,this.collisionVertexArray=new Kn,this.collisionVertexArrayExt=new ft}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,AT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,kT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Qe("CollisionBuffers",Vm);class _s{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_m([]),this.placementViewportMatrix=_m([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=km(this.zoom,r["text-size"]),this.iconSizeData=km(this.zoom,r["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(f=>Yi[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID}createArrays(){this.text=new Nm(new va(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Nm(new va(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Od,this.lineVertexArray=new ya,this.symbolInstances=new cs}calculateGlyphDependencies(e,r,s,u,d){for(let f=0;f<e.length;f++)if(r[e.charCodeAt(f)]=!0,u&&d){const y=zu[e.charAt(f)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,s,u){const d=this.layers[0],f=d.layout,y=f.get("text-font"),v=f.get("text-field"),b=f.get("icon-image"),E=(v.value.kind!=="constant"||v.value.value instanceof Nn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),S=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,k=f.get("symbol-sort-key");if(this.features=[],!E&&!S)return;const D=r.iconDependencies,B=r.glyphDependencies,O=r.availableImages,Z=new P(this.zoom);for(const{feature:K,id:ee,index:se,sourceLayerIndex:ue}of e){const le=d._featureFilter.needGeometry,pe=ba(K,le);if(!d._featureFilter.filter(Z,pe,s))continue;let Ae,be;if(le||(pe.geometry=Ao(K,s,u)),E){const Re=d.getValueAndResolveTokens("text-field",pe,s,O),ke=Nn.factory(Re);lE(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||C()==="unavailable"||this.hasRTLText&&M.isParsed())&&(Ae=PT(ke,d,pe))}if(S){const Re=d.getValueAndResolveTokens("icon-image",pe,s,O);be=Re instanceof Mi?Re:Mi.fromString(Re)}if(!Ae&&!be)continue;const qe=this.sortFeaturesByKey?k.evaluate(pe,{},s):void 0;if(this.features.push({id:ee,text:Ae,icon:be,index:se,sourceLayerIndex:ue,geometry:pe.geometry,properties:K.properties,type:sE[K.type],sortKey:qe}),be&&(D[be.name]=!0),Ae){const Re=y.evaluate(pe,{},s).join(","),ke=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yi.vertical)>=0;for(const Fe of Ae.sections)if(Fe.image)D[Fe.image.name]=!0;else{const Oe=Zr(Ae.toString()),ze=Fe.fontStack||Re,We=B[ze]=B[ze]||{};this.calculateGlyphDependencies(Fe.text,We,ke,this.allowVerticalPlacement,Oe)}}}f.get("symbol-placement")==="line"&&(this.features=function(K){const ee={},se={},ue=[];let le=0;function pe(Re){ue.push(K[Re]),le++}function Ae(Re,ke,Fe){const Oe=se[Re];return delete se[Re],se[ke]=Oe,ue[Oe].geometry[0].pop(),ue[Oe].geometry[0]=ue[Oe].geometry[0].concat(Fe[0]),Oe}function be(Re,ke,Fe){const Oe=ee[ke];return delete ee[ke],ee[Re]=Oe,ue[Oe].geometry[0].shift(),ue[Oe].geometry[0]=Fe[0].concat(ue[Oe].geometry[0]),Oe}function qe(Re,ke,Fe){const Oe=Fe?ke[0][ke[0].length-1]:ke[0][0];return`${Re}:${Oe.x}:${Oe.y}`}for(let Re=0;Re<K.length;Re++){const ke=K[Re],Fe=ke.geometry,Oe=ke.text?ke.text.toString():null;if(!Oe){pe(Re);continue}const ze=qe(Oe,Fe),We=qe(Oe,Fe,!0);if(ze in se&&We in ee&&se[ze]!==ee[We]){const Je=be(ze,We,Fe),yt=Ae(ze,We,ue[Je].geometry);delete ee[ze],delete se[We],se[qe(Oe,ue[yt].geometry,!0)]=yt,ue[Je].geometry=null}else ze in se?Ae(ze,We,Fe):We in ee?be(ze,We,Fe):(pe(Re),ee[ze]=le-1,se[We]=le-1)}return ue.filter(Re=>Re.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ee)=>K.sortKey-ee.sortKey)}update(e,r,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const f={};for(let y=e.segment+1;y<r.length;y++)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:u},y<r.length-1&&(u+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const v=f[y];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,u,d,f,y,v,b,E,S,k,D,B){const O=e.indexArray,Z=e.layoutVertexArray,K=e.segments.prepareSegment(4*r.length,Z,O,this.canOverlap?f.sortKey:void 0),ee=this.glyphOffsetArray.length,se=K.vertexLength,ue=this.allowVerticalPlacement&&y===Yi.vertical?Math.PI/2:0,le=f.text&&f.text.sections;for(let pe=0;pe<r.length;pe++){const{tl:Ae,tr:be,bl:qe,br:Re,tex:ke,pixelOffsetTL:Fe,pixelOffsetBR:Oe,minFontScaleX:ze,minFontScaleY:We,glyphOffset:Je,isSDF:yt,sectionIndex:Wt}=r[pe],dt=K.vertexLength,Nt=Je[1];ap(Z,v.x,v.y,v.z,b.x,b.y,Ae.x,Nt+Ae.y,ke.x,ke.y,s,yt,Fe.x,Fe.y,ze,We),ap(Z,v.x,v.y,v.z,b.x,b.y,be.x,Nt+be.y,ke.x+ke.w,ke.y,s,yt,Oe.x,Fe.y,ze,We),ap(Z,v.x,v.y,v.z,b.x,b.y,qe.x,Nt+qe.y,ke.x,ke.y+ke.h,s,yt,Fe.x,Oe.y,ze,We),ap(Z,v.x,v.y,v.z,b.x,b.y,Re.x,Nt+Re.y,ke.x+ke.w,ke.y+ke.h,s,yt,Oe.x,Oe.y,ze,We),Um(e.dynamicLayoutVertexArray,v,ue),O.emplaceBack(dt,dt+1,dt+2),O.emplaceBack(dt+1,dt+2,dt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),pe!==r.length-1&&Wt===r[pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,f,f.index,{},D,B,le&&le[Wt])}e.placedSymbolArray.emplaceBack(v.x,v.y,v.z,b.x,b.y,ee,this.glyphOffsetArray.length-ee,se,E,S,b.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],y,0,!1,0,k,0)}_commitLayoutVertex(e,r,s,u,d,f,y){e.emplaceBack(r,s,u,d,f,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,s,u,d,f,y){const v=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),b=v.vertexLength,E=y.tileAnchorX,S=y.tileAnchorY;for(let D=0;D<4;D++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,d,f,E,S,new he(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,d,f,E,S,new he(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,d,f,E,S,new he(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,d,f,E,S,new he(e.x1,e.y2)),v.vertexLength+=4;const k=s.indexArray;k.emplaceBack(b,b+1),k.emplaceBack(b+1,b+2),k.emplaceBack(b+2,b+3),k.emplaceBack(b+3,b),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,u,d,f){for(let y=u;y<d;y++){const v=s.get(y),b=this.getSymbolInstanceTextSize(e,f,r,y);this._addCollisionDebugVertices(v,b,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,r,s,u,d,f){for(let y=u;y<d;y++){const v=s.get(y),b=this.getSymbolInstanceIconSize(e,r,y);this._addCollisionDebugVertices(v,b,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vm(Ln,Dv.members,en),this.iconCollisionBox=new Vm(Ln,Dv.members,en);const s=jl(this.iconSizeData,e),u=jl(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(u,e,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,r,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,r,s,u){const d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),f=ep(this.textSizeData,e,d)/Gn;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,r,s){const u=this.icon.placedSymbolArray.get(s),d=ep(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,s){e.emplaceBack(r,-s,-s),e.emplaceBack(r,s,-s),e.emplaceBack(r,s,s),e.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(e,r,s,u,d,f){for(let y=u;y<d;y++){const v=s.get(y),b=this.getSymbolInstanceTextSize(e,f,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,v.padding)}}_updateIconDebugCollisionBoxes(e,r,s,u,d){for(let f=u;f<d;f++){const y=s.get(f),v=this.getSymbolInstanceIconSize(e,r,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,y.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=jl(this.iconSizeData,e),u=jl(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(u,e,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(s,e,r,f.iconBoxStartIndex,f.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,u,d,f,y,v,b){const E={};for(let S=r;S<s;S++){const k=e.get(S);E.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.textFeatureIndex=k.featureIndex;break}for(let S=u;S<d;S++){const k=e.get(S);E.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.verticalTextFeatureIndex=k.featureIndex;break}for(let S=f;S<y;S++){const k=e.get(S);E.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.iconFeatureIndex=k.featureIndex;break}for(let S=v;S<b;S++){const k=e.get(S);E.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.verticalIconFeatureIndex=k.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),u=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),u=[],d=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const v=this.symbolInstances.get(y);u.push(0|Math.round(r*v.tileAnchorX+s*v.tileAnchorY)),d.push(v.featureIndex)}return f.sort((y,v)=>u[y]-u[v]||d[v]-d[y]),f}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((u,d,f)=>{u>=0&&f.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Qe("SymbolBucket",_s,{omit:["layers","collisionBoxArray","features","compareText"]}),_s.MAX_GLYPHS=65535,_s.addDynamicAttributes=Um;const cE=new Se({"symbol-placement":new j(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new j(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new j(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Q(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new j(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new j(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new j(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new j(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new j(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Q(ce.layout_symbol["icon-size"]),"icon-text-fit":new j(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new j(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Q(ce.layout_symbol["icon-image"]),"icon-rotate":new Q(ce.layout_symbol["icon-rotate"]),"icon-padding":new j(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new j(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Q(ce.layout_symbol["icon-offset"]),"icon-anchor":new Q(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new j(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new j(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new j(ce.layout_symbol["text-rotation-alignment"]),"text-field":new Q(ce.layout_symbol["text-field"]),"text-font":new Q(ce.layout_symbol["text-font"]),"text-size":new Q(ce.layout_symbol["text-size"]),"text-max-width":new Q(ce.layout_symbol["text-max-width"]),"text-line-height":new Q(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Q(ce.layout_symbol["text-letter-spacing"]),"text-justify":new Q(ce.layout_symbol["text-justify"]),"text-radial-offset":new Q(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new j(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new Q(ce.layout_symbol["text-anchor"]),"text-max-angle":new j(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new j(ce.layout_symbol["text-writing-mode"]),"text-rotate":new Q(ce.layout_symbol["text-rotate"]),"text-padding":new j(ce.layout_symbol["text-padding"]),"text-keep-upright":new j(ce.layout_symbol["text-keep-upright"]),"text-transform":new Q(ce.layout_symbol["text-transform"]),"text-offset":new Q(ce.layout_symbol["text-offset"]),"text-allow-overlap":new j(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new j(ce.layout_symbol["text-ignore-placement"]),"text-optional":new j(ce.layout_symbol["text-optional"])});var jm={paint:new Se({"icon-opacity":new Q(ce.paint_symbol["icon-opacity"]),"icon-color":new Q(ce.paint_symbol["icon-color"]),"icon-halo-color":new Q(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Q(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Q(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new j(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new j(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Q(ce.paint_symbol["text-opacity"]),"text-color":new Q(ce.paint_symbol["text-color"],{runtimeType:mn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Q(ce.paint_symbol["text-halo-color"]),"text-halo-width":new Q(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Q(ce.paint_symbol["text-halo-blur"]),"text-translate":new j(ce.paint_symbol["text-translate"]),"text-translate-anchor":new j(ce.paint_symbol["text-translate-anchor"])}),layout:cE};class sx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:sr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qe("FormatSectionOverride",sx,{omit:["defaultValue"]});class lp extends Tr{constructor(e){super(e,jm)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const d of s)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,u){const d=this.layout.get(e).evaluate(r,{},s,u),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Wi(f.value)||!d?d:function(y,v){return v.replace(/{([^{}]+)}/g,(b,E)=>E in y?String(y[E]):"")}(r.properties,d)}createBucket(e){return new _s(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of jm.paint.overridableProperties){if(!lp.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new sx(r),u=new ru(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Vr("source",u):new xl("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new H(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&lp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),u=jm.paint.properties[r];let d=!1;const f=y=>{for(const v of y)if(u.overrides&&u.overrides.hasOverride(v))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Nn)f(s.value.value.sections);else if(s.value.kind==="source"){const y=b=>{d||(b instanceof yo&&_n(b.value)===qo?f(b.value.sections):b instanceof Ks?f(b.sections):b.eachChild(y))},v=s.value;v._styleExpression&&y(v._styleExpression.expression)}return d}getProgramConfiguration(e){return new Co(this,e)}}var uE={paint:new Se({"background-color":new j(ce.paint_background["background-color"]),"background-pattern":new we(ce.paint_background["background-pattern"]),"background-opacity":new j(ce.paint_background["background-opacity"])})},hE={paint:new Se({"raster-opacity":new j(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new j(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new j(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new j(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new j(ce.paint_raster["raster-saturation"]),"raster-contrast":new j(ce.paint_raster["raster-contrast"]),"raster-resampling":new j(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new j(ce.paint_raster["raster-fade-duration"])})};class dE extends Tr{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var pE={paint:new Se({"sky-type":new j(ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new j(ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new j(ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new j(ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new j(ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new xe(ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new j(ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new j(ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new j(ce.paint_sky["sky-opacity"])})};function $m(n,e,r){const s=Ul(0,0,1),u=dv(gm());return function(d,f,y){y*=.5;var v=f[0],b=f[1],E=f[2],S=f[3],k=Math.sin(y),D=Math.cos(y);d[0]=v*D-E*k,d[1]=b*D+S*k,d[2]=E*D+v*k,d[3]=S*D-b*k}(u,u,r?-te(n)+Math.PI:te(n)),pv(u,u,-te(e)),hv(s,s,u),uv(s,s)}const fE={circle:class extends Tr{constructor(n){super(n,D2)}createBucket(n){return new pm(n)}queryRadius(n){const e=n;return Ol("circle-radius",this,e)+Ol("circle-stroke-width",this,e)+Zd(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,s,u,d,f,y){const v=iv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return mv(n,s,d,f,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,b)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Co(this,n)}},heatmap:class extends Tr{createBucket(n){return new gv(n)}constructor(n){super(n,V2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Ol("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,s,u,d,f,y){const v=this.paint.get("heatmap-radius").evaluate(e,r);return mv(n,s,d,f,y,!0,!0,new he(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Co(this,n)}},hillshade:class extends Tr{constructor(n){super(n,j2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(n){return new Co(this,n)}},fill:class extends Tr{constructor(n){super(n,oT)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(n){return new Co(this,n)}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Jd(n)}queryRadius(){return Zd(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,s,u,d){return!n.queryGeometry.isAboveHorizon&&Jy(nv(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Tr{constructor(n){super(n,_T)}createBucket(n){return new Am(n)}queryRadius(){return Zd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Co(this,n)}queryIntersectsFeature(n,e,r,s,u,d,f,y,v){const b=iv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),S=this.paint.get("fill-extrusion-base").evaluate(e,r),k=[0,0],D=y&&d.elevation,B=d.elevation?d.elevation.exaggeration():1;if(D){const K=n.tile.getBucket(this).centroidVertexArray,ee=v+1;if(ee<K.length){const se=K.get(ee);k[0]=se.a_centroid_pos0,k[1]=se.a_centroid_pos1}}if(k[0]===0&&k[1]===1)return!1;const O=function(K,ee,se,ue,le,pe,Ae,be,qe){return pe?function(Re,ke,Fe,Oe,ze,We,Je,yt,Wt){const dt=[],Nt=[],Xe=[0,0,0,1];for(const Xt of Re){const Ft=[],bn=[];for(const Tn of Xt){const Mn=Tn.x+Oe.x,Fn=Tn.y+Oe.y,Zt=gT(Mn,Fn,ke,Fe,We,Je,yt,Wt);Xe[0]=Mn,Xe[1]=Fn,Xe[2]=Zt.base,Xe[3]=1,Su(Xe,Xe,ze),Xe[3]=Math.max(Xe[3],1e-5);const Vt=Iv([Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]]);Xe[0]=Mn,Xe[1]=Fn,Xe[2]=Zt.top,Xe[3]=1,Su(Xe,Xe,ze),Xe[3]=Math.max(Xe[3],1e-5);const rn=Iv([Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]]);Ft.push(Vt),bn.push(rn)}dt.push(Ft),Nt.push(bn)}return[dt,Nt]}(K,ee,se,ue,le,pe,Ae,be,qe):function(Re,ke,Fe,Oe,ze){const We=[],Je=[],yt=ze[8]*ke,Wt=ze[9]*ke,dt=ze[10]*ke,Nt=ze[11]*ke,Xe=ze[8]*Fe,Xt=ze[9]*Fe,Ft=ze[10]*Fe,bn=ze[11]*Fe;for(const Tn of Re){const Mn=[],Fn=[];for(const Zt of Tn){const Vt=Zt.x+Oe.x,rn=Zt.y+Oe.y,Zn=ze[0]*Vt+ze[4]*rn+ze[12],En=ze[1]*Vt+ze[5]*rn+ze[13],Dn=ze[2]*Vt+ze[6]*rn+ze[14],qn=ze[3]*Vt+ze[7]*rn+ze[15],ln=Zn+yt,bi=En+Wt,Ht=Dn+dt,Sn=Math.max(qn+Nt,1e-5),Cn=Zn+Xe,yn=En+Xt,pn=Dn+Ft,Pn=Math.max(qn+bn,1e-5),Yt=new he(ln/Sn,bi/Sn);Yt.z=Ht/Sn,Mn.push(Yt);const Jn=new he(Cn/Pn,yn/Pn);Jn.z=pn/Pn,Fn.push(Jn)}We.push(Mn),Je.push(Fn)}return[We,Je]}(K,ee,se,ue,le)}(s,S,E,b,f,D?y:null,k,B,d.center.lat),Z=n.queryGeometry;return function(K,ee,se){let ue=1/0;Jy(se,ee)&&(ue=kv(se,ee[0]));for(let le=0;le<ee.length;le++){const pe=ee[le],Ae=K[le];for(let be=0;be<pe.length-1;be++){const qe=pe[be],Re=[qe,pe[be+1],Ae[be+1],Ae[be],qe];Ky(se,Re)&&(ue=Math.min(ue,kv(se,Re)))}}return ue!==1/0&&ue}(O[0],O[1],Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends Tr{constructor(n){super(n,Mv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ea,this.gradientVersion=(this.gradientVersion+1)%tt}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=Pv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Qd(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Co(this,n)}queryRadius(n){const e=n,r=zv(Ol("line-width",this,e),Ol("line-gap-width",this,e)),s=Ol("line-offset",this,e);return r/2+Math.abs(s)+Zd(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,s,u,d){if(n.queryGeometry.isAboveHorizon)return!1;const f=nv(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*zv(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),v=this.paint.get("line-offset").evaluate(e,r);return v&&(s=function(b,E){const S=[],k=new he(0,0);for(let D=0;D<b.length;D++){const B=b[D],O=[];for(let Z=0;Z<B.length;Z++){const K=B[Z-1],ee=B[Z],se=B[Z+1],ue=Z===0?k:ee.sub(K)._unit()._perp(),le=Z===B.length-1?k:se.sub(ee)._unit()._perp(),pe=ue._add(le)._unit();pe._mult(1/(pe.x*le.x+pe.y*le.y)),O.push(pe._mult(E)._add(ee))}S.push(O)}return S}(s,v*n.pixelToTileUnitsFactor)),function(b,E,S){for(let k=0;k<E.length;k++){const D=E[k];if(b.length>=3){for(let B=0;B<D.length;B++)if(Fl(b,D[B]))return!0}if(I2(b,D,S))return!0}return!1}(f,s,y)}isTileClipped(){return!0}},symbol:lp,background:class extends Tr{constructor(n){super(n,uE)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Tr{constructor(n){super(n,hE)}getProgramIds(){return["raster"]}},sky:class extends Tr{constructor(n){super(n,pE),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=xm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(n,e){const r=this.paint.get("sky-type");if(r==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),u=!s,d=n.style.light,f=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&ot("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?$m(f.azimuthal,90-f.polar,e):$m(s[0],90-s[1],e)}if(r==="gradient"){const s=this.paint.get("sky-gradient-center");return $m(s[0],90-s[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:ax,HTMLCanvasElement:lx,HTMLVideoElement:cx,ImageData:ux,ImageBitmap:cp}=Me;class up{constructor(e,r,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,s){const{width:u,height:d}=e,{context:f}=this,{gl:y}=f;if(y.bindTexture(y.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),s||this.size&&this.size[0]===u&&this.size[1]===d){const{x:v,y:b}=s||{x:0,y:0};e instanceof ax||e instanceof lx||e instanceof cx||e instanceof ux||cp&&e instanceof cp?y.texSubImage2D(y.TEXTURE_2D,0,v,b,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,v,b,u,d,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[u,d],e instanceof ax||e instanceof lx||e instanceof cx||e instanceof ux||cp&&e instanceof cp?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,u,d,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Gm{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ds({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=mi(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const u=[];let d=e.length%2==1?-e[e.length-1]*s:0,f=e[0]*s,y=!0;u.push({left:d,right:f,isDash:y,zeroLength:e[0]===0});let v=e[0];for(let b=1;b<e.length;b++){y=!y;const E=e[b];d=v*s,v+=E,f=v*s,u.push({left:d,right:f,isDash:y,zeroLength:E===0})}return u}addRoundDash(e,r,s){const u=r/2;for(let d=-s;d<=s;d++){const f=this.width*(this.nextRow+s+d);let y=0,v=e[y];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++y]);const E=Math.abs(b-v.left),S=Math.abs(b-v.right),k=Math.min(E,S);let D;const B=d/s*(u+1);if(v.isDash){const O=u-Math.abs(B);D=Math.sqrt(k*k+O*O)}else D=u-Math.sqrt(k*k+B*B);this.image.data[f+b]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,r){for(let v=e.length-1;v>=0;--v){const b=e[v],E=e[v+1];b.zeroLength?e.splice(v,1):E&&E.isDash===b.isDash&&(E.left=b.left,e.splice(v,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,y=e[f];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++f]);const b=Math.abs(v-y.left),E=Math.abs(v-y.right),S=Math.min(b,E);this.image.data[d+v]=Math.max(0,Math.min(255,(y.isDash?S:-S)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const u=r==="round",d=u?7:0,f=2*d+1;if(this.nextRow+f>this.height)return ot("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let E=0;E<e.length;E++)e[E]<0&&(ot("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),y+=e[E];if(y!==0){const E=this.width/y,S=this.getDashRanges(e,this.width,E);u?this.addRoundDash(S,E,d):this.addRegularDash(S,r==="square"?.5*E:0)}const v=this.nextRow+d;this.nextRow+=f;const b={tl:[v,d],br:[y,0]};return this.positions[s]=b,b}}Qe("LineAtlas",Gm);class mE{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const _E=Me.performance;function hx(n){const e=n?n.url.toString():void 0;return _E.getEntriesByName(e)}class gE{constructor(){this.tasks={},this.taskQueue=[],ji(["process"],this),this.invoker=new mE(this.process),this.nextId=0}add(e,r){const s=this.nextId++,u=function({type:d,isSymbolTile:f,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-y:d==="maybePrepare"&&f?400-y:500:200-y:100-y}(r);if(u===0){In();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:r,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){In();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const d=this.tasks[this.taskQueue[u]];d.priority<r&&(r=d.priority,e=u)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}function hp(n,e){const r=Math.pow(2,-n.z),s=n.x*r,u=(n.x+1)*r,d=n.y*r,f=(n.y+1)*r;if(e.name==="mercator")return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const y=wa(s),v=wa(u),b=Wr(d),E=Wr(f),S=e.project(y,b),k=e.project(v,b),D=e.project(v,E),B=e.project(y,E);let O=Math.min(S.x,k.x,D.x,B.x),Z=Math.min(S.y,k.y,D.y,B.y),K=Math.max(S.x,k.x,D.x,B.x),ee=Math.max(S.y,k.y,D.y,B.y);const se=r/16;function ue(pe,Ae,be,qe,Re,ke){const Fe=(be+Re)/2,Oe=(qe+ke)/2,ze=e.project(wa(Fe),Wr(Oe)),We=Math.max(0,O-ze.x,Z-ze.y,ze.x-K,ze.y-ee);O=Math.min(O,ze.x),K=Math.max(K,ze.x),Z=Math.min(Z,ze.y),ee=Math.max(ee,ze.y),We>se&&(ue(pe,ze,be,qe,Fe,Oe),ue(ze,Ae,Fe,Oe,Re,ke))}ue(S,k,s,d,u,d),ue(k,D,u,d,u,f),ue(D,B,u,f,s,f),ue(B,S,s,f,s,d),O-=se,Z-=se,K+=se,ee+=se;const le=1/Math.max(K-O,ee-Z);return{scale:le,x:O*le,y:Z*le,x2:K*le,y2:ee*le,projection:e}}function dx(n,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Zm{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=Ru(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=(d=this.y,f=this.z,y=dx(256*(u=this.x),256*(d=Math.pow(2,f)-d-1),f),v=dx(256*(u+1),256*(d+1),f),y[0]+","+y[1]+","+v[0]+","+v[1]);var u,d,f,y,v;const b=function(E,S,k){let D,B="";for(let O=E;O>0;O--)D=1<<O-1,B+=(S&D?1:0)+(k&D?2:0);return B}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",b).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class px{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ru(e,r.z,r.z,r.x,r.y)}}class wi{constructor(e,r,s,u,d){this.overscaledZ=e,this.wrap=r,this.canonical=new Zm(s,+u,+d),this.key=r===0&&e===s?this.canonical.key:Ru(r,e,s,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new wi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Ru(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Ru(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new wi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new wi(r,this.wrap,r,s,u),new wi(r,this.wrap,r,s+1,u),new wi(r,this.wrap,r,s,u+1),new wi(r,this.wrap,r,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new wi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new wi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new px(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ru(n,e,r,s,u){const d=1<<Math.min(r,22);let f=d*(u%d)+s%d;return n&&r<22&&(f+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*f+r)+(e-r)}Qe("CanonicalTileID",Zm),Qe("OverscaledTileID",wi,{omit:["projMatrix"]});class fx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class mx{constructor(e,r,s,u,d){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}var yE=ye([{name:"a_pos",type:"Int16",components:2}]);const cr=32,Hr=33,gs=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,r=0,s=0,u=0,d=0,f=0,y=0;for(1&e?u=d=f=cr:r=s=y=cr;(e>>=1)>1;){const b=r+u>>1,E=s+d>>1;1&e?(u=r,d=s,r=f,s=y):(r=u,s=d,u=f,d=y),f=b,y=E}const v=4*n;gs[v+0]=r,gs[v+1]=s,gs[v+2]=u,gs[v+3]=d}const Yr=new Uint16Array(2178),ys=new Uint8Array(1089),dp=new Uint16Array(1089);function _x(n){return n===0?-.03125:n===32?.03125:0}var qm=ye([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const gx={type:2,extent:Pt,loadGeometry:()=>[[new he(0,0),new he(8193,0),new he(8193,8193),new he(0,8193),new he(0,0)]]};class yx{constructor(e,r,s,u,d){this.tileID=e,this.uid=sn(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<gi.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=hp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){const f={};if(!d)return f;for(const y of u){const v=y.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(v.length!==0){y.layers=v,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(b=>v.filter(E=>E.id===b)[0]));for(const b of v)f[b.id]=y}}return f}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof _s){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof _s&&d.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||C()!=="deferred"||I();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new si}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new up(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new up(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new up(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,u,d,f,y,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:f,params:d,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),d=r?r.sourceLayer:"",f=u._geojsonTileLayer||u[d];if(!f)return;const y=oa(r&&r.filter),{z:v,x:b,y:E}=this.tileID.canonical,S={z:v,x:b,y:E};for(let k=0;k<f.length;k++){const D=f.feature(k);if(y.needGeometry){const Z=ba(D,!0);if(!y.filter(new P(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!y.filter(new P(this.tileID.overscaledZ),D))continue;const B=s.getId(D,d),O=new mx(D,v,b,E,B);O.tile=S,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=Hn(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const d=this.expirationTime-r;d?this.expirationTime=s+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const s=this.latestFeatureIndex.loadVTLayers(),u=r.style.listImages();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const f=this.buckets[d],y=f.layers[0].sourceLayer||"_geojsonTileLayer",v=s[y],b=e[y];if(!v||!b||Object.keys(b).length===0)continue;if(f.update(b,v,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof Qd||f instanceof Jd){const S=r.style._getSourceCache(f.layers[0].source);r._terrain&&r._terrain.enabled&&S&&f.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(S.id,this.tileID)}const E=r&&r.style&&r.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<gi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=gi.now()+e}setDependencies(e,r){const s={};for(const u of r)s[u]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const u=this.dependencies[s];if(u){for(const d of r)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const s=Ao(gx,this.tileID.canonical,this.tileTransform)[0],u=new et,d=new Bn;for(let f=0;f<s.length;f++){const{x:y,y:v}=s[f];u.emplaceBack(y,v),d.emplaceBack(f)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,qm.members),this._tileDebugSegments=Rn.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const s=Ao(gx,this.tileID.canonical,this.tileTransform)[0];let u,d;if(this.isRaster){const f=function(y,v){const b=hp(y,v),E=Math.pow(2,y.z);for(let Z=0;Z<Hr;Z++)for(let K=0;K<Hr;K++){const ee=wa((y.x+(K+_x(K))/cr)/E),se=Wr((y.y+(Z+_x(Z))/cr)/E),ue=v.project(ee,se),le=Z*Hr+K;Yr[2*le+0]=Math.round((ue.x*b.scale-b.x)*Pt),Yr[2*le+1]=Math.round((ue.y*b.scale-b.y)*Pt)}ys.fill(0),dp.fill(0);for(let Z=2045;Z>=0;Z--){const K=4*Z,ee=gs[K+0],se=gs[K+1],ue=gs[K+2],le=gs[K+3],pe=ee+ue>>1,Ae=se+le>>1,be=pe+Ae-se,qe=Ae+ee-pe,Re=se*Hr+ee,ke=le*Hr+ue,Fe=Ae*Hr+pe,Oe=Math.hypot((Yr[2*Re+0]+Yr[2*ke+0])/2-Yr[2*Fe+0],(Yr[2*Re+1]+Yr[2*ke+1])/2-Yr[2*Fe+1])>=16;if(ys[Fe]=ys[Fe]||(Oe?1:0),Z<1022){const ze=(se+qe>>1)*Hr+(ee+be>>1),We=(le+qe>>1)*Hr+(ue+be>>1);ys[Fe]=ys[Fe]||ys[ze]||ys[We]}}const S=new ct,k=new wn;let D=0;function B(Z,K){const ee=K*Hr+Z;return dp[ee]===0&&(S.emplaceBack(Yr[2*ee+0],Yr[2*ee+1],Z*Pt/cr,K*Pt/cr),dp[ee]=++D),dp[ee]-1}function O(Z,K,ee,se,ue,le){const pe=Z+ee>>1,Ae=K+se>>1;if(Math.abs(Z-ue)+Math.abs(K-le)>1&&ys[Ae*Hr+pe])O(ue,le,Z,K,pe,Ae),O(ee,se,ue,le,pe,Ae);else{const be=B(Z,K),qe=B(ee,se),Re=B(ue,le);k.emplaceBack(be,qe,Re)}}return O(0,0,cr,cr,cr,0),O(cr,cr,0,0,0,cr),{vertices:S,indices:k}}(this.tileID.canonical,r);u=f.vertices,d=f.indices}else{u=new ct,d=new wn;for(const{x:y,y:v}of s)u.emplaceBack(y,v,0,0);const f=Wd(u.int16,void 0,4);for(let y=0;y<f.length;y+=3)d.emplaceBack(f[y],f[y+1],f[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,qm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Rn.simpleSegment(0,0,u.length,d.length)}}class vE{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},tn(this.stateChanges[e][u],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])s[d]||(this.deletedStates[e][u][d]=null)}else for(const d in s)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,r,s){if(this.deletedStates[e]===null)return;const u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),u=tn({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(d===null)return{};for(const f in d)delete u[f]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const f in this.stateChanges[u])this.state[u][f]||(this.state[u][f]={}),tn(this.state[u][f],this.stateChanges[u][f]),d[f]=this.state[u][f];s[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const f in this.state[u])d[f]={},this.state[u][f]={};else for(const f in this.deletedStates[u]){if(this.deletedStates[u][f]===null)this.state[u][f]={};else for(const y of Object.keys(this.deletedStates[u][f]))delete this.state[u][f][y];d[f]=this.state[u][f]}s[u]=s[u]||{},tn(s[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const u in e)e[u].setFeatureState(s,r)}}class vx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function xx(n,e,r,s){let u=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(s[f])<1e-15){if(r[f]<n[f]||r[f]>e[f])return null}else{const y=1/s[f];let v=(n[f]-r[f])*y,b=(e[f]-r[f])*y;if(v>b){const E=v;v=b,b=E}if(v>u&&(u=v),b<d&&(d=b),u>d)return null}return u}function wx(n,e,r,s,u,d,f,y,v,b,E){const S=s-n,k=u-e,D=d-r,B=f-n,O=y-e,Z=v-r,K=E[1]*Z-E[2]*O,ee=E[2]*B-E[0]*Z,se=E[0]*O-E[1]*B,ue=S*K+k*ee+D*se;if(Math.abs(ue)<1e-15)return null;const le=1/ue,pe=b[0]-n,Ae=b[1]-e,be=b[2]-r,qe=(pe*K+Ae*ee+be*se)*le;if(qe<0||qe>1)return null;const Re=Ae*D-be*k,ke=be*S-pe*D,Fe=pe*k-Ae*S,Oe=(E[0]*Re+E[1]*ke+E[2]*Fe)*le;return Oe<0||qe+Oe>1?null:(B*Re+O*ke+Z*Fe)*le}function bx(n,e,r){return(n-e)/(r-e)}function Tx(n,e,r,s,u,d,f,y,v){const b=1<<r,E=d-s,S=f-u,k=(n+1)/b*E+s,D=(e+0)/b*S+u,B=(e+1)/b*S+u;y[0]=(n+0)/b*E+s,y[1]=D,v[0]=k,v[1]=B}class Ex{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(d){const f=Math.ceil(Math.log2(d.dim/8)),y=[];let v=Math.ceil(Math.pow(2,f));const b=1/v,E=(D,B,O,Z,K)=>{const ee=Z?1:0,se=(D+1)*O-ee,ue=B*O,le=(B+1)*O-ee;K[0]=D*O,K[1]=ue,K[2]=se,K[3]=le};let S=new vx(v);const k=[];for(let D=0;D<v*v;D++){E(D%v,Math.floor(D/v),b,!1,k);const B=vs(k[0],k[1],d),O=vs(k[2],k[1],d),Z=vs(k[2],k[3],d),K=vs(k[0],k[3],d);S.minimums.push(Math.min(B,O,Z,K)),S.maximums.push(Math.max(B,O,Z,K)),S.leaves.push(1)}for(y.push(S),v/=2;v>=1;v/=2){const D=y[y.length-1];S=new vx(v);for(let B=0;B<v*v;B++){E(B%v,Math.floor(B/v),2,!0,k);const O=D.getElevation(k[0],k[1]),Z=D.getElevation(k[2],k[1]),K=D.getElevation(k[2],k[3]),ee=D.getElevation(k[0],k[3]),se=D.isLeaf(k[0],k[1]),ue=D.isLeaf(k[2],k[1]),le=D.isLeaf(k[2],k[3]),pe=D.isLeaf(k[0],k[3]),Ae=Math.min(O.min,Z.min,K.min,ee.min),be=Math.max(O.max,Z.max,K.max,ee.max),qe=se&&ue&&le&&pe;S.maximums.push(be),S.minimums.push(Ae),S.leaves.push(be-Ae<=5&&qe?1:0)}y.push(S)}return y}(this.dem),s=r.length-1,u=r[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,u,d,f,y=1){return xx([e,r,-100],[s,u,this.maximums[0]*y],d,f)}raycast(e,r,s,u,d,f,y=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,r,s,u,d,f,y);if(v==null)return null;const b=[],E=[],S=[],k=[],D=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:B,t:O,nodex:Z,nodey:K,depth:ee}=D.pop();if(this.leaves[B]){Tx(Z,K,ee,e,r,s,u,S,k);const ue=1<<ee,le=(Z+0)/ue,pe=(Z+1)/ue,Ae=(K+0)/ue,be=(K+1)/ue,qe=vs(le,Ae,this.dem)*y,Re=vs(pe,Ae,this.dem)*y,ke=vs(pe,be,this.dem)*y,Fe=vs(le,be,this.dem)*y,Oe=wx(S[0],S[1],qe,k[0],S[1],Re,k[0],k[1],ke,d,f),ze=wx(k[0],k[1],ke,S[0],k[1],Fe,S[0],S[1],qe,d,f),We=Math.min(Oe!==null?Oe:Number.MAX_VALUE,ze!==null?ze:Number.MAX_VALUE);if(We!==Number.MAX_VALUE)return We;{const Je=cv([],d,f,O);if(Sx(qe,Re,Fe,ke,bx(Je[0],S[0],k[0]),bx(Je[1],S[1],k[1]))>=Je[2])return O}continue}let se=0;for(let ue=0;ue<this._siblingOffset.length;ue++){Tx((Z<<1)+this._siblingOffset[ue][0],(K<<1)+this._siblingOffset[ue][1],ee+1,e,r,s,u,S,k),S[2]=-100,k[2]=this.maximums[this.childOffsets[B]+ue]*y;const le=xx(S,k,d,f);if(le!=null){const pe=le;b[ue]=pe;let Ae=!1;for(let be=0;be<se&&!Ae;be++)pe>=b[E[be]]&&(E.splice(be,0,ue),Ae=!0);Ae||(E[se]=ue),se++}}for(let ue=0;ue<se;ue++){const le=E[ue];D.push({idx:this.childOffsets[B]+le,t:b[le],nodex:(Z<<1)+this._siblingOffset[le][0],nodey:(K<<1)+this._siblingOffset[le][1],depth:ee+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,u,d){if(e[u].isLeaf(r,s)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=u-1,y=e[f];let v,b=0;for(let E=0;E<this._siblingOffset.length;E++){const S=2*r+this._siblingOffset[E][0],k=2*s+this._siblingOffset[E][1],D=y.getElevation(S,k),B=y.isLeaf(S,k),O=this._addNode(D.min,D.max,B);B&&(b|=1<<E),v||(v=O)}for(let E=0;E<this._siblingOffset.length;E++)b&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*s+this._siblingOffset[E][1],f,v+E)}}function Sx(n,e,r,s,u,d){return Bt(Bt(n,r,d),Bt(e,s,d),u)}function vs(n,e,r){const s=r.dim,u=Ke(n*s-.5,0,s-1),d=Ke(e*s-.5,0,s-1),f=Math.floor(u),y=Math.floor(d),v=Math.min(f+1,s-1),b=Math.min(y+1,s-1);return Sx(r.get(f,y),r.get(v,y),r.get(f,b),r.get(v,b),u-f,d-y)}const Cx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class pp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,u=!1,d=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return ot(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const f=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let y=0;y<f;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(f,y)]=this.data[this._idx(f-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,f)]=this.data[this._idx(y,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ex(this)}get(e,r,s=!1){const u=new Uint8Array(this.data.buffer);s&&(e=Ke(e,-1,this.dim),r=Ke(r,-1,this.dim));const d=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[d],u[d+1],u[d+2])}static getUnpackVector(e){return Cx[e]}get unpackVector(){return Cx[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}static pack(e,r){const s=[0,0,0,0],u=pp.getUnpackVector(r);let d=Math.floor((e+u[3])/u[2]);return s[2]=d%256,d=Math.floor(d/256),s[1]=d%256,d=Math.floor(d/256),s[0]=d,s}getPixels(){return new Hi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,d=r*this.dim+this.dim,f=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:u=d-1;break;case 1:d=u+1}switch(s){case-1:f=y-1;break;case 1:y=f+1}const v=-r*this.dim,b=-s*this.dim;for(let E=f;E<y;E++)for(let S=u;S<d;S++)this.data[this._idx(S,E)]=e.data[this._idx(S+v,E+b)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Qe("DEMData",pp),Qe("DemMinMaxQuadTree",Ex,{omit:["dem"]});class xE{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:r,timeout:void 0};if(s!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},s)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,u=r===void 0?0:this.data[s].indexOf(r),d=this.data[s][u];return this.data[s].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||r.push(u);for(const s of r)this.remove(s.value.tileID,s)}}class Xl{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}Xl.ReadOnly=!1,Xl.ReadWrite=!0,Xl.disabled=new Xl(519,Xl.ReadOnly,[0,1]);const Wm=7680;class Xm{constructor(e,r,s,u,d,f){this.test=e,this.ref=r,this.mask=s,this.fail=u,this.depthFail=d,this.pass=f}}Xm.disabled=new Xm({func:519,mask:0},0,0,Wm,Wm,Wm);class Kr{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}Kr.Replace=[1,0],Kr.disabled=new Kr(Kr.Replace,Dt.transparent,[!1,!1,!1,!1]),Kr.unblended=new Kr(Kr.Replace,Dt.transparent,[!0,!0,!0,!0]),Kr.alphaBlended=new Kr([1,771],Dt.transparent,[!0,!0,!0,!0]);const Hm=1029,Ym=2305;class Er{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}Er.disabled=new Er(!1,Hm,Ym),Er.backCCW=new Er(!0,Hm,Ym),Er.backCW=new Er(!0,Hm,2304),Er.frontCW=new Er(!0,1028,2304),Er.frontCCW=new Er(!0,1028,Ym);class Ea extends je{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new xE(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new vE}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return on(this._tiles).map(e=>e.tileID).sort(Ax).map(e=>e.key)}getRenderableIds(e){const r=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&r.push(this._tiles[s]);return e?r.sort((s,u)=>{const d=s.tileID,f=u.tileID,y=new he(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),v=new he(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-f.overscaledZ||v.y-y.y||v.x-y.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(Ax).map(s=>s.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,u){if(u)return e.state="errored",void(u.status!==404?this._source.fire(new it(u,{tile:e})):this.update(this.transform));e.timeAdded=gi.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Be("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const d=r[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const f=this.getTileByID(d);s(e,f),s(f,e)}}function s(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let f=d.tileID.canonical.x-u.tileID.canonical.x;const y=d.tileID.canonical.y-u.tileID.canonical.y,v=Math.pow(2,u.tileID.canonical.z),b=d.tileID.key;f===0&&y===0||Math.abs(y)>1||(Math.abs(f)>1&&(Math.abs(f+v)===1?f+=v:Math.abs(f-v)===1&&(f-=v)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,f,y),u.neighboringTiles&&u.neighboringTiles[b]&&(u.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,u){for(const d in this._tiles){let f=this._tiles[d];if(u[d]||!f.hasData()||f.tileID.overscaledZ<=r||f.tileID.overscaledZ>s)continue;let y=f.tileID;for(;f&&f.tileID.overscaledZ>r+1;){const b=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[b.key],f&&f.hasData()&&(y=b)}let v=y;for(;v.overscaledZ>r;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){u[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const u=e.scaledTo(s),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,u=Math.ceil(e.height/r)+1,d=Math.floor(s*u*5),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(f)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),s[d.tileID.key]=d}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,r,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new wi(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const d=this._updateRetainedTiles(u);if(kx(this._source.type)&&u.length!==0){const y={},v={},b=Object.keys(d);for(const S of b){const k=d[S],D=this._tiles[S];if(!D||D.fadeEndTime&&D.fadeEndTime<=gi.now())continue;const B=this.findLoadedParent(k,Math.max(k.overscaledZ-Ea.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),y[B.tileID.key]=B.tileID),v[S]=k}const E=u[u.length-1].overscaledZ;for(const S in this._tiles){const k=this._tiles[S];if(d[S]||!k.hasData())continue;let D=k.tileID;for(;D.overscaledZ>E;){D=D.scaledTo(D.overscaledZ-1);const B=this._tiles[D.key];if(B&&B.hasData()&&v[D.key]){d[S]=k.tileID;break}}}for(const S in y)d[S]||(this._coveredTiles[S]=!0,d[S]=y[S])}for(const y in d)this._tiles[y].clearFadeHold();const f=function(y,v){const b=[];for(const E in y)E in v||b.push(E);return b}(this._tiles,d);for(const y of f){const v=this._tiles[y];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const s={},u=e.reduce((b,E)=>Math.min(b,E.overscaledZ),1/0),d=e[0].overscaledZ,f=Math.max(d-Ea.maxOverzooming,this._source.minzoom),y=Math.max(d+Ea.maxUnderzooming,this._source.minzoom),v={};for(const b of e){const E=this._addTile(b);r[b.key]=b,E.hasData()||u<this._source.maxzoom&&(v[b.key]=b)}this._retainLoadedChildren(v,u,y,r);for(const b of e){let E=this._tiles[b.key];if(E.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const k=b.children(this._source.maxzoom)[0],D=this.getTile(k);if(D&&D.hasData()){r[k.key]=k;continue}}else{const k=b.children(this._source.maxzoom);if(r[k[0].key]&&r[k[1].key]&&r[k[2].key]&&r[k[3].key])continue}let S=E.wasRequested();for(let k=b.overscaledZ-1;k>=f;--k){const D=b.scaledTo(k);if(s[D.key]||(s[D.key]=!0,E=this.getTile(D),!E&&S&&(E=this._addTile(D)),E&&(r[D.key]=D,S=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}r.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;u=d}for(const d of r)this._loadedParentTiles[d]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=Boolean(r);if(!s){const u=this.map?this.map.painter:null;r=new yx(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._source.type==="raster"||this._source.type==="raster-dem"),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new Be("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,r,s){const u=[],d=this.transform;if(!d)return u;for(const f in this._tiles){const y=this._tiles[f];if(s&&y.clearQueryDebugViz(),y.holdingForFade())continue;const v=e.containsTile(y,d,r);v&&u.push(v)}return u}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(kx(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=gi.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const u=this._tiles[e];u&&u.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}}function Ax(n,e){const r=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-r||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function kx(n){return n==="raster"||n==="image"||n==="video"}Ea.maxOverzooming=10,Ea.maxUnderzooming=3;class fp{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const u=s||e.findDEMTileFor(r);if(!u||!u.dem)return;const d=u.dem,f=u.tileID,y=1<<r.canonical.z-f.canonical.z;return new fp(u,u.tileSize/Pt/y,[(r.canonical.x/y-f.canonical.x)*d.dim,(r.canonical.y/y-f.canonical.y)*d.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(s);return new he(u,d)}getElevationAt(e,r,s,u){const d=e*this._scale+this._offset[0],f=r*this._scale+this._offset[1],y=Math.floor(d),v=Math.floor(f),b=this._dem;return u=!!u,s?Bt(Bt(b.get(y,v,u),b.get(y,v+1,u),f-v),Bt(b.get(y+1,v,u),b.get(y+1,v+1,u),f-v),d-y):b.get(y,v,u)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*cm(1,e)*this._dem.stride}}class Ix{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new os(Pt,16,0),this.featureIndexArray=new Uy,this.promoteId=r}insert(e,r,s,u,d,f=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,d,f);const v=this.grid;for(let b=0;b<r.length;b++){const E=r[b],S=[1/0,1/0,-1/0,-1/0];for(let k=0;k<E.length;k++){const D=E[k];S[0]=Math.min(S[0],D.x),S[1]=Math.min(S[1],D.y),S[2]=Math.max(S[2],D.x),S[3]=Math.max(S[3],D.y)}S[0]<Pt&&S[1]<Pt&&S[2]>=0&&S[3]>=0&&v.insert(y,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ta.VectorTile(new Du(this.rawTileData)).layers,this.sourceLayerCoder=new fx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,u){this.loadVTLayers();const d=e.params||{},f=oa(d.filter),y=e.tileResult,v=e.transform,b=y.bufferedTilespaceBounds,E=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(B,O,Z,K)=>tv(y.bufferedTilespaceGeometry,B,O,Z,K));E.sort(wE);let S=null;v.elevation&&E.length>0&&(S=fp.create(v.elevation,this.tileID));const k={};let D;for(let B=0;B<E.length;B++){const O=E[B];if(O===D)continue;D=O;const Z=this.featureIndexArray.get(O);let K=null;this.loadMatchingFeature(k,Z,f,d.layers,d.availableImages,r,s,u,(ee,se,ue,le=0)=>(K||(K=Ao(ee,this.tileID.canonical,e.tileTransform)),se.queryIntersectsFeature(y,ee,ue,K,this.z,e.transform,e.pixelPosMatrix,S,le)))}return k}loadMatchingFeature(e,r,s,u,d,f,y,v,b){const{featureIndex:E,bucketIndex:S,sourceLayerIndex:k,layoutVertexArrayOffset:D}=r,B=this.bucketLayerIDs[S];if(u&&!function(ee,se){for(let ue=0;ue<ee.length;ue++)if(se.indexOf(ee[ue])>=0)return!0;return!1}(u,B))return;const O=this.sourceLayerCoder.decode(k),Z=this.vtLayers[O].feature(E);if(s.needGeometry){const ee=ba(Z,!0);if(!s.filter(new P(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!s.filter(new P(this.tileID.overscaledZ),Z))return;const K=this.getId(Z,O);for(let ee=0;ee<B.length;ee++){const se=B[ee];if(u&&u.indexOf(se)<0)continue;const ue=f[se];if(!ue)continue;let le={};K!==void 0&&v&&(le=v.getState(ue.sourceLayer||"_geojsonTileLayer",K));const pe=tn({},y[se]);pe.paint=Mx(pe.paint,ue.paint,Z,le,d),pe.layout=Mx(pe.layout,ue.layout,Z,le,d);const Ae=!b||b(Z,ue,le,D);if(!Ae)continue;const be=new mx(Z,this.z,this.x,this.y,K);be.layer=pe;let qe=e[se];qe===void 0&&(qe=e[se]=[]),qe.push({featureIndex:E,feature:be,intersectionZ:Ae})}}lookupSymbolFeatures(e,r,s,u,d,f,y,v){const b={};this.loadVTLayers();const E=oa(d);for(const S of e)this.loadMatchingFeature(b,{bucketIndex:s,sourceLayerIndex:u,featureIndex:S,layoutVertexArrayOffset:0},E,f,y,v,r);return b}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),d=this.vtFeatures[u];if(d[r])return d[r];const f=this.vtLayers[u].feature(r);return d[r]=f,f}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function Mx(n,e,r,s,u){return _i(n,(d,f)=>{const y=e instanceof J?e.get(f):null;return y&&y.evaluate?y.evaluate(r,s,u):y})}function wE(n,e){return e-n}Qe("FeatureIndex",Ix,{omit:["rawTileData","sourceLayerCoder"]});class Px{constructor(e){const r={},s=[];for(const y in e){const v=e[y],b=r[y]={};for(const E in v.glyphs){const S=v.glyphs[+E];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const k=S.metrics.localGlyph?2:1,D={x:0,y:0,w:S.bitmap.width+2*k,h:S.bitmap.height+2*k};s.push(D),b[E]=D}}const{w:u,h:d}=Mm(s),f=new ds({width:u||1,height:d||1});for(const y in e){const v=e[y];for(const b in v.glyphs){const E=v.glyphs[+b];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const S=r[y][b],k=E.metrics.localGlyph?2:1;ds.copy(E.bitmap,f,{x:0,y:0},{x:S.x+k,y:S.y+k},E.bitmap)}}this.image=f,this.positions=r}}Qe("GlyphAtlas",Px);class bE{constructor(e){this.tileID=new wi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,e.projection&&(this.tileTransform=hp(e.tileID.canonical,e.projection))}parse(e,r,s,u,d){this.status="parsing",this.data=e,this.collisionBoxArray=new si;const f=new fx(Object.keys(e.layers).sort()),y=new Ix(this.tileID,this.promoteId);y.bucketLayerIDs=[];const v={},b=new Gm(256,256),E={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:s},S=r.familiesBySource[this.source];for(const le in S){const pe=e.layers[le];if(!pe)continue;let Ae=!1,be=!1;for(const ke of S[le])ke[0].type==="symbol"?Ae=!0:be=!0;if(this.isSymbolTile===!0&&!Ae||this.isSymbolTile===!1&&!be)continue;pe.version===1&&ot(`Vector tile source "${this.source}" layer "${le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qe=f.encode(le),Re=[];for(let ke=0;ke<pe.length;ke++){const Fe=pe.feature(ke),Oe=y.getId(Fe,le);Re.push({feature:Fe,id:Oe,index:ke,sourceLayerIndex:qe})}for(const ke of S[le]){const Fe=ke[0];this.isSymbolTile!==void 0&&Fe.type==="symbol"!==this.isSymbolTile||Fe.minzoom&&this.zoom<Math.floor(Fe.minzoom)||Fe.maxzoom&&this.zoom>=Fe.maxzoom||Fe.visibility!=="none"&&(Km(ke,this.zoom,s),(v[Fe.id]=Fe.createBucket({index:y.bucketLayerIDs.length,layers:ke,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qe,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:s})).populate(Re,E,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(ke.map(Oe=>Oe.id)))}}let k,D,B,O;b.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=_i(E.glyphDependencies,le=>Object.keys(le).map(Number));Object.keys(K).length?u.send("getGlyphs",{uid:this.uid,stacks:K},(le,pe)=>{k||(k=le,D=pe,ue.call(this))},void 0,!1,Z):D={};const ee=Object.keys(E.iconDependencies);ee.length?u.send("getImages",{icons:ee,source:this.source,tileID:this.tileID,type:"icons"},(le,pe)=>{k||(k=le,B=pe,ue.call(this))},void 0,!1,Z):B={};const se=Object.keys(E.patternDependencies);function ue(){if(k)return d(k);if(D&&B&&O){const le=new Px(D),pe=new Nv(B,O);for(const Ae in v){const be=v[Ae];be instanceof _s?(Km(be.layers,this.zoom,s),iE(be,D,le.positions,B,pe.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom)):be.hasPattern&&(be instanceof Qd||be instanceof Jd||be instanceof Am)&&(Km(be.layers,this.zoom,s),be.addFeatures(E,this.tileID.canonical,pe.patternPositions,s))}this.status="done",d(null,{buckets:on(v).filter(Ae=>!Ae.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:le.image,lineAtlas:b,imageAtlas:pe,glyphMap:this.returnDependencies?D:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?le.positions:null})}}se.length?u.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"patterns"},(le,pe)=>{k||(k=le,O=pe,ue.call(this))},void 0,!1,Z):O={},ue.call(this)}}function Km(n,e,r){const s=new P(e);for(const u of n)u.recalculate(s,r)}class zx{constructor(e){this.entries={},this.scheduler=e}request(e,r,s,u){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[f,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(f,y)},r):u(f,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=s((f,y)=>{d.result=[f,y];for(const v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(f,y)},r):v(f,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(f=>f!==u),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function Dx(n,e,r){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const d=R(n.request,(f,y,v,b)=>{f?u(f):y&&u(null,{vectorTile:r?void 0:new Ta.VectorTile(new Du(y)),rawData:y,cacheControl:v,expires:b})});return()=>{d.cancel(),u()}},e)}var TE={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&fv(this.parallels,this.constants.parallels))return;const n=Math.sin(te(this.parallels[0])),e=(n+Math.sin(te(this.parallels[1])))/2,r=1+n*(2*e-n),s=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:s,parallels:this.parallels}},project(n,e){this.initializeConstants();const r=te(n-this.center[0]),s=te(e),{n:u,c:d,r0:f}=this.constants,y=Math.sqrt(d-2*u*Math.sin(s))/u;return{x:y*Math.sin(r*u),y:y*Math.cos(r*u)-f}},unproject(n,e){this.initializeConstants();const{n:r,c:s,r0:u}=this.constants,d=u+e;let f=Math.atan2(n,Math.abs(d))*Math.sign(d);d*r<0&&(f-=Math.PI*Math.sign(n)*Math.sign(d));const y=te(this.center[0])*r;f=pt(f,-Math.PI-y,Math.PI-y);const v=ae(f/r)+this.center[0],b=Math.asin(Ke((s-(n*n+d*d)*r*r)/(2*r),-1,1)),E=Ke(ae(b),-85.051129,hs);return new Gt(v,E)}};const Fu=1.340264,Ou=-.081106,Uu=893e-6,Nu=.003796,mp=Math.sqrt(3)/2;var EE={name:"equalEarth",center:[0,0],range:[3.5,7],project(n,e){e=e/180*Math.PI,n=n/180*Math.PI;const r=Math.asin(mp*Math.sin(e)),s=r*r,u=s*s*s;return{x:.5*(n*Math.cos(r)/(mp*(Fu+3*Ou*s+u*(7*Uu+9*Nu*s)))/Math.PI+.5),y:1-.5*(r*(Fu+Ou*s+u*(Uu+Nu*s))/Math.PI+1)}},unproject(n,e){n=(2*n-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,s=r*r,u=s*s*s;for(let b,E,S,k=0;k<12&&(E=r*(Fu+Ou*s+u*(Uu+Nu*s))-e,S=Fu+3*Ou*s+u*(7*Uu+9*Nu*s),b=E/S,r=Ke(r-b,-Math.PI/3,Math.PI/3),s=r*r,u=s*s*s,!(Math.abs(b)<1e-12));++k);const d=mp*n*(Fu+3*Ou*s+u*(7*Uu+9*Nu*s))/Math.cos(r),f=Math.asin(Math.sin(r)/mp),y=Ke(180*d/Math.PI,-180,180),v=Ke(180*f/Math.PI,-85.051129,hs);return new Gt(y,v)}},SE={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(n,e)=>({x:.5+n/360,y:.5-e/360}),unproject(n,e){const r=360*(n-.5),s=Ke(360*(.5-e),-85.051129,hs);return new Gt(r,s)}};const Hl=Math.PI/2;function _p(n){return Math.tan((Hl+n)/2)}var CE={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&fv(this.parallels,this.constants.parallels))return;const n=te(this.parallels[0]),e=te(this.parallels[1]),r=Math.cos(n),s=n===e?Math.sin(n):Math.log(r/Math.cos(e))/Math.log(_p(e)/_p(n)),u=r*Math.pow(_p(n),s)/s;this.constants={n:s,f:u,parallels:this.parallels}},project(n,e){this.initializeConstants(),e=te(e),n=te(n-this.center[0]);const r=1e-6,{n:s,f:u}=this.constants;u>0?e<-Hl+r&&(e=-Hl+r):e>Hl-r&&(e=Hl-r);const d=u/Math.pow(_p(e),s),f=d*Math.sin(s*n),y=u-d*Math.cos(s*n);return{x:.5*(f/Math.PI+.5),y:1-.5*(y/Math.PI+.5)}},unproject(n,e){this.initializeConstants(),n=(2*n-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:s}=this.constants,u=s-e,d=Math.sign(u),f=Math.sign(r)*Math.sqrt(n*n+u*u);let y=Math.atan2(n,Math.abs(u))*d;u*r<0&&(y-=Math.PI*Math.sign(n)*d);const v=Ke(ae(y/r)+this.center[0],-180,180),b=Ke(ae(2*Math.atan(Math.pow(s/f,1/r))-Hl),-85.051129,hs);return new Gt(v,b)}},AE={name:"mercator",wrap:!0,center:[0,0],project:(n,e)=>({x:am(n),y:lm(e)}),unproject(n,e){const r=wa(n),s=Wr(e);return new Gt(r,s)}};const Lx=te(hs);var kE={name:"naturalEarth",center:[0,0],range:[3.5,7],project(n,e){const r=(e=te(e))*e,s=r*r;return{x:.5*((n=te(n))*(.8707-.131979*r+s*(s*(.003971*r-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+s*(.028874*r-.044475-.005916*s)))/Math.PI+1)}},unproject(n,e){n=(2*n-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,s=25,u=0,d=r*r;do{d=r*r;const v=d*d;u=(r*(1.007226+d*(.015085+v*(.028874*d-.044475-.005916*v)))-e)/(1.007226+d*(.045255+v*(.259866*d-.311325-.005916*11*v))),r=Ke(r-u,-Lx,Lx)}while(Math.abs(u)>1e-6&&--s>0);d=r*r;const f=Ke(ae(n/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=ae(r);return new Gt(f,y)}};const Bx=te(hs),Rx={albers:TE,equalEarth:EE,equirectangular:SE,lambertConformalConic:CE,mercator:AE,naturalEarth:kE,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(n,e){e=te(e),n=te(n);const r=Math.cos(e),s=2/Math.PI,u=Math.acos(r*Math.cos(n/2)),d=Math.sin(u)/u,f=.5*(n*s+2*r*Math.sin(n/2)/d)||0,y=.5*(e+Math.sin(e)/d)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(y/Math.PI+1)}},unproject(n,e){let r=n=(2*n-.5)*Math.PI,s=e=(2*(1-e)-1)*Math.PI,u=25;const d=1e-6;let f=0,y=0;do{const v=Math.cos(s),b=Math.sin(s),E=2*b*v,S=b*b,k=v*v,D=Math.cos(r/2),B=Math.sin(r/2),O=2*D*B,Z=B*B,K=1-k*D*D,ee=K?1/K:0,se=K?Math.acos(v*D)*Math.sqrt(1/K):0,ue=.5*(2*se*v*B+2*r/Math.PI)-n,le=.5*(se*b+s)-e,pe=.5*ee*(k*Z+se*v*D*S)+1/Math.PI,Ae=ee*(O*E/4-se*b*B),be=.125*ee*(E*B-se*b*k*O),qe=.5*ee*(S*D+se*Z*v)+.5,Re=Ae*be-qe*pe;f=(le*Ae-ue*qe)/Re,y=(ue*be-le*pe)/Re,r=Ke(r-f,-Math.PI,Math.PI),s=Ke(s-y,-Bx,Bx)}while((Math.abs(f)>d||Math.abs(y)>d)&&--u>0);return new Gt(ae(r),ae(s))}}};l.ARRAY_TYPE=ai,l.AUTH_ERR_MSG=jo,l.Actor=class{constructor(n,e,r){this.target=n,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ji(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=In()?n:Me,this.scheduler=new gE}send(n,e,r,s,u=!1,d){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=d,this.callbacks[f]=r);const y=Zs(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:n,hasCallback:!!r,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:ua(e,y)},y),{cancel:()=>{r&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(e.mustQueue||In()){const s=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),s&&s.metadata||{type:"message"})}else this.processTask(r,e)}processTask(n,e){if(e.type==="<response>"){const r=this.callbacks[n];delete this.callbacks[n],r&&(e.error?r(ha(e.error)):r(null,ha(e.data)))}else{const r=Zs(this.globalScope)?void 0:[],s=e.hasCallback?(d,f)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:d?ua(d):null,data:ua(f,r)},r)}:d=>{},u=ha(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],u.source)[d[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=Zm,l.Color=Dt,l.ColorMode=Kr,l.CullFaceMode=Er,l.DEMData=pp,l.DataConstantProperty=j,l.DedupedRequest=zx,l.DepthMode=Xl,l.EXTENT=Pt,l.Elevation=class{getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){e==null&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const u=s.getSource().maxzoom,d=1<<u,f=Math.floor(n.x),y=n.x-f,v=new wi(u,f,u,Math.floor(y*d),Math.floor(n.y*d)),b=this.findDEMTileFor(v);if(!b||!b.dem)return e;const E=b.dem,S=1<<b.tileID.canonical.z,k=(y*S-b.tileID.canonical.x)*E.dim,D=(n.y*S-b.tileID.canonical.y)*E.dim,B=Math.floor(k),O=Math.floor(D);return(r?this.exaggeration():1)*Bt(Bt(E.get(B,O),E.get(B,O+1),D-O),Bt(E.get(B+1,O),E.get(B+1,O+1),D-O),k-B)}getAtTileOffset(n,e,r){const s=1<<n.canonical.z;return this.getAtPointOrZero(new $d(n.wrap+(n.canonical.x+e/Pt)/s,(n.canonical.y+r/Pt)/s))}getForTilePoints(n,e,r,s){const u=fp.create(this,n,s);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,u=1<<n.canonical.z-s.canonical.z;let d=n.canonical.x/u-s.canonical.x,f=n.canonical.y/u-s.canonical.y,y=0;for(let v=0;v<n.canonical.z-s.canonical.z&&!r.leaves[y];v++){d*=2,f*=2;const b=2*Math.floor(f)+Math.floor(d);y=r.childOffsets[y]+b,d%=1,f%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=it,l.EvaluationParameters=P,l.Event=Be,l.Evented=je,l.GlyphManager=ql,l.ImagePosition=Pm,l.LineAtlas=Gm,l.LngLat=Gt,l.LngLatBounds=xa,l.LocalGlyphMode=Bm,l.MAX_MERCATOR_LATITUDE=hs,l.MAX_SAFE_INTEGER=tt,l.MercatorCoordinate=$d,l.ONE_EM=Gn,l.OverscaledTileID=wi,l.Properties=Se,l.RGBAImage=Hi,l.RequestManager=class{constructor(n,e,r){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Vo,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!Ai(n))return n;const r=ki(n);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!Ai(n))return n;const r=ki(n);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(n,e){if(!Ai(n))return n;const r=ki(n);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(n,e,r,s){const u=ki(n);return Ai(n)?(u.path=`/styles/v1${u.path}/sprite${e}${r}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${r}`,Yn(u))}normalizeTileURL(n,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Ai(n))return n;const s=ki(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&s.authority!=="raster"&&r===512?"@2x":""}${lo.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${Ct.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Ct.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(d){for(const f of d){const y=f.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||Ct.ACCESS_TOKEN;return Ct.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(n,e){const r=ki(n);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return n;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${Ct.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${Ct.TILE_URL_VERSION}/`,"")}`;let u=r.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(n,e){const r=!!e&&Ai(e),s=[];for(const u of n.tiles||[])Dr(u)?s.push(this.canonicalizeTileURL(u,r)):s.push(u);return s}_makeAPIURL(n,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=ki(Ct.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,n.protocol==="http"){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if(s.path!=="/"&&(n.path=`${s.path}${n.path}`),!Ct.REQUIRE_ACCESS_TOKEN)return Yn(n);if(e=e||Ct.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return n.params=n.params.filter(u=>u.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),Yn(n)}},l.ResourceType=ho,l.SegmentVector=Rn,l.SourceCache=Ea,l.StencilMode=Xm,l.StructArrayLayout1ui2=Bn,l.StructArrayLayout2f1f2i16=$n,l.StructArrayLayout2i4=et,l.StructArrayLayout2ui4=en,l.StructArrayLayout3f12=ft,l.StructArrayLayout3ui6=wn,l.StructArrayLayout4i8=ct,l.Texture=up,l.Tile=yx,l.Transitionable=$,l.Uniform1f=Vd,l.Uniform1i=class extends Eo{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},l.Uniform2f=class extends Eo{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},l.Uniform3f=class extends Eo{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},l.Uniform4f=Gy,l.UniformColor=Zy,l.UniformMatrix2f=class extends Eo{constructor(n,e){super(n,e),this.current=v2}set(n){for(let e=0;e<4;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},l.UniformMatrix3f=class extends Eo{constructor(n,e){super(n,e),this.current=y2}set(n){for(let e=0;e<9;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},l.UniformMatrix4f=class extends Eo{constructor(n,e){super(n,e),this.current=g2}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},l.UnwrappedTileID=px,l.ValidationError=Te,l.VectorTileWorkerSource=class extends je{constructor(n,e,r,s,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=r,this.loadVectorData=u||Dx,this.loading={},this.loaded={},this.deduped=new zx(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const r=n.uid,s=n&&n.request,u=s&&s.collectResourceTiming,d=this.loading[r]=new bE(n);d.abort=this.loadVectorData(n,(f,y)=>{const v=!this.loading[r];if(delete this.loading[r],v||f||!y)return d.status="done",v||(this.loaded[r]=d),e(f);const b=y.rawData,E={};y.expires&&(E.expires=y.expires),y.cacheControl&&(E.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new Ta.VectorTile(new Du(b));const S=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,D)=>{if(k||!D)return e(k);const B={};if(u){const O=hx(s);O.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,tn({rawTileData:b.slice(0)},D,E,B))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[r]=d})}reloadTile(n,e){const r=this.loaded,s=n.uid,u=this;if(r&&r[s]){const d=r[s];d.showCollisionBoxes=n.showCollisionBoxes,d.enableTerrain=!!n.enableTerrain;const f=(y,v)=>{const b=d.reloadCallback;b&&(delete d.reloadCallback,d.parse(d.vectorTile,u.layerIndex,this.availableImages,u.actor,b)),e(y,v)};d.status==="parsing"?d.reloadCallback=f:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(n,e){const r=n.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),e()}removeTile(n,e){const r=this.loaded,s=n.uid;r&&r[s]&&delete r[s],e()}},l.WritingMode=Yi,l.ZoomHistory=Sd,l.add=function(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n},l.addDynamicAttributes=Um,l.altitudeFromMercatorZ=um,l.asyncAll=st,l.bezier=lt,l.bindAll=ji,l.boundsAttributes=qm,l.bufferConvexPolygon=function(n,e){const r=[];for(let s=0;s<n.length;s++){const u=pt(s-1,-1,n.length-1),d=pt(s+1,-1,n.length-1),f=n[s],y=n[d],v=n[u].sub(f).unit(),b=y.sub(f).unit(),E=b.angleWithSep(v.x,v.y),S=v.add(b).unit().mult(-1*e/Math.sin(E/2));r.push(f.add(S))}return r},l.cacheEntryPossiblyAdded=function(n){Ys++,Ys>uo&&(n.getActor().send("enforceCacheSizeLimit",Ha),Ys=0)},l.clamp=Ke,l.clearTileCache=function(n){const e=Me.caches.delete(Hs);n&&e.catch(n).then(()=>n())},l.clipLine=Jv,l.clone=function(n){var e=new ai(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},l.clone$1=function(n){var e=new ai(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},l.clone$2=$e,l.collisionCircleLayout=IT,l.config=Ct,l.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},l.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},l.create=qd,l.create$1=function(){var n=new ai(16);return ai!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},l.create$2=rv,l.createExpression=es,l.createLayout=ye,l.createStyleLayer=function(n){return n.type==="custom"?new dE(n):new fE[n.type](n)},l.cross=function(n,e,r){var s=e[0],u=e[1],d=e[2],f=r[0],y=r[1],v=r[2];return n[0]=u*v-d*y,n[1]=d*f-s*v,n[2]=s*y-u*f,n},l.degToRad=te,l.div=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},l.dot=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},l.dot$1=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]},l.ease=He,l.easeCubicInOut=Le,l.emitValidationErrors=bd,l.endsWith=$i,l.enforceCacheSizeLimit=function(n){vr(),Ii&&Ii.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-n;s++)e.delete(r[s])})})},l.evaluateSizeForFeature=ep,l.evaluateSizeForZoom=jl,l.evaluateVariableOffset=ix,l.evented=T,l.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},l.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},l.exported=gi,l.exported$1=lo,l.extend=tn,l.filterObject=Si,l.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},l.fromQuat=function(n,e){var r=e[0],s=e[1],u=e[2],d=e[3],f=r+r,y=s+s,v=u+u,b=r*f,E=s*f,S=s*y,k=u*f,D=u*y,B=u*v,O=d*f,Z=d*y,K=d*v;return n[0]=1-S-B,n[1]=E+K,n[2]=k-Z,n[3]=0,n[4]=E-K,n[5]=1-b-B,n[6]=D+O,n[7]=0,n[8]=k+Z,n[9]=D-O,n[10]=1-b-S,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.fromRotation=function(n,e){var r=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=r,n[2]=0,n[3]=-r,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},l.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return De[e]},l.getAABBPointSquareDist=function(n,e,r){let s=0;for(let u=0;u<2;++u){const d=r?r[u]:0;n[u]>d&&(s+=(n[u]-d)*(n[u]-d)),e[u]<d&&(s+=(d-e[u])*(d-e[u]))}return s},l.getAnchorAlignment=Lm,l.getAnchorJustification=Fm,l.getBounds=function(n){let e=1/0,r=1/0,s=-1/0,u=-1/0;for(const d of n)e=Math.min(e,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),u=Math.max(u,d.y);return{min:new he(e,r),max:new he(s,u)}},l.getImage=ge,l.getJSON=function(n,e){return z(tn(n,{type:"json"}),e)},l.getMapSessionAPI=Xa,l.getPerformanceMeasurement=hx,l.getProjection=function(n){const e=Rx[n.name];if(!e)throw new Error(`Invalid projection name: ${n.name}`);return e.conic?function(r,s){if(s.parallels&&Math.abs(s.parallels[0]+s.parallels[1])<.01){let u=function(d){const f=Math.max(.01,Math.cos(te(d))),y=1/(2*Math.max(Math.PI*f,1/f));return{wrap:!0,project(v,b){const E=te(v)*f,S=Math.sin(te(b))/f;return{x:E*y+.5,y:-S*y+.5}},unproject(v,b){const E=-(b-.5)/y,S=Ke(ae((v-.5)/y)/f,-180,180),k=Math.asin(Ke(E*f,-1,1)),D=Ke(ae(k),-85.051129,hs);return new Gt(S,D)}}}(s.parallels[0]);if(s.name==="lambertConformalConic"){const{project:d,unproject:f}=Rx.mercator;u={wrap:!0,project:d,unproject:f}}return tn({},r,s,u)}return tn({},r,s)}(e,n):e},l.getRTLTextPluginStatus=C,l.getReferrer=q,l.getTilePoint=function(n,{x:e,y:r},s=0){return new he(((e-s)*n.scale-n.x)*Pt,(r*n.scale-n.y)*Pt)},l.getTileVec3=function(n,e,r=0){return Ul(((e.x-r)*n.scale-n.x)*Pt,(e.y*n.scale-n.y)*Pt,um(e.z,e.y))},l.getVideo=function(n,e){const r=Me.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<n.length;s++){const u=Me.document.createElement("source");ie(n[s])||(r.crossOrigin="Anonymous"),u.src=n[s],r.appendChild(u)}return{cancel:()=>{}}},l.identity=_m,l.identity$1=dv,l.invert=function(n,e){var r=e[0],s=e[1],u=e[2],d=e[3],f=e[4],y=e[5],v=e[6],b=e[7],E=e[8],S=e[9],k=e[10],D=e[11],B=e[12],O=e[13],Z=e[14],K=e[15],ee=r*y-s*f,se=r*v-u*f,ue=r*b-d*f,le=s*v-u*y,pe=s*b-d*y,Ae=u*b-d*v,be=E*O-S*B,qe=E*Z-k*B,Re=E*K-D*B,ke=S*Z-k*O,Fe=S*K-D*O,Oe=k*K-D*Z,ze=ee*Oe-se*Fe+ue*ke+le*Re-pe*qe+Ae*be;return ze?(n[0]=(y*Oe-v*Fe+b*ke)*(ze=1/ze),n[1]=(u*Fe-s*Oe-d*ke)*ze,n[2]=(O*Ae-Z*pe+K*le)*ze,n[3]=(k*pe-S*Ae-D*le)*ze,n[4]=(v*Re-f*Oe-b*qe)*ze,n[5]=(r*Oe-u*Re+d*qe)*ze,n[6]=(Z*ue-B*Ae-K*se)*ze,n[7]=(E*Ae-k*ue+D*se)*ze,n[8]=(f*Fe-y*Re+b*be)*ze,n[9]=(s*Re-r*Fe-d*be)*ze,n[10]=(B*pe-O*ue+K*ee)*ze,n[11]=(S*ue-E*pe-D*ee)*ze,n[12]=(y*qe-f*ke-v*be)*ze,n[13]=(r*ke-s*qe+u*be)*ze,n[14]=(O*se-B*le-Z*ee)*ze,n[15]=(E*le-S*se+k*ee)*ze,n):null},l.isMapAuthenticated=function(n){return Lr.has(n)},l.isMapboxURL=Ai,l.latFromMercatorY=Wr,l.len=F2,l.length=sv,l.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},l.loadVectorTile=Dx,l.makeRequest=z,l.mercatorXfromLng=am,l.mercatorYfromLat=lm,l.mercatorZfromAltitude=cm,l.mul=function(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n[3]=e[3]*r[3],n},l.mul$1=L2,l.mul$2=R2,l.multiply=ov,l.multiply$1=lv,l.nextPowerOfTwo=mi,l.normalize=uv,l.normalize$1=function(n,e){var r=e[0],s=e[1],u=e[2],d=e[3],f=r*r+s*s+u*u+d*d;return f>0&&(f=1/Math.sqrt(f)),n[0]=r*f,n[1]=s*f,n[2]=u*f,n[3]=d*f,n},l.number=Bt,l.ortho=function(n,e,r,s,u,d,f){var y=1/(e-r),v=1/(s-u),b=1/(d-f);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*b,n[11]=0,n[12]=(e+r)*y,n[13]=(u+s)*v,n[14]=(f+d)*b,n[15]=1,n},l.pbf=Du,l.perspective=function(n,e,r,s,u){var d,f=1/Math.tan(e/2);return n[0]=f/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0?(n[10]=(u+s)*(d=1/(s-u)),n[14]=2*u*s*d):(n[10]=-1,n[14]=-2*s),n},l.pick=function(n,e){const r={};for(let s=0;s<e.length;s++){const u=e[s];u in n&&(r[u]=n[u])}return r},l.plugin=M,l.pointGeometry=he,l.polygonIntersectsBox=tv,l.polygonIntersectsPolygon=Ky,l.polygonizeBounds=function(n,e,r=0,s=!0){const u=new he(r,r),d=n.sub(u),f=e.add(u),y=[d,new he(f.x,d.y),f,new he(d.x,f.y)];return s&&y.push(d),y},l.posAttributes=yE,l.postMapLoadEvent=Uc,l.postTurnstileEvent=Xs,l.potpack=Mm,l.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},l.radToDeg=ae,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(n){return n({pluginStatus:p,pluginURL:m}),T.on("pluginStateChange",n),n},l.removeAuthState=function(n){Lr.delete(n)},l.renderColorRamp=xm,l.rotateX=function(n,e,r){var s=Math.sin(r),u=Math.cos(r),d=e[4],f=e[5],y=e[6],v=e[7],b=e[8],E=e[9],S=e[10],k=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*u+b*s,n[5]=f*u+E*s,n[6]=y*u+S*s,n[7]=v*u+k*s,n[8]=b*u-d*s,n[9]=E*u-f*s,n[10]=S*u-y*s,n[11]=k*u-v*s,n},l.rotateX$1=pv,l.rotateY=function(n,e,r){var s=Math.sin(r),u=Math.cos(r),d=e[0],f=e[1],y=e[2],v=e[3],b=e[8],E=e[9],S=e[10],k=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u-b*s,n[1]=f*u-E*s,n[2]=y*u-S*s,n[3]=v*u-k*s,n[8]=d*s+b*u,n[9]=f*s+E*u,n[10]=y*s+S*u,n[11]=v*s+k*u,n},l.rotateZ=function(n,e,r){var s=Math.sin(r),u=Math.cos(r),d=e[0],f=e[1],y=e[2],v=e[3],b=e[4],E=e[5],S=e[6],k=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u+b*s,n[1]=f*u+E*s,n[2]=y*u+S*s,n[3]=v*u+k*s,n[4]=b*u-d*s,n[5]=E*u-f*s,n[6]=S*u-y*s,n[7]=k*u-v*s,n},l.rotateZ$1=function(n,e,r){r*=.5;var s=e[0],u=e[1],d=e[2],f=e[3],y=Math.sin(r),v=Math.cos(r);return n[0]=s*v+u*y,n[1]=u*v-s*y,n[2]=d*v+f*y,n[3]=f*v-d*y,n},l.scale=function(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n},l.scale$1=function(n,e,r){var s=r[0],u=r[1],d=r[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},l.scale$2=function(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n},l.scaleAndAdd=cv,l.setCacheLimits=function(n,e){Ha=n,uo=e},l.setRTLTextPlugin=function(n,e,r=!1){if(p===ls||p===h||p===t)throw new Error("setRTLTextPlugin cannot be called multiple times.");m=gi.resolveURL(n),p=ls,a=e,x(),r||I()},l.smoothstep=function(n,e,r){return(r=Ke((r-n)/(e-n),0,1))*r*(3-2*r)},l.spec=ce,l.storeAuthState=function(n,e){e?Lr.add(n):Lr.delete(n)},l.sub=B2,l.subtract=av,l.symbolSize=MT,l.tileTransform=hp,l.transformMat3=function(n,e,r){var s=e[0],u=e[1],d=e[2];return n[0]=s*r[0]+u*r[3]+d*r[6],n[1]=s*r[1]+u*r[4]+d*r[7],n[2]=s*r[2]+u*r[5]+d*r[8],n},l.transformMat4=Su,l.transformMat4$1=function(n,e,r){var s=e[0],u=e[1],d=e[2],f=r[3]*s+r[7]*u+r[11]*d+r[15];return n[0]=(r[0]*s+r[4]*u+r[8]*d+r[12])/(f=f||1),n[1]=(r[1]*s+r[5]*u+r[9]*d+r[13])/f,n[2]=(r[2]*s+r[6]*u+r[10]*d+r[14])/f,n},l.transformQuat=hv,l.translate=function(n,e,r){var s,u,d,f,y,v,b,E,S,k,D,B,O=r[0],Z=r[1],K=r[2];return e===n?(n[12]=e[0]*O+e[4]*Z+e[8]*K+e[12],n[13]=e[1]*O+e[5]*Z+e[9]*K+e[13],n[14]=e[2]*O+e[6]*Z+e[10]*K+e[14],n[15]=e[3]*O+e[7]*Z+e[11]*K+e[15]):(u=e[1],d=e[2],f=e[3],y=e[4],v=e[5],b=e[6],E=e[7],S=e[8],k=e[9],D=e[10],B=e[11],n[0]=s=e[0],n[1]=u,n[2]=d,n[3]=f,n[4]=y,n[5]=v,n[6]=b,n[7]=E,n[8]=S,n[9]=k,n[10]=D,n[11]=B,n[12]=s*O+y*Z+S*K+e[12],n[13]=u*O+v*Z+k*K+e[13],n[14]=d*O+b*Z+D*K+e[14],n[15]=f*O+E*Z+B*K+e[15]),n},l.triggerPluginCompletionEvent=g,l.uniqueId=sn,l.validateCustomStyleLayer=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateFog=hu,l.validateLight=nm,l.validateStyle=To,l.values=on,l.vectorTile=Ta,l.version=W,l.warnOnce=ot,l.window=Me,l.wrap=pt}),A(["./shared"],function(l){function W(q){const z=typeof q;if(z==="number"||z==="boolean"||z==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){let Y="[";for(const ie of q)Y+=`${W(ie)},`;return`${Y}]`}const R=Object.keys(q).sort();let G="{";for(let Y=0;Y<R.length;Y++)G+=`${JSON.stringify(R[Y])}:${W(q[R[Y]])},`;return`${G}}`}function _e(q){let z="";for(const R of l.refProperties)z+=`/${W(q[R])}`;return z}class ve{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,R){for(const Y of z)this._layerConfigs[Y.id]=Y,(this._layers[Y.id]=l.createStyleLayer(Y)).compileFilter(),this.keyCache[Y.id]&&delete this.keyCache[Y.id];for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const G=function(Y,ie){const me={};for(let oe=0;oe<Y.length;oe++){const ge=ie&&ie[Y[oe].id]||_e(Y[oe]);ie&&(ie[Y[oe].id]=ge);let Pe=me[ge];Pe||(Pe=me[ge]=[]),Pe.push(Y[oe])}const fe=[];for(const oe in me)fe.push(me[oe]);return fe}(l.values(this._layerConfigs),this.keyCache);for(const Y of G){const ie=Y.map(Ge=>this._layers[Ge.id]),me=ie[0];if(me.visibility==="none")continue;const fe=me.source||"";let oe=this.familiesBySource[fe];oe||(oe=this.familiesBySource[fe]={});const ge=me.sourceLayer||"_geojsonTileLayer";let Pe=oe[ge];Pe||(Pe=oe[ge]=[]),Pe.push(ie)}}}const{ImageBitmap:he}=l.window;class ne{loadTile(z,R){const{uid:G,encoding:Y,rawImageData:ie,padding:me,buildQuadTree:fe}=z,oe=he&&ie instanceof he?this.getImageData(ie,me):ie;R(null,new l.DEMData(G,oe,Y,me<1,fe))}getImageData(z,R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const G=this.offscreenCanvasContext.getImageData(-R,-R,z.width+2*R,z.height+2*R);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:G.width,height:G.height},G.data)}}var Me=function q(z,R){var G,Y=z&&z.type;if(Y==="FeatureCollection")for(G=0;G<z.features.length;G++)q(z.features[G],R);else if(Y==="GeometryCollection")for(G=0;G<z.geometries.length;G++)q(z.geometries[G],R);else if(Y==="Feature")q(z.geometry,R);else if(Y==="Polygon")tt(z.coordinates,R);else if(Y==="MultiPolygon")for(G=0;G<z.coordinates.length;G++)tt(z.coordinates[G],R);return z};function tt(q,z){if(q.length!==0){nt(q[0],z);for(var R=1;R<q.length;R++)nt(q[R],!z)}}function nt(q,z){for(var R=0,G=0,Y=0,ie=q.length,me=ie-1;Y<ie;me=Y++){var fe=(q[Y][0]-q[me][0])*(q[me][1]+q[Y][1]),oe=R+fe;G+=Math.abs(R)>=Math.abs(fe)?R-oe+fe:fe-oe+R,R=oe}R+G>=0!=!!z&&q.reverse()}const de=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class te{constructor(z){this._feature=z,this.extent=l.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(this._feature.type===1){const z=[];for(const R of this._feature.geometry)z.push([new l.pointGeometry(R[0],R[1])]);return z}{const z=[];for(const R of this._feature.geometry){const G=[];for(const Y of R)G.push(new l.pointGeometry(Y[0],Y[1]));z.push(G)}return z}}toGeoJSON(z,R,G){return de.call(this,z,R,G)}}class ae{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=z.length,this._features=z}feature(z){return new te(this._features[z])}}var De=l.vectorTile.VectorTileFeature,Le=lt;function lt(q,z){this.options=z||{},this.features=q,this.length=q.length}function He(q,z){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=z||4096}lt.prototype.feature=function(q){return new He(this.features[q],this.options.extent)},He.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var z=0;z<q.length;z++){for(var R=q[z],G=[],Y=0;Y<R.length;Y++)G.push(new l.pointGeometry(R[Y][0],R[Y][1]));this.geometry.push(G)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,z=1/0,R=-1/0,G=1/0,Y=-1/0,ie=0;ie<q.length;ie++)for(var me=q[ie],fe=0;fe<me.length;fe++){var oe=me[fe];z=Math.min(z,oe.x),R=Math.max(R,oe.x),G=Math.min(G,oe.y),Y=Math.max(Y,oe.y)}return[z,G,R,Y]},He.prototype.toGeoJSON=De.prototype.toGeoJSON;var Ke=st,pt=Le;function st(q){var z=new l.pbf;return function(R,G){for(var Y in R.layers)G.writeMessage(3,on,R.layers[Y])}(q,z),z.finish()}function on(q,z){var R;z.writeVarintField(15,q.version||1),z.writeStringField(1,q.name||""),z.writeVarintField(5,q.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<q.length;R++)G.feature=q.feature(R),z.writeMessage(2,tn,G);var Y=G.keys;for(R=0;R<Y.length;R++)z.writeStringField(3,Y[R]);var ie=G.values;for(R=0;R<ie.length;R++)z.writeMessage(4,Vi,ie[R])}function tn(q,z){var R=q.feature;R.id!==void 0&&z.writeVarintField(1,R.id),z.writeMessage(2,Un,q),z.writeVarintField(3,R.type),z.writeMessage(4,mi,R)}function Un(q,z){var R=q.feature,G=q.keys,Y=q.values,ie=q.keycache,me=q.valuecache;for(var fe in R.properties){var oe=R.properties[fe],ge=ie[fe];if(oe!==null){ge===void 0&&(G.push(fe),ie[fe]=ge=G.length-1),z.writeVarint(ge);var Pe=typeof oe;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(oe=JSON.stringify(oe));var Ge=Pe+":"+oe,Be=me[Ge];Be===void 0&&(Y.push(oe),me[Ge]=Be=Y.length-1),z.writeVarint(Be)}}}function sn(q,z){return(z<<3)+(7&q)}function rr(q){return q<<1^q>>31}function mi(q,z){for(var R=q.loadGeometry(),G=q.type,Y=0,ie=0,me=R.length,fe=0;fe<me;fe++){var oe=R[fe],ge=1;G===1&&(ge=oe.length),z.writeVarint(sn(1,ge));for(var Pe=G===3?oe.length-1:oe.length,Ge=0;Ge<Pe;Ge++){Ge===1&&G!==1&&z.writeVarint(sn(2,Pe-1));var Be=oe[Ge].x-Y,it=oe[Ge].y-ie;z.writeVarint(rr(Be)),z.writeVarint(rr(it)),Y+=Be,ie+=it}G===3&&z.writeVarint(sn(7,1))}}function Vi(q,z){var R=typeof q;R==="string"?z.writeStringField(1,q):R==="boolean"?z.writeBooleanField(7,q):R==="number"&&(q%1!=0?z.writeDoubleField(3,q):q<0?z.writeSVarintField(6,q):z.writeVarintField(5,q))}function ji(q,z,R,G,Y,ie){if(Y-G<=R)return;const me=G+Y>>1;$i(q,z,me,G,Y,ie%2),ji(q,z,R,G,me-1,ie+1),ji(q,z,R,me+1,Y,ie+1)}function $i(q,z,R,G,Y,ie){for(;Y>G;){if(Y-G>600){const ge=Y-G+1,Pe=R-G+1,Ge=Math.log(ge),Be=.5*Math.exp(2*Ge/3),it=.5*Math.sqrt(Ge*Be*(ge-Be)/ge)*(Pe-ge/2<0?-1:1);$i(q,z,R,Math.max(G,Math.floor(R-Pe*Be/ge+it)),Math.min(Y,Math.floor(R+(ge-Pe)*Be/ge+it)),ie)}const me=z[2*R+ie];let fe=G,oe=Y;for(_i(q,z,G,R),z[2*Y+ie]>me&&_i(q,z,G,Y);fe<oe;){for(_i(q,z,fe,oe),fe++,oe--;z[2*fe+ie]<me;)fe++;for(;z[2*oe+ie]>me;)oe--}z[2*G+ie]===me?_i(q,z,G,oe):(oe++,_i(q,z,oe,Y)),oe<=R&&(G=oe+1),R<=oe&&(Y=oe-1)}}function _i(q,z,R,G){Si(q,R,G),Si(z,2*R,2*G),Si(z,2*R+1,2*G+1)}function Si(q,z,R){const G=q[z];q[z]=q[R],q[R]=G}function $e(q,z,R,G){const Y=q-R,ie=z-G;return Y*Y+ie*ie}Ke.fromVectorTileJs=st,Ke.fromGeojsonVt=function(q,z){z=z||{};var R={};for(var G in q)R[G]=new Le(q[G].features,z),R[G].name=G,R[G].version=z.version,R[G].extent=z.extent;return st({layers:R})},Ke.GeoJSONWrapper=pt;const ut=q=>q[0],ot=q=>q[1];class Lt{constructor(z,R=ut,G=ot,Y=64,ie=Float64Array){this.nodeSize=Y,this.points=z;const me=z.length<65536?Uint16Array:Uint32Array,fe=this.ids=new me(z.length),oe=this.coords=new ie(2*z.length);for(let ge=0;ge<z.length;ge++)fe[ge]=ge,oe[2*ge]=R(z[ge]),oe[2*ge+1]=G(z[ge]);ji(fe,oe,Y,0,fe.length-1,0)}range(z,R,G,Y){return function(ie,me,fe,oe,ge,Pe,Ge){const Be=[0,ie.length-1,0],it=[];let je,ce;for(;Be.length;){const Te=Be.pop(),St=Be.pop(),Ot=Be.pop();if(St-Ot<=Ge){for(let zt=Ot;zt<=St;zt++)je=me[2*zt],ce=me[2*zt+1],je>=fe&&je<=ge&&ce>=oe&&ce<=Pe&&it.push(ie[zt]);continue}const _t=Math.floor((Ot+St)/2);je=me[2*_t],ce=me[2*_t+1],je>=fe&&je<=ge&&ce>=oe&&ce<=Pe&&it.push(ie[_t]);const At=(Te+1)%2;(Te===0?fe<=je:oe<=ce)&&(Be.push(Ot),Be.push(_t-1),Be.push(At)),(Te===0?ge>=je:Pe>=ce)&&(Be.push(_t+1),Be.push(St),Be.push(At))}return it}(this.ids,this.coords,z,R,G,Y,this.nodeSize)}within(z,R,G){return function(Y,ie,me,fe,oe,ge){const Pe=[0,Y.length-1,0],Ge=[],Be=oe*oe;for(;Pe.length;){const it=Pe.pop(),je=Pe.pop(),ce=Pe.pop();if(je-ce<=ge){for(let At=ce;At<=je;At++)$e(ie[2*At],ie[2*At+1],me,fe)<=Be&&Ge.push(Y[At]);continue}const Te=Math.floor((ce+je)/2),St=ie[2*Te],Ot=ie[2*Te+1];$e(St,Ot,me,fe)<=Be&&Ge.push(Y[Te]);const _t=(it+1)%2;(it===0?me-oe<=St:fe-oe<=Ot)&&(Pe.push(ce),Pe.push(Te-1),Pe.push(_t)),(it===0?me+oe>=St:fe+oe>=Ot)&&(Pe.push(Te+1),Pe.push(je),Pe.push(_t))}return Ge}(this.ids,this.coords,z,R,G,this.nodeSize)}}const hn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:q=>q},In=Math.fround||(Hn=new Float32Array(1),q=>(Hn[0]=+q,Hn[0]));var Hn;class Ci{constructor(z){this.options=Ct(Object.create(hn),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:R,minZoom:G,maxZoom:Y,nodeSize:ie}=this.options;R&&console.time("total time");const me=`prepare ${z.length} points`;R&&console.time(me),this.points=z;let fe=[];for(let oe=0;oe<z.length;oe++)z[oe].geometry&&fe.push(Fo(z[oe],oe));this.trees[Y+1]=new Lt(fe,lo,Pr,ie,Float32Array),R&&console.timeEnd(me);for(let oe=Y;oe>=G;oe--){const ge=+Date.now();fe=this._cluster(fe,oe),this.trees[oe]=new Lt(fe,lo,Pr,ie,Float32Array),R&&console.log("z%d: %d clusters in %dms",oe,fe.length,+Date.now()-ge)}return R&&console.timeEnd("total time"),this}getClusters(z,R){let G=((z[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,z[1]));let ie=z[2]===180?180:((z[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)G=-180,ie=180;else if(G>ie){const Pe=this.getClusters([G,Y,180,me],R),Ge=this.getClusters([-180,Y,ie,me],R);return Pe.concat(Ge)}const fe=this.trees[this._limitZoom(R)],oe=fe.range(ao(G),gi(me),ao(ie),gi(Y)),ge=[];for(const Pe of oe){const Ge=fe.points[Pe];ge.push(Ge.numPoints?Oo(Ge):this.points[Ge.index])}return ge}getChildren(z){const R=this._getOriginId(z),G=this._getOriginZoom(z),Y="No cluster with the specified id.",ie=this.trees[G];if(!ie)throw new Error(Y);const me=ie.points[R];if(!me)throw new Error(Y);const fe=this.options.radius/(this.options.extent*Math.pow(2,G-1)),oe=ie.within(me.x,me.y,fe),ge=[];for(const Pe of oe){const Ge=ie.points[Pe];Ge.parentId===z&&ge.push(Ge.numPoints?Oo(Ge):this.points[Ge.index])}if(ge.length===0)throw new Error(Y);return ge}getLeaves(z,R,G){const Y=[];return this._appendLeaves(Y,z,R=R||10,G=G||0,0),Y}getTile(z,R,G){const Y=this.trees[this._limitZoom(z)],ie=Math.pow(2,z),{extent:me,radius:fe}=this.options,oe=fe/me,ge=(G-oe)/ie,Pe=(G+1+oe)/ie,Ge={features:[]};return this._addTileFeatures(Y.range((R-oe)/ie,ge,(R+1+oe)/ie,Pe),Y.points,R,G,ie,Ge),R===0&&this._addTileFeatures(Y.range(1-oe/ie,ge,1,Pe),Y.points,ie,G,ie,Ge),R===ie-1&&this._addTileFeatures(Y.range(0,ge,oe/ie,Pe),Y.points,-1,G,ie,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(z){let R=this._getOriginZoom(z)-1;for(;R<=this.options.maxZoom;){const G=this.getChildren(z);if(R++,G.length!==1)break;z=G[0].properties.cluster_id}return R}_appendLeaves(z,R,G,Y,ie){const me=this.getChildren(R);for(const fe of me){const oe=fe.properties;if(oe&&oe.cluster?ie+oe.point_count<=Y?ie+=oe.point_count:ie=this._appendLeaves(z,oe.cluster_id,G,Y,ie):ie<Y?ie++:z.push(fe),z.length===G)break}return ie}_addTileFeatures(z,R,G,Y,ie,me){for(const fe of z){const oe=R[fe],ge=oe.numPoints;let Pe,Ge,Be;if(ge)Pe=Zs(oe),Ge=oe.x,Be=oe.y;else{const ce=this.points[oe.index];Pe=ce.properties,Ge=ao(ce.geometry.coordinates[0]),Be=gi(ce.geometry.coordinates[1])}const it={type:1,geometry:[[Math.round(this.options.extent*(Ge*ie-G)),Math.round(this.options.extent*(Be*ie-Y))]],tags:Pe};let je;ge?je=oe.id:this.options.generateId?je=oe.index:this.points[oe.index].id&&(je=this.points[oe.index].id),je!==void 0&&(it.id=je),me.features.push(it)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(+z,this.options.maxZoom+1))}_cluster(z,R){const G=[],{radius:Y,extent:ie,reduce:me,minPoints:fe}=this.options,oe=Y/(ie*Math.pow(2,R));for(let ge=0;ge<z.length;ge++){const Pe=z[ge];if(Pe.zoom<=R)continue;Pe.zoom=R;const Ge=this.trees[R+1],Be=Ge.within(Pe.x,Pe.y,oe),it=Pe.numPoints||1;let je=it;for(const ce of Be){const Te=Ge.points[ce];Te.zoom>R&&(je+=Te.numPoints||1)}if(je>it&&je>=fe){let ce=Pe.x*it,Te=Pe.y*it,St=me&&it>1?this._map(Pe,!0):null;const Ot=(ge<<5)+(R+1)+this.points.length;for(const _t of Be){const At=Ge.points[_t];if(At.zoom<=R)continue;At.zoom=R;const zt=At.numPoints||1;ce+=At.x*zt,Te+=At.y*zt,At.parentId=Ot,me&&(St||(St=this._map(Pe,!0)),me(St,this._map(At)))}Pe.parentId=Ot,G.push(xt(ce/je,Te/je,Ot,je,St))}else if(G.push(Pe),je>1)for(const ce of Be){const Te=Ge.points[ce];Te.zoom<=R||(Te.zoom=R,G.push(Te))}}return G}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,R){if(z.numPoints)return R?Ct({},z.properties):z.properties;const G=this.points[z.index].properties,Y=this.options.map(G);return R&&Y===G?Ct({},Y):Y}}function xt(q,z,R,G,Y){return{x:In(q),y:In(z),zoom:1/0,id:R,parentId:-1,numPoints:G,properties:Y}}function Fo(q,z){const[R,G]=q.geometry.coordinates;return{x:In(ao(R)),y:In(gi(G)),zoom:1/0,index:z,parentId:-1}}function Oo(q){return{type:"Feature",id:q.id,properties:Zs(q),geometry:{type:"Point",coordinates:[(z=q.x,360*(z-.5)),Uo(q.y)]}};var z}function Zs(q){const z=q.numPoints,R=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return Ct(Ct({},q.properties),{cluster:!0,cluster_id:q.id,point_count:z,point_count_abbreviated:R})}function ao(q){return q/360+.5}function gi(q){const z=Math.sin(q*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function Uo(q){const z=(180-360*q)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function Ct(q,z){for(const R in z)q[R]=z[R];return q}function lo(q){return q.x}function Pr(q){return q.y}function or(q,z,R,G){for(var Y,ie=G,me=R-z>>1,fe=R-z,oe=q[z],ge=q[z+1],Pe=q[R],Ge=q[R+1],Be=z+3;Be<R;Be+=3){var it=qs(q[Be],q[Be+1],oe,ge,Pe,Ge);if(it>ie)Y=Be,ie=it;else if(it===ie){var je=Math.abs(Be-me);je<fe&&(Y=Be,fe=je)}}ie>G&&(Y-z>3&&or(q,z,Y,G),q[Y+2]=ie,R-Y>3&&or(q,Y,R,G))}function qs(q,z,R,G,Y,ie){var me=Y-R,fe=ie-G;if(me!==0||fe!==0){var oe=((q-R)*me+(z-G)*fe)/(me*me+fe*fe);oe>1?(R=Y,G=ie):oe>0&&(R+=me*oe,G+=fe*oe)}return(me=q-R)*me+(fe=z-G)*fe}function zr(q,z,R,G){var Y={id:q===void 0?null:q,type:z,geometry:R,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var me=ie.geometry,fe=ie.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")No(ie,me);else if(fe==="Polygon"||fe==="MultiLineString")for(var oe=0;oe<me.length;oe++)No(ie,me[oe]);else if(fe==="MultiPolygon")for(oe=0;oe<me.length;oe++)for(var ge=0;ge<me[oe].length;ge++)No(ie,me[oe][ge])}(Y),Y}function No(q,z){for(var R=0;R<z.length;R+=3)q.minX=Math.min(q.minX,z[R]),q.minY=Math.min(q.minY,z[R+1]),q.maxX=Math.max(q.maxX,z[R]),q.maxY=Math.max(q.maxY,z[R+1])}function Vo(q,z,R,G){if(z.geometry){var Y=z.geometry.coordinates,ie=z.geometry.type,me=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),fe=[],oe=z.id;if(R.promoteId?oe=z.properties[R.promoteId]:R.generateId&&(oe=G||0),ie==="Point")jo(Y,fe);else if(ie==="MultiPoint")for(var ge=0;ge<Y.length;ge++)jo(Y[ge],fe);else if(ie==="LineString")Ai(Y,fe,me,!1);else if(ie==="MultiLineString"){if(R.lineMetrics){for(ge=0;ge<Y.length;ge++)Ai(Y[ge],fe=[],me,!1),q.push(zr(oe,"LineString",fe,z.properties));return}Dr(Y,fe,me,!1)}else if(ie==="Polygon")Dr(Y,fe,me,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(ge=0;ge<z.geometry.geometries.length;ge++)Vo(q,{id:oe,geometry:z.geometry.geometries[ge],properties:z.properties},R,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<Y.length;ge++){var Pe=[];Dr(Y[ge],Pe,me,!0),fe.push(Pe)}}q.push(zr(oe,ie,fe,z.properties))}}function jo(q,z){z.push(Za(q[0])),z.push(ki(q[1])),z.push(0)}function Ai(q,z,R,G){for(var Y,ie,me=0,fe=0;fe<q.length;fe++){var oe=Za(q[fe][0]),ge=ki(q[fe][1]);z.push(oe),z.push(ge),z.push(0),fe>0&&(me+=G?(Y*ge-oe*ie)/2:Math.sqrt(Math.pow(oe-Y,2)+Math.pow(ge-ie,2))),Y=oe,ie=ge}var Pe=z.length-3;z[2]=1,or(z,0,Pe,R),z[Pe+2]=1,z.size=Math.abs(me),z.start=0,z.end=z.size}function Dr(q,z,R,G){for(var Y=0;Y<q.length;Y++){var ie=[];Ai(q[Y],ie,R,G),z.push(ie)}}function Za(q){return q/360+.5}function ki(q){var z=Math.sin(q*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function Yn(q,z,R,G,Y,ie,me,fe){if(G/=z,ie>=(R/=z)&&me<G)return q;if(me<R||ie>=G)return null;for(var oe=[],ge=0;ge<q.length;ge++){var Pe=q[ge],Ge=Pe.geometry,Be=Pe.type,it=Y===0?Pe.minX:Pe.minY,je=Y===0?Pe.maxX:Pe.maxY;if(it>=R&&je<G)oe.push(Pe);else if(!(je<R||it>=G)){var ce=[];if(Be==="Point"||Be==="MultiPoint")qa(Ge,ce,R,G,Y);else if(Be==="LineString")$o(Ge,ce,R,G,Y,!1,fe.lineMetrics);else if(Be==="MultiLineString")Xs(Ge,ce,R,G,Y,!1);else if(Be==="Polygon")Xs(Ge,ce,R,G,Y,!0);else if(Be==="MultiPolygon")for(var Te=0;Te<Ge.length;Te++){var St=[];Xs(Ge[Te],St,R,G,Y,!0),St.length&&ce.push(St)}if(ce.length){if(fe.lineMetrics&&Be==="LineString"){for(Te=0;Te<ce.length;Te++)oe.push(zr(Pe.id,Be,ce[Te],Pe.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(ce.length===1?(Be="LineString",ce=ce[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=ce.length===3?"Point":"MultiPoint"),oe.push(zr(Pe.id,Be,ce,Pe.tags))}}}return oe.length?oe:null}function qa(q,z,R,G,Y){for(var ie=0;ie<q.length;ie+=3){var me=q[ie+Y];me>=R&&me<=G&&(z.push(q[ie]),z.push(q[ie+1]),z.push(q[ie+2]))}}function $o(q,z,R,G,Y,ie,me){for(var fe,oe,ge=Ws(q),Pe=Y===0?Uc:Wa,Ge=q.start,Be=0;Be<q.length-3;Be+=3){var it=q[Be],je=q[Be+1],ce=q[Be+2],Te=q[Be+3],St=q[Be+4],Ot=Y===0?it:je,_t=Y===0?Te:St,At=!1;me&&(fe=Math.sqrt(Math.pow(it-Te,2)+Math.pow(je-St,2))),Ot<R?_t>R&&(oe=Pe(ge,it,je,Te,St,R),me&&(ge.start=Ge+fe*oe)):Ot>G?_t<G&&(oe=Pe(ge,it,je,Te,St,G),me&&(ge.start=Ge+fe*oe)):Go(ge,it,je,ce),_t<R&&Ot>=R&&(oe=Pe(ge,it,je,Te,St,R),At=!0),_t>G&&Ot<=G&&(oe=Pe(ge,it,je,Te,St,G),At=!0),!ie&&At&&(me&&(ge.end=Ge+fe*oe),z.push(ge),ge=Ws(q)),me&&(Ge+=fe)}var zt=q.length-3;it=q[zt],je=q[zt+1],ce=q[zt+2],(Ot=Y===0?it:je)>=R&&Ot<=G&&Go(ge,it,je,ce),zt=ge.length-3,ie&&zt>=3&&(ge[zt]!==ge[0]||ge[zt+1]!==ge[1])&&Go(ge,ge[0],ge[1],ge[2]),ge.length&&z.push(ge)}function Ws(q){var z=[];return z.size=q.size,z.start=q.start,z.end=q.end,z}function Xs(q,z,R,G,Y,ie){for(var me=0;me<q.length;me++)$o(q[me],z,R,G,Y,ie,!1)}function Go(q,z,R,G){q.push(z),q.push(R),q.push(G)}function Uc(q,z,R,G,Y,ie){var me=(ie-z)/(G-z);return q.push(ie),q.push(R+(Y-R)*me),q.push(1),me}function Wa(q,z,R,G,Y,ie){var me=(ie-R)/(Y-R);return q.push(z+(G-z)*me),q.push(ie),q.push(1),me}function Xa(q,z){for(var R=[],G=0;G<q.length;G++){var Y,ie=q[G],me=ie.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")Y=Lr(ie.geometry,z);else if(me==="MultiLineString"||me==="Polygon"){Y=[];for(var fe=0;fe<ie.geometry.length;fe++)Y.push(Lr(ie.geometry[fe],z))}else if(me==="MultiPolygon")for(Y=[],fe=0;fe<ie.geometry.length;fe++){for(var oe=[],ge=0;ge<ie.geometry[fe].length;ge++)oe.push(Lr(ie.geometry[fe][ge],z));Y.push(oe)}R.push(zr(ie.id,me,Y,ie.tags))}return R}function Lr(q,z){var R=[];R.size=q.size,q.start!==void 0&&(R.start=q.start,R.end=q.end);for(var G=0;G<q.length;G+=3)R.push(q[G]+z,q[G+1],q[G+2]);return R}function Hs(q,z){if(q.transformed)return q;var R,G,Y,ie=1<<q.z,me=q.x,fe=q.y;for(R=0;R<q.features.length;R++){var oe=q.features[R],ge=oe.geometry,Pe=oe.type;if(oe.geometry=[],Pe===1)for(G=0;G<ge.length;G+=2)oe.geometry.push(Ii(ge[G],ge[G+1],z,ie,me,fe));else for(G=0;G<ge.length;G++){var Ge=[];for(Y=0;Y<ge[G].length;Y+=2)Ge.push(Ii(ge[G][Y],ge[G][Y+1],z,ie,me,fe));oe.geometry.push(Ge)}}return q.transformed=!0,q}function Ii(q,z,R,G,Y,ie){return[Math.round(R*(q*G-Y)),Math.round(R*(z*G-ie))]}function co(q,z,R,G,Y){for(var ie=z===Y.maxZoom?0:Y.tolerance/((1<<z)*Y.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:G,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<q.length;fe++){me.numFeatures++,Ha(me,q[fe],ie,Y);var oe=q[fe].minX,ge=q[fe].minY,Pe=q[fe].maxX,Ge=q[fe].maxY;oe<me.minX&&(me.minX=oe),ge<me.minY&&(me.minY=ge),Pe>me.maxX&&(me.maxX=Pe),Ge>me.maxY&&(me.maxY=Ge)}return me}function Ha(q,z,R,G){var Y=z.geometry,ie=z.type,me=[];if(ie==="Point"||ie==="MultiPoint")for(var fe=0;fe<Y.length;fe+=3)me.push(Y[fe]),me.push(Y[fe+1]),q.numPoints++,q.numSimplified++;else if(ie==="LineString")uo(me,Y,q,R,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(fe=0;fe<Y.length;fe++)uo(me,Y[fe],q,R,ie==="Polygon",fe===0);else if(ie==="MultiPolygon")for(var oe=0;oe<Y.length;oe++){var ge=Y[oe];for(fe=0;fe<ge.length;fe++)uo(me,ge[fe],q,R,!0,fe===0)}if(me.length){var Pe=z.tags||null;if(ie==="LineString"&&G.lineMetrics){for(var Ge in Pe={},z.tags)Pe[Ge]=z.tags[Ge];Pe.mapbox_clip_start=Y.start/Y.size,Pe.mapbox_clip_end=Y.end/Y.size}var Be={geometry:me,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:Pe};z.id!==null&&(Be.id=z.id),q.features.push(Be)}}function uo(q,z,R,G,Y,ie){var me=G*G;if(G>0&&z.size<(Y?me:G))R.numPoints+=z.length/3;else{for(var fe=[],oe=0;oe<z.length;oe+=3)(G===0||z[oe+2]>me)&&(R.numSimplified++,fe.push(z[oe]),fe.push(z[oe+1])),R.numPoints++;Y&&function(ge,Pe){for(var Ge=0,Be=0,it=ge.length,je=it-2;Be<it;je=Be,Be+=2)Ge+=(ge[Be]-ge[je])*(ge[Be+1]+ge[je+1]);if(Ge>0===Pe)for(Be=0,it=ge.length;Be<it/2;Be+=2){var ce=ge[Be],Te=ge[Be+1];ge[Be]=ge[it-2-Be],ge[Be+1]=ge[it-1-Be],ge[it-2-Be]=ce,ge[it-1-Be]=Te}}(fe,ie),q.push(fe)}}function vr(q,z){var R=(z=this.options=function(Y,ie){for(var me in ie)Y[me]=ie[me];return Y}(Object.create(this.options),z)).debug;if(R&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var G=function(Y,ie){var me=[];if(Y.type==="FeatureCollection")for(var fe=0;fe<Y.features.length;fe++)Vo(me,Y.features[fe],ie,fe);else Vo(me,Y.type==="Feature"?Y:{geometry:Y},ie);return me}(q,z);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(G=function(Y,ie){var me=ie.buffer/ie.extent,fe=Y,oe=Yn(Y,1,-1-me,me,0,-1,2,ie),ge=Yn(Y,1,1-me,2+me,0,-1,2,ie);return(oe||ge)&&(fe=Yn(Y,1,-me,1+me,0,-1,2,ie)||[],oe&&(fe=Xa(oe,1).concat(fe)),ge&&(fe=fe.concat(Xa(ge,-1)))),fe}(G,z)).length&&this.splitTile(G,0,0,0),R&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zo(q,z,R){return 32*((1<<q)*R+z)+q}function Ys(q,z){const R=q.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const G=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!G)return z(null,null);const Y=new ae(G.features);let ie=Ke(Y);ie.byteOffset===0&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),z(null,{vectorTile:Y,rawData:ie.buffer})}vr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vr.prototype.splitTile=function(q,z,R,G,Y,ie,me){for(var fe=[q,z,R,G],oe=this.options,ge=oe.debug;fe.length;){G=fe.pop(),R=fe.pop(),z=fe.pop(),q=fe.pop();var Pe=1<<z,Ge=Zo(z,R,G),Be=this.tiles[Ge];if(!Be&&(ge>1&&console.time("creation"),Be=this.tiles[Ge]=co(q,z,R,G,oe),this.tileCoords.push({z,x:R,y:G}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,R,G,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var it="z"+z;this.stats[it]=(this.stats[it]||0)+1,this.total++}if(Be.source=q,Y){if(z===oe.maxZoom||z===Y)continue;var je=1<<Y-z;if(R!==Math.floor(ie/je)||G!==Math.floor(me/je))continue}else if(z===oe.indexMaxZoom||Be.numPoints<=oe.indexMaxPoints)continue;if(Be.source=null,q.length!==0){ge>1&&console.time("clipping");var ce,Te,St,Ot,_t,At,zt=.5*oe.buffer/oe.extent,fo=.5-zt,sr=.5+zt,Ze=1+zt;ce=Te=St=Ot=null,_t=Yn(q,Pe,R-zt,R+sr,0,Be.minX,Be.maxX,oe),At=Yn(q,Pe,R+fo,R+Ze,0,Be.minX,Be.maxX,oe),q=null,_t&&(ce=Yn(_t,Pe,G-zt,G+sr,1,Be.minY,Be.maxY,oe),Te=Yn(_t,Pe,G+fo,G+Ze,1,Be.minY,Be.maxY,oe),_t=null),At&&(St=Yn(At,Pe,G-zt,G+sr,1,Be.minY,Be.maxY,oe),Ot=Yn(At,Pe,G+fo,G+Ze,1,Be.minY,Be.maxY,oe),At=null),ge>1&&console.timeEnd("clipping"),fe.push(ce||[],z+1,2*R,2*G),fe.push(Te||[],z+1,2*R,2*G+1),fe.push(St||[],z+1,2*R+1,2*G),fe.push(Ot||[],z+1,2*R+1,2*G+1)}}},vr.prototype.getTile=function(q,z,R){var G=this.options,Y=G.extent,ie=G.debug;if(q<0||q>24)return null;var me=1<<q,fe=Zo(q,z=(z%me+me)%me,R);if(this.tiles[fe])return Hs(this.tiles[fe],Y);ie>1&&console.log("drilling down to z%d-%d-%d",q,z,R);for(var oe,ge=q,Pe=z,Ge=R;!oe&&ge>0;)ge--,Pe=Math.floor(Pe/2),Ge=Math.floor(Ge/2),oe=this.tiles[Zo(ge,Pe,Ge)];return oe&&oe.source?(ie>1&&console.log("found parent tile z%d-%d-%d",ge,Pe,Ge),ie>1&&console.time("drilling down"),this.splitTile(oe.source,ge,Pe,Ge,q,z,R),ie>1&&console.timeEnd("drilling down"),this.tiles[fe]?Hs(this.tiles[fe],Y):null):null};class ho extends l.VectorTileWorkerSource{constructor(z,R,G,Y,ie){super(z,R,G,Y,Ys),ie&&(this.loadGeoJSON=ie)}loadData(z,R){const G=z&&z.request,Y=G&&G.collectResourceTiming;this.loadGeoJSON(z,(ie,me)=>{if(ie||!me)return R(ie);if(typeof me!="object")return R(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{Me(me,!0);try{if(z.filter){const oe=l.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(oe.result==="error")throw new Error(oe.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));const ge=me.features.filter(Pe=>oe.value.evaluate({zoom:0},Pe));me={type:"FeatureCollection",features:ge}}this._geoJSONIndex=z.cluster?new Ci(function({superclusterOptions:oe,clusterProperties:ge}){if(!ge||!oe)return oe;const Pe={},Ge={},Be={accumulated:null,zoom:0},it={properties:null},je=Object.keys(ge);for(const ce of je){const[Te,St]=ge[ce],Ot=l.createExpression(St),_t=l.createExpression(typeof Te=="string"?[Te,["accumulated"],["get",ce]]:Te);Pe[ce]=Ot.value,Ge[ce]=_t.value}return oe.map=ce=>{it.properties=ce;const Te={};for(const St of je)Te[St]=Pe[St].evaluate(Be,it);return Te},oe.reduce=(ce,Te)=>{it.properties=Te;for(const St of je)Be.accumulated=ce[St],ce[St]=Ge[St].evaluate(Be,it)},oe}(z)).load(me.features):function(oe,ge){return new vr(oe,ge)}(me,z.geojsonVtOptions)}catch(oe){return R(oe)}this.loaded={};const fe={};if(Y){const oe=l.getPerformanceMeasurement(G);oe&&(fe.resourceTiming={},fe.resourceTiming[z.source]=JSON.parse(JSON.stringify(oe)))}R(null,fe)}})}reloadTile(z,R){const G=this.loaded;return G&&G[z.uid]?super.reloadTile(z,R):this.loadTile(z,R)}loadGeoJSON(z,R){if(z.request)l.getJSON(z.request,R);else{if(typeof z.data!="string")return R(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return R(null,JSON.parse(z.data))}catch{return R(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(G){R(G)}}getClusterChildren(z,R){try{R(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(G){R(G)}}getClusterLeaves(z,R){try{R(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(G){R(G)}}}class po{constructor(z){this.self=z,this.actor=new l.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:ho},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,G)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=G},this.self.registerRTLTextPlugin=R=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=R.applyArabicShaping,l.plugin.processBidirectionalText=R.processBidirectionalText,l.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}clearCaches(z,R,G){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],G()}checkIfReady(z,R,G){G()}setReferrer(z,R){this.referrer=R}spriteLoaded(z,R){this.isSpriteLoaded[z]=R;for(const G in this.workerSources[z]){const Y=this.workerSources[z][G];for(const ie in Y)Y[ie]instanceof l.VectorTileWorkerSource&&(Y[ie].isSpriteLoaded=R,Y[ie].fire(new l.Event("isSpriteLoaded")))}}setImages(z,R,G){this.availableImages[z]=R;for(const Y in this.workerSources[z]){const ie=this.workerSources[z][Y];for(const me in ie)ie[me].availableImages=R}G()}enableTerrain(z,R,G){this.terrain=R,G()}setProjection(z,R){this.projections[z]=l.getProjection(R)}setLayers(z,R,G){this.getLayerIndex(z).replace(R),G()}updateLayers(z,R,G){this.getLayerIndex(z).update(R.layers,R.removedIds),G()}loadTile(z,R,G){const Y=this.enableTerrain?l.extend({enableTerrain:this.terrain},R):R;Y.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,R.type,R.source).loadTile(Y,G)}loadDEMTile(z,R,G){const Y=this.enableTerrain?l.extend({buildQuadTree:this.terrain},R):R;this.getDEMWorkerSource(z,R.source).loadTile(Y,G)}reloadTile(z,R,G){const Y=this.enableTerrain?l.extend({enableTerrain:this.terrain},R):R;Y.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,R.type,R.source).reloadTile(Y,G)}abortTile(z,R,G){this.getWorkerSource(z,R.type,R.source).abortTile(R,G)}removeTile(z,R,G){this.getWorkerSource(z,R.type,R.source).removeTile(R,G)}removeSource(z,R,G){if(!this.workerSources[z]||!this.workerSources[z][R.type]||!this.workerSources[z][R.type][R.source])return;const Y=this.workerSources[z][R.type][R.source];delete this.workerSources[z][R.type][R.source],Y.removeSource!==void 0?Y.removeSource(R,G):G()}loadWorkerSource(z,R,G){try{this.self.importScripts(R.url),G()}catch(Y){G(Y.toString())}}syncRTLPluginState(z,R,G){try{l.plugin.setState(R);const Y=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&Y!=null){this.self.importScripts(Y);const ie=l.plugin.isParsed();G(ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),ie)}}catch(Y){G(Y.toString())}}getAvailableImages(z){let R=this.availableImages[z];return R||(R=[]),R}getLayerIndex(z){let R=this.layerIndexes[z];return R||(R=this.layerIndexes[z]=new ve),R}getWorkerSource(z,R,G){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][R]||(this.workerSources[z][R]={}),this.workerSources[z][R][G]||(this.workerSources[z][R][G]=new this.workerSourceTypes[R]({send:(Y,ie,me,fe,oe,ge)=>{this.actor.send(Y,ie,me,z,oe,ge)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][R][G]}getDEMWorkerSource(z,R){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][R]||(this.demWorkerSources[z][R]=new ne),this.demWorkerSources[z][R]}enforceCacheSizeLimit(z,R){l.enforceCacheSizeLimit(R)}getWorkerPerformanceMetrics(z,R,G){G(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new po(self)),po}),A(["./shared"],function(l){var W=_e;function _e(h){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,m,g=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(g);try{m=new Worker(x),p=!0}catch{p=!1}return m&&m.terminate(),URL.revokeObjectURL(x),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var m=p.getContext("2d");if(!m)return!1;var g=m.getImageData(0,0,1,1);return g&&g.width===p.width}()?(ve[a=t&&t.failIfMajorPerformanceCaveat]===void 0&&(ve[a]=function(p){var m,g=function(x){var T=document.createElement("canvas"),C=Object.create(_e.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=x,T.getContext("webgl",C)||T.getContext("experimental-webgl",C)}(p);if(!g)return!1;try{m=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!m||g.isContextLost())&&(g.shaderSource(m,"void main() {}"),g.compileShader(m),g.getShaderParameter(m,g.COMPILE_STATUS)===!0)}(a)),ve[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(h)}var ve={};function he(h,t){if(Array.isArray(h)){if(!Array.isArray(t)||h.length!==t.length)return!1;for(let a=0;a<h.length;a++)if(!he(h[a],t[a]))return!1;return!0}if(typeof h=="object"&&h!==null&&t!==null){if(typeof t!="object"||Object.keys(h).length!==Object.keys(t).length)return!1;for(const a in h)if(!he(h[a],t[a]))return!1;return!0}return h===t}_e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ne={create:function(h,t,a){const p=l.window.document.createElement(h);return t!==void 0&&(p.className=t),a&&a.appendChild(p),p},createNS:function(h,t){return l.window.document.createElementNS(h,t)}},Me=l.window.document&&l.window.document.documentElement.style,tt=Me&&Me.userSelect!==void 0?"userSelect":"WebkitUserSelect";let nt;ne.disableDrag=function(){Me&&tt&&(nt=Me[tt],Me[tt]="none")},ne.enableDrag=function(){Me&&tt&&(Me[tt]=nt)},ne.setTransform=function(h,t){h.style.transform=t};let de=!1;try{const h=Object.defineProperty({},"passive",{get(){de=!0}});l.window.addEventListener("test",h,h),l.window.removeEventListener("test",h,h)}catch{de=!1}ne.addEventListener=function(h,t,a,p={}){h.addEventListener(t,a,"passive"in p&&de?p:p.capture)},ne.removeEventListener=function(h,t,a,p={}){h.removeEventListener(t,a,"passive"in p&&de?p:p.capture)};const te=function(h){h.preventDefault(),h.stopPropagation(),l.window.removeEventListener("click",te,!0)};function ae(h,t,a){const p=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new l.pointGeometry((a.clientX-t.left)*p,(a.clientY-t.top)*p)}function De(h,t){var a=t[0],p=t[1],m=t[2],g=t[3],x=a*g-m*p;return x?(h[0]=g*(x=1/x),h[1]=-p*x,h[2]=-m*x,h[3]=a*x,h):null}ne.suppressClick=function(){l.window.addEventListener("click",te,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",te,!0)},0)},ne.mousePos=function(h,t){const a=h.getBoundingClientRect();return ae(h,a,t)},ne.touchPos=function(h,t){const a=h.getBoundingClientRect(),p=[];for(let m=0;m<t.length;m++)p.push(ae(h,a,t[m]));return p},ne.mouseButton=function(h){return l.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},ne.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};class Le{constructor(t,a){this.pos=t,this.dir=a}intersectsPlane(t,a,p){const m=l.dot(a,this.dir);if(Math.abs(m)<1e-6)return!1;const g=l.dot(l.sub(l.create(),t,this.pos),a)/m,x=l.scaleAndAdd(l.create(),this.pos,this.dir,g);return l.copy(p,x),!0}}class lt{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,p){const m=Math.pow(2,p),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const C=l.transformMat4([],T,t),I=1/C[3]/a*m;return l.mul(C,C,[I,I,1/C[3],I])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const C=l.sub([],g[T[0]],g[T[1]]),I=l.sub([],g[T[2]],g[T[1]]),M=l.normalize([],l.cross([],C,I)),P=-l.dot(M,g[T[1]]);return M.concat(P)});return new lt(g,x)}}class He{constructor(t,a){this.min=t,this.max=a,this.center=l.scale([],l.add([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],p=l.clone(this.min),m=l.clone(this.max);for(let g=0;g<a.length;g++)p[g]=a[g]?this.min[g]:this.center[g],m[g]=a[g]?this.center[g]:this.max[g];return m[2]=this.max[2],new He(p,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<t.planes.length;m++){const g=t.planes[m];let x=0;for(let T=0;T<a.length;T++)x+=l.dot$1(g,a[T])>=0;if(x===0)return 0;x!==a.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let T=0;T<t.points.length;T++){const C=t.points[T][m]-this.min[m];g=Math.min(g,C),x=Math.max(x,C)}if(x<0||g>this.max[m]-this.min[m])return 0}return 1}}function Ke(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class pt extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:p}of this.requestors)this._notify(a,p);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,a){this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,a){if(!t)return!0;let p=0;for(const m of t){if(m[0]<p||m[1]<m[0]||a<m[1])return!1;p=m[1]}return!0}_validateContent(t,a){return!(t&&(t.length!==4||t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,a){a.version=this.images[t].version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let p=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(p=!1);this.isLoaded()||p?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const p={};for(const m of t){this.images[m]||this.fire(new l.Event("styleimagemissing",{id:m}));const g=this.images[m];g?p[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:l.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,p)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],p=this.getImage(t);if(!p)return null;if(a&&a.position.version===p.version)return a.position;if(a)a.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},g=new l.ImagePosition(m,p);this.patterns[t]={bin:m,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:a,h:p}=l.potpack(t),m=this.atlasImage;m.resize({width:a||1,height:p||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],T=x.x+1,C=x.y+1,I=this.images[g].data,M=I.width,P=I.height;l.RGBAImage.copy(I,m,{x:0,y:0},{x:T,y:C},{width:M,height:P}),l.RGBAImage.copy(I,m,{x:0,y:P-1},{x:T,y:C-1},{width:M,height:1}),l.RGBAImage.copy(I,m,{x:0,y:0},{x:T,y:C+P},{width:M,height:1}),l.RGBAImage.copy(I,m,{x:M-1,y:0},{x:T-1,y:C},{width:1,height:P}),l.RGBAImage.copy(I,m,{x:0,y:0},{x:T+M,y:C},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const p=this.images[a];Ke(p)&&this.updateImage(a,p)}}}const st=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(h,t){return function([a,p,m]){const g=l.degToRad(p+90),x=l.degToRad(m);return{x:a*Math.cos(g)*Math.sin(x),y:a*Math.sin(g)*Math.sin(x),z:a*Math.cos(x),azimuthal:p,polar:m}}(h.expression.evaluate(t))}interpolate(h,t,a){return{x:l.number(h.x,t.x,a),y:l.number(h.y,t.y,a),z:l.number(h.z,t.z,a),azimuthal:l.number(h.azimuthal,t.azimuthal,a),polar:l.number(h.polar,t.polar,a)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),on="-transition";class tn extends l.Evented{constructor(t){super(),this._transitionable=new l.Transitionable(st),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(l.validateLight,t,a))for(const p in t){const m=t[p];l.endsWith(p,on)?this._transitionable.setTransition(p.slice(0,-on.length),m):this._transitionable.setValue(p,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,t.call(l.validateStyle,l.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const Un=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)}),sn="-transition";class rr extends l.Evented{constructor(t){super(),this._transitionable=new l.Transitionable(Un),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const a in t){const p=t[a];l.endsWith(a,sn)?this._transitionable.setTransition(a.slice(0,-sn.length),p):this._transitionable.setValue(a,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function mi(h,t,a,p){const m=l.smoothstep(45,65,a),[g,x]=Vi(h,p),T=l.length(t);let C=1-Math.min(1,Math.exp((T-g)/(x-g)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*m*h.alpha}function Vi(h,t){const a=.5/Math.tan(.5*t);return[h.range[0]+a,h.range[1]+a]}const ji=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"])}),$i="-transition";class _i extends l.Evented{constructor(t,a){super(),this._transitionable=new l.Transitionable(ji),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=a}isSoftDisabled(){return this._transform.projection.name!=="mercator"}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a={}){if(!this._validate(l.validateFog,t,a))for(const p in t){const m=t[p];l.endsWith(p,$i)?this._transitionable.setTransition(p.slice(0,-$i.length),m):this._transitionable.setValue(p,m)}}getOpacity(t){if(this.isSoftDisabled())return 0;const a=this.properties&&this.properties.get("color")||1;return l.smoothstep(45,65,t)*a.a}getOpacityAtLatLng(t,a){return this.isSoftDisabled()?0:function(p,m,g){const x=l.MercatorCoordinate.fromLngLat(m),T=g.elevation?g.elevation.getAtPointOrZero(x):0,C=[x.x,x.y,T];return l.transformMat4$1(C,C,g.mercatorFogMatrix),mi(p,C,g.pitch,g._fov)}(this.state,t,a)}getFovAdjustedRange(t){return this.isSoftDisabled()?[0,1]:Vi(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,t.call(l.validateStyle,l.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Si{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let m=0;m<p.length;m++){const g=new Si.Actor(p[m],a,this.id);g.name=`Worker ${m}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,a,p){l.asyncAll(this.actors,(m,g)=>{m.send(t,a,g)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function $e(h,t,a){return t*(l.EXTENT/(h.tileSize*Math.pow(2,a-h.tileID.overscaledZ)))}Si.Actor=l.Actor;class ut{constructor(t,a,p,m){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(g=>m.pointCoordinate3D(g)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,a){let p,m;if(t instanceof l.pointGeometry||typeof t[0]=="number"){const g=l.pointGeometry.convert(t);p=[l.pointGeometry.convert(t)],m=a.isPointAboveHorizon(g)}else{const g=l.pointGeometry.convert(t[0]),x=l.pointGeometry.convert(t[1]);p=[g,x],m=l.polygonizeBounds(g,x).every(T=>a.isPointAboveHorizon(T))}return new ut(p,a.getCameraPoint(),m,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return l.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],m=l.polygonizeBounds(a,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<p.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?m[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(m[3]=this.cameraPoint)),l.bufferConvexPolygon(m,t)}containsTile(t,a,p){const m=t.queryPadding+1,g=t.tileID.wrap,x=p?this._bufferedCameraMercator(m,a).map($=>l.getTilePoint(t.tileTransform,$,g)):this._bufferedScreenMercator(m,a).map($=>l.getTilePoint(t.tileTransform,$,g)),T=this.screenGeometryMercator.map($=>l.getTileVec3(t.tileTransform,$,g)),C=T.map($=>new l.pointGeometry($[0],$[1])),I=a.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),M=l.getTileVec3(t.tileTransform,I,g),P=T.map($=>{const U=l.sub($,$,M);return l.normalize(U,U),new Le(M,U)}),F=$e(t,1,a.zoom);if(l.polygonIntersectsBox(x,0,0,l.EXTENT,l.EXTENT))return{queryGeometry:this,tilespaceGeometry:C,tilespaceRays:P,bufferedTilespaceGeometry:x,bufferedTilespaceBounds:(V=l.getBounds(x),V.min.x=l.clamp(V.min.x,0,l.EXTENT),V.min.y=l.clamp(V.min.y,0,l.EXTENT),V.max.x=l.clamp(V.max.x,0,l.EXTENT),V.max.y=l.clamp(V.max.y,0,l.EXTENT),V),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:F};var V}_bufferedScreenMercator(t,a){const p=ot(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const m=this.bufferedScreenGeometry(t).map(g=>a.pointCoordinate3D(g));return this._screenRaycastCache[p]=m,m}}_bufferedCameraMercator(t,a){const p=ot(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const m=this.bufferedCameraGeometry(t).map(g=>a.pointCoordinate3D(g));return this._cameraRaycastCache[p]=m,m}}}function ot(h){return 100*h|0}function Lt(h,t,a){const p=function(m,g){if(m)return a(m);if(g){const x=l.pick(l.extend(g,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(T=>T.id)),x.tiles=t.canonicalizeTileset(x,h.url),a(null,x)}};return h.url?l.getJSON(t.transformRequest(t.normalizeSourceURL(h.url),l.ResourceType.Source),p):l.exported.frame(()=>p(null,h))}class hn{constructor(t,a,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*a),m=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*a),g=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*a),x=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*a);return t.x>=p&&t.x<g&&t.y>=m&&t.y<x}}class In{constructor(t,a,p){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Hn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ci{constructor(t,a,p,m){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let p=0;p<this.attributes.length;p++){const m=a.attributes[this.attributes[p].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,a,p){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],x=a.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[Hn[g.type]],!1,this.itemSize,g.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fo extends xt{getDefault(){return l.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Oo extends xt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Zs extends xt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ao extends xt{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class gi extends xt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Uo extends xt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ct extends xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class lo extends xt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Pr extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class or extends xt{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class qs extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class zr extends xt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class No extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Vo extends xt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class jo extends xt{getDefault(){return l.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ai extends xt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Dr extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Za extends xt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ki extends xt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Yn extends xt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class qa extends xt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class $o extends xt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ws extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Xs extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Go extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Uc extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Wa extends xt{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xa extends xt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Lr extends xt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Hs extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ii extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class co extends xt{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Ha extends co{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class uo extends co{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vr extends uo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Zo{constructor(t,a,p,m){this.context=t,this.width=a,this.height=p;const g=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Ha(t,g),m&&(this.depthAttachment=new uo(t,g))}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class Ys{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Fo(this),this.clearDepth=new Oo(this),this.clearStencil=new Zs(this),this.colorMask=new ao(this),this.depthMask=new gi(this),this.stencilMask=new Uo(this),this.stencilFunc=new Ct(this),this.stencilOp=new lo(this),this.stencilTest=new Pr(this),this.depthRange=new or(this),this.depthTest=new qs(this),this.depthFunc=new zr(this),this.blend=new No(this),this.blendFunc=new Vo(this),this.blendColor=new jo(this),this.blendEquation=new Ai(this),this.cullFace=new Dr(this),this.cullFaceSide=new Za(this),this.frontFace=new ki(this),this.program=new Yn(this),this.activeTexture=new qa(this),this.viewport=new $o(this),this.bindFramebuffer=new Ws(this),this.bindRenderbuffer=new Xs(this),this.bindTexture=new Go(this),this.bindVertexBuffer=new Uc(this),this.bindElementBuffer=new Wa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Xa(this),this.pixelStoreUnpack=new Lr(this),this.pixelStoreUnpackPremultiplyAlpha=new Hs(this),this.pixelStoreUnpackFlipY=new Ii(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new In(this,t,a)}createVertexBuffer(t,a,p){return new Ci(this,t,a,p)}createRenderbuffer(t,a,p){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,t,a,p),this.bindRenderbuffer.set(null),g}createFramebuffer(t,a,p){return new Zo(this,t,a,p)}clear({color:t,depth:a,stencil:p}){const m=this.gl;let g=0;t&&(g|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),p!==void 0&&(g|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){he(t.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ho extends l.Evented{constructor(t,a,p,m){super(),this.id=t,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},a),l.extend(this,l.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new l.ErrorEvent(t)):a&&(l.extend(this,a),a.bounds&&(this.tileBounds=new hn(a.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(a.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const p=l.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=l.getImage(this.map._requestManager.transformRequest(m,l.ResourceType.Tile),(g,x,T,C)=>{if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(g)t.state="errored",a(g);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:T,expires:C});const I=this.map.painter.context,M=I.gl;t.texture=this.map.painter.getTileTexture(x.width),t.texture?t.texture.update(x,{useMipmap:!0}):(t.texture=new l.Texture(I,x,M.RGBA,{useMipmap:!0}),t.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE),I.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),t.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),a(null)}})}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}let po;class q extends l.Evented{constructor(t,a,p,m){super(),this.id=t,this.dispatcher=p,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(t,a){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,m)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):m&&(this.image=l.exported.getImageData(m),t&&(this.coordinates=t),a&&a(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t,delete this._boundsArray;const a=t.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let m=1/0,g=1/0,x=-1/0,T=-1/0;for(const P of p)m=Math.min(m,P.x),g=Math.min(g,P.y),x=Math.max(x,P.x),T=Math.max(T,P.y);const C=Math.max(x-m,T-g),I=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,I);return new l.CanonicalTileID(I,Math.floor((m+x)/2*M),Math.floor((g+T)/2*M))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const t=l.tileTransform(this.tileID,this.map.transform.projection),a=this.coordinates.map(p=>{const m=t.projection.project(p[0],p[1]);return l.getTilePoint(t,m)._round()});return this._boundsArray=new l.StructArrayLayout4i8,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new l.Texture(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const p in this.tiles){const m=this.tiles[p];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const z={vector:class extends l.Evented{constructor(h,t,a,p){if(super(),this.id=h,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(t,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(h,t)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):t&&(l.extend(this,t),t.bounds&&(this.tileBounds=new hn(t.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h();const t=this.map.style._getSourceCaches(this.id);for(const a of t)a.clearTiles();this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(a,l.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=t:h.request=h.actor.send("reloadTile",p,m.bind(this));else if(h.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,m.bind(this),void 0,!0);else{const g=l.loadVectorTile.call({deduped:this._deduped},p,(x,T)=>{x||!T?m.call(this,x):(p.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,m.bind(this),void 0,!0))},!0);h.request={cancel:g}}function m(g,x){return delete h.request,h.aborted?t(null):g&&g.status!==404?t(g):(x&&x.resourceTiming&&(h.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&h.setExpiryData(x),h.loadVectorData(x,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ho,"raster-dem":class extends ho{constructor(h,t,a,p){super(h,t,a,p),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(m,g){m&&(h.state="errored",t(m)),g&&(h.dem=g,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=l.getImage(this.map._requestManager.transformRequest(a,l.ResourceType.Tile),function(m,g,x,T){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(m)h.state="errored",t(m);else if(g){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:x,expires:T});const C=l.window.ImageBitmap&&g instanceof l.window.ImageBitmap&&(po==null&&(po=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&typeof l.window.createImageBitmap=="function"),po),I=1-(g.width-l.prevPowerOfTwo(g.width))/2;I<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const M=C?g:l.exported.getImageData(g,I),P={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:M,encoding:this.encoding,padding:I};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",P,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const t=h.canonical,a=Math.pow(2,t.z),p=(t.x-1+a)%a,m=t.x===0?h.wrap-1:h.wrap,g=(t.x+1+a)%a,x=t.x+1===a?h.wrap+1:h.wrap,T={};return T[new l.OverscaledTileID(h.overscaledZ,m,t.z,p,t.y).key]={backfilled:!1},T[new l.OverscaledTileID(h.overscaledZ,x,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(T[new l.OverscaledTileID(h.overscaledZ,m,t.z,p,t.y-1).key]={backfilled:!1},T[new l.OverscaledTileID(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},T[new l.OverscaledTileID(h.overscaledZ,x,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<a&&(T[new l.OverscaledTileID(h.overscaledZ,m,t.z,p,t.y+1).key]={backfilled:!1},T[new l.OverscaledTileID(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},T[new l.OverscaledTileID(h.overscaledZ,x,t.z,g,t.y+1).key]={backfilled:!1}),T}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends l.Evented{constructor(h,t,a,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(p),this._data=t.data,this._options=l.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:l.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},t),this}getClusterLeaves(h,t,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:t,offset:a},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=l.extend({},this.workerOptions),t=this._data;typeof t=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(t),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(a,p)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new l.ErrorEvent(a));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(m.resourceTiming=p.resourceTiming[this.id]),this.fire(new l.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,t){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(a,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,m)=>(delete h.request,h.unloadVectorData(),h.aborted?t(null):p?t(p):(h.loadVectorData(m,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends q{constructor(h,t,a,p){super(h,t,a,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,l.ResourceType.Source).url);l.getVideo(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new l.ErrorEvent(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(h,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const a in this.tiles){const p=this.tiles[a];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:q,canvas:class extends q{constructor(h,t,a,p){super(h,t,a,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(g=>typeof g!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context,a=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(t,this.canvas,a.RGBA,{premultiply:!0});for(const p in this.tiles){const m=this.tiles[p];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}}},R=function(h,t,a,p){const m=new z[t.type](h,t,a,p);if(m.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${m.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],m),m};function G(h,t){const a=l.identity([]);return l.scale$1(a,a,[.5*h.width,.5*-h.height,1]),l.translate(a,a,[1,-1,0]),l.multiply(a,a,h.calculateProjMatrix(t.toUnwrapped()))}function Y(h,t,a,p,m,g,x,T=!1){const C=h.tilesIn(p,x,T);C.sort(me);const I=[];for(const P of C)I.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,a,h._state,P,m,g,G(h.transform,P.tile.tileID),T)});const M=function(P){const F={},V={};for(const $ of P){const U=$.queryResults,X=$.wrappedTileID,N=V[X]=V[X]||{};for(const H in U){const J=U[H],j=N[H]=N[H]||{},Q=F[H]=F[H]||[];for(const re of J)j[re.featureIndex]||(j[re.featureIndex]=!0,Q.push(re))}}return F}(I);for(const P in M)M[P].forEach(F=>{const V=F.feature,$=h.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=$});return M}function ie(h,t){const a=h.getRenderableIds().map(g=>h.getTileByID(g)),p=[],m={};for(let g=0;g<a.length;g++){const x=a[g],T=x.tileID.canonical.key;m[T]||(m[T]=!0,x.querySourceFeatures(p,t))}return p}function me(h,t){const a=h.tileID,p=t.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}function fe(){return ls.workerClass!=null?new ls.workerClass:new l.window.Worker(ls.workerUrl)}const oe="mapboxgl_preloaded_worker_pool";class ge{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ge.workerCount;)this.workers.push(new fe);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oe]}numActive(){return Object.keys(this.active).length}}let Pe;function Ge(){return Pe||(Pe=new ge),Pe}function Be(h,t){const a={};for(const p in h)p!=="ref"&&(a[p]=h[p]);return l.refProperties.forEach(p=>{p in t&&(a[p]=t[p])}),a}function it(h){h=h.slice();const t=Object.create(null);for(let a=0;a<h.length;a++)t[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=Be(h[a],t[h[a].ref]));return h}ge.workerCount=2;const je={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ce(h,t,a){a.push({command:je.addSource,args:[h,t[h]]})}function Te(h,t,a){t.push({command:je.removeSource,args:[h]}),a[h]=!0}function St(h,t,a,p){Te(h,a,p),ce(h,t,a)}function Ot(h,t,a){let p;for(p in h[a])if(h[a].hasOwnProperty(p)&&p!=="data"&&!he(h[a][p],t[a][p]))return!1;for(p in t[a])if(t[a].hasOwnProperty(p)&&p!=="data"&&!he(h[a][p],t[a][p]))return!1;return!0}function _t(h,t,a,p,m,g){let x;for(x in t=t||{},h=h||{})h.hasOwnProperty(x)&&(he(h[x],t[x])||a.push({command:g,args:[p,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!h.hasOwnProperty(x)&&(he(h[x],t[x])||a.push({command:g,args:[p,x,t[x],m]}))}function At(h){return h.id}function zt(h,t){return h[t.id]=t,h}class fo{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.clamp(t,0,1);let a=1,p=this._distances[a];const m=t*this.paddedLength+this.padding;for(;p<m&&a<this._distances.length;)p=this._distances[++a];const g=a-1,x=this._distances[g],T=p-x,C=T>0?(m-x)/T:0;return this.points[g].mult(1-C).add(this.points[a].mult(C))}}class sr{constructor(t,a,p){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(a/p);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,p,m,g){this._forEachCell(a,p,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(t,a,p,m){this._forEachCell(a-m,p-m,a+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(p),this.circles.push(m)}_insertBoxCell(t,a,p,m,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,a,p,m,g,x){this.circleCells[g].push(x)}_query(t,a,p,m,g,x){if(p<0||t>this.width||m<0||a>this.height)return!g&&[];const T=[];if(t<=0&&a<=0&&this.width<=p&&this.height<=m){if(g)return!0;for(let C=0;C<this.boxKeys.length;C++)T.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const I=this.circles[3*C],M=this.circles[3*C+1],P=this.circles[3*C+2];T.push({key:this.circleKeys[C],x1:I-P,y1:M-P,x2:I+P,y2:M+P})}return x?T.filter(x):T}return this._forEachCell(t,a,p,m,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},x),g?T.length>0:T}_queryCircle(t,a,p,m,g){const x=t-p,T=t+p,C=a-p,I=a+p;if(T<0||x>this.width||I<0||C>this.height)return!m&&[];const M=[];return this._forEachCell(x,C,T,I,this._queryCellCircle,M,{hitTest:m,circle:{x:t,y:a,radius:p},seenUids:{box:{},circle:{}}},g),m?M.length>0:M}query(t,a,p,m,g){return this._query(t,a,p,m,!1,g)}hitTest(t,a,p,m,g){return this._query(t,a,p,m,!0,g)}hitTestCircle(t,a,p,m){return this._queryCircle(t,a,p,!0,m)}_queryCell(t,a,p,m,g,x,T,C){const I=T.seenUids,M=this.boxCells[g];if(M!==null){const F=this.bboxes;for(const V of M)if(!I.box[V]){I.box[V]=!0;const $=4*V;if(t<=F[$+2]&&a<=F[$+3]&&p>=F[$+0]&&m>=F[$+1]&&(!C||C(this.boxKeys[V]))){if(T.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[V],x1:F[$],y1:F[$+1],x2:F[$+2],y2:F[$+3]})}}}const P=this.circleCells[g];if(P!==null){const F=this.circles;for(const V of P)if(!I.circle[V]){I.circle[V]=!0;const $=3*V;if(this._circleAndRectCollide(F[$],F[$+1],F[$+2],t,a,p,m)&&(!C||C(this.circleKeys[V]))){if(T.hitTest)return x.push(!0),!0;{const U=F[$],X=F[$+1],N=F[$+2];x.push({key:this.circleKeys[V],x1:U-N,y1:X-N,x2:U+N,y2:X+N})}}}}}_queryCellCircle(t,a,p,m,g,x,T,C){const I=T.circle,M=T.seenUids,P=this.boxCells[g];if(P!==null){const V=this.bboxes;for(const $ of P)if(!M.box[$]){M.box[$]=!0;const U=4*$;if(this._circleAndRectCollide(I.x,I.y,I.radius,V[U+0],V[U+1],V[U+2],V[U+3])&&(!C||C(this.boxKeys[$])))return x.push(!0),!0}}const F=this.circleCells[g];if(F!==null){const V=this.circles;for(const $ of F)if(!M.circle[$]){M.circle[$]=!0;const U=3*$;if(this._circlesCollide(V[U],V[U+1],V[U+2],I.x,I.y,I.radius)&&(!C||C(this.circleKeys[$])))return x.push(!0),!0}}}_forEachCell(t,a,p,m,g,x,T,C){const I=this._convertToXCellCoord(t),M=this._convertToYCellCoord(a),P=this._convertToXCellCoord(p),F=this._convertToYCellCoord(m);for(let V=I;V<=P;V++)for(let $=M;$<=F;$++)if(g.call(this,t,a,p,m,this.xCellCount*$+V,x,T,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,p,m,g,x){const T=m-t,C=g-a,I=p+x;return I*I>T*T+C*C}_circleAndRectCollide(t,a,p,m,g,x,T){const C=(x-m)/2,I=Math.abs(t-(m+C));if(I>C+p)return!1;const M=(T-g)/2,P=Math.abs(a-(g+M));if(P>M+p)return!1;if(I<=C||P<=M)return!0;const F=I-C,V=P-M;return F*F+V*V<=p*p}}const Ze=Math.tan(85*Math.PI/180);function Et(h,t,a,p,m){const g=l.create$1();if(t){const x=De([],m);g[0]=x[0],g[1]=x[1],g[4]=x[2],g[5]=x[3],a||l.rotateZ(g,g,p.angle)}else l.multiply(g,p.labelPlaneMatrix,h);return g}function wt(h,t,a,p,m){if(t){const g=l.clone$1(h),x=l.identity([]);return x[0]=m[0],x[1]=m[1],x[4]=m[2],x[5]=m[3],l.multiply(g,g,x),a||l.rotateZ(g,g,-p.angle),g}return p.glCoordMatrix}function mn(h,t,a=0){const p=[h.x,h.y,a,1];a?l.transformMat4(p,p,t):Ka(p,p,t);const m=p[3];return{point:new l.pointGeometry(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function mo(h,t){return Math.min(.5+h/t*.5,1.5)}function bt(h,t){const a=h[0]/h[3],p=h[1]/h[3];return a>=-t[0]&&a<=t[0]&&p>=-t[1]&&p<=t[1]}function Ya(h,t,a,p,m,g,x,T,C){const I=p?h.textSizeData:h.iconSizeData,M=l.evaluateSizeForZoom(I,a.transform.zoom),P=[256/a.width*2+1,256/a.height*2+1],F=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;F.clear();const V=h.lineVertexArray,$=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,U=a.transform.width/a.transform.height;let X=!1;for(let N=0;N<$.length;N++){const H=$.get(N);if(H.writingMode!==l.WritingMode.vertical||X||N!==0&&$.get(N-1).writingMode===l.WritingMode.horizontal||(X=!0),H.hidden||H.writingMode===l.WritingMode.vertical&&!X){Gi(H.numGlyphs,F);continue}X=!1;const J=new l.pointGeometry(H.tileAnchorX,H.tileAnchorY),j=C?C(J):0,Q=[J.x,J.y,j],re=[...Q,1];if(l.transformMat4(re,re,t),!bt(re,P)){Gi(H.numGlyphs,F);continue}const we=mo(a.transform.cameraToCenterDistance,re[3]),xe=l.evaluateSizeForFeature(I,M,H),Se=x?xe/we:xe*we,Ce=mn(new l.pointGeometry(Q[0],Q[1]),m,Q[2]);if(Ce.signedDistanceFromCamera<=0){Gi(H.numGlyphs,F);continue}let Ue={};const Ee=x?null:C,Ne=yi(H,Se,!1,T,t,m,g,h.glyphOffsetArray,V,F,Ce.point,J,Ue,U,Ee);X=Ne.useVertical,Ee&&Ne.needsFlipping&&(Ue={}),(Ne.notEnoughRoom||X||Ne.needsFlipping&&yi(H,Se,!0,T,t,m,g,h.glyphOffsetArray,V,F,Ce.point,J,Ue,U,Ee).notEnoughRoom)&&Gi(H.numGlyphs,F)}p?h.text.dynamicLayoutVertexBuffer.updateData(F):h.icon.dynamicLayoutVertexBuffer.updateData(F)}function qo(h,t,a,p,m,g,x,T,C,I,M,P,F){const V=T.glyphStartIndex+T.numGlyphs,$=T.lineStartIndex,U=T.lineStartIndex+T.lineLength,X=t.getoffsetX(T.glyphStartIndex),N=t.getoffsetX(V-1),H=Br(h*X,a,p,m,g,x,T.segment,$,U,C,I,M,P,F,!0);if(!H)return null;const J=Br(h*N,a,p,m,g,x,T.segment,$,U,C,I,M,P,F,!0);return J?{first:H,last:J}:null}function Wo(h,t,a,p){return h.writingMode===l.WritingMode.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*p?{useVertical:!0}:h.writingMode===l.WritingMode.vertical?t.y<a.y?{needsFlipping:!0}:null:h.flipState!==0&&function(m,g,x){const T=(g.x-m.x)*x;return T===0||Math.abs((g.y-m.y)/T)>Ze}(t,a,p)?h.flipState===1?{needsFlipping:!0}:null:t.x>a.x?{needsFlipping:!0}:null}function yi(h,t,a,p,m,g,x,T,C,I,M,P,F,V,$){const U=t/24,X=h.lineOffsetX*U,N=h.lineOffsetY*U;let H;if(h.numGlyphs>1){const J=h.glyphStartIndex+h.numGlyphs,j=h.lineStartIndex,Q=h.lineStartIndex+h.lineLength,re=qo(U,T,X,N,a,M,P,h,C,g,F,$,!1);if(!re)return{notEnoughRoom:!0};const we=mn(re.first.point,x).point,xe=mn(re.last.point,x).point;if(p&&!a){const Se=Wo(h,we,xe,V);if(h.flipState=Se&&Se.needsFlipping?1:2,Se)return Se}H=[re.first];for(let Se=h.glyphStartIndex+1;Se<J-1;Se++)H.push(Br(U*T.getoffsetX(Se),X,N,a,M,P,h.segment,j,Q,C,g,F,$,!1,!1));H.push(re.last)}else{if(p&&!a){const j=mn(P,m).point,Q=h.lineStartIndex+h.segment+1,re=new l.pointGeometry(C.getx(Q),C.gety(Q)),we=mn(re,m),xe=Wo(h,j,we.signedDistanceFromCamera>0?we.point:Wh(P,re,j,1,m,void 0),V);if(h.flipState=xe&&xe.needsFlipping?1:2,xe)return xe}const J=Br(U*T.getoffsetX(h.glyphStartIndex),X,N,a,M,P,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,C,g,F,$,!1,!1);if(!J)return{notEnoughRoom:!0};H=[J]}for(const J of H)l.addDynamicAttributes(I,J.point,J.angle);return{}}function nn(h,t,a){const p={x:h.x,y:h.y,z:0};if(!a)return mn(p,t,p.z);const m=a(h);return mn(new l.pointGeometry(p.x,p.y),t,p.z+m)}function Wh(h,t,a,p,m,g){const x=nn(h.add(h.sub(t)._unit()),m,g).point,T=a.sub(x);return a.add(T._mult(p/T.mag()))}function Br(h,t,a,p,m,g,x,T,C,I,M,P,F,V,$){const U=p?h-t:h+t;let X=U>0?1:-1,N=0;p&&(X*=-1,N=Math.PI),X<0&&(N+=Math.PI);let H=X>0?T+x:T+x+1,J=m,j=m,Q=0,re=0;const we=Math.abs(U),xe=[],Se=[];let Ce=g;const Ue=()=>{const ct=H-X;return Q===0?g:new l.pointGeometry(I.getx(ct),I.gety(ct))},Ee=()=>Wh(Ue(),Ce,j,we-Q+1,M,F);for(;Q+re<=we;){if(H+=X,H<T||H>=C)return null;if(j=J,xe.push(J),V&&Se.push(Ce||Ue()),J=P[H],J===void 0){Ce=new l.pointGeometry(I.getx(H),I.gety(H));const ct=nn(Ce,M,F);J=ct.signedDistanceFromCamera>0?P[H]=ct.point:Ee()}else Ce=null;Q+=re,re=j.dist(J)}$&&F&&(Ce=Ce||new l.pointGeometry(I.getx(H),I.gety(H)),P[H]=J=P[H]===void 0?J:Ee(),re=j.dist(J));const Ne=(we-Q)/re,ye=J.sub(j),Ve=ye.mult(Ne)._add(j);a&&Ve._add(ye._unit()._perp()._mult(a*X));const et=N+Math.atan2(J.y-j.y,J.x-j.x);return xe.push(Ve),V&&(Ce=Ce||new l.pointGeometry(I.getx(H),I.gety(H)),Se.push(function(ct,ht,ft){const mt=1-ft;return new l.pointGeometry(ct.x*mt+ht.x*ft,ct.y*mt+ht.y*ft)}(Se.length>0?Se[Se.length-1]:Ce,Ce,Ne))),{point:Ve,angle:et,path:xe,tilePath:Se}}const Nc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gi(h,t){for(let a=0;a<h;a++){const p=t.length;t.resize(p+4),t.float32.set(Nc,3*p)}}function Ka(h,t,a){const p=t[0],m=t[1];return h[0]=a[0]*p+a[4]*m+a[12],h[1]=a[1]*p+a[5]*m+a[13],h[3]=a[3]*p+a[7]*m+a[15],h}const Zi=100;class Dt{constructor(t,a,p=new sr(t.width+200,t.height+200,25),m=new sr(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Zi,this.screenBottomBoundary=t.height+Zi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,p,m,g,x,T){let C=a.projectedAnchorZ;a.elevation&&(C+=a.elevation);const I=this.projectAndGetPerspectiveRatio(x,a.projectedAnchorX,a.projectedAnchorY,C,a.tileID),M=g*I.perspectiveRatio,P=(a.x1*t+p.x-a.padding)*M+I.point.x,F=(a.y1*t+p.y-a.padding)*M+I.point.y,V=(a.x2*t+p.x+a.padding)*M+I.point.x,$=(a.y2*t+p.y+a.padding)*M+I.point.y,U=I.perspectiveRatio<=.55||I.aboveHorizon;return!this.isInsideGrid(P,F,V,$)||!m&&this.grid.hitTest(P,F,V,$,T)||U?{box:[],offscreen:!1}:{box:[P,F,V,$],offscreen:this.isOffscreen(P,F,V,$)}}placeCollisionCircles(t,a,p,m,g,x,T,C,I,M,P,F,V,$){const U=[],X=this.transform.elevation,N=X?Ee=>X.getAtTileOffset($,Ee.x,Ee.y):Ee=>0,H=new l.pointGeometry(a.tileAnchorX,a.tileAnchorY),J=N(H),j=this.projectAndGetPerspectiveRatio(x,H.x,H.y,J,$),{perspectiveRatio:Q}=j,re=(M?g/Q:g*Q)/l.ONE_EM,we=mn(H,T,J).point,xe=j.signedDistanceFromCamera>0?qo(re,m,a.lineOffsetX*re,a.lineOffsetY*re,!1,we,H,a,p,T,{},X&&!M?N:null,M&&!!X):null;let Se=!1,Ce=!1,Ue=!0;if(xe&&!j.aboveHorizon){const Ee=.5*F*Q+V,Ne=new l.pointGeometry(-100,-100),ye=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ve=new fo,et=xe.first,ct=xe.last;let ht=[];for(let at=et.path.length-1;at>=1;at--)ht.push(et.path[at]);for(let at=1;at<ct.path.length;at++)ht.push(ct.path[at]);const ft=2.5*Ee;if(C){const at=ht.map(X?(gt,Ut)=>{const xn=N(Ut<et.path.length-1?et.tilePath[et.path.length-1-Ut]:ct.tilePath[Ut-et.path.length+2]);return mn(gt,C,xn)}:gt=>mn(gt,C));ht=at.some(gt=>gt.signedDistanceFromCamera<=0)?[]:at.map(gt=>gt.point)}let mt=[];if(ht.length>0){const at=ht[0].clone(),gt=ht[0].clone();for(let Ut=1;Ut<ht.length;Ut++)at.x=Math.min(at.x,ht[Ut].x),at.y=Math.min(at.y,ht[Ut].y),gt.x=Math.max(gt.x,ht[Ut].x),gt.y=Math.max(gt.y,ht[Ut].y);mt=at.x>=Ne.x&&gt.x<=ye.x&&at.y>=Ne.y&&gt.y<=ye.y?[ht]:gt.x<Ne.x||at.x>ye.x||gt.y<Ne.y||at.y>ye.y?[]:l.clipLine([ht],Ne.x,Ne.y,ye.x,ye.y)}for(const at of mt){Ve.reset(at,.25*Ee);let gt=0;gt=Ve.length<=.5*Ee?1:Math.ceil(Ve.paddedLength/ft)+1;for(let Ut=0;Ut<gt;Ut++){const xn=Ut/Math.max(gt-1,1),Ln=Ve.lerp(xn),$n=Ln.x+Zi,Kn=Ln.y+Zi;U.push($n,Kn,Ee,0);const wn=$n-Ee,wr=Kn-Ee,lr=$n+Ee,Jt=Kn+Ee;if(Ue=Ue&&this.isOffscreen(wn,wr,lr,Jt),Ce=Ce||this.isInsideGrid(wn,wr,lr,Jt),!t&&this.grid.hitTestCircle($n,Kn,Ee,P)&&(Se=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Se}}}}return{circles:!I&&Se||!Ce?[]:U,offscreen:Ue,collisionDetected:Se}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let p=1/0,m=1/0,g=-1/0,x=-1/0;for(const M of t){const P=new l.pointGeometry(M.x+Zi,M.y+Zi);p=Math.min(p,P.x),m=Math.min(m,P.y),g=Math.max(g,P.x),x=Math.max(x,P.y),a.push(P)}const T=this.grid.query(p,m,g,x).concat(this.ignoredGrid.query(p,m,g,x)),C={},I={};for(const M of T){const P=M.key;if(C[P.bucketInstanceId]===void 0&&(C[P.bucketInstanceId]={}),C[P.bucketInstanceId][P.featureIndex])continue;const F=[new l.pointGeometry(M.x1,M.y1),new l.pointGeometry(M.x2,M.y1),new l.pointGeometry(M.x2,M.y2),new l.pointGeometry(M.x1,M.y2)];l.polygonIntersectsPolygon(a,F)&&(C[P.bucketInstanceId][P.featureIndex]=!0,I[P.bucketInstanceId]===void 0&&(I[P.bucketInstanceId]=[]),I[P.bucketInstanceId].push(P.featureIndex))}return I}insertCollisionBox(t,a,p,m,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:m,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,p,m,g){const x=a?this.ignoredGrid:this.grid,T={bucketInstanceId:p,featureIndex:m,collisionGroupID:g};for(let C=0;C<t.length;C+=4)x.insertCircle(T,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,a,p,m,g){const x=[a,p,m||0,1];let T=!1;if(m||this.transform.pitch>0){l.transformMat4(x,x,t);let C=!1;this.fogState&&g&&(C=function(I,M,P,F,V,$){const U=$.calculateFogTileMatrix(V),X=[M,P,F];return l.transformMat4$1(X,X,U),mi(I,X,$.pitch,$._fov)}(this.fogState,a,p,m||0,g.toUnwrapped(),this.transform)>.9),T=x[2]>x[3]||C}else Ka(x,x,t);return{point:new l.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+Zi,(-x[1]/x[3]+1)/2*this.transform.height+Zi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/x[3]*.5,1.5),signedDistanceFromCamera:x[3],aboveHorizon:T}}isOffscreen(t,a,p,m){return p<Zi||t>=this.screenRightBoundary||m<Zi||a>this.screenBottomBoundary}isInsideGrid(t,a,p,m){return p>=0&&t<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=l.identity([]);return l.translate(t,t,[-100,-100,0]),t}}class Ja{constructor(t,a,p,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class _o{constructor(t,a,p,m,g,x=!1){this.text=new Ja(t?t.text:null,a,p,g),this.icon=new Ja(t?t.icon:null,a,m,g),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Nn{constructor(t,a,p,m=!1){this.text=t,this.icon=a,this.skipFade=p,this.clipped=m}}class Mi{constructor(){this.invProjMatrix=l.create$1(),this.viewportMatrix=l.create$1(),this.circles=[]}}class Xh{constructor(t,a,p,m,g){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=g}}class Qa{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[t]}}function _n(h,t,a,p,m){const{horizontalAlign:g,verticalAlign:x}=l.getAnchorAlignment(h),T=-(g-.5)*t,C=-(x-.5)*a,I=l.evaluateVariableOffset(h,p);return new l.pointGeometry(T+I[0]*m,C+I[1]*m)}function go(h,t,a,p,m){const g=new l.pointGeometry(h,t);return a&&g._rotate(p?m:-m),g}class yo{constructor(t,a,p,m,g){this.transform=t.clone(),this.collisionIndex=new Dt(this.transform,g),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Qa(p),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,p,m){const g=p.getBucket(a),x=p.latestFeatureIndex;if(!g||!x||a.id!==g.layerIds[0])return;const T=g.layers[0].layout,C=p.collisionBoxArray,I=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),M=p.tileSize/l.EXTENT,P=p.tileID.toUnwrapped(),F=this.transform.calculateProjMatrix(P),V=T.get("text-pitch-alignment")==="map",$=T.get("text-rotation-alignment")==="map";a.compileFilter();const U=a.dynamicFilter(),X=a.dynamicFilterNeedsFeature(),N=this.transform.calculatePixelsToTileUnitsMatrix(p),H=Et(F,V,$,this.transform,N);let J=null;if(V){const re=wt(F,V,$,this.transform,N);J=l.multiply([],this.transform.labelPlaneMatrix,re)}let j=null;U&&p.latestFeatureIndex&&(j={unwrappedTileID:P,dynamicFilter:U,dynamicFilterNeedsFeature:X,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Xh(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,p.tileID);const Q={bucket:g,layout:T,posMatrix:F,textLabelPlaneMatrix:H,labelToScreenMatrix:J,clippingData:j,scale:I,textPixelRatio:M,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(m)for(const re of g.sortKeyRanges){const{sortKey:we,symbolInstanceStart:xe,symbolInstanceEnd:Se}=re;t.push({sortKey:we,symbolInstanceStart:xe,symbolInstanceEnd:Se,parameters:Q})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(t,a,p,m,g,x,T,C,I,M,P,F,V,$,U,X,N,H){const J=[F.textOffset0,F.textOffset1],j=_n(t,p,m,J,g),Q=this.collisionIndex.placeCollisionBox(g,a,go(j.x,j.y,x,T,this.transform.angle),P,C,I,M.predicate);if((!X||this.collisionIndex.placeCollisionBox($.getSymbolInstanceIconSize(H,this.transform.zoom,V),X,go(j.x,j.y,x,T,this.transform.angle),P,C,I,M.predicate).box.length!==0)&&Q.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(re=this.prevPlacement.variableOffsets[F.crossTileID].anchor),this.variableOffsets[F.crossTileID]={textOffset:J,width:p,height:m,anchor:t,textScale:g,prevAnchor:re},this.markUsedJustification($,t,F,U),$.allowVerticalPlacement&&(this.markUsedOrientation($,U,F),this.placedOrientations[F.crossTileID]=U),{shift:j,placedGlyphBoxes:Q}}}placeLayerBucketPart(t,a,p,m){const{bucket:g,layout:x,posMatrix:T,textLabelPlaneMatrix:C,labelToScreenMatrix:I,clippingData:M,textPixelRatio:P,holdingForFade:F,collisionBoxArray:V,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:U,collisionGroup:X}=t.parameters,N=x.get("text-optional"),H=x.get("icon-optional"),J=x.get("text-allow-overlap"),j=x.get("icon-allow-overlap"),Q=x.get("text-rotation-alignment")==="map",re=x.get("text-pitch-alignment")==="map",we=x.get("icon-text-fit")!=="none",xe=x.get("symbol-z-order")==="viewport-y",Se=J&&(j||!g.hasIconData()||H),Ce=j&&(J||!g.hasTextData()||N);!g.collisionArrays&&V&&g.deserializeCollisionBoxes(V),p&&m&&g.updateCollisionDebugBuffers(this.transform.zoom,V);const Ue=(Ee,Ne,ye)=>{if(M){const Jt={zoom:this.transform.zoom,pitch:this.transform.pitch};let dn=null;if(M.dynamicFilterNeedsFeature){const Mt=this.retainedQueryData[g.bucketInstanceId];dn=M.featureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:Mt.bucketIndex,sourceLayerIndex:Mt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,M.dynamicFilter)(Jt,dn,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new l.pointGeometry(Ee.tileAnchorX,Ee.tileAnchorY),this.transform.calculateDistanceTileData(M.unwrappedTileID)))return this.placements[Ee.crossTileID]=new Nn(!1,!1,!1,!0),void(a[Ee.crossTileID]=!0)}if(a[Ee.crossTileID])return;if(F)return void(this.placements[Ee.crossTileID]=new Nn(!1,!1,!1));let Ve=!1,et=!1,ct=!0,ht=null,ft={box:null,offscreen:null},mt={box:null,offscreen:null},at=null,gt=null,Ut=null,xn=0,Ln=0,$n=0;ye.textFeatureIndex?xn=ye.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(xn=Ee.featureIndex),ye.verticalTextFeatureIndex&&(Ln=ye.verticalTextFeatureIndex);const Kn=Jt=>{Jt.tileID=this.retainedQueryData[g.bucketInstanceId].tileID,(this.transform.elevation||Jt.elevation)&&(Jt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[g.bucketInstanceId].tileID,Jt.tileAnchorX,Jt.tileAnchorY):0)},wn=ye.textBox;if(wn){Kn(wn);const Jt=Mt=>{let en=l.WritingMode.horizontal;if(g.allowVerticalPlacement&&!Mt&&this.prevPlacement){const Bn=this.prevPlacement.placedOrientations[Ee.crossTileID];Bn&&(this.placedOrientations[Ee.crossTileID]=Bn,en=Bn,this.markUsedOrientation(g,en,Ee))}return en},dn=(Mt,en)=>{if(g.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&ye.verticalTextBox){for(const Bn of g.writingModes)if(Bn===l.WritingMode.vertical?(ft=en(),mt=ft):ft=Mt(),ft&&ft.box&&ft.box.length)break}else ft=Mt()};if(x.get("text-variable-anchor")){let Mt=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ee.crossTileID]){const Qt=this.prevPlacement.variableOffsets[Ee.crossTileID];Mt.indexOf(Qt.anchor)>0&&(Mt=Mt.filter(xi=>xi!==Qt.anchor),Mt.unshift(Qt.anchor))}const en=(Qt,xi,ga)=>{const si=g.getSymbolInstanceTextSize($,Ee,this.transform.zoom,Ne),qr=(Qt.x2-Qt.x1)*si+2*Qt.padding,Fd=(Qt.y2-Qt.y1)*si+2*Qt.padding,Ll=we&&!j?xi:null;Ll&&Kn(Ll);let cs={box:[],offscreen:!1};const Od=J?2*Mt.length:Mt.length;for(let ya=0;ya<Od;++ya){const Bl=this.attemptAnchorPlacement(Mt[ya%Mt.length],Qt,qr,Fd,si,Q,re,P,T,X,ya>=Mt.length,Ee,Ne,g,ga,Ll,$,U);if(Bl&&(cs=Bl.placedGlyphBoxes,cs&&cs.box&&cs.box.length)){Ve=!0,ht=Bl.shift;break}}return cs};dn(()=>en(wn,ye.iconBox,l.WritingMode.horizontal),()=>{const Qt=ye.verticalTextBox;return Qt&&Kn(Qt),g.allowVerticalPlacement&&!(ft&&ft.box&&ft.box.length)&&Ee.numVerticalGlyphVertices>0&&Qt?en(Qt,ye.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),ft&&(Ve=ft.box,ct=ft.offscreen);const Bn=Jt(ft&&ft.box);if(!Ve&&this.prevPlacement){const Qt=this.prevPlacement.variableOffsets[Ee.crossTileID];Qt&&(this.variableOffsets[Ee.crossTileID]=Qt,this.markUsedJustification(g,Qt.anchor,Ee,Bn))}}else{const Mt=(en,Bn)=>{const Qt=g.getSymbolInstanceTextSize($,Ee,this.transform.zoom,Ne),xi=this.collisionIndex.placeCollisionBox(Qt,en,new l.pointGeometry(0,0),J,P,T,X.predicate);return xi&&xi.box&&xi.box.length&&(this.markUsedOrientation(g,Bn,Ee),this.placedOrientations[Ee.crossTileID]=Bn),xi};dn(()=>Mt(wn,l.WritingMode.horizontal),()=>{const en=ye.verticalTextBox;return g.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&en?(Kn(en),Mt(en,l.WritingMode.vertical)):{box:null,offscreen:null}}),Jt(ft&&ft.box&&ft.box.length)}}if(at=ft,Ve=at&&at.box&&at.box.length>0,ct=at&&at.offscreen,Ee.useRuntimeCollisionCircles){const Jt=g.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex>=0?Ee.centerJustifiedTextSymbolIndex:Ee.verticalPlacedTextSymbolIndex),dn=l.evaluateSizeForFeature(g.textSizeData,$,Jt),Mt=x.get("text-padding");gt=this.collisionIndex.placeCollisionCircles(J,Jt,g.lineVertexArray,g.glyphOffsetArray,dn,T,C,I,p,re,X.predicate,Ee.collisionCircleDiameter*dn/l.ONE_EM,Mt,this.retainedQueryData[g.bucketInstanceId].tileID),Ve=J||gt.circles.length>0&&!gt.collisionDetected,ct=ct&&gt.offscreen}if(ye.iconFeatureIndex&&($n=ye.iconFeatureIndex),ye.iconBox){const Jt=dn=>{Kn(dn);const Mt=we&&ht?go(ht.x,ht.y,Q,re,this.transform.angle):new l.pointGeometry(0,0),en=g.getSymbolInstanceIconSize(U,this.transform.zoom,Ne);return this.collisionIndex.placeCollisionBox(en,dn,Mt,j,P,T,X.predicate)};mt&&mt.box&&mt.box.length&&ye.verticalIconBox?(Ut=Jt(ye.verticalIconBox),et=Ut.box.length>0):(Ut=Jt(ye.iconBox),et=Ut.box.length>0),ct=ct&&Ut.offscreen}const wr=N||Ee.numHorizontalGlyphVertices===0&&Ee.numVerticalGlyphVertices===0,lr=H||Ee.numIconVertices===0;if(wr||lr?lr?wr||(et=et&&Ve):Ve=et&&Ve:et=Ve=et&&Ve,Ve&&at&&at.box&&this.collisionIndex.insertCollisionBox(at.box,x.get("text-ignore-placement"),g.bucketInstanceId,mt&&mt.box&&Ln?Ln:xn,X.ID),et&&Ut&&this.collisionIndex.insertCollisionBox(Ut.box,x.get("icon-ignore-placement"),g.bucketInstanceId,$n,X.ID),gt&&(Ve&&this.collisionIndex.insertCollisionCircles(gt.circles,x.get("text-ignore-placement"),g.bucketInstanceId,xn,X.ID),p)){const Jt=g.bucketInstanceId;let dn=this.collisionCircleArrays[Jt];dn===void 0&&(dn=this.collisionCircleArrays[Jt]=new Mi);for(let Mt=0;Mt<gt.circles.length;Mt+=4)dn.circles.push(gt.circles[Mt+0]),dn.circles.push(gt.circles[Mt+1]),dn.circles.push(gt.circles[Mt+2]),dn.circles.push(gt.collisionDetected?1:0)}this.placements[Ee.crossTileID]=new Nn(Ve||Se,et||Ce,ct||g.justReloaded),a[Ee.crossTileID]=!0};if(xe){const Ee=g.getSortedSymbolIndexes(this.transform.angle);for(let Ne=Ee.length-1;Ne>=0;--Ne){const ye=Ee[Ne];Ue(g.symbolInstances.get(ye),ye,g.collisionArrays[ye])}}else for(let Ee=t.symbolInstanceStart;Ee<t.symbolInstanceEnd;Ee++)Ue(g.symbolInstances.get(Ee),Ee,g.collisionArrays[Ee]);if(p&&g.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[g.bucketInstanceId];l.invert(Ee.invProjMatrix,T),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(t,a,p,m){let g;g=m===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(a)];const x=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const T of x)T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=g>=0&&T!==g?0:p.crossTileID)}markUsedOrientation(t,a,p){const m=a===l.WritingMode.horizontal||a===l.WritingMode.horizontalOnly?a:0,g=a===l.WritingMode.vertical?a:0,x=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const T of x)t.text.placedSymbolArray.get(T).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(t):1,g=a?a.opacities:{},x=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const C in this.placements){const I=this.placements[C],M=g[C];M?(this.opacities[C]=new _o(M,m,I.text,I.icon,null,I.clipped),p=p||I.text!==M.text.placed||I.icon!==M.icon.placed):(this.opacities[C]=new _o(null,m,I.text,I.icon,I.skipFade,I.clipped),p=p||I.text||I.icon)}for(const C in g){const I=g[C];if(!this.opacities[C]){const M=new _o(I,m,!1,!1);M.isHidden()||(this.opacities[C]=M,p=p||I.text.placed||I.icon.placed)}}for(const C in x)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=x[C]);for(const C in T)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=T[C]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const p={};for(const m of a){const g=m.getBucket(t);g&&m.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,p,m.collisionBoxArray)}}updateBucketOpacities(t,a,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,g=!!t.layers[0].dynamicFilter(),x=new _o(null,0,!1,!1,!0),T=m.get("text-allow-overlap"),C=m.get("icon-allow-overlap"),I=m.get("text-variable-anchor"),M=m.get("text-rotation-alignment")==="map",P=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",V=new _o(null,0,T&&(C||!t.hasIconData()||m.get("icon-optional")),C&&(T||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const $=(U,X,N)=>{for(let H=0;H<X/4;H++)U.opacityVertexArray.emplaceBack(N)};for(let U=0;U<t.symbolInstances.length;U++){const X=t.symbolInstances.get(U),{numHorizontalGlyphVertices:N,numVerticalGlyphVertices:H,crossTileID:J}=X;let j=this.opacities[J];a[J]?j=x:j||(j=V,this.opacities[J]=j),a[J]=!0;const Q=X.numIconVertices>0,re=this.placedOrientations[X.crossTileID],we=re===l.WritingMode.vertical,xe=re===l.WritingMode.horizontal||re===l.WritingMode.horizontalOnly;if(N>0||H>0){const Se=jc(j.text);$(t.text,N,we?Vn:Se),$(t.text,H,xe?Vn:Se);const Ce=j.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(Ne=>{Ne>=0&&(t.text.placedSymbolArray.get(Ne).hidden=Ce||we?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=Ce||xe?1:0);const Ue=this.variableOffsets[X.crossTileID];Ue&&this.markUsedJustification(t,Ue.anchor,X,re);const Ee=this.placedOrientations[X.crossTileID];Ee&&(this.markUsedJustification(t,"left",X,Ee),this.markUsedOrientation(t,Ee,X))}if(Q){const Se=jc(j.icon);X.placedIconSymbolIndex>=0&&($(t.icon,X.numIconVertices,we?Vn:Se),t.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=j.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&($(t.icon,X.numVerticalIconVertices,xe?Vn:Se),t.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=j.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Se=t.collisionArrays[U];if(Se){let Ce=new l.pointGeometry(0,0),Ue=!0;if(Se.textBox||Se.verticalTextBox){if(I){const Ne=this.variableOffsets[J];Ne?(Ce=_n(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),M&&Ce._rotate(P?this.transform.angle:-this.transform.angle)):Ue=!1}g&&(Ue=!j.clipped),Se.textBox&&vn(t.textCollisionBox.collisionVertexArray,j.text.placed,!Ue||we,Ce.x,Ce.y),Se.verticalTextBox&&vn(t.textCollisionBox.collisionVertexArray,j.text.placed,!Ue||xe,Ce.x,Ce.y)}const Ee=Ue&&Boolean(!xe&&Se.verticalIconBox);Se.iconBox&&vn(t.iconCollisionBox.collisionVertexArray,j.icon.placed,Ee,F?Ce.x:0,F?Ce.y:0),Se.verticalIconBox&&vn(t.iconCollisionBox.collisionVertexArray,j.icon.placed,!Ee,F?Ce.x:0,F?Ce.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const U=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=U.invProjMatrix,t.placementViewportMatrix=U.viewportMatrix,t.collisionCircleArray=U.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function vn(h,t,a,p,m){h.emplaceBack(t?1:0,a?1:0,p||0,m||0),h.emplaceBack(t?1:0,a?1:0,p||0,m||0),h.emplaceBack(t?1:0,a?1:0,p||0,m||0),h.emplaceBack(t?1:0,a?1:0,p||0,m||0)}const Vc=Math.pow(2,25),qi=Math.pow(2,24),Ks=Math.pow(2,17),el=Math.pow(2,16),jf=Math.pow(2,9),Rr=Math.pow(2,8),$f=Math.pow(2,1);function jc(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,a=Math.floor(127*h.opacity);return a*Vc+t*qi+a*Ks+t*el+a*jf+t*Rr+a*$f+t}const Vn=0;class tl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,p,m,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(x,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((T,C)=>T.sortKey-C.sortKey));this._currentPartIndex<x.length;){const T=x[this._currentPartIndex];if(a.placeLayerBucketPart(T,this._seenCrossTileIDs,p,T.symbolInstanceStart===0),this._currentPartIndex++,g())return!0}return!1}}class Fr{constructor(t,a,p,m,g,x,T,C){this.placement=new yo(t,g,x,T,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,a,p){const m=l.exported.now(),g=()=>{const x=l.exported.now()-m;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=a[t[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=T)&&(!x.maxzoom||x.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new tl(x)),this._inProgressLayer.continuePlacement(p[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const $c=512/l.EXTENT/2;class nl{constructor(t,a,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let m=0;m<a.length;m++){const g=a.get(m),x=g.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,a){const p=$c/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*l.EXTENT+t.tileAnchorX)*p),y:Math.floor((a.canonical.y*l.EXTENT+t.tileAnchorY)*p)}}findMatches(t,a,p){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const T=this.indexedSymbolInstances[x.key];if(!T)continue;const C=this.getScaledCoordinates(x,a);for(const I of T)if(Math.abs(I.coord.x-C.x)<=m&&Math.abs(I.coord.y-C.y)<=m&&!p[I.crossTileID]){p[I.crossTileID]=!0,x.crossTileID=I.crossTileID;break}}}}class Gf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const p in this.indexes){const m=this.indexes[p],g={};for(const x in m){const T=m[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),g[T.tileID.key]=T}this.indexes[p]=g}this.lng=t}addBucket(t,a,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const T in x){const C=x[T];C.tileID.isChildOf(t)&&C.findMatches(a.symbolInstances,t,m)}else{const T=x[t.scaledTo(Number(g)).key];T&&T.findMatches(a.symbolInstances,t,m)}}for(let g=0;g<a.symbolInstances.length;g++){const x=a.symbolInstances.get(g);x.crossTileID||(x.crossTileID=p.generate(),m[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new nl(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const p in a.indexedSymbolInstances)for(const m of a.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let a=!1;for(const p in this.indexes){const m=this.indexes[p];for(const g in m)t[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[g]),delete m[g],a=!0)}return a}}class il{constructor(){this.layerIndexes={},this.crossTileIDs=new Gf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,p){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Zf);let g=!1;const x={};m.handleWrapJump(p);for(const T of a){const C=T.getBucket(t);C&&t.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(T.tileID,C,this.crossTileIDs)&&(g=!0),x[C.bucketInstanceId]=!0)}return m.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const a={};t.forEach(p=>{a[p]=!0});for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}const rl=(h,t)=>l.emitValidationErrors(h,t&&t.filter(a=>a.identifier!=="source.canvas")),Hh=l.pick(je,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),qf=l.pick(je,["setCenter","setZoom","setBearing","setPitch"]),Yh=function(){const h={},t=l.spec.$version;for(const a in l.spec.$root){const p=l.spec.$root[a];if(p.required){let m=null;m=a==="version"?t:p.type==="array"?[]:{},m!=null&&(h[a]=m)}}return h}(),Wf={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Pi extends l.Evented{constructor(t,a={}){super(),this.map=t,this.dispatcher=new Si(Ge(),this),this.imageManager=new pt,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(t._requestManager,a.localFontFamily?l.LocalGlyphMode.all:a.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new l.LineAtlas(256,512),this.crossTileSymbolIndex=new il,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=Pi.registerForPluginStateChange(m=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(g,x)=>{if(l.triggerPluginCompletionEvent(g),x&&x.every(T=>T))for(const T in p._sourceCaches){const C=p._sourceCaches[T],I=C.getSource().type;I!=="vector"&&I!=="geojson"||C.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getSource(m.sourceId);if(g&&g.vectorLayerIds)for(const x in this._layers){const T=this._layers[x];T.source===g.id&&this._validateLayer(T)}})}loadURL(t,a={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof a.validate=="boolean"?a.validate:!l.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,a.accessToken);const m=this.map._requestManager.transformRequest(t,l.ResourceType.Style);this._request=l.getJSON(m,(g,x)=>{this._request=null,g?this.fire(new l.ErrorEvent(g)):x&&this._load(x,p)})}loadJSON(t,a={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Yh,!1)}_updateLayerCount(t,a){const p=a?1:-1;t.is3D()&&(this._num3DLayers+=p),t.type==="circle"&&(this._numCircleLayers+=p),t.type==="symbol"&&(this._numSymbolLayers+=p)}_load(t,a){if(a&&rl(this,l.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this.updateProjection();for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const p=it(this.stylesheet.layers);this._order=p.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of p)m=l.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new tn(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const t=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),t){this.map.painter.clearBackgroundTiles();for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles();this.map._update(!0)}}_loadSprite(t){this._spriteRequest=function(a,p,m){let g,x,T;const C=l.exported.devicePixelRatio>1?"@2x":"";let I=l.getJSON(p.transformRequest(p.normalizeSpriteURL(a,C,".json"),l.ResourceType.SpriteJSON),(F,V)=>{I=null,T||(T=F,g=V,P())}),M=l.getImage(p.transformRequest(p.normalizeSpriteURL(a,C,".png"),l.ResourceType.SpriteImage),(F,V)=>{M=null,T||(T=F,x=V,P())});function P(){if(T)m(T);else if(g&&x){const F=l.exported.getImageData(x),V={};for(const $ in g){const{width:U,height:X,x:N,y:H,sdf:J,pixelRatio:j,stretchX:Q,stretchY:re,content:we}=g[$],xe=new l.RGBAImage({width:U,height:X});l.RGBAImage.copy(F,xe,{x:N,y:H},{x:0,y:0},{width:U,height:X}),V[$]={data:xe,pixelRatio:j,sdf:J,stretchX:Q,stretchY:re,content:we}}m(null,V)}}return{cancel(){I&&(I.cancel(),I=null),M&&(M.cancel(),M=null)}}}(t,this.map._requestManager,(a,p)=>{if(this._spriteRequest=null,a)this.fire(new l.ErrorEvent(a));else if(p)for(const m in p)this.imageManager.addImage(m,p[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(t){const a=this.getSource(t.source);if(!a)return;const p=t.sourceLayer;p&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const a=[];for(const p of t){const m=this._layers[p];m.type!=="custom"&&a.push(m.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Wf[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(m.length||g.length)&&this._updateWorkerLayers(m,g);for(const x in this._updatedSources){const T=this._updatedSources[x];T==="reload"?this._reloadSource(x):T==="clear"&&this._clearSource(x)}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const p={};for(const m in this._sourceCaches){const g=this._sourceCaches[m];p[m]=g.used,g.used=!1}for(const m of this._order){const g=this._layers[m];if(g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)){const T=this._getLayerSourceCache(g);T&&(T.used=!0)}const x=this.map.painter;if(x){const T=g.getProgramIds();if(!T)continue;const C=g.getProgramConfiguration(t.zoom);for(const I of T)x.useProgram(I,C)}}for(const m in p){const g=this._sourceCaches[m];p[m]!==g.used&&g.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),rl(this,l.validateStyle(t)))return!1;(t=l.clone$2(t)).layers=it(t.layers);const a=function(m,g){if(!m)return[{command:je.setStyle,args:[g]}];let x=[];try{if(!he(m.version,g.version))return[{command:je.setStyle,args:[g]}];he(m.center,g.center)||x.push({command:je.setCenter,args:[g.center]}),he(m.zoom,g.zoom)||x.push({command:je.setZoom,args:[g.zoom]}),he(m.bearing,g.bearing)||x.push({command:je.setBearing,args:[g.bearing]}),he(m.pitch,g.pitch)||x.push({command:je.setPitch,args:[g.pitch]}),he(m.sprite,g.sprite)||x.push({command:je.setSprite,args:[g.sprite]}),he(m.glyphs,g.glyphs)||x.push({command:je.setGlyphs,args:[g.glyphs]}),he(m.transition,g.transition)||x.push({command:je.setTransition,args:[g.transition]}),he(m.light,g.light)||x.push({command:je.setLight,args:[g.light]}),he(m.fog,g.fog)||x.push({command:je.setFog,args:[g.fog]}),he(m.projection,g.projection)||x.push({command:je.setProjection,args:[g.projection]});const T={},C=[];(function(P,F,V,$){let U;for(U in F=F||{},P=P||{})P.hasOwnProperty(U)&&(F.hasOwnProperty(U)||Te(U,V,$));for(U in F)F.hasOwnProperty(U)&&(P.hasOwnProperty(U)?he(P[U],F[U])||(P[U].type==="geojson"&&F[U].type==="geojson"&&Ot(P,F,U)?V.push({command:je.setGeoJSONSourceData,args:[U,F[U].data]}):St(U,F,V,$)):ce(U,F,V))})(m.sources,g.sources,C,T);const I=[];m.layers&&m.layers.forEach(P=>{T[P.source]?x.push({command:je.removeLayer,args:[P.id]}):I.push(P)});let M=m.terrain;M&&T[M.source]&&(x.push({command:je.setTerrain,args:[void 0]}),M=void 0),x=x.concat(C),he(M,g.terrain)||x.push({command:je.setTerrain,args:[g.terrain]}),function(P,F,V){F=F||[];const $=(P=P||[]).map(At),U=F.map(At),X=P.reduce(zt,{}),N=F.reduce(zt,{}),H=$.slice(),J=Object.create(null);let j,Q,re,we,xe,Se,Ce;for(j=0,Q=0;j<$.length;j++)re=$[j],N.hasOwnProperty(re)?Q++:(V.push({command:je.removeLayer,args:[re]}),H.splice(H.indexOf(re,Q),1));for(j=0,Q=0;j<U.length;j++)re=U[U.length-1-j],H[H.length-1-j]!==re&&(X.hasOwnProperty(re)?(V.push({command:je.removeLayer,args:[re]}),H.splice(H.lastIndexOf(re,H.length-Q),1)):Q++,Se=H[H.length-j],V.push({command:je.addLayer,args:[N[re],Se]}),H.splice(H.length-j,0,re),J[re]=!0);for(j=0;j<U.length;j++)if(re=U[j],we=X[re],xe=N[re],!J[re]&&!he(we,xe))if(he(we.source,xe.source)&&he(we["source-layer"],xe["source-layer"])&&he(we.type,xe.type)){for(Ce in _t(we.layout,xe.layout,V,re,null,je.setLayoutProperty),_t(we.paint,xe.paint,V,re,null,je.setPaintProperty),he(we.filter,xe.filter)||V.push({command:je.setFilter,args:[re,xe.filter]}),he(we.minzoom,xe.minzoom)&&he(we.maxzoom,xe.maxzoom)||V.push({command:je.setLayerZoomRange,args:[re,xe.minzoom,xe.maxzoom]}),we)we.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?_t(we[Ce],xe[Ce],V,re,Ce.slice(6),je.setPaintProperty):he(we[Ce],xe[Ce])||V.push({command:je.setLayerProperty,args:[re,Ce,xe[Ce]]}));for(Ce in xe)xe.hasOwnProperty(Ce)&&!we.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?_t(we[Ce],xe[Ce],V,re,Ce.slice(6),je.setPaintProperty):he(we[Ce],xe[Ce])||V.push({command:je.setLayerProperty,args:[re,Ce,xe[Ce]]}))}else V.push({command:je.removeLayer,args:[re]}),Se=H[H.lastIndexOf(re)+1],V.push({command:je.addLayer,args:[xe,Se]})}(I,g.layers,x)}catch(T){console.warn("Unable to compute style diff:",T),x=[{command:je.setStyle,args:[g]}]}return x}(this.serialize(),t).filter(m=>!(m.command in qf));if(a.length===0)return!1;const p=a.filter(m=>!(m.command in Hh));if(p.length>0)throw new Error(`Unimplemented: ${p.map(m=>m.command).join(", ")}.`);return a.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,!0}addImage(t,a){if(this.getImage(t))return this.fire(new l.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,a,p={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.validateStyle.source,`sources.${t}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=R(t,a,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:t}));const g=x=>{const T=(x?"symbol:":"other:")+t,C=this._sourceCaches[T]=new l.SourceCache(T,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[t]=C,C.style=this,C.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const a=this.getSource(t);if(a===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new l.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new l.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(t);for(const m of p)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getSource(t).setData(a),this._changed=!0}getSource(t){const a=this._getSourceCache(t);return a&&a.getSource()}addLayer(t,a,p={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(t.type==="custom"){if(rl(this,l.validateCustomStyleLayer(t)))return;g=l.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=l.clone$2(t),t=l.extend(t,{source:m})),this._validate(l.validateStyle.layer,`layers.${m}`,t,{arrayIndex:-1},p))return;g=l.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[g.id]=g.serialize(),this._updateLayerCount(g,!0)}const x=a?this._order.indexOf(a):this._order.length;if(a&&x===-1)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const T=this._getLayerSourceCache(g);if(this._removedLayers[m]&&g.source&&T&&g.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",T.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const p=this._order.indexOf(t);this._order.splice(p,1);const m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new l.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,p){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===a&&m.maxzoom===p||(a!=null&&(m.minzoom=a),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,a,p={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!he(m.filter,a))return a==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(l.validateStyle.filter,`layers.${m.id}.filter`,a,{layerType:m.type},p)||(m.filter=l.clone$2(a),this._updateLayer(m)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return l.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,a,p,m={}){this._checkLoaded();const g=this.getLayer(t);g?he(g.getLayoutProperty(a),p)||(g.setLayoutProperty(a,p,m),this._updateLayer(g)):this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,a){const p=this.getLayer(t);if(p)return p.getLayoutProperty(a);this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,a,p,m={}){this._checkLoaded();const g=this.getLayer(t);g?he(g.getPaintProperty(a),p)||(g.setPaintProperty(a,p,m)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const p=t.source,m=t.sourceLayer,g=this.getSource(p);if(g===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=g.type;if(x==="geojson"&&m)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(p);for(const C of T)C.setFeatureState(m,t.id,a)}removeFeatureState(t,a){this._checkLoaded();const p=t.source,m=this.getSource(p);if(m===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const g=m.type,x=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!x)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(p);for(const C of T)C.removeFeatureState(x,t.id,a)}getFeatureState(t){this._checkLoaded();const a=t.source,p=t.sourceLayer,m=this.getSource(a);if(m!==void 0){if(m.type!=="vector"||p)return t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(p,t.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const a in this._sourceCaches){const p=this._sourceCaches[a].getSource();t[p.id]||(t[p.id]=p.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const a=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",a.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=x=>this._layers[x].type==="fill-extrusion",p={},m=[];for(let x=this._order.length-1;x>=0;x--){const T=this._order[x];if(a(T)){p[T]=x;for(const C of t){const I=C[T];if(I)for(const M of I)m.push(M)}}}m.sort((x,T)=>T.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const T=this._order[x];if(a(T))for(let C=m.length-1;C>=0;C--){const I=m[C].feature;if(p[I.layer.id]<x)break;g.push(I),m.pop()}else for(const C of t){const I=C[T];if(I)for(const M of I)g.push(M.feature)}}return g}queryRenderedFeatures(t,a,p){a&&a.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",a.filter,null,a);const m={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of a.layers){const I=this._layers[C];if(!I)return this.fire(new l.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[I.source]=!0}}const g=[];a.availableImages=this._availableImages;const x=a&&a.layers?a.layers.some(C=>{const I=this.getLayer(C);return I&&I.is3D()}):this.has3DLayers(),T=ut.createFromScreenPoints(t,p);for(const C in this._sourceCaches){const I=this._sourceCaches[C].getSource().id;a.layers&&!m[I]||g.push(Y(this._sourceCaches[C],this._layers,this._serializedLayers,T,a,p,x,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(C,I,M,P,F,V,$){const U={},X=V.queryRenderedSymbols(P),N=[];for(const H of Object.keys(X).map(Number))N.push($[H]);N.sort(me);for(const H of N){const J=H.featureIndex.lookupSymbolFeatures(X[H.bucketInstanceId],I,H.bucketIndex,H.sourceLayerIndex,F.filter,F.layers,F.availableImages,C);for(const j in J){const Q=U[j]=U[j]||[],re=J[j];re.sort((we,xe)=>{const Se=H.featureSortOrder;if(Se){const Ce=Se.indexOf(we.featureIndex);return Se.indexOf(xe.featureIndex)-Ce}return xe.featureIndex-we.featureIndex});for(const we of re)Q.push(we)}}for(const H in U)U[H].forEach(J=>{const j=J.feature,Q=M(C[H]).getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=Q});return U}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,a){a&&a.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",a.filter,null,a);const p=this._getSourceCaches(t);let m=[];for(const g of p)m=m.concat(ie(g,a));return m}addSourceType(t,a,p){return Pi.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(Pi.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const x in t)if(!he(t[x],p[x])){m=!0;break}if(!m)return;const g={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(g)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(typeof t.source=="object"){const a="terrain-dem-src";this.addSource(a,t.source),t=l.clone$2(t),t=l.extend(t,{source:a})}if(!this._validate(l.validateStyle.terrain,"terrain",t)){if(this.terrain){const a=this.terrain,p=a.get();for(const m in t)if(!he(t[m],p[m])){a.set(t),this.stylesheet.terrain=t;const g={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(g);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const a=this.fog=new _i(t,this.map.transform);this.stylesheet.fog=t;const p={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,p=a.get();for(const m in t)if(!he(t[m],p[m])){a.set(t),this.stylesheet.fog=t;const g={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(g);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(p=>this.isLayerDraped(this._layers[p])),a=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t){const a=this.terrain=new rr(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const p={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_validate(t,a,p,m,g={}){return(!g||g.validate!==!1)&&rl(this,t.call(l.validateStyle,l.extend({key:a,style:this.serialize(),value:p,styleSpec:l.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const a=this._getSourceCaches(t);for(const p of a)p.clearTiles()}_reloadSource(t){const a=this._getSourceCaches(t);for(const p of a)p.resume(),p.reload()}_updateSources(t){for(const a in this._sourceCaches)this._sourceCaches[a].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,p,m,g=!1){let x=!1,T=!1;const C={};for(const I of this._order){const M=this._layers[I];if(M.type!=="symbol")continue;if(!C[M.source]){const F=this._getLayerSourceCache(M);if(!F)continue;C[M.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,$)=>$.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan($.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(M,C[M.source],t.center.lng);x=x||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),g=g||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),t.zoom))&&(this.pauseablePlacement=new Fr(t,this._order,g,a,p,m,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),T=!0),x&&this.pauseablePlacement.placement.setStale()),T||x)for(const I of this._order){const M=this._layers[I];M.type==="symbol"&&this.placement.updateLayerOpacities(M,C[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,p){this.imageManager.getImages(a.icons,p),this._updateTilesForChangedImages();const m=g=>{g&&g.setDependencies(a.tileID.key,a.type,a.icons)};m(this._otherSourceCaches[a.source]),m(this._symbolSourceCaches[a.source])}getGlyphs(t,a,p){this.glyphManager.getGlyphs(a.stacks,p)}getResource(t,a,p){return l.makeRequest(a,p)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}Pi.getSourceType=function(h){return z[h]},Pi.setSourceType=function(h,t){z[h]=t},Pi.registerForPluginStateChange=l.registerForPluginStateChange;var Gc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Zc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Js={},Xo={};Js=kt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else 
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Xo=kt(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Or=kt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ho=Gc;var ol={background:kt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:kt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:kt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:kt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:kt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:kt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:kt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:kt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zc),skyboxGradient:kt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zc),skyboxCapture:kt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:kt(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:kt(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:kt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function kt(h,t,a){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,g=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x=h.match(m),T=t.match(m),C=Gc.match(m);let I=T?T.concat(x):x;a||(Js.staticUniforms&&(I=Js.staticUniforms.concat(I)),Xo.staticUniforms&&(I=Xo.staticUniforms.concat(I))),I&&(I=I.concat(C));const M={};return{fragmentSource:h=h.replace(p,(P,F,V,$,U)=>(M[U]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${V} ${$} ${U};
#else
uniform ${V} ${$} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${V} ${$} ${U} = u_${U};
#endif
`)),vertexSource:t=t.replace(p,(P,F,V,$,U)=>{const X=$==="float"?"vec2":"vec4",N=U.match(/color/)?"color":X;return M[U]?F==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${V} ${X} a_${U};
varying ${V} ${$} ${U};
#else
uniform ${V} ${$} u_${U};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${V} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${N}(a_${U}, u_${U}_t);
#else
    ${V} ${$} ${U} = u_${U};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${V} ${X} a_${U};
#else
uniform ${V} ${$} u_${U};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${V} ${$} ${U} = a_${U};
#else
    ${V} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${V} ${$} ${U} = unpack_mix_${N}(a_${U}, u_${U}_t);
#else
    ${V} ${$} ${U} = u_${U};
#endif
`}),staticAttributes:g,staticUniforms:I}}class sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,p,m,g,x,T,C){this.context=t;let I=this.boundPaintVertexBuffers.length!==m.length;for(let M=0;!I&&M<m.length;M++)this.boundPaintVertexBuffers[M]!==m[M]&&(I=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===p&&!I&&this.boundIndexBuffer===g&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===C?(t.bindVertexArrayOES.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),C&&C.bind()):this.freshBind(a,p,m,g,x,T,C)}freshBind(t,a,p,m,g,x,T){let C;const I=t.numAttributes,M=this.context,P=M.gl;if(M.extVertexArrayObject)this.vao&&this.destroy(),this.vao=M.extVertexArrayObject.createVertexArrayOES(),M.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=T;else{C=M.currentNumAttributes||0;for(let F=I;F<C;F++)P.disableVertexAttribArray(F)}a.enableAttributes(P,t);for(const F of p)F.enableAttributes(P,t);x&&x.enableAttributes(P,t),T&&T.enableAttributes(P,t),a.bind(),a.setVertexAttribPointers(P,t,g);for(const F of p)F.bind(),F.setVertexAttribPointers(P,t,g);x&&(x.bind(),x.setVertexAttribPointers(P,t,g)),m&&m.bind(),T&&(T.bind(),T.setVertexAttribPointers(P,t,g)),M.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function al(h,t){const a=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new l.MercatorCoordinate(0,p/a).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/a).toLngLat().lat]}function qc(h,t,a,p,m,g,x){const T=h.context,C=T.gl,I=a.fbo;if(!I)return;h.prepareDrawTile(t);const M=h.useProgram("hillshade");T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,I.colorAttachment.get());const P=((U,X,N,H)=>{const J=N.paint.get("hillshade-shadow-color"),j=N.paint.get("hillshade-highlight-color"),Q=N.paint.get("hillshade-accent-color");let re=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=U.transform.angle);const we=!U.options.moving;return{u_matrix:H||U.transform.calculateProjMatrix(X.tileID.toUnwrapped(),we),u_image:0,u_latrange:al(0,X.tileID),u_light:[N.paint.get("hillshade-exaggeration"),re],u_shadow:J,u_highlight:j,u_accent:Q}})(h,a,p,h.terrain?t.projMatrix:null);h.prepareDrawProgram(T,M,t.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:$}=h.getTileBoundsBuffers(a);M.draw(T,C.TRIANGLES,m,g,x,l.CullFaceMode.disabled,P,p.id,F,V,$)}function Qs(h,t,a){if(!t.needsDEMTextureUpload)return;const p=h.context,m=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(a.stride);const g=a.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new l.Texture(p,g,m.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ea(h,t,a,p,m,g){const x=h.context,T=x.gl;if(!t.dem)return;const C=t.dem;if(x.activeTexture.set(T.TEXTURE1),Qs(h,t,C),!t.demTexture)return;t.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const I=C.dim;x.activeTexture.set(T.TEXTURE0);let M=t.fbo;if(!M){const $=new l.Texture(x,{width:I,height:I,data:null},T.RGBA);$.bind(T.LINEAR,T.CLAMP_TO_EDGE),M=t.fbo=x.createFramebuffer(I,I,!0),M.colorAttachment.set($.texture)}x.bindFramebuffer.set(M.framebuffer),x.viewport.set([0,0,I,I]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:F,tileBoundsSegments:V}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(x,T.TRIANGLES,p,m,g,l.CullFaceMode.disabled,(($,U)=>{const X=U.stride,N=l.create$1();return l.ortho(N,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(N,N,[0,-l.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[X,X],u_zoom:$.overscaledZ,u_unpack:U.unpackVector}})(t.tileID,C),a.id,P,F,V),t.needsHillshadePrepare=!1}const Bt=(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image0:new l.Uniform1i(h,t.u_image0),u_skirt_height:new l.Uniform1f(h,t.u_skirt_height)}),ta=(h,t)=>({u_matrix:h,u_image0:0,u_skirt_height:t}),ll=new class{constructor(){this.operations={}}newMorphing(h,t,a,p,m){if(h in this.operations){const g=this.operations[h];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[h]={startTime:p,phase:0,duration:m,from:t,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const a=this.operations[t];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Wc={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Kh(h,t){const a=1<<h.z;return!t&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const na=h=>({u_matrix:h});function Xc(h,t,a,p,m){if(m>0){const g=l.exported.now(),x=(g-h.timeAdded)/m,T=t?(g-t.timeAdded)/m:-1,C=a.getSource(),I=p.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(h.tileID.overscaledZ-I),P=M&&h.refreshedUponExpiration?1:l.clamp(M?x:1-T,0,1);return h.refreshedUponExpiration&&x>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-P}:{opacity:P,mix:0}}return{opacity:1,mix:0}}class Xf extends l.SourceCache{constructor(t){const a=R("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Si(Ge(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,p){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,x)=>{if(g[x.key]="",!this._tiles[x.key]){const T=new l.Tile(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);T.state="loaded",this._tiles[x.key]=T}return g},{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const p=Object.values(a);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Jh extends l.OverscaledTileID{constructor(t,a,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=p}}class Hc extends l.Elevation{constructor(t,a){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,m,g]=function(C){const I=new l.StructArrayLayout4i8,M=new l.StructArrayLayout3ui6,P=131;I.reserve(17161),M.reserve(33800);const F=l.EXTENT/128,V=l.EXTENT+F/2,$=V+F;for(let X=-F;X<$;X+=F)for(let N=-F;N<$;N+=F){const H=N<0||N>V||X<0||X>V?24575:0,J=l.clamp(Math.round(N),0,l.EXTENT),j=l.clamp(Math.round(X),0,l.EXTENT);I.emplaceBack(J+H,j,J,j)}const U=(X,N)=>{const H=N*P+X;M.emplaceBack(H+1,H,H+P),M.emplaceBack(H+P,H+P+1,H+1)};for(let X=1;X<129;X++)for(let N=1;N<129;N++)U(N,X);return[0,129].forEach(X=>{for(let N=0;N<130;N++)U(N,X),U(X,N)}),[I,M,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(p,l.boundsAttributes.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=l.SegmentVector.simpleSegment(0,0,p.length,m.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,p.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Xf(a.map),this.orthoMatrix=l.create$1(),l.ortho(this.orthoMatrix,0,l.EXTENT,0,l.EXTENT,0,1);const T=x.gl;this._overlapStencilMode=new l.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,a,p){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const m=t.terrain.properties;this.sourceCache=t._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const g=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const x=this.sourceCache.getSource().tileSize/128,T=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(a,x*T,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),a.updateElevation(!p),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&l.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=a.getIds().map(C=>{const I=a.getTileByID(C).tileID;return I.projMatrix=p.calculateProjMatrix(I.toUnwrapped()),I});(function(C,I){const M=I.transform.pointCoordinate(I.transform.getCameraPoint()),P=new l.pointGeometry(M.x,M.y);C.sort((F,V)=>{if(V.overscaledZ-F.overscaledZ)return V.overscaledZ-F.overscaledZ;const $=new l.pointGeometry(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),U=new l.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),X=P.mult(1<<F.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr($)-X.distSqr(U)})})(m,this.painter),this._previousZoom=p.zoom;const g=this.proxyToSource||{};this.proxyToSource={},m.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const x=this._style._sourceCaches;for(const C in x){const I=x[C];if(!I.used||(I!==this.sourceCache&&(this._findCoveringTileCache[I.id]={}),this._setupProxiedCoordsForOrtho(I,t[C],g),I.usedForTerrain))continue;const M=t[C];I.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[a.id]=m.map(C=>new Jh(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const T={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const I=this.terrainTileForTile[C.key];if(!I)continue;const M=I.tileID.key;M in T||(this._visibleDemTiles.push(I),T[M]=M)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const p=this._findTileCoveringTileID(a,this.sourceCache);p&&(this.terrainTileForTile[a.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const p in this.terrainTileForTile){const m=this.terrainTileForTile[p],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Qs(this.painter,m,g))}}_prepareDemTileUniforms(t,a,p,m){if(!a||a.demTexture==null)return!1;const g=t.tileID.canonical,x=Math.pow(2,a.tileID.canonical.z-g.z),T=m||"";return p[`u_dem_tl${T}`]=[g.x*x%1,g.y*x%1],p[`u_dem_scale${T}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const a=this._visibleDemTiles.reduce((p,m)=>{if(!m.dem)return p;const g=m.dem.tree.minimums[0];return g>0&&t++,p+g},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const p=this._getLoadedAreaMinimum(),m={width:1,height:1,data:new Uint8Array(l.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(m,{premultiply:!1}):g=this._emptyDEMTexture=new l.Texture(t,m,a.RGBA,{premultiply:!1}),g}setupElevationDraw(t,a,p){const m=this.painter.context,g=m.gl,x=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var T;x.u_dem_size=this.sourceCache.getSource().tileSize,x.u_exaggeration=this.exaggeration();let C=null,I=null,M=1;if(p&&p.morphing&&this._useVertexMorphing){const P=p.morphing.srcDemTile,F=p.morphing.dstDemTile;M=p.morphing.phase,P&&F&&(this._prepareDemTileUniforms(t,P,x,"_prev")&&(I=P),this._prepareDemTileUniforms(t,F,x)&&(C=F))}if(I&&C?(m.activeTexture.set(g.TEXTURE2),C.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),m.activeTexture.set(g.TEXTURE4),I.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),x.u_dem_lerp=M):(C=this.terrainTileForTile[t.tileID.key],m.activeTexture.set(g.TEXTURE2),(this._prepareDemTileUniforms(t,C,x)?C.demTexture:this.emptyDEMTexture).bind(g.NEAREST,g.CLAMP_TO_EDGE)),p&&p.useDepthForOcclusion&&(m.activeTexture.set(g.TEXTURE3),this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),p&&p.useMeterToDem&&C){const P=(1<<C.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=P}p&&p.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),a.setTerrainUniformValues(m,x)}renderToBackBuffer(t){const a=this.painter,p=this.painter.context;t.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),this.renderingToTexture=!1,function(m,g,x,T,C){const I=m.context,M=I.gl;let P,F;const V=m.options.showTerrainWireframe?2:0,$=(J,j)=>{if(F===J)return;const Q=[Wc[J]];j&&Q.push(Wc[V]),P=m.useProgram("terrainRaster",null,Q),F=J},U=m.colorModeForRenderPass(),X=new l.DepthMode(M.LEQUAL,l.DepthMode.ReadWrite,m.depthRangeFor3D);ll.update(C);const N=m.transform,H=6*Math.pow(1.5,22-N.zoom)*g.exaggeration();(V?[!1,!0]:[!1]).forEach(J=>{F=-1;const j=J?M.LINES:M.TRIANGLES,[Q,re]=J?g.getWirefameBuffer():[g.gridIndexBuffer,g.gridSegments];for(const Se of T){const Ce=x.getTile(Se),Ue=l.StencilMode.disabled,Ee=g.prevTerrainTileForTile[Se.key],Ne=g.terrainTileForTile[Se.key];xe=Ne,(we=Ee)!=null&&xe!=null&&we.hasData()&&xe.hasData()&&we.demTexture!=null&&xe.demTexture!=null&&we.tileID.key!==xe.tileID.key&&ll.newMorphing(Se.key,Ee,Ne,C,250),I.activeTexture.set(M.TEXTURE0),Ce.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const ye=ll.getMorphValuesForProxy(Se.key),Ve=ye?1:0;let et;ye&&(et={morphing:{srcDemTile:ye.from,dstDemTile:ye.to,phase:l.easeCubicInOut(ye.phase)}});const ct=ta(Se.projMatrix,Kh(Se.canonical,N.renderWorldCopies)?H/10:H);$(Ve,J),g.setupElevationDraw(Ce,P,et),m.prepareDrawProgram(I,P,Se.toUnwrapped()),P.draw(I,j,X,Ue,U,l.CullFaceMode.backCCW,ct,"terrain_raster",g.gridBuffer,Q,re)}var we,xe})}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,p=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),T=[],C=a.style.order;let I=0;for(const M of g){const P=m.getTileByID(M.proxyTileKey),F=m.proxyCachedFBO[M.key]?m.proxyCachedFBO[M.key][t]:void 0,V=F!==void 0?m.renderCache[F]:this.pool[I++],$=F!==void 0;if(P.texture=V.tex,$&&!V.dirty){T.push(P.tileID);continue}let U;p.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(p.clear({color:l.Color.transparent}),V.dirty=!1);for(let X=x.start;X<=x.end;++X){const N=a.style._layers[C[X]];if(N.isHidden(a.transform.zoom))continue;const H=a.style._getLayerSourceCache(N),J=H?this.proxyToSource[M.key][H.id]:[M];if(!J)continue;const j=J;p.viewport.set([0,0,V.fb.width,V.fb.height]),U!==(H?H.id:null)&&(this._setupStencil(V,J,N,H),U=H?H.id:null),a.renderLayer(a,H,N,j)}this.renderedToTile?(V.dirty=!0,T.push(P.tileID)):$||--I,I===5&&(I=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),x.end+1}postRender(){}renderCacheEfficiency(t){const a=t.order.length;if(a===0)return{efficiency:100};let p,m=0,g=0,x=!1;for(let T=0;T<a;++T){const C=t._layers[t.order[T]];this._style.isLayerDraped(C)?(x&&++m,++g):x||(x=!0,p=C.id)}return g===0?{efficiency:100}:{efficiency:100*(1-m/g),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,p){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const x=g.tileID,T=Math.pow(2,x.overscaledZ),{x:C,y:I}=x.canonical,M=C/T,P=(C+1)/T,F=I/T,V=(I+1)/T;return{minx:M,miny:F,maxx:P,maxy:V,t:g.dem.tree.raycastRoot(M,F,P,V,t,a,p),tile:g}});m.sort((g,x)=>(g.t!==null?g.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const g of m){if(g.t==null)return null;const x=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,a,p);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,a=t.gl,p=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const m=new l.Texture(t,{width:p[0],height:p[1],data:null},a.RGBA);m.bind(a.LINEAR,a.CLAMP_TO_EDGE);const g=t.createFramebuffer(p[0],p[1],!1);return g.colorAttachment.set(m.texture),g.depthAttachment=new vr(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._layers[t],p=a.isHidden(this.painter.transform.zoom),m=a.getCrossfadeParameters(),g=!!m&&m.t!==1,x=a.hasTransition();return a.type!=="custom"&&!p&&(g||x)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof ho){t=!0;break}if(t)for(let a=0;a<this._style.order.length;++a){const p=this._style._layers[this._style.order[a]],m=p.isHidden(this.painter.transform.zoom),g=this._style._getLayerSourceCache(p);if(p.type!=="raster"||m||!g)continue;const x=p.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][g.id];if(C)for(const I of C){const M=Xc(g.getTile(I),g.findLoadedParent(I,0),g,this.painter.transform,x);(M.opacity!==1||M.mix!==0)&&this._clearRenderCacheForTile(g.id,I)}}}}_setupDrapedRenderBatches(){const t=this._style.order,a=t.length;if(a===0)return;const p=[];let m,g=0,x=this._style._layers[t[g]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++g<a;)x=this._style._layers[t[g]];for(;g<a;++g){const T=this._style._layers[t[g]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?m===void 0&&(m=g):m!==void 0&&(p.push({start:m,end:g-1}),m=void 0))}m!==void 0&&p.push({start:m,end:g-1}),this._drapedRenderBatches=p}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const x=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<x.length;++T){const C=Object.values(x[T]);a.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,m=this._tilesDirty;for(let x=p.length-1;x>=0;x--){const T=p[x];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){const C=t[T.key],I=this.proxyToSource[T.key];let M=0;for(const P in I){const F=I[P],V=C[P];if(!V||V.length!==F.length||F.some(($,U)=>$!==V[U]||m[P]&&m[P].hasOwnProperty($.key))){M=-1;break}++M}for(const P in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][P]].dirty=M<0||M!==Object.values(C).length}}const g=[...this._drapedRenderBatches];g.sort((x,T)=>T.end-T.start-(x.end-x.start));for(const x of g)for(const T of p){if(a.proxyCachedFBO[T.key])continue;let C=a.renderCachePool.pop();C===void 0&&a.renderCache.length<50&&(C=a.renderCache.length,a.renderCache.push(this._createFBO())),C!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][x.start]=C,a.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,p,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,x=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(p.isTileClipped())T=a.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(t,a){const p=this.painter,m=this.painter.context,g=m.gl;p._tileClippingMaskIDs={},m.setColorMode(l.ColorMode.disabled),m.setDepthMode(l.DepthMode.disabled);const x=p.useProgram("clippingMask");for(const T of t){const C=p._tileClippingMaskIDs[T.key]=--a;x.draw(m,g.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,na(T.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const p=[t.x,t.y,1,1];l.transformMat4(p,p,a.pixelMatrixInverse),l.scale$2(p,p,1/p[3]),p[0]/=a.worldSize,p[1]/=a.worldSize;const m=a._camera.position,g=l.mercatorZfromAltitude(1,a.center.lat),x=[m[0],m[1],m[2]/g,0],T=l.subtract([],p.slice(0,3),x);l.normalize(T,T);const C=this.raycast(x,T,this._exaggeration);return C!==null&&C?(l.scaleAndAdd(x,x,T,C),x[3]=x[2],x[2]*=g,x):null}drawDepth(){const t=this.painter,a=t.context,p=this.proxySourceCache,m=Math.ceil(t.width),g=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===g||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const x=a.gl,T=a.createFramebuffer(m,g,!0);a.activeTexture.set(x.TEXTURE0);const C=new l.Texture(a,{width:m,height:g,data:null},x.RGBA);C.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.colorAttachment.set(C.texture);const I=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,m,g);T.depthAttachment.set(I),this._depthFBO=T,this._depthTexture=C}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,m,g]),function(x,T,C,I){const M=x.context,P=M.gl;M.clear({depth:1});const F=x.useProgram("terrainDepth"),V=new l.DepthMode(P.LESS,l.DepthMode.ReadWrite,x.depthRangeFor3D);for(const $ of I){const U=C.getTile($),X=ta($.projMatrix,0);T.setupElevationDraw(U,F),F.draw(M,P.TRIANGLES,V,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,X,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(t,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,a,p){if(t.getSource()instanceof q)return this._setupProxiedCoordsForImageSource(t,a,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let T=0;T<g.length;T++){const C=g[T],I=this._findTileCoveringTileID(C,t);if(I){const M=this._createProxiedId(C,I,p[C.key]&&p[C.key][t.id]);m.push(M),this.proxyToSource[C.key][t.id]=[M]}}let x=!1;for(let T=0;T<a.length;T++){const C=t.getTile(a[T]);if(!C||!C.hasData())continue;const I=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==C.tileID.canonical.z){const M=this.proxyToSource[I.tileID.key][t.id],P=this._createProxiedId(I.tileID,C,p[I.tileID.key]&&p[I.tileID.key][t.id]);M?M.splice(M.length-1,0,P):this.proxyToSource[I.tileID.key][t.id]=[P],m.push(P),x=!0}}this._sourceTilesOverlap[t.id]=x}_setupProxiedCoordsForImageSource(t,a,p){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords,x=t.getSource(),T=new l.pointGeometry(x.tileID.x,x.tileID.y)._div(1<<x.tileID.z),C=x.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((M,P)=>(M.min.x=Math.min(M.min.x,P.x-T.x),M.min.y=Math.min(M.min.y,P.y-T.y),M.max.x=Math.max(M.max.x,P.x-T.x),M.max.y=Math.max(M.max.y,P.y-T.y),M),{min:new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(M,P)=>{const F=M.wrap+M.canonical.x/(1<<M.canonical.z),V=M.canonical.y/(1<<M.canonical.z),$=l.EXTENT/(1<<M.canonical.z),U=P.wrap+P.canonical.x/(1<<P.canonical.z),X=P.canonical.y/(1<<P.canonical.z);return F+$<U+C.min.x||F>U+C.max.x||V+$<X+C.min.y||V>X+C.max.y};for(let M=0;M<g.length;M++){const P=g[M];for(let F=0;F<a.length;F++){const V=t.getTile(a[F]);if(!V||!V.hasData()||I(P,V.tileID))continue;const $=this._createProxiedId(P,V,p[P.key]&&p[P.key][t.id]),U=this.proxyToSource[P.key][t.id];U?U.push($):this.proxyToSource[P.key][t.id]=[$],m.push($)}}}_createProxiedId(t,a,p){let m=this.orthoMatrix;if(p){const g=p.find(x=>x.key===a.tileID.key);if(g)return g}if(a.tileID.key!==t.key){const g=t.canonical.z-a.tileID.canonical.z;let x,T,C;m=l.create$1();const I=a.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(x=l.EXTENT>>g,T=x*((a.tileID.canonical.x<<g)-t.canonical.x+I),C=x*((a.tileID.canonical.y<<g)-t.canonical.y)):(x=l.EXTENT<<-g,T=l.EXTENT*(a.tileID.canonical.x-(t.canonical.x+I<<-g)),C=l.EXTENT*(a.tileID.canonical.y-(t.canonical.y<<-g))),l.ortho(m,0,x,0,x,0,1),l.translate(m,m,[T,C,0])}return new Jh(a.tileID,t.key,m)}_findTileCoveringTileID(t,a){let p=a.getTile(t);if(p&&p.hasData())return p;const m=this._findCoveringTileCache[a.id],g=m[t.key];if(p=g?a.getTileByID(g):null,p&&p.hasData()||g===null)return p;let x=p?p.tileID:t,T=x.overscaledZ;const C=a.getSource().minzoom,I=[];if(!g){const P=a.getSource().maxzoom;if(t.canonical.z>=P){const F=t.canonical.z-P;a.getSource().reparseOverscaled?(T=Math.max(t.canonical.z+2,a.transform.tileZoom),x=new l.OverscaledTileID(T,t.wrap,P,t.canonical.x>>F,t.canonical.y>>F)):F!==0&&(T=P,x=new l.OverscaledTileID(T,t.wrap,P,t.canonical.x>>F,t.canonical.y>>F))}x.key!==t.key&&(I.push(x.key),p=a.getTile(x))}const M=P=>{I.forEach(F=>{m[F]=P}),I.length=0};for(T-=1;T>=C&&(!p||!p.hasData());T--){p&&M(p.tileID.key);const P=x.calculateScaledKey(T);if(p=a.getTileByID(P),p&&p.hasData())break;const F=m[P];if(F===null)break;F===void 0?I.push(P):p=a.getTileByID(F)}return M(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(a){let p,m,g;const x=new l.StructArrayLayout2ui4,T=131;for(m=1;m<129;m++){for(p=1;p<129;p++)g=m*T+p,x.emplaceBack(g,g+1),x.emplaceBack(g,g+T),x.emplaceBack(g+1,g+T),m===128&&x.emplaceBack(g+T,g+T+1);x.emplaceBack(g+1,g+1+T)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function cl(h){const t=[];for(let a=0;a<h.length;a++){if(h[a]===null)continue;const p=h[a].split(" ");t.push(p.pop())}return t}class ul{static cacheKey(t,a,p){let m=`${t}${p?p.cacheKey:""}`;for(const g of a)m+=`/${g}`;return m}constructor(t,a,p,m,g,x){const T=t.gl;this.program=T.createProgram();const C=cl(p.staticAttributes),I=m?m.getBinderAttributes():[],M=C.concat(I),P=p.staticUniforms?cl(p.staticUniforms):[],F=m?m.getBinderUniforms():[],V=P.concat(F),$=[];for(const Q of V)$.indexOf(Q)<0&&$.push(Q);let U=m?m.defines():[];U=U.concat(x.map(Q=>`#define ${Q}`));const X=U.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ho,Or.fragmentSource,Xo.fragmentSource,p.fragmentSource).join(`
`),N=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ho,Or.vertexSource,Xo.vertexSource,Js.vertexSource,p.vertexSource).join(`
`),H=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(H,X),T.compileShader(H),T.attachShader(this.program,H);const J=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(J,N),T.compileShader(J),T.attachShader(this.program,J),this.attributes={};const j={};this.numAttributes=M.length;for(let Q=0;Q<this.numAttributes;Q++)M[Q]&&(T.bindAttribLocation(this.program,Q,M[Q]),this.attributes[M[Q]]=Q);T.linkProgram(this.program),T.deleteShader(J),T.deleteShader(H);for(let Q=0;Q<$.length;Q++){const re=$[Q];if(re&&!j[re]){const we=T.getUniformLocation(this.program,re);we&&(j[re]=we)}}this.fixedUniforms=g(t,j),this.binderUniforms=m?m.getUniforms(t,j):[],x.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Q,re)=>({u_dem:new l.Uniform1i(Q,re.u_dem),u_dem_prev:new l.Uniform1i(Q,re.u_dem_prev),u_dem_unpack:new l.Uniform4f(Q,re.u_dem_unpack),u_dem_tl:new l.Uniform2f(Q,re.u_dem_tl),u_dem_scale:new l.Uniform1f(Q,re.u_dem_scale),u_dem_tl_prev:new l.Uniform2f(Q,re.u_dem_tl_prev),u_dem_scale_prev:new l.Uniform1f(Q,re.u_dem_scale_prev),u_dem_size:new l.Uniform1f(Q,re.u_dem_size),u_dem_lerp:new l.Uniform1f(Q,re.u_dem_lerp),u_exaggeration:new l.Uniform1f(Q,re.u_exaggeration),u_depth:new l.Uniform1i(Q,re.u_depth),u_depth_size_inv:new l.Uniform2f(Q,re.u_depth_size_inv),u_meter_to_dem:new l.Uniform1f(Q,re.u_meter_to_dem),u_label_plane_matrix_inv:new l.UniformMatrix4f(Q,re.u_label_plane_matrix_inv),u_tile_tl_up:new l.Uniform3f(Q,re.u_tile_tl_up),u_tile_tr_up:new l.Uniform3f(Q,re.u_tile_tr_up),u_tile_br_up:new l.Uniform3f(Q,re.u_tile_br_up),u_tile_bl_up:new l.Uniform3f(Q,re.u_tile_bl_up),u_tile_up_scale:new l.Uniform1f(Q,re.u_tile_up_scale)}))(t,j)),x.indexOf("FOG")!==-1&&(this.fogUniforms=((Q,re)=>({u_fog_matrix:new l.UniformMatrix4f(Q,re.u_fog_matrix),u_fog_range:new l.Uniform2f(Q,re.u_fog_range),u_fog_color:new l.Uniform4f(Q,re.u_fog_color),u_fog_horizon_blend:new l.Uniform1f(Q,re.u_fog_horizon_blend),u_fog_temporal_offset:new l.Uniform1f(Q,re.u_fog_temporal_offset)}))(t,j))}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in a)p[m].set(a[m])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in a)p[m].location&&p[m].set(a[m])}}draw(t,a,p,m,g,x,T,C,I,M,P,F,V,$,U,X){const N=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(m),t.setColorMode(g),t.setCullFace(x);for(const J in this.fixedUniforms)this.fixedUniforms[J].set(T[J]);$&&$.setUniforms(t,this.binderUniforms,F,{zoom:V});const H={[N.LINES]:2,[N.TRIANGLES]:3,[N.LINE_STRIP]:1}[a];for(const J of P.get()){const j=J.vaos||(J.vaos={});(j[C]||(j[C]=new sl)).bind(t,this,I,$?$.getPaintVertexBuffers():[],M,J.vertexOffset,U,X),N.drawElements(a,J.primitiveLength*H,N.UNSIGNED_SHORT,J.primitiveOffset*H*2)}}}function hl(h,t,a){const p=1/$e(a,1,t.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,t.transform.tileZoom)/m,x=g*(a.tileID.canonical.x+a.tileID.wrap*m),T=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[p,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[x>>16,T>>16],u_pixel_coord_lower:[65535&x,65535&T]}}const Yc=(h,t,a,p)=>{const m=t.style.light,g=m.properties.get("position"),x=[g.x,g.y,g.z],T=l.create$2();m.properties.get("anchor")==="viewport"&&(l.fromRotation(T,-t.transform.angle),l.transformMat3(x,x,T));const C=m.properties.get("color");return{u_matrix:h,u_lightpos:x,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+a,u_opacity:p}},Qh=(h,t,a,p,m,g,x)=>l.extend(Yc(h,t,a,p),hl(g,t,x),{u_height_factor:-Math.pow(2,m.overscaledZ)/x.tileSize/8}),ed=h=>({u_matrix:h}),Yo=(h,t,a,p)=>l.extend(ed(h),hl(a,t,p)),ia=(h,t)=>({u_matrix:h,u_world:t}),td=(h,t,a,p,m)=>l.extend(Yo(h,t,a,p),{u_world:m}),vi=(h,t,a,p)=>{const m=h.transform;let g;return g=p.paint.get("circle-pitch-alignment")==="map"?m.calculatePixelsToTileUnitsMatrix(a):new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]),{u_camera_to_center_distance:m.cameraToCenterDistance,u_matrix:h.translatePosMatrix(t.projMatrix,a,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:g}},Kc=h=>{const t=[];return h.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},dl=(h,t,a)=>{const p=l.EXTENT/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},ra=(h,t,a=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:a}),Jc=(h,t,a,p)=>({u_matrix:h,u_extrude_scale:$e(t,1,a),u_intensity:p}),Qc=(h,t,a,p,m,g)=>{const x=h.transform,T=x.calculatePixelsToTileUnitsMatrix(t),C={u_matrix:ml(h,t,a,m),u_pixels_to_tile_units:T,u_device_pixel_ratio:l.exported.devicePixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(eu(a)){const I=fl(t,h.transform);C.u_texsize=t.lineAtlasTexture.size,C.u_scale=[I,p.fromScale,p.toScale],C.u_mix=p.t}return C},pl=(h,t,a,p,m)=>{const g=h.transform,x=fl(t,g);return{u_matrix:ml(h,t,a,m),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:g.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:l.exported.devicePixelRatio,u_image:0,u_scale:[x,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}};function fl(h,t){return 1/$e(h,1,t.tileZoom)}function ml(h,t,a,p){return h.translatePosMatrix(p||t.tileID.projMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const _l=h=>{const t=[];return eu(h)&&t.push("RENDER_LINE_DASH"),h.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),t};function eu(h){const t=h.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const nd=(h,t,a,p,m)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(x=m.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=m.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Ko(m.paint.get("raster-hue-rotate"))};var g,x};function Ko(h){h*=Math.PI/180;const t=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const id=(h,t,a,p,m,g,x,T,C,I,M,P,F,V)=>{const $=m.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:$.width/$.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:T,u_is_text:+C,u_pitch_with_map:+p,u_texsize:I,u_tile_id:M,u_zoom_transition:P,u_inv_rot_matrix:F,u_merc_center:V,u_texture:0}},rd=(h,t,a,p,m,g,x,T,C,I,M,P,F,V,$)=>{const{cameraToCenterDistance:U,_pitch:X}=m.transform;return l.extend(id(h,t,a,p,m,g,x,T,C,I,P,F,V,$),{u_gamma_scale:p?U*Math.cos(m.terrain?0:X):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+M})},Hf=(h,t,a,p,m,g,x,T,C,I,M,P,F,V)=>l.extend(rd(h,t,a,p,m,g,x,T,!0,C,!0,M,P,F,V),{u_texsize_icon:I,u_texture_icon:1}),Yf=(h,t,a)=>({u_matrix:h,u_opacity:t,u_color:a}),Kf=(h,t,a,p,m,g)=>l.extend(function(x,T,C,I){const M=C.imageManager.getPattern(x.from.toString()),P=C.imageManager.getPattern(x.to.toString()),{width:F,height:V}=C.imageManager.getPixelSize(),$=Math.pow(2,I.tileID.overscaledZ),U=I.tileSize*Math.pow(2,C.transform.tileZoom)/$,X=U*(I.tileID.canonical.x+I.tileID.wrap*$),N=U*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[F,V],u_mix:T.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/$e(I,1,C.transform.tileZoom),u_pixel_coord_upper:[X>>16,N>>16],u_pixel_coord_lower:[65535&X,65535&N]}}(p,g,a,m),{u_matrix:h,u_opacity:t}),Jf={fillExtrusion:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_lightpos:new l.Uniform3f(h,t.u_lightpos),u_lightintensity:new l.Uniform1f(h,t.u_lightintensity),u_lightcolor:new l.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(h,t.u_vertical_gradient),u_opacity:new l.Uniform1f(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_lightpos:new l.Uniform3f(h,t.u_lightpos),u_lightintensity:new l.Uniform1f(h,t.u_lightintensity),u_lightcolor:new l.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(h,t.u_vertical_gradient),u_height_factor:new l.Uniform1f(h,t.u_height_factor),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade),u_opacity:new l.Uniform1f(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_world:new l.Uniform2f(h,t.u_world),u_image:new l.Uniform1i(h,t.u_image),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_extrude_scale:new l.UniformMatrix2f(h,t.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_extrude_scale:new l.Uniform2f(h,t.u_extrude_scale)}),collisionCircle:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_inv_matrix:new l.UniformMatrix4f(h,t.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new l.UniformColor(h,t.u_color),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_overlay:new l.Uniform1i(h,t.u_overlay),u_overlay_scale:new l.Uniform1f(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new l.Uniform1f(h,t.u_extrude_scale),u_intensity:new l.Uniform1f(h,t.u_intensity),u_matrix:new l.UniformMatrix4f(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_image:new l.Uniform1i(h,t.u_image),u_color_ramp:new l.Uniform1i(h,t.u_color_ramp),u_opacity:new l.Uniform1f(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_latrange:new l.Uniform2f(h,t.u_latrange),u_light:new l.Uniform2f(h,t.u_light),u_shadow:new l.UniformColor(h,t.u_shadow),u_highlight:new l.UniformColor(h,t.u_highlight),u_accent:new l.UniformColor(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_image:new l.Uniform1i(h,t.u_image),u_dimension:new l.Uniform2f(h,t.u_dimension),u_zoom:new l.Uniform1f(h,t.u_zoom),u_unpack:new l.Uniform4f(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_pixels_to_tile_units:new l.UniformMatrix2f(h,t.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_dash_image:new l.Uniform1i(h,t.u_dash_image),u_gradient_image:new l.Uniform1i(h,t.u_gradient_image),u_image_height:new l.Uniform1f(h,t.u_image_height),u_texsize:new l.Uniform2f(h,t.u_texsize),u_scale:new l.Uniform3f(h,t.u_scale),u_mix:new l.Uniform1f(h,t.u_mix)}),linePattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_texsize:new l.Uniform2f(h,t.u_texsize),u_pixels_to_tile_units:new l.UniformMatrix2f(h,t.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_image:new l.Uniform1i(h,t.u_image),u_units_to_pixels:new l.Uniform2f(h,t.u_units_to_pixels),u_scale:new l.Uniform3f(h,t.u_scale),u_fade:new l.Uniform1f(h,t.u_fade)}),raster:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_tl_parent:new l.Uniform2f(h,t.u_tl_parent),u_scale_parent:new l.Uniform1f(h,t.u_scale_parent),u_buffer_scale:new l.Uniform1f(h,t.u_buffer_scale),u_fade_t:new l.Uniform1f(h,t.u_fade_t),u_opacity:new l.Uniform1f(h,t.u_opacity),u_image0:new l.Uniform1i(h,t.u_image0),u_image1:new l.Uniform1i(h,t.u_image1),u_brightness_low:new l.Uniform1f(h,t.u_brightness_low),u_brightness_high:new l.Uniform1f(h,t.u_brightness_high),u_saturation_factor:new l.Uniform1f(h,t.u_saturation_factor),u_contrast_factor:new l.Uniform1f(h,t.u_contrast_factor),u_spin_weights:new l.Uniform3f(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_tile_id:new l.Uniform3f(h,t.u_tile_id),u_zoom_transition:new l.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(h,t.u_merc_center),u_texture:new l.Uniform1i(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texture:new l.Uniform1i(h,t.u_texture),u_gamma_scale:new l.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_tile_id:new l.Uniform3f(h,t.u_tile_id),u_zoom_transition:new l.Uniform1f(h,t.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(h,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(h,t.u_merc_center),u_is_halo:new l.Uniform1i(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new l.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(h,t.u_size_t),u_size:new l.Uniform1f(h,t.u_size),u_camera_to_center_distance:new l.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(h,t.u_pitch),u_rotate_symbol:new l.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(h,t.u_fade_change),u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new l.Uniform1i(h,t.u_is_text),u_pitch_with_map:new l.Uniform1i(h,t.u_pitch_with_map),u_texsize:new l.Uniform2f(h,t.u_texsize),u_texsize_icon:new l.Uniform2f(h,t.u_texsize_icon),u_texture:new l.Uniform1i(h,t.u_texture),u_texture_icon:new l.Uniform1i(h,t.u_texture_icon),u_gamma_scale:new l.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_opacity:new l.Uniform1f(h,t.u_opacity),u_color:new l.UniformColor(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_opacity:new l.Uniform1f(h,t.u_opacity),u_image:new l.Uniform1i(h,t.u_image),u_pattern_tl_a:new l.Uniform2f(h,t.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(h,t.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(h,t.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(h,t.u_pattern_br_b),u_texsize:new l.Uniform2f(h,t.u_texsize),u_mix:new l.Uniform1f(h,t.u_mix),u_pattern_size_a:new l.Uniform2f(h,t.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(h,t.u_pattern_size_b),u_scale_a:new l.Uniform1f(h,t.u_scale_a),u_scale_b:new l.Uniform1f(h,t.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(h,t.u_tile_units_to_pixels)}),terrainRaster:Bt,terrainDepth:Bt,skybox:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_sun_direction:new l.Uniform3f(h,t.u_sun_direction),u_cubemap:new l.Uniform1i(h,t.u_cubemap),u_opacity:new l.Uniform1f(h,t.u_opacity),u_temporal_offset:new l.Uniform1f(h,t.u_temporal_offset)}),skyboxGradient:(h,t)=>({u_matrix:new l.UniformMatrix4f(h,t.u_matrix),u_color_ramp:new l.Uniform1i(h,t.u_color_ramp),u_center_direction:new l.Uniform3f(h,t.u_center_direction),u_radius:new l.Uniform1f(h,t.u_radius),u_opacity:new l.Uniform1f(h,t.u_opacity),u_temporal_offset:new l.Uniform1f(h,t.u_temporal_offset)}),skyboxCapture:(h,t)=>({u_matrix_3f:new l.UniformMatrix3f(h,t.u_matrix_3f),u_sun_direction:new l.Uniform3f(h,t.u_sun_direction),u_sun_intensity:new l.Uniform1f(h,t.u_sun_intensity),u_color_tint_r:new l.Uniform4f(h,t.u_color_tint_r),u_color_tint_m:new l.Uniform4f(h,t.u_color_tint_m),u_luminance:new l.Uniform1f(h,t.u_luminance)})};let Jo;function gl(h,t,a,p,m,g,x){const T=h.context,C=T.gl,I=h.useProgram("collisionBox"),M=[];let P=0,F=0;for(let J=0;J<p.length;J++){const j=p[J],Q=t.getTile(j),re=Q.getBucket(a);if(!re)continue;let we=j.projMatrix;m[0]===0&&m[1]===0||(we=h.translatePosMatrix(j.projMatrix,Q,m,g));const xe=x?re.textCollisionBox:re.iconCollisionBox,Se=re.collisionCircleArray;if(Se.length>0){const Ce=l.create$1(),Ue=we;l.mul$1(Ce,re.placementInvProjMatrix,h.transform.glCoordMatrix),l.mul$1(Ce,Ce,re.placementViewportMatrix),M.push({circleArray:Se,circleOffset:F,transform:Ue,invTransform:Ce}),P+=Se.length/4,F=P}xe&&(h.terrain&&h.terrain.setupElevationDraw(Q,I),I.draw(T,C.LINES,l.DepthMode.disabled,l.StencilMode.disabled,h.colorModeForRenderPass(),l.CullFaceMode.disabled,dl(we,h.transform,Q),a.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,h.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!x||!M.length)return;const V=h.useProgram("collisionCircle"),$=new l.StructArrayLayout2f1f2i16;$.resize(4*P),$._trim();let U=0;for(const J of M)for(let j=0;j<J.circleArray.length/4;j++){const Q=4*j,re=J.circleArray[Q+0],we=J.circleArray[Q+1],xe=J.circleArray[Q+2],Se=J.circleArray[Q+3];$.emplace(U++,re,we,xe,Se,0),$.emplace(U++,re,we,xe,Se,1),$.emplace(U++,re,we,xe,Se,2),$.emplace(U++,re,we,xe,Se,3)}(!Jo||Jo.length<2*P)&&(Jo=function(J){const j=2*J,Q=new l.StructArrayLayout3ui6;Q.resize(j),Q._trim();for(let re=0;re<j;re++){const we=6*re;Q.uint16[we+0]=4*re+0,Q.uint16[we+1]=4*re+1,Q.uint16[we+2]=4*re+2,Q.uint16[we+3]=4*re+2,Q.uint16[we+4]=4*re+3,Q.uint16[we+5]=4*re+0}return Q}(P));const X=T.createIndexBuffer(Jo,!0),N=T.createVertexBuffer($,l.collisionCircleLayout.members,!0);for(const J of M){const j={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(H=h.transform).cameraToCenterDistance,u_viewport_size:[H.width,H.height]};V.draw(T,C.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,h.colorModeForRenderPass(),l.CullFaceMode.disabled,j,a.id,N,X,l.SegmentVector.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,h.transform.zoom,null,null,null)}var H;N.destroy(),X.destroy()}const vo=l.identity(new Float32Array(16));function od(h,t,a,p,m,g){const{horizontalAlign:x,verticalAlign:T}=l.getAnchorAlignment(h),C=-(x-.5)*t,I=-(T-.5)*a,M=l.evaluateVariableOffset(h,p);return new l.pointGeometry((C/m+M[0])*g,(I/m+M[1])*g)}function sd(h,t,a,p,m,g,x,T,C,I,M,P){const F=h.text.placedSymbolArray,V=h.text.dynamicLayoutVertexArray,$=h.icon.dynamicLayoutVertexArray,U={};V.clear();for(let X=0;X<F.length;X++){const N=F.get(X),H=h.allowVerticalPlacement&&!N.placedOrientation,J=N.hidden||!N.crossTileID||H?null:p[N.crossTileID];if(J){const j=new l.pointGeometry(N.tileAnchorX,N.tileAnchorY),Q=P(j),re=mn(j,a?T:x,Q),we=mo(g.cameraToCenterDistance,re.signedDistanceFromCamera);let xe=m.evaluateSizeForFeature(h.textSizeData,I,N)*we/l.ONE_EM;a&&(xe*=h.tilePixelRatio/C);const{width:Se,height:Ce,anchor:Ue,textOffset:Ee,textScale:Ne}=J,ye=od(Ue,Se,Ce,Ee,Ne,xe),Ve=a?mn(j.add(ye),x,Q).point:re.point.add(t?ye.rotate(-g.angle):ye),et=h.allowVerticalPlacement&&N.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let ct=0;ct<N.numGlyphs;ct++)l.addDynamicAttributes(V,Ve,et);M&&N.associatedIconIndex>=0&&(U[N.associatedIconIndex]={shiftedAnchor:Ve,angle:et})}else Gi(N.numGlyphs,V)}if(M){$.clear();const X=h.icon.placedSymbolArray;for(let N=0;N<X.length;N++){const H=X.get(N);if(H.hidden)Gi(H.numGlyphs,$);else{const J=U[N];if(J)for(let j=0;j<H.numGlyphs;j++)l.addDynamicAttributes($,J.shiftedAnchor,J.angle);else Gi(H.numGlyphs,$)}}h.icon.dynamicLayoutVertexBuffer.updateData($)}h.text.dynamicLayoutVertexBuffer.updateData(V)}function tu(h,t,a){return a.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ur(h,t,a,p,m,g,x,T,C,I,M,P){const F=h.context,V=F.gl,$=h.transform,U=T==="map",X=C==="map",N=U&&a.layout.get("symbol-placement")!=="point",H=U&&!X&&!N,J=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let j=!1;const Q=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),re=[0,0],we=a.layout.get("text-variable-anchor"),xe=[],Se=[];h.terrain&&X&&Se.push("PITCH_WITH_MAP_TERRAIN"),N&&Se.push("PROJECTED_POS_ON_VIEWPORT");for(const Ce of p){const Ue=t.getTile(Ce),Ee=Ue.getBucket(a);if(!Ee)continue;const Ne=m?Ee.text:Ee.icon;if(!Ne||!Ne.segments.get().length)continue;const ye=Ne.programConfigurations.get(a.id),Ve=m||Ee.sdfIcons,et=m?Ee.textSizeData:Ee.iconSizeData,ct=X||$.pitch!==0,ht=h.useProgram(tu(Ve,m,Ee),ye,Se),ft=l.evaluateSizeForZoom(et,$.zoom),mt=[Ce.canonical.x,Ce.canonical.y,1<<Ce.canonical.z];let at,gt,Ut,xn,Ln=[0,0],$n=null;if(m){if(gt=Ue.glyphAtlasTexture,Ut=V.LINEAR,at=Ue.glyphAtlasTexture.size,Ee.iconsInText){Ln=Ue.imageAtlasTexture.size,$n=Ue.imageAtlasTexture;const si=et.kind==="composite"||et.kind==="camera";xn=ct||h.options.rotating||h.options.zooming||si?V.LINEAR:V.NEAREST}}else{const si=a.layout.get("icon-size").constantOr(0)!==1||Ee.iconsNeedLinear;gt=Ue.imageAtlasTexture,Ut=Ve||h.options.rotating||h.options.zooming||si||ct?V.LINEAR:V.NEAREST,at=Ue.imageAtlasTexture.size}const Kn=h.transform.calculatePixelsToTileUnitsMatrix(Ue),wn=Et(Ce.projMatrix,X,U,h.transform,Kn),wr=h.terrain&&X&&N?l.invert(new Float32Array(16),wn):vo,lr=wt(Ce.projMatrix,X,U,h.transform,Kn),Jt=we&&Ee.hasTextData(),dn=a.layout.get("icon-text-fit")!=="none"&&Jt&&Ee.hasIconData();if(N){const si=$.elevation;Ya(Ee,Ce.projMatrix,h,m,wn,lr,X,I,si?qr=>si.getAtTileOffset(Ce,qr.x,qr.y):null)}const Mt=h.translatePosMatrix(Ce.projMatrix,Ue,g,x),en=N||m&&we||dn?vo:wn,Bn=h.translatePosMatrix(lr,Ue,g,x,!0),Qt=Ve&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xi;xi=Ve?Ee.iconsInText?Hf(et.kind,ft,H,X,h,Mt,en,Bn,at,Ln,mt,0,h.identityMat,re):rd(et.kind,ft,H,X,h,Mt,en,Bn,m,at,!0,mt,0,h.identityMat,re):id(et.kind,ft,H,X,h,Mt,en,Bn,m,at,mt,0,h.identityMat,re);const ga={program:ht,buffers:Ne,uniformValues:xi,atlasTexture:gt,atlasTextureIcon:$n,atlasInterpolation:Ut,atlasInterpolationIcon:xn,isSDF:Ve,hasHalo:Qt,tile:Ue,labelPlaneMatrixInv:wr};if(J&&Ee.canOverlap){j=!0;const si=Ne.segments.get();for(const qr of si)xe.push({segments:new l.SegmentVector([qr]),sortKey:qr.sortKey,state:ga})}else xe.push({segments:Ne.segments,sortKey:0,state:ga})}j&&xe.sort((Ce,Ue)=>Ce.sortKey-Ue.sortKey);for(const Ce of xe){const Ue=Ce.state;if(h.terrain&&h.terrain.setupElevationDraw(Ue.tile,Ue.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Ue.labelPlaneMatrixInv}),F.activeTexture.set(V.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,V.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(F.activeTexture.set(V.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Ue.isSDF){const Ee=Ue.uniformValues;Ue.hasHalo&&(Ee.u_is_halo=1,nu(Ue.buffers,Ce.segments,a,h,Ue.program,Q,M,P,Ee)),Ee.u_is_halo=0}nu(Ue.buffers,Ce.segments,a,h,Ue.program,Q,M,P,Ue.uniformValues)}}function nu(h,t,a,p,m,g,x,T,C){const I=p.context;m.draw(I,I.gl.TRIANGLES,g,x,T,l.CullFaceMode.disabled,C,a.id,h.layoutVertexBuffer,h.indexBuffer,t,a.paint,p.transform.zoom,h.programConfigurations.get(a.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function xo(h,t,a,p,m,g,x){const T=h.context.gl,C=a.paint.get("fill-pattern"),I=C&&C.constantOr(1),M=a.getCrossfadeParameters();let P,F,V,$,U;x?(F=I&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=T.LINES):(F=I?"fillPattern":"fill",P=T.TRIANGLES);for(const X of p){const N=t.getTile(X);if(I&&!N.patternsLoaded())continue;const H=N.getBucket(a);if(!H)continue;h.prepareDrawTile(X);const J=H.programConfigurations.get(a.id),j=h.useProgram(F,J);I&&(h.context.activeTexture.set(T.TEXTURE0),N.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),J.updatePaintBuffers(M));const Q=C.constantOr(null);if(Q&&N.imageAtlas){const we=N.imageAtlas,xe=we.patternPositions[Q.to.toString()],Se=we.patternPositions[Q.from.toString()];xe&&Se&&J.setConstantPatternPositions(xe,Se)}const re=h.translatePosMatrix(X.projMatrix,N,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(x){$=H.indexBuffer2,U=H.segments2;const we=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];V=F==="fillOutlinePattern"&&I?td(re,h,M,N,we):ia(re,we)}else $=H.indexBuffer,U=H.segments,V=I?Yo(re,h,M,N):ed(re);h.prepareDrawProgram(h.context,j,X.toUnwrapped()),j.draw(h.context,P,m,h.stencilModeForClipping(X),g,l.CullFaceMode.disabled,V,a.id,H.layoutVertexBuffer,$,U,a.paint,h.transform.zoom,J)}}function Nr(h,t,a,p,m,g,x){const T=h.context,C=T.gl,I=a.paint.get("fill-extrusion-pattern"),M=I.constantOr(1),P=a.getCrossfadeParameters(),F=a.paint.get("fill-extrusion-opacity");for(const V of p){const $=t.getTile(V),U=$.getBucket(a);if(!U)continue;const X=U.programConfigurations.get(a.id),N=h.useProgram(M?"fillExtrusionPattern":"fillExtrusion",X);if(h.terrain){const re=h.terrain;if(!U.enableTerrain)continue;if(re.setupElevationDraw($,N,{useMeterToDem:!0}),ad(T,t,V,U,a,re),!U.centroidVertexBuffer){const we=N.attributes.a_centroid_pos;we!==void 0&&C.vertexAttrib2f(we,0,0)}}M&&(h.context.activeTexture.set(C.TEXTURE0),$.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),X.updatePaintBuffers(P));const H=I.constantOr(null);if(H&&$.imageAtlas){const re=$.imageAtlas,we=re.patternPositions[H.to.toString()],xe=re.patternPositions[H.from.toString()];we&&xe&&X.setConstantPatternPositions(we,xe)}const J=h.translatePosMatrix(V.projMatrix,$,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),j=a.paint.get("fill-extrusion-vertical-gradient"),Q=M?Qh(J,h,j,F,V,P,$):Yc(J,h,j,F);h.prepareDrawProgram(T,N,V.toUnwrapped()),N.draw(T,T.gl.TRIANGLES,m,g,x,l.CullFaceMode.backCCW,Q,a.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,a.paint,h.transform.zoom,X,h.terrain?U.centroidVertexBuffer:null)}}function ad(h,t,a,p,m,g){const x=[N=>{let H=N.canonical.x-1,J=N.wrap;return H<0&&(H=(1<<N.canonical.z)-1,J--),new l.OverscaledTileID(N.overscaledZ,J,N.canonical.z,H,N.canonical.y)},N=>{let H=N.canonical.x+1,J=N.wrap;return H===1<<N.canonical.z&&(H=0,J++),new l.OverscaledTileID(N.overscaledZ,J,N.canonical.z,H,N.canonical.y)},N=>new l.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,(N.canonical.y===0?1<<N.canonical.z:N.canonical.y)-1),N=>new l.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y===(1<<N.canonical.z)-1?0:N.canonical.y+1)],T=N=>{const H=t.getSource().maxzoom,J=we=>{const xe=t.getTileByID(we);if(xe&&xe.hasData())return xe.getBucket(m)};let j,Q,re;return(N.overscaledZ===N.canonical.z||N.overscaledZ>=H)&&(j=J(N.key)),N.overscaledZ>=H&&(Q=J(N.calculateScaledKey(N.overscaledZ+1))),N.overscaledZ>H&&(re=J(N.calculateScaledKey(N.overscaledZ-1))),j||Q||re},C=[0,0,0],I=(N,H)=>(C[0]=Math.min(N.min.y,H.min.y),C[1]=Math.max(N.max.y,H.max.y),C[2]=l.EXTENT-H.min.x>N.max.x?H.min.x-l.EXTENT:N.max.x,C),M=(N,H)=>(C[0]=Math.min(N.min.x,H.min.x),C[1]=Math.max(N.max.x,H.max.x),C[2]=l.EXTENT-H.min.y>N.max.y?H.min.y-l.EXTENT:N.max.y,C),P=[(N,H)=>I(N,H),(N,H)=>I(H,N),(N,H)=>M(N,H),(N,H)=>M(H,N)],F=new l.pointGeometry(0,0);let V,$,U;const X=(N,H,J,j,Q)=>{const re=[[j?J:N,j?N:J,0],[j?J:H,j?H:J,0]],we=Q<0?l.EXTENT+Q:Q,xe=[j?we:(N+H)/2,j?(N+H)/2:we,0];return J===0&&Q<0||J!==0&&Q>0?g.getForTilePoints(U,[xe],!0,$):re.push(xe),g.getForTilePoints(a,re,!0,V),Math.max(re[0][2],re[1][2],xe[2])/g.exaggeration()};for(let N=0;N<4;N++){const H=p.borders[N];if(H.length===0&&(p.borderDone[N]=!0),p.borderDone[N])continue;const J=U=x[N](a),j=T(J);if(!j||!j.enableTerrain||($=g.findDEMTileFor(J),!$||!$.dem))continue;if(!V){const xe=g.findDEMTileFor(a);if(!xe||!xe.dem)return;V=xe}const Q=(N<2?1:5)-N,re=j.borders[Q];let we=0;for(let xe=0;xe<H.length;xe++){const Se=p.featuresOnBorder[H[xe]],Ce=Se.borders[N];let Ue;for(;we<re.length&&(Ue=j.featuresOnBorder[re[we]],!(Ue.borders[Q][1]>Ce[0]+3));)j.borderDone[Q]||j.encodeCentroid(void 0,Ue,!1),we++;if(Ue&&we<re.length){const Ee=we;let Ne=0;for(;!(Ue.borders[Q][0]>Ce[1]-3)&&(Ne++,++we!==re.length);)Ue=j.featuresOnBorder[re[we]];if(Ue=j.featuresOnBorder[re[Ee]],Se.intersectsCount()>1||Ue.intersectsCount()>1||Ne!==1){Ne!==1&&(we=Ee),p.encodeCentroid(void 0,Se,!1),j.borderDone[Q]||j.encodeCentroid(void 0,Ue,!1);continue}const ye=P[N](Se,Ue),Ve=N%2?l.EXTENT-1:0;F.x=X(ye[0],Math.min(l.EXTENT-1,ye[1]),Ve,N<2,ye[2]),F.y=0,p.encodeCentroid(F,Se,!1),j.borderDone[Q]||j.encodeCentroid(F,Ue,!1)}else p.encodeCentroid(void 0,Se,!1)}p.borderDone[N]=p.needsCentroidUpdate=!0,j.borderDone[Q]||(j.borderDone[Q]=j.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(h)}const iu=new l.Color(1,0,0,1),Rt=new l.Color(0,1,0,1),yl=new l.Color(0,0,1,1),Qf=new l.Color(1,0,1,1),ld=new l.Color(0,1,1,1);function Qo(h,t,a,p){vl(h,0,t+a/2,h.transform.width,a,p)}function cd(h,t,a,p){vl(h,t-a/2,0,a,h.transform.height,p)}function vl(h,t,a,p,m,g){const x=h.context,T=x.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*l.exported.devicePixelRatio,a*l.exported.devicePixelRatio,p*l.exported.devicePixelRatio,m*l.exported.devicePixelRatio),x.clear({color:g}),T.disable(T.SCISSOR_TEST)}function ud(h,t,a){const p=h.context,m=p.gl,g=a.projMatrix,x=h.useProgram("debug"),T=t.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(T,x);const C=l.DepthMode.disabled,I=l.StencilMode.disabled,M=h.colorModeForRenderPass(),P="$debug";p.activeTexture.set(m.TEXTURE0),h.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),T._makeDebugTileBoundsBuffers(h.context,h.transform.projection);const F=T._tileDebugBuffer||h.debugBuffer,V=T._tileDebugIndexBuffer||h.debugIndexBuffer,$=T._tileDebugSegments||h.debugSegments;x.draw(p,m.LINE_STRIP,C,I,M,l.CullFaceMode.disabled,ra(g,l.Color.red),P,F,V,$);const U=T.latestRawTileData,X=Math.floor((U&&U.byteLength||0)/1024),N=t.getTile(a).tileSize,H=512/Math.min(N,512)*(a.overscaledZ/h.transform.zoom)*.5;let J=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(J+=` => ${a.overscaledZ}`),function(j,Q){j.initDebugOverlayCanvas();const re=j.debugOverlayCanvas,we=j.context.gl,xe=j.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,re.width,re.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(Q,5,5),xe.strokeText(Q,5,5),j.debugOverlayTexture.update(re),j.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(h,`${J} ${X}kb`),x.draw(p,m.TRIANGLES,C,I,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,ra(g,l.Color.transparent,H),P,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}const em=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ru}=em;function Wi(h,t,a,p){h.emplaceBack(t,a,p)}class es{constructor(t){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,Wi(this.vertexArray,-1,-1,1),Wi(this.vertexArray,1,-1,1),Wi(this.vertexArray,-1,1,1),Wi(this.vertexArray,1,1,1),Wi(this.vertexArray,-1,-1,-1),Wi(this.vertexArray,1,-1,-1),Wi(this.vertexArray,-1,1,-1),Wi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ru),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function Vr(h,t,a,p,m,g){const x=h.gl,T=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),I=t.paint.get("sky-atmosphere-sun-intensity"),M=((P,F,V,$,U)=>({u_matrix_3f:P,u_sun_direction:F,u_sun_intensity:V,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(l.fromMat4([],p),m,I,T,C);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),a.draw(h,x.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,M,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const xl={symbol:function(h,t,a,p,m){if(h.renderPass!=="translucent")return;const g=l.StencilMode.disabled,x=h.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(T,C,I,M,P,F,V){const $=C.transform,U=P==="map",X=F==="map";for(const N of T){const H=M.getTile(N),J=H.getBucket(I);if(!J||!J.text||!J.text.segments.get().length)continue;const j=l.evaluateSizeForZoom(J.textSizeData,$.zoom),Q=C.transform.calculatePixelsToTileUnitsMatrix(H),re=Et(N.projMatrix,X,U,C.transform,Q),we=I.layout.get("icon-text-fit")!=="none"&&J.hasIconData();if(j){const xe=Math.pow(2,$.zoom-H.tileID.overscaledZ),Se=$.elevation;sd(J,U,X,V,l.symbolSize,$,re,N.projMatrix,xe,j,we,Se?Ce=>Se.getAtTileOffset(N,Ce.x,Ce.y):Ce=>0)}}}(p,h,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),m),a.paint.get("icon-opacity").constantOr(1)!==0&&Ur(h,t,a,p,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),g,x),a.paint.get("text-opacity").constantOr(1)!==0&&Ur(h,t,a,p,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),g,x),t.map.showCollisionBoxes&&(gl(h,t,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),gl(h,t,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,a,p){if(h.renderPass!=="translucent")return;const m=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),x=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const C=h.context,I=C.gl,M=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),P=l.StencilMode.disabled,F=h.colorModeForRenderPass(),V=[];for(let $=0;$<p.length;$++){const U=p[$],X=t.getTile(U),N=X.getBucket(a);if(!N)continue;const H=N.programConfigurations.get(a.id),J=Kc(a),j={programConfiguration:H,program:h.useProgram("circle",H,J),layoutVertexBuffer:N.layoutVertexBuffer,indexBuffer:N.indexBuffer,uniformValues:vi(h,U,X,a),tile:X};if(T){const Q=N.segments.get();for(const re of Q)V.push({segments:new l.SegmentVector([re]),sortKey:re.sortKey,state:j})}else V.push({segments:N.segments,sortKey:0,state:j})}T&&V.sort(($,U)=>$.sortKey-U.sortKey);for(const $ of V){const{programConfiguration:U,program:X,layoutVertexBuffer:N,indexBuffer:H,uniformValues:J,tile:j}=$.state,Q=$.segments;h.terrain&&h.terrain.setupElevationDraw(j,X,{useDepthForOcclusion:!0}),h.prepareDrawProgram(C,X,j.tileID.toUnwrapped()),X.draw(C,I.TRIANGLES,M,P,F,l.CullFaceMode.disabled,J,a.id,N,H,Q,a.paint,h.transform.zoom,U)}},heatmap:function(h,t,a,p){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const m=h.context,g=m.gl,x=l.StencilMode.disabled,T=new l.ColorMode([g.ONE,g.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(C,I,M){const P=C.gl;C.activeTexture.set(P.TEXTURE1),C.viewport.set([0,0,I.width/4,I.height/4]);let F=M.heatmapFbo;if(F)P.bindTexture(P.TEXTURE_2D,F.colorAttachment.get()),C.bindFramebuffer.set(F.framebuffer);else{const V=P.createTexture();P.bindTexture(P.TEXTURE_2D,V),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR),F=M.heatmapFbo=C.createFramebuffer(I.width/4,I.height/4,!1),function($,U,X,N){const H=$.gl;H.texImage2D(H.TEXTURE_2D,0,H.RGBA,U.width/4,U.height/4,0,H.RGBA,$.extRenderToTextureHalfFloat?$.extTextureHalfFloat.HALF_FLOAT_OES:H.UNSIGNED_BYTE,null),N.colorAttachment.set(X)}(C,I,V,F)}})(m,h,a),m.clear({color:l.Color.transparent});for(let C=0;C<p.length;C++){const I=p[C];if(t.hasRenderableParent(I))continue;const M=t.getTile(I),P=M.getBucket(a);if(!P)continue;const F=P.programConfigurations.get(a.id),V=h.useProgram("heatmap",F),{zoom:$}=h.transform;h.terrain&&h.terrain.setupElevationDraw(M,V),h.prepareDrawProgram(m,V,I.toUnwrapped()),V.draw(m,g.TRIANGLES,l.DepthMode.disabled,x,T,l.CullFaceMode.disabled,Jc(I.projMatrix,M,$,a.paint.get("heatmap-intensity")),a.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,a.paint,h.transform.zoom,F)}m.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(m,g){const x=m.context,T=x.gl,C=g.heatmapFbo;if(!C)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,C.colorAttachment.get()),x.activeTexture.set(T.TEXTURE1);let I=g.colorRampTexture;I||(I=g.colorRampTexture=new l.Texture(x,g.colorRamp,T.RGBA)),I.bind(T.LINEAR,T.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(x,T.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,m.colorModeForRenderPass(),l.CullFaceMode.disabled,((M,P,F,V)=>({u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)}(h,a))},line:function(h,t,a,p){if(h.renderPass!=="translucent")return;const m=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const x=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),C=a.paint.get("line-dasharray"),I=C.constantOr(1),M=a.layout.get("line-cap"),P=a.paint.get("line-pattern"),F=P.constantOr(1),V=a.paint.get("line-gradient"),$=a.getCrossfadeParameters(),U=F?"linePattern":"line",X=h.context,N=X.gl;for(const H of p){const J=t.getTile(H);if(F&&!J.patternsLoaded())continue;const j=J.getBucket(a);if(!j)continue;h.prepareDrawTile(H);const Q=j.programConfigurations.get(a.id),re=_l(a),we=h.useProgram(U,Q,re),xe=P.constantOr(null);if(xe&&J.imageAtlas){const Ne=J.imageAtlas,ye=Ne.patternPositions[xe.to.toString()],Ve=Ne.patternPositions[xe.from.toString()];ye&&Ve&&Q.setConstantPatternPositions(ye,Ve)}const Se=C.constantOr(null),Ce=M.constantOr(null);if(!F&&Se&&Ce&&J.lineAtlas){const Ne=J.lineAtlas,ye=Ne.getDash(Se.to,Ce),Ve=Ne.getDash(Se.from,Ce);ye&&Ve&&Q.setConstantPatternPositions(ye,Ve)}const Ue=h.terrain?H.projMatrix:null,Ee=F?pl(h,J,a,$,Ue):Qc(h,J,a,$,Ue,j.lineClipsArray.length);if(V){const Ne=j.gradients[a.id];let ye=Ne.texture;if(a.gradientVersion!==Ne.version){let Ve=256;if(a.stepInterpolant){const et=t.getSource().maxzoom,ct=H.canonical.z===et?Math.ceil(1<<h.transform.maxZoom-H.canonical.z):1;Ve=l.clamp(l.nextPowerOfTwo(j.maxLineLength/l.EXTENT*1024*ct),256,X.maxTextureSize)}Ne.gradient=l.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ve,image:Ne.gradient||void 0,clips:j.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new l.Texture(X,Ne.gradient,N.RGBA),Ne.version=a.gradientVersion,ye=Ne.texture}X.activeTexture.set(N.TEXTURE1),ye.bind(a.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}I&&(X.activeTexture.set(N.TEXTURE0),J.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),Q.updatePaintBuffers($)),F&&(X.activeTexture.set(N.TEXTURE0),J.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Q.updatePaintBuffers($)),h.prepareDrawProgram(X,we,H.toUnwrapped()),we.draw(X,N.TRIANGLES,x,h.stencilModeForClipping(H),T,l.CullFaceMode.disabled,Ee,a.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,a.paint,h.transform.zoom,Q,j.layoutVertexBuffer2)}},fill:function(h,t,a,p){const m=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=h.colorModeForRenderPass(),T=a.paint.get("fill-pattern"),C=h.opaquePassEnabledForLayer()&&!T.constantOr(1)&&m.constantOr(l.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===C){const I=h.depthModeForSublayer(1,h.renderPass==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);xo(h,t,a,p,I,x,!1)}if(h.renderPass==="translucent"&&a.paint.get("fill-antialias")){const I=h.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);xo(h,t,a,p,I,x,!0)}},"fill-extrusion":function(h,t,a,p){const m=a.paint.get("fill-extrusion-opacity");if(m!==0&&h.renderPass==="translucent"){const g=new l.DepthMode(h.context.gl.LEQUAL,l.DepthMode.ReadWrite,h.depthRangeFor3D);if(m!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Nr(h,t,a,p,g,l.StencilMode.disabled,l.ColorMode.disabled),Nr(h,t,a,p,g,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const x=h.colorModeForRenderPass();Nr(h,t,a,p,g,l.StencilMode.disabled,x)}}},hillshade:function(h,t,a,p){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const m=h.context,g=h.depthModeForSublayer(0,l.DepthMode.ReadOnly),x=h.colorModeForRenderPass(),T=h.terrain&&h.terrain.renderingToTexture,[C,I]=h.renderPass!=="translucent"||T?[{},p]:h.stencilConfigForOverlap(p);for(const M of I){const P=t.getTile(M);if(P.needsHillshadePrepare&&h.renderPass==="offscreen")ea(h,P,a,g,l.StencilMode.disabled,x);else if(h.renderPass==="translucent"){const F=T&&h.terrain?h.terrain.stencilModeForRTTOverlap(M):C[M.overscaledZ];qc(h,M,P,a,g,F,x)}}m.viewport.set([0,0,h.width,h.height])},raster:function(h,t,a,p,m,g){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!p.length)return;const x=h.context,T=x.gl,C=t.getSource(),I=h.useProgram("raster"),M=h.colorModeForRenderPass(),P=h.terrain&&h.terrain.renderingToTexture,[F,V]=C instanceof q||P?[{},p]:h.stencilConfigForOverlap(p),$=V[V.length-1].overscaledZ,U=!h.options.moving;for(const X of V){const N=P?l.DepthMode.disabled:h.depthModeForSublayer(X.overscaledZ-$,a.paint.get("raster-opacity")===1?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,T.LESS),H=X.toUnwrapped(),J=t.getTile(X);if(P&&(!J||!J.hasData()))continue;const j=P?X.projMatrix:h.transform.calculateProjMatrix(H,U),Q=h.terrain&&P?h.terrain.stencilModeForRTTOverlap(X):F[X.overscaledZ],re=g?0:a.paint.get("raster-fade-duration");J.registerFadeDuration(re);const we=t.findLoadedParent(X,0),xe=Xc(J,we,t,h.transform,re);let Se,Ce;h.terrain&&h.terrain.prepareDrawTile(X);const Ue=a.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;x.activeTexture.set(T.TEXTURE0),J.texture.bind(Ue,T.CLAMP_TO_EDGE),x.activeTexture.set(T.TEXTURE1),we?(we.texture.bind(Ue,T.CLAMP_TO_EDGE),Se=Math.pow(2,we.tileID.overscaledZ-J.tileID.overscaledZ),Ce=[J.tileID.canonical.x*Se%1,J.tileID.canonical.y*Se%1]):J.texture.bind(Ue,T.CLAMP_TO_EDGE);const Ee=nd(j,Ce||[0,0],Se||1,xe,a);if(h.prepareDrawProgram(x,I,H),C instanceof q)I.draw(x,T.TRIANGLES,N,l.StencilMode.disabled,M,l.CullFaceMode.disabled,Ee,a.id,C.boundsBuffer,h.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:ye,tileBoundsSegments:Ve}=h.getTileBoundsBuffers(J);I.draw(x,T.TRIANGLES,N,Q,M,l.CullFaceMode.disabled,Ee,a.id,Ne,ye,Ve)}}},background:function(h,t,a,p){const m=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g===0)return;const x=h.context,T=x.gl,C=h.transform,I=C.tileSize,M=a.paint.get("background-pattern");if(h.isPatternMissing(M))return;const P=!M&&m.a===1&&g===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==P)return;const F=l.StencilMode.disabled,V=h.depthModeForSublayer(0,P==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),$=h.colorModeForRenderPass(),U=h.useProgram(M?"backgroundPattern":"background");let X,N=p;N||(X=h.getBackgroundTiles(),N=Object.values(X).map(J=>J.tileID)),M&&(x.activeTexture.set(T.TEXTURE0),h.imageManager.bind(h.context));const H=a.getCrossfadeParameters();for(const J of N){const j=J.toUnwrapped(),Q=p?J.projMatrix:h.transform.calculateProjMatrix(j);h.prepareDrawTile(J);const re=t?t.getTile(J):X?X[J.key]:new l.Tile(J,I,C.zoom,h),we=M?Kf(Q,g,h,M,{tileID:J,tileSize:I},H):Yf(Q,g,m);h.prepareDrawProgram(x,U,j);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Se,tileBoundsSegments:Ce}=h.getTileBoundsBuffers(re);U.draw(x,T.TRIANGLES,V,F,$,l.CullFaceMode.disabled,we,a.id,xe,Se,Ce)}},sky:function(h,t,a){const p=h.transform,m=p.projection.name==="mercator"?1:l.smoothstep(7,8,p.zoom),g=a.paint.get("sky-opacity")*m;if(g===0)return;const x=h.context,T=a.paint.get("sky-type"),C=new l.DepthMode(x.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),I=h.frameCounter/1e3%1;T==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&(function(M,P,F,V){const $=M.context,U=$.gl;let X=P.skyboxFbo;if(!X){X=P.skyboxFbo=$.createFramebuffer(32,32,!1),P.skyboxGeometry=new es($),P.skyboxTexture=$.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,P.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let j=0;j<6;++j)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(X.framebuffer),$.viewport.set([0,0,32,32]);const N=P.getCenter(M,!0),H=M.useProgram("skyboxCapture"),J=new Float64Array(16);l.identity(J),l.rotateY(J,J,.5*-Math.PI),Vr($,P,H,J,N,0),l.identity(J),l.rotateY(J,J,.5*Math.PI),Vr($,P,H,J,N,1),l.identity(J),l.rotateX(J,J,.5*-Math.PI),Vr($,P,H,J,N,2),l.identity(J),l.rotateX(J,J,.5*Math.PI),Vr($,P,H,J,N,3),l.identity(J),Vr($,P,H,J,N,4),l.identity(J),l.rotateY(J,J,Math.PI),Vr($,P,H,J,N,5),$.viewport.set([0,0,M.width,M.height])}(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&function(M,P,F,V,$){const U=M.context,X=U.gl,N=M.transform,H=M.useProgram("skybox");U.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,P.skyboxTexture);const J=((j,Q,re,we,xe)=>({u_matrix:j,u_sun_direction:Q,u_cubemap:0,u_opacity:we,u_temporal_offset:xe}))(N.skyboxMatrix,P.getCenter(M,!1),0,V,$);M.prepareDrawProgram(U,H),H.draw(U,X.TRIANGLES,F,l.StencilMode.disabled,M.colorModeForRenderPass(),l.CullFaceMode.backCW,J,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,a,C,g,I):T==="gradient"&&h.renderPass==="sky"&&function(M,P,F,V,$){const U=M.context,X=U.gl,N=M.transform,H=M.useProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new es(U)),U.activeTexture.set(X.TEXTURE0);let J=P.colorRampTexture;J||(J=P.colorRampTexture=new l.Texture(U,P.colorRamp,X.RGBA)),J.bind(X.LINEAR,X.CLAMP_TO_EDGE);const j=((Q,re,we,xe,Se)=>({u_matrix:Q,u_color_ramp:0,u_center_direction:re,u_radius:l.degToRad(we),u_opacity:xe,u_temporal_offset:Se}))(N.skyboxMatrix,P.getCenter(M,!1),P.paint.get("sky-gradient-radius"),V,$);M.prepareDrawProgram(U,H),H.draw(U,X.TRIANGLES,F,l.StencilMode.disabled,M.colorModeForRenderPass(),l.CullFaceMode.backCW,j,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,a,C,g,I)},debug:function(h,t,a){for(let p=0;p<a.length;p++)ud(h,t,a[p])},custom:function(h,t,a){const p=h.context,m=a.implementation;if(h.transform.projection.name==="mercator"){if(h.renderPass==="offscreen"){const g=m.prerender;g&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),g.call(m,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(l.StencilMode.disabled);const g=m.renderingMode==="3d"?new l.DepthMode(h.context.gl.LEQUAL,l.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,l.DepthMode.ReadOnly);p.setDepthMode(g),m.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}else l.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class hd{constructor(t,a){this.context=new Ys(t),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new il,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,a){const p=!!t&&!!t.terrain&&this.transform.projection.name==="mercator";if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Hc(this,t));const m=this._terrain;this.transform.elevation=p?m:null,m.update(t,this.transform,a)}_updateFog(t){const a=t.fog;if(!a||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,m]=a.getFovAdjustedRange(this.transform._fov);if(p>m)return void(this.transform.fogCullDistSq=null);const g=p+.78*(m-p);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,a){if(this.width=t*l.exported.devicePixelRatio,this.height=a*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const t=this.context,a=new l.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(l.EXTENT,0),a.emplaceBack(0,l.EXTENT),a.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(a,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=t.createVertexBuffer(p,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const m=new l.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const g=new l.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(l.EXTENT,0,l.EXTENT,0),g.emplaceBack(0,l.EXTENT,0,l.EXTENT),g.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(g,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const T=new l.StructArrayLayout1ui2;for(const I of[0,1,3,2,0])T.emplaceBack(I);this.debugIndexBuffer=t.createIndexBuffer(T),this.emptyTexture=new l.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=l.create$1();const C=this.context.gl;this.stencilClearMode=new l.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(l.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(t,a.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,na(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,p){if(!(a&&this.currentStencilSource!==a.id&&t.isTileClipped()&&p&&p.length))return;this.currentStencilSource=a.id;const m=this.context,g=m.gl;this.nextStencilID+p.length>256&&this.clearStencil(),m.setColorMode(l.ColorMode.disabled),m.setDepthMode(l.DepthMode.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of p){const C=a.getTile(T),I=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:M,tileBoundsIndexBuffer:P,tileBoundsSegments:F}=this.getTileBoundsBuffers(C);x.draw(m,g.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:g.ALWAYS,mask:0},I,255,g.KEEP,g.KEEP,g.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,na(T.projMatrix),"$clipping",M,P,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new l.StencilMode({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new l.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,p=t.sort((x,T)=>T.overscaledZ-x.overscaledZ),m=p[p.length-1].overscaledZ,g=p[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let T=0;T<g;T++)x[T+m]=new l.StencilMode({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[x,p]}return[{[m]:l.StencilMode.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const a=1/8;return new l.ColorMode([t.CONSTANT_COLOR,t.ONE],new l.Color(a,a,a,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(t,a,p){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new l.DepthMode(p||this.context.gl.LEQUAL,a,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style.order,m=this.style._sourceCaches;for(const I in m){const M=m[I];M.used&&M.prepare(this.context)}const g={},x={},T={};for(const I in m){const M=m[I];g[I]=M.getVisibleCoordinates(),x[I]=g[I].slice().reverse(),T[I]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<p.length;I++)if(this.style._layers[p[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const I of p){const M=this.style._layers[I],P=t._getLayerSourceCache(M);if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const F=P?x[P.id]:void 0;(M.type==="custom"||M.isSky()||F&&F.length)&&this.renderLayer(this,P,M,F)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let C=l.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(C=this.style.fog.properties.get("color")),this.context.clear({color:a.showOverdrawInspector?l.Color.black:C,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[p[this.currentLayer]],M=t._getLayerSourceCache(I);if(I.isSky())continue;const P=M?x[M.id]:void 0;this._renderTileClippingMasks(I,M,P),this.renderLayer(this,M,I,P)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const I=this.style._layers[p[this.currentLayer]],M=t._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,M,I,M?x[M.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const I=this.style._layers[p[this.currentLayer]],M=t._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const P=M?(I.type==="symbol"?T:x)[M.id]:void 0;this._renderTileClippingMasks(I,M,M?g[M.id]:void 0),this.renderLayer(this,M,I,P),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let I=null;l.values(this.style._layers).forEach(M=>{const P=t._getLayerSourceCache(M);P&&!M.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<P.getSource().maxzoom)&&(I=P)}),I&&this.options.showTileBoundaries&&xl.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const M=I.transform.padding;Qo(I,I.transform.height-(M.top||0),3,iu),Qo(I,M.bottom||0,3,Rt),cd(I,M.left||0,3,yl),cd(I,I.transform.width-(M.right||0),3,Qf);const P=I.transform.centerPoint;(function(F,V,$,U){vl(F,V-1,$-10,2,20,U),vl(F,V-10,$-1,20,2,U)})(I,P.x,I.transform.height-P.y,ld)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%l.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,a,p,m){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||m&&m.length)&&(this.id=p.id,this.gpuTimingStart(p),xl[p.type](t,a,p,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),p.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const a={};for(const p in t){const m=t[p],g=this.context.extTimerQuery,x=g.getQueryObjectEXT(m.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(m.query),a[p]=x}return a}translatePosMatrix(t,a,p,m,g){if(!p[0]&&!p[1])return t;const x=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const I=Math.sin(x),M=Math.cos(x);p=[p[0]*M-p[1]*I,p[0]*I+p[1]*M]}const T=[g?p[0]:$e(a,p[0],this.transform.zoom),g?p[1]:$e(a,p[1],this.transform.zoom),0],C=new Float32Array(16);return l.translate(C,t,T),C}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!a||!p}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),a&&!t&&a.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),t&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(t,a,p){this.cache=this.cache||{};const m=p||[],g=this.currentGlobalDefines().concat(m),x=ul.cacheKey(t,g,a);return this.cache[x]||(this.cache[x]=new ul(this.context,t,ol[t],a,Jf[t],g)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,a,p){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const g=m.getOpacity(this.transform.pitch);g!==0&&a.setFogUniformValues(t,((x,T,C,I)=>{const M=T.properties.get("color"),P=x.frameCounter/1e3%1,F=[M.r/M.a,M.g/M.a,M.b/M.a,I];return{u_fog_matrix:C?x.transform.calculateFogTileMatrix(C):x.identityMat,u_fog_range:T.getFovAdjustedRange(x.transform._fov),u_fog_color:F,u_fog_horizon_blend:T.properties.get("horizon-blend"),u_fog_temporal_offset:P}})(this,m,p,g))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const m of p)a[m.key]=t[m.key]||new l.Tile(m,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class ts{constructor(t=0,a=0,p=0,m=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=p,this.right=m}interpolate(t,a,p){return a.top!=null&&t.top!=null&&(this.top=l.number(t.top,a.top,p)),a.bottom!=null&&t.bottom!=null&&(this.bottom=l.number(t.bottom,a.bottom,p)),a.left!=null&&t.left!=null&&(this.left=l.number(t.left,a.left,p)),a.right!=null&&t.right!=null&&(this.right=l.number(t.right,a.right,p)),this}getCenter(t,a){const p=l.clamp((this.left+t-this.right)/2,0,t),m=l.clamp((this.top+a-this.bottom)/2,0,a);return new l.pointGeometry(p,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ts(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function jr(h,t){return[h[4*t],h[4*t+1],h[4*t+2],h[4*t+3]]}function zi(h,t,a){h[4*t+0]=a[0],h[4*t+1]=a[1],h[4*t+2]=a[2],h[4*t+3]=a[3]}function wl(h,t){const a=jr(h,3);l.fromQuat(h,t),zi(h,3,a)}function ou(h,t){zi(h,3,[t[0],t[1],t[2],1])}function bl(h,t){const a=l.identity$1([]);return l.rotateZ$1(a,a,-t),l.rotateX$1(a,a,-h),a}function $r(h,t){const a=[h[0],h[1],0],p=[t[0],t[1],0];if(l.length(a)>=1e-15){const x=l.normalize([],a);l.scale(p,x,l.dot(p,x)),t[0]=p[0],t[1]=p[1]}const m=l.cross([],t,h);if(l.len(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return bl(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),g)}class su{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(a){if(!a)return;const p=Array.isArray(a)?new l.MercatorCoordinate(a[0],a[1],a[2]):a;return p.x=l.wrap(p.x,0,1),p}(t):t}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(t)):0,m=this.position,g=l.MercatorCoordinate.fromLngLat(t,p),x=[g.x-m.x,g.y-m.y,g.z-m.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=$r(x,a)}setPitchBearing(t,a){this.orientation=bl(l.degToRad(t),l.degToRad(-a))}}class ns{constructor(t,a){this._transform=l.identity([]),this._orientation=l.identity$1([]),a&&(this._orientation=a,wl(this._transform,this._orientation)),t&&ou(this._transform,t)}get mercatorPosition(){const t=this.position;return new l.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=jr(this._transform,3);return[t[0],t[1],t[2]]}set position(t){ou(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,wl(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=bl(t,a),wl(this._transform,this._orientation)}forward(){const t=jr(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=jr(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=jr(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const p=new Float64Array(16);return l.invert(p,this.getWorldToCamera(t,a)),p}getWorldToCameraPosition(t,a,p){const m=this.position;l.scale(m,m,-t);const g=new Float64Array(16);return l.fromScaling(g,[p,p,p]),l.translate(g,g,m),g[10]*=a,g}getWorldToCamera(t,a){const p=new Float64Array(16),m=new Float64Array(4),g=this.position;return l.conjugate(m,this._orientation),l.scale(g,g,-t),l.fromQuat(p,m),l.translate(p,p,g),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=a,p[9]*=a,p[10]*=a,p[11]*=a,p}getCameraToClipPerspective(t,a,p,m){const g=new Float64Array(16);return l.perspective(g,t,a,p,m),g}getDistanceToElevation(t){const a=t===0?0:l.mercatorZfromAltitude(t,this.position[1]),p=this.forward();return(a-this.position[2])/p[2]}clone(){return new ns([...this.position],[...this.orientation])}}function Tl(h,t){const a=au(h),p=function(g,x,T,C,I){const M=new l.LngLat(T.lng-180*wo,T.lat),P=new l.LngLat(T.lng+180*wo,T.lat),F=g.project(M.lng,M.lat),V=g.project(P.lng,P.lat),$=-Math.atan2(V.y-F.y,V.x-F.x),U=l.MercatorCoordinate.fromLngLat(T);U.y=l.clamp(U.y,-.999975,.999975);const X=U.toLngLat(),N=g.project(X.lng,X.lat),H=l.MercatorCoordinate.fromLngLat(X);H.x+=wo;const J=H.toLngLat(),j=g.project(J.lng,J.lat),Q=dd(j.x-N.x,j.y-N.y,$),re=l.MercatorCoordinate.fromLngLat(X);re.y+=wo;const we=re.toLngLat(),xe=g.project(we.lng,we.lat),Se=dd(xe.x-N.x,xe.y-N.y,$),Ce=Math.abs(Q.x)/Math.abs(Se.y),Ue=l.identity([]);l.rotateZ(Ue,Ue,-$*(1-(I?0:C)));const Ee=l.identity([]);return l.scale$1(Ee,Ee,[1,1-(1-Ce)*C,1]),Ee[4]=-Se.x/Se.y*C,l.rotateZ(Ee,Ee,$),l.multiply(Ee,Ue,Ee),Ee}(h.projection,0,h.center,a,t),m=oa(h);return l.scale$1(p,p,[m,m,1]),p}function oa(h){const t=h.projection,a=au(h),p=bo(t,h.center),m=bo(t,l.LngLat.convert(t.center));return Math.pow(2,p*a+(1-a)*m)}function au(h){const t=h.projection.range;if(!t)return 0;const a=Math.max(h.width,h.height),p=Math.log(a/1024)/Math.LN2;return l.smoothstep(t[0]+p,t[1]+p,h.zoom)}const wo=1/4e4;function bo(h,t){const a=l.clamp(t.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),p=new l.LngLat(t.lng-180*wo,a),m=new l.LngLat(t.lng+180*wo,a),g=h.project(p.lng,a),x=h.project(m.lng,a),T=l.MercatorCoordinate.fromLngLat(p),C=l.MercatorCoordinate.fromLngLat(m),I=x.x-g.x,M=x.y-g.y,P=C.x-T.x,F=C.y-T.y,V=Math.sqrt((P*P+F*F)/(I*I+M*M));return Math.log(V)/Math.LN2}function dd(h,t,a){const p=Math.cos(a),m=Math.sin(a);return{x:h*p-t*m,y:h*m+t*p}}class lu{constructor(t,a,p,m,g){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=p==null?0:p,this._maxPitch=m==null?60:m,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ts,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ns,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new lu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.setMaxBounds(this.getMaxBounds()),t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.setProjection(this.getProjection()),t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(t){t==null&&(t={name:"mercator"}),this.projectionOptions=t;const a=this.projection?this.getProjection():void 0;return this.projection=l.getProjection(t),!he(a,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.wrap===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return l.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;var p;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(m,g,x){var T=g[0],C=g[1],I=g[2],M=g[3],P=Math.sin(x),F=Math.cos(x);m[0]=T*F+I*P,m[1]=C*F+M*P,m[2]=T*-P+I*F,m[3]=C*-P+M*F}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=l.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return t===-1?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,a=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(a+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let m=0,g=0;for(let x=0;x<a.length;x++){const T=new l.pointGeometry(a[x][0]*this.width,p+a[x][1]*(this.height-p)),C=t.pointCoordinate(T);if(!C)continue;const I=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);m+=C[3]*I,g+=I}return g===0?NaN:m/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const t=this._cameraZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=l.mercatorZfromAltitude(a,this.center.lat),m=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-p,g);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const m=l.length(l.sub([],this._camera.position,p));return l.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!l.exactEquals(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];l.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new su;return a.position=new l.MercatorCoordinate(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!l.length$1(t))return!1;l.normalize$1(t,t);const a=l.transformQuat([],[0,0,-1],t),p=l.transformQuat([],[0,-1,0],t);if(p[2]<0)return!1;const m=$r(a,p);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=l.clamp(t[2],m/p,m/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,p){this._unmodified=!1,this._edgeInsets.interpolate(t,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new l.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),m=this.pointCoordinate(new l.pointGeometry(this.width,0)),g=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new l.pointGeometry(0,this.height)),T=Math.floor(Math.min(p.x,m.x,g.x,x.x)),C=Math.floor(Math.max(p.x,m.x,g.x,x.x)),I=1;for(let M=T-I;M<=C+I;M++)M!==0&&a.push(new l.UnwrappedTileID(M,t))}return a}coveringTiles(t){let a=this.coveringZoomLevel(t);const p=a,m=this.elevation&&!t.isTerrainDEM,g=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const x=this.locationCoordinate(this.center),T=1<<a,C=[T*x.x,T*x.y,0],I=lt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a),M=this.pointCoordinate(this.getCameraPoint()),P=T*l.mercatorZfromAltitude(1,this.center.lat),F=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),V=[T*M.x,T*M.y,F],$=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),U=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&g?a:0,X=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,N=t.isTerrainDEM?-X:this._elevation?this._elevation.getMinElevationBelowMSL():0,H=oa(this),J=ye=>{const Ve=1/4e4,et=new l.MercatorCoordinate(ye.x+Ve,ye.y,ye.z),ct=new l.MercatorCoordinate(ye.x,ye.y+Ve,ye.z),ht=ye.toLngLat(),ft=et.toLngLat(),mt=ct.toLngLat(),at=this.locationCoordinate(ht),gt=this.locationCoordinate(ft),Ut=this.locationCoordinate(mt),xn=Math.hypot(gt.x-at.x,gt.y-at.y),Ln=Math.hypot(Ut.x-at.x,Ut.y-at.y);return Math.sqrt(xn*Ln)*H/Ve},j=(ye,Ve,et,ct,ht,ft)=>{const mt=l.tileTransform({z:ye,x:Ve,y:et},this.projection);return new He([(ct+mt.x/mt.scale)*T,T*(mt.y/mt.scale),ht],[(ct+mt.x2/mt.scale)*T,T*(mt.y2/mt.scale),ft])},Q=ye=>({aabb:j(0,0,0,ye,N,X),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),re=[];let we=[];const xe=a,Se=t.reparseOverscaled?p:a,Ce=ye=>{if(!this._elevation||!ye.tileID)return;const Ve=this._elevation.getMinMaxForTile(ye.tileID),et=ye.aabb;Ve?(et.min[2]=Ve.min,et.max[2]=Ve.max,et.center[2]=(et.min[2]+et.max[2])/2):(ye.shouldSplit=Ne(ye),ye.shouldSplit||(et.min[2]=et.max[2]=et.center[2]=this._centerAltitude))},Ue=ye=>ye*ye,Ee=Ue((F-this._centerAltitude)*P),Ne=ye=>{if(ye.zoom<U)return!0;if(ye.zoom===xe)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;const Ve=ye.aabb.distanceX(V),et=ye.aabb.distanceY(V);let ct=Ee;m&&(ct=Ue(ye.aabb.distanceZ(V)*P));let ht=1;if(!g&&p<=5){const mt=Math.pow(2,ye.zoom),at=J(new l.MercatorCoordinate((ye.x+.5)/mt,(ye.y+.5)/mt));ht=at>.85?1:at}const ft=Ve*Ve+et*et+ct;return ft<Ue((1<<xe-ye.zoom)*$*ht*((mt,at)=>{if(at*Ue(.707)<mt)return 1;const gt=Math.sqrt(at/mt);return gt/(1.4144271570014144+(Math.pow(1.1,gt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ct,Ee),ft))};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)re.push(Q(-ye)),re.push(Q(ye));for(re.push(Q(0));re.length>0;){const ye=re.pop(),Ve=ye.x,et=ye.y;let ct=ye.fullyVisible;if(!ct){const ht=ye.aabb.intersects(I);if(ht===0)continue;ct=ht===2}if(ye.zoom!==xe&&Ne(ye))for(let ht=0;ht<4;ht++){const ft=(Ve<<1)+ht%2,mt=(et<<1)+(ht>>1),at={aabb:this.projection.name==="mercator"?ye.aabb.quadrant(ht):j(ye.zoom+1,ft,mt,ye.wrap,0,0),zoom:ye.zoom+1,x:ft,y:mt,wrap:ye.wrap,fullyVisible:ct,tileID:void 0,shouldSplit:void 0};m&&(at.tileID=new l.OverscaledTileID(ye.zoom+1===xe?Se:ye.zoom+1,ye.wrap,ye.zoom+1,ft,mt),Ce(at)),re.push(at)}else{const ht=ye.zoom===xe?Se:ye.zoom;if(t.minzoom&&t.minzoom>ht)continue;const ft=C[0]-(.5+Ve+(ye.wrap<<ye.zoom))*(1<<a-ye.zoom),mt=C[1]-.5-et,at=ye.tileID?ye.tileID:new l.OverscaledTileID(ht,ye.wrap,ye.zoom,Ve,et);we.push({tileID:at,distanceSq:ft*ft+mt*mt})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,Ve=this.horizonLineFromTop();we=we.filter(et=>{const ct=[0,0,0,1],ht=[l.EXTENT,l.EXTENT,0,1],ft=this.calculateFogTileMatrix(et.tileID.toUnwrapped());l.transformMat4(ct,ct,ft),l.transformMat4(ht,ht,ft);const mt=l.getAABBPointSquareDist(ct,ht);if(mt===0)return!0;let at=!1;const gt=this._elevation;if(gt&&mt>ye&&Ve!==0){const Ut=this.calculateProjMatrix(et.tileID.toUnwrapped());let xn;t.isTerrainDEM||(xn=gt.getMinMaxForTile(et.tileID)),xn||(xn={min:N,max:X});const Ln=l.furthestTileCorner(this.rotation),$n=[Ln[0]*l.EXTENT,Ln[1]*l.EXTENT,xn.max];l.transformMat4$1($n,$n,Ut),at=(1-$n[1])*this.height*.5<Ve}return mt<ye||at})}return we.sort((ye,Ve)=>ye.distanceSq-Ve.distanceSq).map(ye=>ye.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=l.clamp(t.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),p=this.projection.project(t.lng,a);return new l.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,a){const p=this.pointCoordinate(a),m=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t);this.setLocation(new l.MercatorCoordinate(g.x-(p.x-m.x),g.y-(p.y-m.y)))}setLocation(t){this.center=this.coordinateLocation(t),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,a){const p=a?l.mercatorZfromAltitude(a,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new l.MercatorCoordinate(m.x,m.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const p=a!=null?a:this._centerAltitude,m=[t.x,t.y,0,1],g=[t.x,t.y,1,1];l.transformMat4(m,m,this.pixelMatrixInverse),l.transformMat4(g,g,this.pixelMatrixInverse);const x=g[3];l.scale$2(m,m,1/m[3]),l.scale$2(g,g,1/x);const T=m[2],C=g[2];return{p0:m,p1:g,t:T===C?0:(p-T)/(C-T)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return l.transformMat4(a,a,this.pixelMatrixInverse),l.transformMat4(p,p,this.pixelMatrixInverse),l.scale$2(a,a,1/a[3]),l.scale$2(p,p,1/p[3]),a[2]=l.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,p[2]=l.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,l.scale$2(a,a,1/this.worldSize),l.scale$2(p,p,1/this.worldSize),new Le([a[0],a[1],a[2]],l.normalize([],l.sub([],p,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:p,t:m}=t,g=l.mercatorZfromAltitude(a[2],this._center.lat),x=l.mercatorZfromAltitude(p[2],this._center.lat);return new l.MercatorCoordinate(l.number(a[0],p[0],m)/this.worldSize,l.number(a[1],p[1],m)/this.worldSize,l.number(g,x,m))}pointCoordinate(t,a=this._centerAltitude){const p=this.horizonLineFromTop(!1),m=new l.pointGeometry(t.x,Math.max(p,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(m,a))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const a=this.elevation;let p=this.elevation.pointCoordinate(t);if(p)return new l.MercatorCoordinate(p[0],p[1],p[2]);let m=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t);const x=.02*g,T=t.clone();for(let C=0;C<10&&g-m>x;C++){T.y=l.number(m,g,.66);const I=a.pointCoordinate(T);I?(g=T.y,p=I):m=T.y}return p?new l.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const a=this.horizonLineFromTop();return t.y<a}}_coordinatePoint(t,a){const p=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return l.transformMat4(m,m,this.pixelMatrix),m[3]>0?new l.pointGeometry(m[0]/m[3],m[1]/m[3]):new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,a){const p=new l.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new l.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),g=new l.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),x=new l.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let T=this.pointCoordinate(p,t),C=this.pointCoordinate(m,t);const I=this.pointCoordinate(g,a),M=this.pointCoordinate(x,a),P=(F,V)=>(V.y-F.y)/(V.x-F.x);return T.y>1&&C.y>=0?T=new l.MercatorCoordinate((1-M.y)/P(M,T)+M.x,1):T.y<0&&C.y<=1&&(T=new l.MercatorCoordinate(-M.y/P(M,T)+M.x,0)),C.y>1&&T.y>=0?C=new l.MercatorCoordinate((1-I.y)/P(I,C)+I.x,1):C.y<0&&T.y<=1&&(C=new l.MercatorCoordinate(-I.y/P(I,C)+I.x,0)),new l.LngLatBounds().extend(this.coordinateLocation(T)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(I))}_getBounds3D(){const t=this.elevation,a=t.visibleDemTiles.reduce((p,m)=>{if(m.dem){const g=m.dem.tree;p.min=Math.min(p.min,g.minimums[0]),p.max=Math.max(p.max,g.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){let p,m,g;const x=t.canonical,T=l.identity(new Float64Array(16));if(this.projection.name==="mercator")p=a/this.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*t.wrap)*p,g=x.y*p;else{const C=l.tileTransform(x,this.projection);p=1,m=C.x+t.wrap*C.scale,g=C.y,l.scale$1(T,T,[p/C.scale,p/C.scale,this.pixelsPerMeter/this.worldSize])}return l.translate(T,T,[m,g,0]),l.scale$1(T,T,[p/l.EXTENT,p/l.EXTENT,1]),T}calculateDistanceTileData(t){const a=t.key,p=this._distanceTileDataCache;if(p[a])return p[a];const m=t.canonical,g=1/this.height,x=this.cameraWorldSize/this.zoomScale(m.z),T=(m.x+Math.pow(2,m.z)*t.wrap)*x,C=m.y*x,I=this.point,M=this.angle,P=Math.sin(-M),F=-Math.cos(-M);return p[a]={bearing:[P,F],center:[(I.x-T)*g,(I.y-C)*g],scale:x/l.EXTENT*g},p[a]}calculateFogTileMatrix(t){const a=t.key,p=this._fogTileMatrixCache;if(p[a])return p[a];const m=this.calculatePosMatrix(t,this.cameraWorldSize);return l.multiply(m,this.worldToFogMatrix,m),p[a]=new Float32Array(m),p[a]}calculateProjMatrix(t,a=!1){const p=t.key,m=a?this._alignedProjMatrixCache:this._projMatrixCache;if(m[p])return m[p];const g=this.calculatePosMatrix(t,this.worldSize);return l.multiply(g,this.projection.name==="mercator"?a?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,g),m[p]=new Float32Array(g),m[p]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[a])return p[a];const m=function(g,x){const{scale:T}=g.tileTransform,C=T*l.EXTENT/(g.tileSize*Math.pow(2,x.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return I=new Float32Array(4),F=(M=x.inverseAdjustmentMatrix)[1],V=M[2],$=M[3],X=(P=[C,C])[1],I[0]=M[0]*(U=P[0]),I[1]=F*U,I[2]=V*X,I[3]=$*X,I;var I,M,P,F,V,$,U,X}(t,this);return p[a]=m,p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const a=this._camera.position,p=this._camera.forward();if(a[2]<=0||p[2]>=0)return;const m=l.mercatorZfromAltitude(1,this._center.lat);a[2]/=m,p[2]/=m,l.normalize(p,p);const g=t.raycast(a,p,t.exaggeration());if(g){const x=l.scaleAndAdd([],a,p,g),T=new l.MercatorCoordinate(x[0],x[1],l.mercatorZfromAltitude(x[2],l.latFromMercatorY(x[1]))),C=this._camera.position,I=T.z+l.length([T.x-C[0],T.y-C[1],T.z-C[2]]);this._cameraZoom=this._zoomFromMercatorZ(I),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const a=t.getAtPointOrZero(this._camera.mercatorPosition),p=this._minimumHeightOverTerrain()*Math.cos(l.degToRad(this._maxPitch)),m=l.mercatorZfromAltitude(a,this._center.lat),g=this._camera.position[2]-m;if(g<p){const x=this.locationCoordinate(this._center,this._centerAltitude),T=this._camera.mercatorPosition,C=[x.x-T.x,x.y-T.y,x.z-T.z],I=l.length(C);C[2]-=p-g;const M=l.length(C);if(M===0)return;l.scale(C,C,I/M),this._camera.position=[x.x-C[0],x.y-C[1],x.z-C[2]],this._camera.orientation=$r(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.name!=="mercator"){const P=this.center;return P.lat=l.clamp(P.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(P.lng=l.clamp(P.lng,this.minLng,this.maxLng)),this.center=P,void(this._constraining=!1)}const t=this._unmodified,{x:a,y:p}=this.point;let m=0,g=a,x=p;const T=this.width/2,C=this.height/2,I=this.worldMinY*this.scale,M=this.worldMaxY*this.scale;if(p-C<I&&(x=I+C),p+C>M&&(x=M-C),M-I<this.height&&(m=Math.max(m,this.height/(M-I)),x=(M+I)/2),this.maxBounds||!this.renderWorldCopies){const P=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,V=this.worldSize/2-(P+F)/2;g=(a+V+this.worldSize)%this.worldSize-V,g-T<P&&(g=P+T),g+T>F&&(g=F-T),F-P<this.width&&(m=Math.max(m,this.width/(F-P)),g=(F+P)/2)}g===a&&x===p||(this.center=this.unproject(new l.pointGeometry(g,x))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const a=this.pixelsPerMeter;this._updateCameraState();const p=Math.PI/2+this._pitch,m=this.fovAboveCenter,g=this.elevation?this.elevation.getMinElevationBelowMSL()*a:0,x=(this._camera.position[2]*this.worldSize-g)/Math.cos(this._pitch),T=Math.sin(m)*x/Math.sin(l.clamp(Math.PI-p-m,.01,Math.PI-.01)),C=this.point,I=C.x,M=C.y,P=Math.cos(Math.PI/2-this._pitch)*T+x,F=Math.min(1.01*P,x*(1/this._horizonShift)),V=this.height/50,$=this._camera.getWorldToCamera(this.worldSize,a),U=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,V,F);U[8]=2*-t.x/this.width,U[9]=2*t.y/this.height;let X=l.mul$1([],U,$);if(this.projection.name!=="mercator"){const Ue=this.locationCoordinate(this.center),Ee=l.identity([]);l.translate(Ee,Ee,[Ue.x*this.worldSize,Ue.y*this.worldSize,0]),l.multiply(Ee,Ee,Tl(this)),l.translate(Ee,Ee,[-Ue.x*this.worldSize,-Ue.y*this.worldSize,0]),l.multiply(X,X,Ee),this.inverseAdjustmentMatrix=function(Ne){const ye=Tl(Ne,!0);return De([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale$1([],X,[this.worldSize,this.worldSize,this.worldSize/a]),this.projMatrix=X,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const N=new Float32Array(16);l.identity(N),l.scale$1(N,N,[1,-1,1]),l.rotateX(N,N,this._pitch),l.rotateZ(N,N,this.angle);const H=l.perspective(new Float32Array(16),this._fov,this.width/this.height,V,F),J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-t.x/this.width,H[9]=2*(t.y+J)/this.height,this.skyboxMatrix=l.multiply(N,H,N);const j=this.width%2/2,Q=this.height%2/2,re=Math.cos(this.angle),we=Math.sin(this.angle),xe=I-Math.round(I)+re*j+we*Q,Se=M-Math.round(M)+re*Q+we*j,Ce=new Float64Array(X);if(l.translate(Ce,Ce,[xe>.5?xe-1:xe,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=Ce,X=l.create$1(),l.scale$1(X,X,[this.width/2,-this.height/2,1]),l.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=l.create$1(),l.scale$1(X,X,[1,-1,1]),l.translate(X,X,[-1,-1,0]),l.scale$1(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},X=l.invert(new Float64Array(16),this.pixelMatrix),!X)throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,a=this.cameraPixelsPerMeter,p=this._camera.position,m=1/this.height,g=[t,t,a];l.scale(g,g,m),l.scale(p,p,-1),l.multiply$1(p,p,g);const x=l.create$1();l.translate(x,x,p),l.scale$1(x,x,g),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,m)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),a=this.cameraToCenterDistance,p=this.point,m=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-l.mercatorZfromAltitude(this._centerAltitude,this.center.lat),g=this.cameraToCenterDistance/m;this._camera.position=[p.x/this.worldSize-t[0]*a/g,p.y/this.worldSize-t[1]*a/g,l.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*a/g]}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=t[2];let m=1;p>0&&(m=Math.min((a-this._camera.position[2])/p,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:p,bearing:m}=this._camera.getPitchBearing(),g=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat),x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),T=Math.max((t[2]-g)/Math.cos(p),x),C=this._zoomFromMercatorZ(T);l.scaleAndAdd(t,t,a,T),this._pitch=l.clamp(p,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(m,-Math.PI,Math.PI),this._setZoom(l.clamp(C,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new l.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||this.projection.name!=="mercator"&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,a){const p=Math.min(t.x,a.x),m=Math.max(t.x,a.x),g=Math.min(t.y,a.y),x=Math.max(t.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new l.pointGeometry(p,g),new l.pointGeometry(m,x),new l.pointGeometry(p,x),new l.pointGeometry(m,g)],C=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const M of T){const P=this.pointRayIntersection(M);if(P.t<0)return!0;const F=this.rayIntersectionCoordinate(P);if(F.x<C||F.y<0||F.x>I||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.pointGeometry(0,0),new l.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,a){const p=l.length(l.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(p)+a;return p-this._mercatorZfromZoom(m)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,t))}}function cu(h,t){let a=!1,p=null;const m=()=>{p=null,a&&(h(),p=setTimeout(m,t),a=!1)};return()=>(a=!0,p||m(),p)}class El{constructor(t){this._hashName=t&&encodeURIComponent(t),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=cu(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,l.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return l.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),x=Math.round(a.lng*g)/g,T=Math.round(a.lat*g)/g,C=this._map.getBearing(),I=this._map.getPitch();let M="";if(M+=t?`/${x}/${T}/${p}`:`${p}/${T}/${x}`,(C||I)&&(M+="/"+Math.round(10*C)/10),I&&(M+=`/${Math.round(I)}`),this._hashName){const P=this._hashName;let F=!1;const V=l.window.location.hash.slice(1).split("&").map($=>{const U=$.split("=")[0];return U===P?(F=!0,`${U}=${M}`):$}).filter($=>$);return F||V.push(`${P}=${M}`),`#${V.join("&")}`}return`#${M}`}_getCurrentHash(){const t=l.window.location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(a=p)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:a,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,t)}}const is={linearity:.3,easing:l.bezier(0,0,.3,1)},pd=l.extend({deceleration:2500,maxSpeed:1400},is),fd=l.extend({deceleration:20,maxSpeed:1400},is),Sl=l.extend({deceleration:1e3,maxSpeed:360},is),uu=l.extend({deceleration:1e3,maxSpeed:90},is);class md{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=l.exported.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const g=aa(a.pan.mag(),p,l.extend({},pd,t||{}));m.offset=a.pan.mult(g.amount/a.pan.mag()),m.center=this._map.transform.center,sa(m,g)}if(a.zoom){const g=aa(a.zoom,p,fd);m.zoom=this._map.transform.zoom+g.amount,sa(m,g)}if(a.bearing){const g=aa(a.bearing,p,Sl);m.bearing=this._map.transform.bearing+l.clamp(g.amount,-179,179),sa(m,g)}if(a.pitch){const g=aa(a.pitch,p,uu);m.pitch=this._map.transform.pitch+g.amount,sa(m,g)}if(m.zoom||m.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),l.extend(m,{noMoveStart:!0})}}function sa(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function aa(h,t,a){const{maxSpeed:p,linearity:m,deceleration:g}=a,x=l.clamp(h*m/(t/1e3),-p,p),T=Math.abs(x)/(g*m);return{easing:a.easing,duration:1e3*T,amount:x*(T/2)}}class oi extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,p,m={}){const g=ne.mousePos(a.getCanvasContainer(),p),x=a.unproject(g);super(t,l.extend({point:g,lngLat:x,originalEvent:p},m)),this._defaultPrevented=!1,this.target=a}}class la extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,p){const m=t==="touchend"?p.changedTouches:p.touches,g=ne.touchPos(a.getCanvasContainer(),m),x=g.map(C=>a.unproject(C)),T=g.reduce((C,I,M,P)=>C.add(I.div(P.length)),new l.pointGeometry(0,0));super(t,{points:g,point:T,lngLats:x,lngLat:a.unproject(T),originalEvent:p}),this._defaultPrevented=!1}}class rs extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class _d{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new rs(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new oi(t.type,this._map,t))}mouseup(t){this._map.fire(new oi(t.type,this._map,t))}preclick(t){const a=l.extend({},t);a.type="preclick",this._map.fire(new oi(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new oi(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new oi(t.type,this._map,t))}mouseover(t){this._map.fire(new oi(t.type,this._map,t))}mouseout(t){this._map.fire(new oi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new la(t.type,this._map,t))}touchmove(t){this._map.fire(new la(t.type,this._map,t))}touchend(t){this._map.fire(new la(t.type,this._map,t))}touchcancel(t){this._map.fire(new la(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gd{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new oi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new oi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new oi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yd{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(ne.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const p=a;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=ne.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(m.x,p.x),x=Math.max(m.x,p.x),T=Math.min(m.y,p.y),C=Math.max(m.y,p.y);this._map._requestDomTask(()=>{this._box&&(ne.setTransform(this._box,`translate(${g}px,${T}px)`),this._box.style.width=x-g+"px",this._box.style.height=C-T+"px")})}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const p=this._startPos,m=a;if(this.reset(),ne.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(p,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ne.remove(this._box),this._box=null),ne.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new l.Event(t,{originalEvent:a}))}}function Cl(h,t){const a={};for(let p=0;p<h.length;p++)a[h[p].identifier]=t[p];return a}class vd{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const g=new l.pointGeometry(0,0);for(const x of m)g._add(x);return g.div(m.length)}(a),this.touches=Cl(p,a)))}touchmove(t,a,p){if(this.aborted||!this.centroid)return;const m=Cl(p,a);for(const g in this.touches){const x=this.touches[g],T=m[g];(!T||T.dist(x)>30)&&(this.aborted=!0)}}touchend(t,a,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Al{constructor(t){this.singleTap=new vd(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,p){this.singleTap.touchstart(t,a,p)}touchmove(t,a,p){this.singleTap.touchmove(t,a,p)}touchend(t,a,p){const m=this.singleTap.touchend(t,a,p);if(m){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class jn{constructor(){this._zoomIn=new Al({numTouches:1,numTaps:2}),this._zoomOut=new Al({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,p){this._zoomIn.touchstart(t,a,p),this._zoomOut.touchstart(t,a,p)}touchmove(t,a,p){this._zoomIn.touchmove(t,a,p),this._zoomOut.touchmove(t,a,p)}touchend(t,a,p){const m=this._zoomIn.touchend(t,a,p),g=this._zoomOut.touchend(t,a,p);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tm={0:1,2:2};class Xi{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const p=ne.mouseButton(t);this._correctButton(t,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(t,a){const p=this._lastPoint;if(p){if(t.preventDefault(),function(m,g){const x=tm[g];return m.buttons===void 0||(m.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}}mouseupWindow(t){this._lastPoint&&ne.mouseButton(t)===this._eventButton&&(this._moved&&ne.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xd extends Xi{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class xr extends Xi{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const p=.8*(a.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class To extends Xi{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const p=-.5*(a.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class nm{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(t,a,p){return this._calculateTransform(t,a,p)}touchmove(t,a,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,a,p)}}touchend(t,a,p){this._calculateTransform(t,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,p){p.length>0&&(this._active=!0);const m=Cl(p,a),g=new l.pointGeometry(0,0),x=new l.pointGeometry(0,0);let T=0;for(const I in m){const M=m[I],P=this._touches[I];P&&(g._add(M),x._add(M.sub(P)),T++,m[I]=M)}if(this._touches=m,T<this._minTouches||!x.mag())return;const C=x.div(T);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(T),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class hu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,a,p){return{}}touchstart(t,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,p){if(!this._firstTwoTouches)return;t.preventDefault();const[m,g]=this._firstTwoTouches,x=kl(p,a,m),T=kl(p,a,g);if(!x||!T)return;const C=this._aroundCenter?null:x.add(T).div(2);return this._move([x,T],C,t)}touchend(t,a,p){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,x=kl(p,a,m),T=kl(p,a,g);x&&T||(this._active&&ne.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function kl(h,t,a){for(let p=0;p<h.length;p++)if(h[p].identifier===a)return t[p]}function wd(h,t){return Math.log(h/t)/Math.LN2}class bd extends hu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(wd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wd(this._distance,p),pinchAround:a}}}function os(h,t){return 180*h.angleWith(t)/Math.PI}class ar extends hu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:os(this._vector,p),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,p=os(t,this._startVector);return Math.abs(p)<a}}function Il(h){return Math.abs(h.y)>Math.abs(h.x)}class Td extends hu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,Il(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,p){const m=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&p.touches.length<3)&&(this._valid=this.gestureBeginsVertically(m,g,p.timeStamp),this._valid))return this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+g.y)/2*-.5}}gestureBeginsVertically(t,a,p){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,g=a.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const x=t.y>0==a.y>0;return Il(t)&&Il(a)&&x}}const ca={panStep:100,bearingStep:15,pitchStep:10};class Qe{constructor(){const t=ca;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,p=0,m=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:T=>{const C=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Ed,zoom:a?Math.round(C)+a*(t.shiftKey?2:1):C,bearing:T.getBearing()+p*this._bearingStep,pitch:T.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:T.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ed(h){return h*(2-h)}const du=4.000244140625;class ua{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=l.exported.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,a!==0&&a%du==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ne.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,a=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>du?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&I!==0&&(I=1/I);const M=a(),P=Math.pow(2,M),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):P;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*I))),this._type==="wheel"&&(this._startZoom=a(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:a(),m=this._startZoom,g=this._easing;let x,T=!1;if(this._type==="wheel"&&m&&g){const C=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),I=g(C);x=l.number(m,p,I),C<1?this._frameId||(this._frameId=!0):T=!0}else x=p,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:x-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=l.ease;if(this._prevEase){const p=this._prevEase,m=(l.exported.now()-p.start)/p.duration,g=p.easing(m+.01)-p.easing(m),x=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-x*x);a=l.bezier(x,T,.25,1)}return this._prevEase={start:l.exported.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!l.window.document.fullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class ha{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cd{constructor(){this._tap=new Al({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,a,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,a,p))}touchmove(t,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=a[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,a,p)}touchend(t,a,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,a,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ad{constructor(t,a,p){this._el=t,this._mousePan=a,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class kd{constructor(t,a,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Id{constructor(t,a,p,m){this._el=t,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const da=h=>h.zoom||h.drag||h.pitch||h.rotate;class Md extends l.Event{}class Ml{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const p=l.sub([],a,t);this.radius=l.length(p[2]<0?l.div([],p,this.constants):[p[0],p[1],0])}projectRay(t){l.div(t,t,this.constants),l.normalize(t,t),l.mul$2(t,t,this.constants);const a=l.scale([],t,this.radius);if(a[2]>0){const p=l.scale([],[0,0,1],l.dot(a,[0,0,1])),m=l.scale([],l.normalize([],[a[0],a[1],0]),this.radius),g=l.add([],a,l.scale([],l.sub([],l.add([],m,p),a),2));a[0]=g[0],a[1]=g[1]}return a}}function ss(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Pl{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new md(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ml,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[m,g,x]of this._listeners)ne.addEventListener(m,g,m===l.window.document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,a,p]of this._listeners)ne.removeEventListener(t,a,t===l.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new _d(a,t));const m=a.boxZoom=new yd(a,t);this._add("boxZoom",m);const g=new jn,x=new Sd;a.doubleClickZoom=new ha(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const T=new Cd;this._add("tapDragZoom",T);const C=a.touchPitch=new Td(a);this._add("touchPitch",C);const I=new xr(t),M=new To(t);a.dragRotate=new kd(t,I,M),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const P=new xd(t),F=new nm(a,t);a.dragPan=new Ad(p,P,F),this._add("mousePan",P),this._add("touchPan",F,["touchZoom","touchRotate"]);const V=new ar,$=new bd;a.touchZoomRotate=new Id(p,$,V,T),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new gd(a));const U=a.scrollZoom=new ua(a,this);this._add("scrollZoom",U,["mousePan"]);const X=a.keyboard=new Qe;this._add("keyboard",X);for(const N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[N]&&a[N].enable(t[N])}_add(t,a,p){this._handlers.push({handlerName:t,handler:a,allowed:p}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(da(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,a,p){for(const m in t)if(m!==p&&(!a||a.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const p of t)this._el.contains(p.target)&&a.push(p);return a}handleEvent(t,a){this._updatingCamera=!0;const p=t.type==="renderFrame",m=p?void 0:t,g={needsRenderFrame:!1},x={},T={},C=t.touches?this._getMapTouches(t.touches):void 0,I=C?ne.touchPos(this._el,C):p?void 0:ne.mousePos(this._el,t);for(const{handlerName:F,handler:V,allowed:$}of this._handlers){if(!V.isEnabled())continue;let U;this._blockedByActive(T,$,F)?V.reset():V[a||t.type]&&(U=V[a||t.type](t,I,C),this.mergeHandlerResult(g,x,U,F,m),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||V.isActive())&&(T[F]=V)}const M={};for(const F in this._previousActiveHandlers)T[F]||(M[F]=m);this._previousActiveHandlers=T,(Object.keys(M).length||ss(g))&&(this._changes.push([g,x,M]),this._triggerRenderFrame()),(Object.keys(T).length||ss(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:P}=g;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(t,a,p,m,g){if(!p)return;l.extend(t,p);const x={handlerName:m,originalEvent:p.originalEvent||g};p.zoomDelta!==void 0&&(a.zoom=x),p.panDelta!==void 0&&(a.drag=x),p.pitchDelta!==void 0&&(a.pitch=x),p.bearingDelta!==void 0&&(a.rotate=x)}_applyChanges(){const t={},a={},p={};for(const[m,g,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new l.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),l.extend(a,g),l.extend(p,x);this._updateMapTransform(t,a,p),this._changes=[]}_updateMapTransform(t,a,p){const m=this._map,g=m.transform,x=H=>[H.x,H.y,H.z];if((H=>{const J=this._eventsInProgress.drag;return J&&!this._handlersById[J.handlerName].isActive()})()&&!ss(t)){const H=g.zoom;g.cameraElevationReference="sea",g.recenterOnTerrain(),g.cameraElevationReference="ground",H!==g.zoom&&this._map._update(!0)}if(!ss(t))return this._fireEvents(a,p,!0);let{panDelta:T,zoomDelta:C,bearingDelta:I,pitchDelta:M,around:P,aroundCoord:F,pinchAround:V}=t;V!==void 0&&(P=V),(H=>a.drag&&!this._eventsInProgress.drag)()&&P&&(this._dragOrigin=x(g.pointCoordinate3D(P)),this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),P=P||m.transform.centerPoint,I&&(g.bearing+=I),M&&(g.pitch+=M),g._updateCameraState();const $=[0,0,0];if(T){const H=g.screenPointToMercatorRay(P),J=g.screenPointToMercatorRay(P.sub(T)),j=this._trackingEllipsoid.projectRay(H.dir),Q=this._trackingEllipsoid.projectRay(J.dir);$[0]=Q[0]-j[0],$[1]=Q[1]-j[1]}const U=g.zoom,X=[0,0,0];if(C){const H=x(F||g.pointCoordinate3D(P)),J={dir:l.normalize([],l.sub([],H,g._camera.position))},j=g.screenPointToMercatorRay(g.centerPoint);if(J.dir[2]<0){const Q=l.altitudeFromMercatorZ(H[2],H[1]),re=g.rayIntersectionCoordinate(g.pointRayIntersection(g.centerPoint,Q)),we=g.zoomDeltaToMovement(x(re),C)*(j.dir[2]/J.dir[2]);l.scale(X,J.dir,we)}else if(g._terrainEnabled()){const Q=g.zoomDeltaToMovement(H,C);l.scale(X,J.dir,Q)}}const N=l.add($,$,X);g._translateCameraConstrained(N),C&&Math.abs(g.zoom-U)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,p,!0)}_fireEvents(t,a,p){const m=da(this._eventsInProgress),g=da(t),x={};for(const M in t){const{originalEvent:P}=t[M];this._eventsInProgress[M]||(x[`${M}start`]=P),this._eventsInProgress[M]=t[M]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const M in x)this._fireEvent(M,x[M]);g&&this._fireEvent("move",g.originalEvent);for(const M in t){const{originalEvent:P}=t[M];this._fireEvent(M,P)}const T={};let C;for(const M in this._eventsInProgress){const{handlerName:P,originalEvent:F}=this._eventsInProgress[M];this._handlersById[P].isActive()||(delete this._eventsInProgress[M],C=a[P]||F,T[`${M}end`]=C)}for(const M in T)this._fireEvent(M,T[M]);const I=da(this._eventsInProgress);if(p&&(m||g)&&!I){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;M?(P(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:C})):(this._map.fire(new l.Event("moveend",{originalEvent:C})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new l.Event(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Md("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const pu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pd extends l.Evented{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,p){return t=l.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,l.extend({offset:t},a),p)}panTo(t,a,p){return this.easeTo(l.extend({center:t},a),p)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,p){return this.easeTo(l.extend({zoom:t},a),p)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,p){return this.easeTo(l.extend({bearing:t},a),p)}resetNorth(t,a){return this.rotateTo(0,l.extend({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=l.LngLatBounds.convert(t);const p=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,a)}_extendCameraOptions(t){const a={top:0,bottom:0,right:0,left:0};if(typeof(t=l.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const p=t.padding;t.padding={top:p,bottom:p,right:p,left:p}}return t.padding=l.extend(a,t.padding),t}_cameraForBoxAndBearing(t,a,p,m){const g=this._extendCameraOptions(m),x=this.transform,T=x.padding,C=x.project(l.LngLat.convert(t)),I=x.project(l.LngLat.convert(a)),M=C.rotate(-l.degToRad(p)),P=I.rotate(-l.degToRad(p)),F=new l.pointGeometry(Math.max(M.x,P.x),Math.max(M.y,P.y)),V=new l.pointGeometry(Math.min(M.x,P.x),Math.min(M.y,P.y)),$=F.sub(V),U=(x.width-(T.left+T.right+g.padding.left+g.padding.right))/$.x,X=(x.height-(T.top+T.bottom+g.padding.top+g.padding.bottom))/$.y;if(X<0||U<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const N=Math.min(x.scaleZoom(x.scale*Math.min(U,X)),g.maxZoom),H=typeof g.offset.x=="number"?new l.pointGeometry(g.offset.x,g.offset.y):l.pointGeometry.convert(g.offset),J=new l.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(p*Math.PI/180),j=H.add(J).mult(x.scale/x.zoomScale(N));return{center:x.unproject(C.add(I).div(2).sub(j)),zoom:N,bearing:p}}_cameraForBox(t,a,p,m,g){const x=this._extendCameraOptions(g);p=p||0,m=m||0,t=l.LngLat.convert(t),a=l.LngLat.convert(a);const T=this.transform.clone();T.padding=x.padding;const C=this.getFreeCameraOptions(),I=new l.LngLat(.5*(t.lng+a.lng),.5*(t.lat+a.lat)),M=.5*(p+m);if(T._camera.position[2]<l.mercatorZfromAltitude(M,I.lat))return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");C.lookAtPoint(I),T.setFreeCameraOptions(C);const P=l.MercatorCoordinate.fromLngLat(t),F=l.MercatorCoordinate.fromLngLat(a),V=T.pointRayIntersection(T.centerPoint,M),$=[(U=T.rayIntersectionCoordinate(V)).x,U.y,U.z];var U;const X=T.screenPointToMercatorRay(T.centerPoint);let N,H=0;do{const J=Math.floor(T.zoom),j=1<<J,Q=Math.min(j*P.x,j*F.x),re=Math.min(j*P.y,j*F.y),we=Math.max(j*P.x,j*F.x),xe=Math.max(j*P.y,j*F.y),Se=new He([Q,re,p],[we,xe,m]),Ce=lt.fromInvProjectionMatrix(T.invProjMatrix,T.worldSize,J);if(Se.intersects(Ce)!==2){N&&(T._camera.position=l.scaleAndAdd([],T._camera.position,X.dir,-N),T._updateStateFromCamera());break}const Ue=l.sub([],T._camera.position,$);N=.5*l.length(Ue),T._camera.position=l.scaleAndAdd([],T._camera.position,X.dir,N);try{T._updateStateFromCamera()}catch{return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++H<10);return{center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch}}fitBounds(t,a,p){return this._fitInternal(this.cameraForBounds(t,a),a,p)}_raycastElevationBox(t,a){const p=this.transform.elevation;if(!p)return;const m=new l.pointGeometry(t.x,a.y),g=new l.pointGeometry(a.x,t.y),x=p.pointCoordinate(t);if(!x)return;const T=p.pointCoordinate(a);if(!T)return;const C=p.pointCoordinate(m);if(!C)return;const I=p.pointCoordinate(g);if(!I)return;const M=new l.MercatorCoordinate(x[0],x[1]).toLngLat(),P=new l.MercatorCoordinate(T[0],T[1]).toLngLat(),F=new l.MercatorCoordinate(C[0],C[1]).toLngLat(),V=new l.MercatorCoordinate(I[0],I[1]).toLngLat(),$=Math.min(M.lng,Math.min(P.lng,Math.min(F.lng,V.lng))),U=Math.min(M.lat,Math.min(P.lat,Math.min(F.lat,V.lat))),X=Math.max(M.lng,Math.max(P.lng,Math.max(F.lng,V.lng))),N=Math.max(M.lat,Math.max(P.lat,Math.max(F.lat,V.lat))),H=Math.min(x[3],Math.min(T[3],Math.min(C[3],I[3]))),J=Math.max(x[3],Math.max(T[3],Math.max(C[3],I[3])));return{minLngLat:new l.LngLat($,U),maxLngLat:new l.LngLat(X,N),minAltitude:H,maxAltitude:J}}fitScreenCoordinates(t,a,p,m,g){let x,T,C,I;const M=l.pointGeometry.convert(t),P=l.pointGeometry.convert(a),F=this._raycastElevationBox(M,P);if(F)x=F.minLngLat,T=F.maxLngLat,C=F.minAltitude,I=F.maxAltitude;else{if(this.transform.anyCornerOffEdge(M,P))return this;x=this.transform.pointLocation(M),T=this.transform.pointLocation(P)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(t)),this.transform.pointLocation(l.pointGeometry.convert(a)),p,m):this._cameraForBox(x,T,C,I,m),m,g)}_fitInternal(t,a,p){return t?(delete(a=l.extend(t,a)).padding,a.linear?this.easeTo(a,p):this.flyTo(a,p)):this}jumpTo(t,a){this.stop();const p=this.transform;let m=!1,g=!1,x=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(m=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=l.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(g=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(x=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this.fire(new l.Event("movestart",a)).fire(new l.Event("move",a)),m&&this.fire(new l.Event("zoomstart",a)).fire(new l.Event("zoom",a)).fire(new l.Event("zoomend",a)),g&&this.fire(new l.Event("rotatestart",a)).fire(new l.Event("rotate",a)).fire(new l.Event("rotateend",a)),x&&this.fire(new l.Event("pitchstart",a)).fire(new l.Event("pitch",a)).fire(new l.Event("pitchend",a)),this.fire(new l.Event("moveend",a))}getFreeCameraOptions(){return this.transform.projection.name!=="mercator"&&l.warnOnce(pu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const p=this.transform;if(p.projection.name!=="mercator")return void l.warnOnce(pu);this.stop();const m=p.zoom,g=p.pitch,x=p.bearing;p.setFreeCameraOptions(t);const T=m!==p.zoom,C=g!==p.pitch,I=x!==p.bearing;return this.fire(new l.Event("movestart",a)).fire(new l.Event("move",a)),T&&this.fire(new l.Event("zoomstart",a)).fire(new l.Event("zoom",a)).fire(new l.Event("zoomend",a)),I&&this.fire(new l.Event("rotatestart",a)).fire(new l.Event("rotate",a)).fire(new l.Event("rotateend",a)),C&&this.fire(new l.Event("pitchstart",a)).fire(new l.Event("pitch",a)).fire(new l.Event("pitchend",a)),this.fire(new l.Event("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=l.extend({offset:[0,0],duration:500,easing:l.ease},t)).animate===!1||!t.essential&&l.exported.prefersReducedMotion)&&(t.duration=0);const p=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),T=this.getPadding(),C="zoom"in t?+t.zoom:m,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,M="pitch"in t?+t.pitch:x,P="padding"in t?t.padding:p.padding,F=l.pointGeometry.convert(t.offset);let V=p.centerPoint.add(F);const $=p.pointLocation(V),U=l.LngLat.convert(t.center||$);this._normalizeCenter(U);const X=p.project($),N=p.project(U).sub(X),H=p.zoomScale(C-m);let J,j;t.around&&(J=l.LngLat.convert(t.around),j=p.locationPoint(J));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||C!==m,this._rotating=this._rotating||g!==I,this._pitching=this._pitching||M!==x,this._padding=!p.isPaddingEqual(P),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Q),this._ease(re=>{if(this._zooming&&(p.zoom=l.number(m,C,re)),this._rotating&&(p.bearing=l.number(g,I,re)),this._pitching&&(p.pitch=l.number(x,M,re)),this._padding&&(p.interpolatePadding(T,P,re),V=p.centerPoint.add(F)),J)p.setLocationAtPoint(J,j);else{const we=p.zoomScale(p.zoom-m),xe=C>m?Math.min(2,H):Math.max(.5,H),Se=Math.pow(xe,1-re),Ce=p.unproject(X.add(N.mult(re*Se)).mult(we));p.setLocationAtPoint(p.renderWorldCopies?Ce.wrap():Ce,V)}this._fireMoveEvents(a)},re=>{p.recenterOnTerrain(),this._afterEase(a,re)},t),this}_prepareEase(t,a,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||p.moving||this.fire(new l.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new l.Event("move",t)),this._zooming&&this.fire(new l.Event("zoom",t)),this._rotating&&this.fire(new l.Event("rotate",t)),this._pitching&&this.fire(new l.Event("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",t)),m&&this.fire(new l.Event("rotateend",t)),g&&this.fire(new l.Event("pitchend",t)),this.fire(new l.Event("moveend",t))}flyTo(t,a){if(!t.essential&&l.exported.prefersReducedMotion){const Ve=l.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ve,a)}this.stop(),t=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},t);const p=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),T=this.getPadding(),C="zoom"in t?l.clamp(+t.zoom,p.minZoom,p.maxZoom):m,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,M="pitch"in t?+t.pitch:x,P="padding"in t?t.padding:p.padding,F=p.zoomScale(C-m),V=l.pointGeometry.convert(t.offset);let $=p.centerPoint.add(V);const U=p.pointLocation($),X=l.LngLat.convert(t.center||U);this._normalizeCenter(X);const N=p.project(U),H=p.project(X).sub(N);let J=t.curve;const j=Math.max(p.width,p.height),Q=j/F,re=H.mag();if("minZoom"in t){const Ve=l.clamp(Math.min(t.minZoom,m,C),p.minZoom,p.maxZoom),et=j/p.zoomScale(Ve-m);J=Math.sqrt(et/re*2)}const we=J*J;function xe(Ve){const et=(Q*Q-j*j+(Ve?-1:1)*we*we*re*re)/(2*(Ve?Q:j)*we*re);return Math.log(Math.sqrt(et*et+1)-et)}function Se(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function Ce(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Ue=xe(0);let Ee=function(Ve){return Ce(Ue)/Ce(Ue+J*Ve)},Ne=function(Ve){return j*((Ce(Ue)*(Se(et=Ue+J*Ve)/Ce(et))-Se(Ue))/we)/re;var et},ye=(xe(1)-Ue)/J;if(Math.abs(re)<1e-6||!isFinite(ye)){if(Math.abs(j-Q)<1e-6)return this.easeTo(t,a);const Ve=Q<j?-1:1;ye=Math.abs(Math.log(Q/j))/J,Ne=function(){return 0},Ee=function(et){return Math.exp(Ve*J*et)}}return t.duration="duration"in t?+t.duration:1e3*ye/("screenSpeed"in t?+t.screenSpeed/J:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==I,this._pitching=M!==x,this._padding=!p.isPaddingEqual(P),this._prepareEase(a,!1),this._ease(Ve=>{const et=Ve*ye,ct=1/Ee(et);p.zoom=Ve===1?C:m+p.scaleZoom(ct),this._rotating&&(p.bearing=l.number(g,I,Ve)),this._pitching&&(p.pitch=l.number(x,M,Ve)),this._padding&&(p.interpolatePadding(T,P,Ve),$=p.centerPoint.add(V));const ht=Ve===1?X:p.unproject(N.add(H.mult(Ne(et))).mult(ct));p.setLocationAtPoint(p.renderWorldCopies?ht.wrap():ht,$),p._updateCenterElevation(),this._fireMoveEvents(a)},()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,a)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,a,p){p.animate===!1||p.duration===0?(t(1),a()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=l.wrap(t,-180,180);const p=Math.abs(t-a);return Math.abs(t-360-a)<p&&(t-=360),Math.abs(t+360-a)<p&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const p=t.lng-a.center.lng;t.lng+=p>180?-360:p<-180?360:0}}class fu{constructor(t={}){this.options=t,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact;return this._map=t,this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ne.create("button","mapboxgl-ctrl-attrib-button",this._container),ne.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ne.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ne.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const p=this._map._getUIString(`AttributionControl.${a}`);t.setAttribute("aria-label",p),t.firstElementChild&&t.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(t){const p=a.reduce((m,g,x)=>(g.value&&(m+=`${g.key}=${g.value}${x<a.length-1?"&":""}`),m),"?");t.href=`${l.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style._sourceCaches;for(const m in a){const g=a[m];if(g.used){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((m,g)=>m.length-g.length),t=t.filter((m,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class mu{constructor(){l.bindAll(["_updateLogo"],this),l.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=ne.create("div","mapboxgl-ctrl");const a=ne.create("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ne.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const p=t[a].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class _u{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const m of p)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function gu(h,t,a){if(h=new l.LngLat(h.lng,h.lat),t){const p=new l.LngLat(h.lng-360,h.lat),m=new l.LngLat(h.lng+360,h.lat),g=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),x=a.locationPoint(h).distSqr(t),T=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint(p).distSqr(t)<x&&(T||Math.abs(p.lng-a.center.lng)<g)?h=p:a.locationPoint(m).distSqr(t)<x&&(T||Math.abs(m.lng-a.center.lng)<g)&&(h=m)}for(;Math.abs(h.lng-a.center.lng)>180;){const p=a.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class pa extends l.Evented{constructor(t,a){if(super(),(t instanceof l.window.HTMLElement||a)&&(t=l.extend({element:t},a)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=l.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ne.create("div"),this._element.setAttribute("aria-label","Map marker");const m=ne.createNS("http://www.w3.org/2000/svg","svg"),g=41,x=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${g}px`),m.setAttributeNS(null,"width",`${x}px`),m.setAttributeNS(null,"viewBox",`0 0 ${x} ${g}`);const T=ne.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const C=ne.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const I=ne.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of M){const j=ne.createNS("http://www.w3.org/2000/svg","ellipse");j.setAttributeNS(null,"opacity","0.04"),j.setAttributeNS(null,"cx","10.5"),j.setAttributeNS(null,"cy","5.80029008"),j.setAttributeNS(null,"rx",J.rx),j.setAttributeNS(null,"ry",J.ry),I.appendChild(j)}const P=ne.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const F=ne.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(F);const V=ne.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const $=ne.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild($);const U=ne.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const X=ne.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const N=ne.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#000000"),N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962");const H=ne.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#FFFFFF"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962"),X.appendChild(N),X.appendChild(H),C.appendChild(I),C.appendChild(P),C.appendChild(V),C.appendChild(U),C.appendChild(X),m.appendChild(C),m.setAttributeNS(null,"height",g*this._scale+"px"),m.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(m),this._offset=l.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const p=this._element.classList;for(const m in zl)p.remove(`mapboxgl-marker-anchor-${m}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ne.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const a=38.1,p=13.5,m=Math.sqrt(Math.pow(p,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-a],"bottom-left":[m,-1*(a-p+m)],"bottom-right":[-m,-1*(a-p+m)],left:[p,-1*(a-p)],right:[-p,-1*(a-p)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,p=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const a=this._map.unproject(t);let p=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const g=this._map.getFreeCameraOptions();if(g.position){const x=g.position.toLngLat();p=x.distanceTo(a)<.9*x.distanceTo(this._lngLat)}}const m=(1-this._map._queryFogOpacity(a))*(p?.2:1);this._element.style.opacity=`${m}`,this._popup&&this._popup._setOpacity(`${m}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const a=this._map.transform;return!!t&&t.x>=0&&t.x<a.width&&t.y>=0&&t.y<a.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=gu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let a="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?a=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(a=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ne.setTransform(this._element,`${zl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${a}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,a=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&a._rotate(t.angle),this._pitchAlignment==="map"&&(a.y*=Math.cos(t._pitch)),a}getOffset(){return this._offset}setOffset(t){return this._offset=l.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class zd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=l.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,p){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+p}}const Dd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:fa,HTMLElement:Ld,ImageBitmap:Gr}=l.window,Bd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ma(h){h.parentNode&&h.parentNode.removeChild(h)}const Rd={showCompass:!0,showZoom:!0,visualizePitch:!1};class yu{constructor(t,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new xr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new To({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ne.addEventListener(a,"mousedown",this.mousedown),ne.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ne.addEventListener(a,"touchmove",this.touchmove),ne.addEventListener(a,"touchend",this.touchend),ne.addEventListener(a,"touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),ne.disableDrag()}move(t,a){const p=this.map,m=this.mouseRotate.mousemoveWindow(t,a);if(m&&m.bearingDelta&&p.setBearing(p.getBearing()+m.bearingDelta),this.mousePitch){const g=this.mousePitch.mousemoveWindow(t,a);g&&g.pitchDelta&&p.setPitch(p.getPitch()+g.pitchDelta)}}off(){const t=this.element;ne.removeEventListener(t,"mousedown",this.mousedown),ne.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ne.removeEventListener(t,"touchmove",this.touchmove),ne.removeEventListener(t,"touchend",this.touchend),ne.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ne.enableDrag(),ne.removeEventListener(l.window,"mousemove",this.mousemove),ne.removeEventListener(l.window,"mouseup",this.mouseup)}mousedown(t){this.down(l.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ne.mousePos(this.element,t)),ne.addEventListener(l.window,"mousemove",this.mousemove),ne.addEventListener(l.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,ne.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ne.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ne.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Zr,Dl=0,_a=!1;const xu={maxWidth:100,unit:"metric"};function wu(h,t,a){const p=a&&a.maxWidth||100,m=h._container.getBoundingClientRect().height/2,g=h.unproject([0,m]),x=h.unproject([p,m]),T=g.distanceTo(x);if(a&&a.unit==="imperial"){const C=3.2808*T;C>5280?as(t,p,C/5280,h._getUIString("ScaleControl.Miles"),h):as(t,p,C,h._getUIString("ScaleControl.Feet"),h)}else a&&a.unit==="nautical"?as(t,p,T/1852,h._getUIString("ScaleControl.NauticalMiles"),h):T>=1e3?as(t,p,T/1e3,h._getUIString("ScaleControl.Kilometers"),h):as(t,p,T,h._getUIString("ScaleControl.Meters"),h)}function as(h,t,a,p,m){const g=function(T){const C=Math.pow(10,`${Math.floor(T)}`.length-1);let I=T/C;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){const P=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*P)/P}(I),C*I}(a),x=g/a;m._requestDomTask(()=>{h.style.width=t*x+"px",h.innerHTML=`${g}&nbsp;${p}`})}const im={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ls={version:l.version,supported:W,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends Pd{constructor(h){if((h=l.extend({},Bd,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new lu(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._renderTaskQueue=new _u,this._domRenderTaskQueue=new _u,this._controls=[],this._markers=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Dd,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new zd(0),this._requestManager=new l.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=l.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof Ld))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),l.window!==void 0&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Pl(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new El(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,l.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new fu({customAttribution:h.customAttribution})),this._logoControl=new mu,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new l.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new l.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){const[t,a]=this._containerDimensions();if(t===this.transform.width&&a===this.transform.height)return this;this._resizeCanvas(t,a),this.transform.resize(t,a),this.painter.resize(Math.ceil(t),Math.ceil(a));const p=!this._moving;return p&&this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),this.fire(new l.Event("resize",h)),p&&this.fire(new l.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(l.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h==null?85:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getProjection(){return this.transform.getProjection()}setProjection(h){this._lazyInitEmptyStyle(),typeof h=="string"&&(h={name:h}),this._runtimeProjection=h,this.style.updateProjection()}project(h){return this.transform.locationPoint3D(l.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(l.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(h,t,a){if(h==="mouseenter"||h==="mouseover"){let p=!1;const m=x=>{const T=t.filter(I=>this.getLayer(I)),C=T.length?this.queryRenderedFeatures(x.point,{layers:T}):[];C.length?p||(p=!0,a.call(this,new oi(h,this,x.originalEvent,{features:C}))):p=!1},g=()=>{p=!1};return{layers:new Set(t),listener:a,delegates:{mousemove:m,mouseout:g}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;const m=x=>{const T=t.filter(C=>this.getLayer(C));(T.length?this.queryRenderedFeatures(x.point,{layers:T}):[]).length?p=!0:p&&(p=!1,a.call(this,new oi(h,this,x.originalEvent)))},g=x=>{p&&(p=!1,a.call(this,new oi(h,this,x.originalEvent)))};return{layers:new Set(t),listener:a,delegates:{mousemove:m,mouseout:g}}}{const p=m=>{const g=t.filter(T=>this.getLayer(T)),x=g.length?this.queryRenderedFeatures(m.point,{layers:g}):[];x.length&&(m.features=x,a.call(this,m),delete m.features)};return{layers:new Set(t),listener:a,delegates:{[h]:p}}}}on(h,t,a){if(a===void 0)return super.on(h,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(h,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(h,t,a){if(a===void 0)return super.once(h,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(h,t,a);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(h,t,a){if(a===void 0)return super.off(h,t);t=new Set(Array.isArray(t)?t:[t]);const p=(g,x)=>{if(g.size!==x.size)return!1;for(const T of g)if(!x.has(T))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[h]:void 0;return m&&(g=>{for(let x=0;x<g.length;x++){const T=g[x];if(T.listener===a&&p(T.layers,t)){for(const C in T.delegates)this.off(C,T.delegates[C]);return g.splice(x,1),this}}})(m),this}queryRenderedFeatures(h,t){return this.style?(t!==void 0||h===void 0||h instanceof l.pointGeometry||Array.isArray(h)||(t=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}queryTerrainElevation(h,t){const a=this.transform.elevation;return a?(t=l.extend({},{exaggerated:!0},t),a.getAtPoint(l.MercatorCoordinate.fromLngLat(h),null,t.exaggerated)):null}setStyle(h,t){return(t=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),h&&(this.style=new Pi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Pi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const a=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(a,l.ResourceType.Style);l.getJSON(p,(m,g)=>{m?this.fire(new l.ErrorEvent(m)):g&&this._updateDiff(g,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h)&&this._update(!0)}catch(a){l.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style._getSourceCaches(h);if(t.length!==0)return t.every(a=>a.loaded());this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const t in h){const a=h[t]._tiles;for(const p in a){const m=a[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(h,t,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,a)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,{pixelRatio:a=1,sdf:p=!1,stretchX:m,stretchY:g,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof fa||Gr&&t instanceof Gr){const{width:T,height:C,data:I}=l.exported.getImageData(t);this.style.addImage(h,{data:new l.RGBAImage({width:T,height:C},I),pixelRatio:a,stretchX:m,stretchY:g,content:x,sdf:p,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:C,data:I}=t,M=t;this.style.addImage(h,{data:new l.RGBAImage({width:T,height:C},new Uint8Array(I)),pixelRatio:a,stretchX:m,stretchY:g,content:x,sdf:p,version:0,userImage:M}),M.onAdd&&M.onAdd(this,h)}}}updateImage(h,t){const a=this.style.getImage(h);if(!a)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof fa||Gr&&t instanceof Gr?l.exported.getImageData(t):t,{width:m,height:g,data:x}=p;return m===void 0||g===void 0?this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):m!==a.data.width||g!==a.data.height?this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(a.data.replace(x,!(t instanceof fa||Gr&&t instanceof Gr)),void this.style.updateImage(h,a))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){l.getImage(this._requestManager.transformRequest(h,l.ResourceType.Image),(a,p)=>{t(a,p instanceof fa?l.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,t,a){return this.style.setLayerZoomRange(h,t,a),this._update(!0)}setFilter(h,t,a={}){return this.style.setFilter(h,t,a),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,a,p={}){return this.style.setPaintProperty(h,t,a,p),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,a,p={}){return this.style.setLayoutProperty(h,t,a,p),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(h),this.transform):0}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300),[h,t]}_detectMissingCSS(){l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=ne.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ne.create("div","mapboxgl-canvas-container",h);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=ne.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions();this._resizeCanvas(a[0],a[1]);const p=this._controlContainer=ne.create("div","mapboxgl-control-container",h),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{m[g]=ne.create("div",`mapboxgl-ctrl-${g}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const a=l.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const h=l.extend({},W.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);t?(l.storeAuthState(t,!0),this.painter=new hd(t,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(t)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;const a=this.painter.context.extTimerQuery,p=l.exported.now();this.listens("gpu-timing-frame")&&(t=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,t));let m=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;let g=!1;const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,I=this.transform.pitch,M=l.exported.now();this.style.zoomHistory.update(C,M);const P=new l.EvaluationParameters(C,{now:M,fadeDuration:x,pitch:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=P.crossFadingFactor();F===1&&F===this._crossFadingFactor||(g=!0,this._crossFadingFactor=F),this.style.update(P)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const C=l.exported.now()-p;a.endQueryEXT(a.TIME_ELAPSED_EXT,t),setTimeout(()=>{const I=a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(t),this.fire(new l.Event("gpu-timing-frame",{cpuTime:C,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(C);this.fire(new l.Event("gpu-timing-layer",{layerTimes:I}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||m;if(T||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(m=this._updateAverageElevation(p,!0)),m)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const h of this._markers)h._update()}_updateAverageElevation(h,t=!1){const a=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();isNaN(m)?m=0:this._averageElevationLastSampledAt=h;const g=Math.abs(p-m);if(g>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(m),a(m);this._averageElevation.easeTo(m,h,300)}else if(g>1e-4)return this._averageElevation.jumpTo(m),a(m)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===l.AUTH_ERR_MSG||h.status===401)){const t=this.painter.context.gl;l.storeAuthState(t,!1),this._logoControl instanceof mu&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,p=a.createFramebuffer();function m(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);const x=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,x),x}return a.bindFramebuffer(a.FRAMEBUFFER,p),this._canvasPixelComparison(m(h),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(h,t,a){let p=a[1]-a[0];const m=h.length/4;for(let g=0;g<t.length;g++){const x=t[g];let T=0;for(let C=0;C<x.length;C+=4)x[C]===h[C]&&x[C+1]===h[C+1]&&x[C+2]===h[C+2]&&x[C+3]===h[C+3]&&(T+=1);p+=(a[g+2]-a[g+1])*(1-T/m)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),l.window!==void 0&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),ma(this._canvasContainer),ma(this._controlContainer),ma(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=l.exported.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,t){l.setCacheLimits(h,t)}get version(){return l.version}},NavigationControl:class{constructor(h){this.options=l.extend({},Rd,h),this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),ne.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),ne.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=ne.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const h=this._map.getZoom(),t=h===this._map.getMaxZoom(),a=h===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=h)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ne.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const a=ne.create("button",h,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(h,t){const a=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends l.Evented{constructor(h){super(),this.options=l.extend({},vu,h),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=cu(this._updateMarkerRotation,20)}onAdd(h){var t;return this._map=h,this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Zr!==void 0?t(Zr):l.window.navigator.permissions!==void 0?l.window.navigator.permissions.query({name:"geolocation"}).then(a=>{Zr=a.state!=="denied",t(Zr)}):(Zr=!!l.window.navigator.geolocation,t(Zr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ne.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Dl=0,_a=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),a=h.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",h)),this._finish()}}_updateCamera(h){const t=new l.LngLat(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,p=this._map.getBearing(),m=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),m,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new l.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._container.getBoundingClientRect().height/2,t=this._map.unproject([0,h]),a=this._map.unproject([100,h]),p=t.distanceTo(a)/100,m=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&_a)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ne.create("button","mapboxgl-ctrl-geolocate",this._container),ne.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ne.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ne.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ne.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Dl--,_a=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Dl++,Dl>1?(h={maximumAge:6e5,timeout:0},_a=!0):(h=this.options.positionOptions,_a=!1),this._geolocationWatchID=l.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else l.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};l.window.DeviceMotionEvent!==void 0&&typeof l.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:fu,ScaleControl:class{constructor(h){this.options=l.extend({},xu,h),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){wu(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ne.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,wu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof l.window.HTMLElement?this._container=h.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ne.remove(this._controlContainer),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=ne.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ne.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(h){super(),this.options=l.extend(Object.create(im),h),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ne.remove(this._content),this._container&&(ne.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=l.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(l.window.document.createTextNode(h))}setHTML(h){const t=l.window.document.createDocumentFragment(),a=l.window.document.createElement("body");let p;for(a.innerHTML=h;p=a.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ne.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._container&&this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._container&&this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=ne.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._pos,a=this._container.offsetWidth,p=this._container.offsetHeight;let m;return m=t.y+h.bottom.y<p?["top"]:t.y>this._map.transform.height-p?["bottom"]:[],t.x<a/2?m.push("left"):t.x>this._map.transform.width-a/2&&m.push("right"),m.length===0?"bottom":m.join("-")}_updateClassList(){const h=[...this._classList];h.push("mapboxgl-popup"),this._anchor&&h.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&h.push("mapboxgl-popup-track-pointer"),this._container.className=h.join(" ")}_update(h){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ne.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ne.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=gu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h){const t=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),a=function(g){if(g||(g=new l.pointGeometry(0,0)),typeof g=="number"){const x=Math.round(Math.sqrt(.5*Math.pow(g,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,g),"top-left":new l.pointGeometry(x,x),"top-right":new l.pointGeometry(-x,x),bottom:new l.pointGeometry(0,-g),"bottom-left":new l.pointGeometry(x,-x),"bottom-right":new l.pointGeometry(-x,-x),left:new l.pointGeometry(g,0),right:new l.pointGeometry(-g,0)}}if(g instanceof l.pointGeometry||Array.isArray(g)){const x=l.pointGeometry.convert(g);return{center:x,top:x,"top-left":x,"top-right":x,bottom:x,"bottom-left":x,"bottom-right":x,left:x,right:x}}return{center:l.pointGeometry.convert(g.center||[0,0]),top:l.pointGeometry.convert(g.top||[0,0]),"top-left":l.pointGeometry.convert(g["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(g["top-right"]||[0,0]),bottom:l.pointGeometry.convert(g.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(g["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(g["bottom-right"]||[0,0]),left:l.pointGeometry.convert(g.left||[0,0]),right:l.pointGeometry.convert(g.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(a),m=t.add(a[p]).round();this._map._requestDomTask(()=>{this._container&&p&&ne.setTransform(this._container,`${zl[p]} translate(${m.x}px,${m.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(rm);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._content&&(this._content.style.opacity=h),this._tip&&(this._tip.style.opacity=h)}},Marker:pa,Style:Pi,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:su,Evented:l.Evented,config:l.config,prewarm:function(){Ge().acquire(oe)},clearPrewarmedResources:function(){const h=Pe;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(oe),Pe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(h){l.config.ACCESS_TOKEN=h},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(h){l.config.API_URL=h},get workerCount(){return ge.workerCount},set workerCount(h){ge.workerCount=h},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){l.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){l.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return ls});var L=w;return L})})(yb);var UM=yb.exports;const xb="SweetAlert2:",XA=i=>{const o=[];for(let c=0;c<i.length;c++)o.indexOf(i[c])===-1&&o.push(i[c]);return o},wb=i=>i.charAt(0).toUpperCase()+i.slice(1),ir=i=>Array.prototype.slice.call(i),Ui=i=>{console.warn(`${xb} ${typeof i=="object"?i.join(" "):i}`)},zc=i=>{console.error(`${xb} ${i}`)},bb=[],HA=i=>{bb.includes(i)||(bb.push(i),Ui(i))},YA=(i,o)=>{HA(`"${i}" is deprecated and will be removed in the next major release. Please use "${o}" instead.`)},vy=i=>typeof i=="function"?i():i,xy=i=>i&&typeof i.toPromise=="function",Uh=i=>xy(i)?i.toPromise():Promise.resolve(i),wy=i=>i&&Promise.resolve(i)===i,Dc={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},KA=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],JA={},QA=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Tb=i=>Object.prototype.hasOwnProperty.call(Dc,i),Eb=i=>KA.indexOf(i)!==-1,by=i=>JA[i],ek=i=>{Tb(i)||Ui(`Unknown parameter "${i}"`)},tk=i=>{QA.includes(i)&&Ui(`The parameter "${i}" is incompatible with toasts`)},nk=i=>{by(i)&&YA(i,by(i))},ik=i=>{!i.backdrop&&i.allowOutsideClick&&Ui('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const o in i)ek(o),i.toast&&tk(o),nk(o)},rk="swal2-",Sb=i=>{const o={};for(const c in i)o[i[c]]=rk+i[c];return o},Ie=Sb(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),Nh=Sb(["success","warning","info","question","error"]),di=()=>document.body.querySelector(`.${Ie.container}`),Vh=i=>{const o=di();return o?o.querySelector(i):null},gr=i=>Vh(`.${i}`),Kt=()=>gr(Ie.popup),jh=()=>gr(Ie.icon),Cb=()=>gr(Ie.title),Lf=()=>gr(Ie["html-container"]),Ab=()=>gr(Ie.image),kb=()=>gr(Ie["progress-steps"]),Bf=()=>gr(Ie["validation-message"]),Ir=()=>Vh(`.${Ie.actions} .${Ie.confirm}`),Vs=()=>Vh(`.${Ie.actions} .${Ie.deny}`),ok=()=>gr(Ie["input-label"]),Lc=()=>Vh(`.${Ie.loader}`),ja=()=>Vh(`.${Ie.actions} .${Ie.cancel}`),Rf=()=>gr(Ie.actions),Ib=()=>gr(Ie.footer),Ff=()=>gr(Ie["timer-progress-bar"]),Ty=()=>gr(Ie.close),sk=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,Ey=()=>{const i=ir(Kt().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((c,_)=>(c=parseInt(c.getAttribute("tabindex")),_=parseInt(_.getAttribute("tabindex")),c>_?1:c<_?-1:0)),o=ir(Kt().querySelectorAll(sk)).filter(c=>c.getAttribute("tabindex")!=="-1");return XA(i.concat(o)).filter(c=>yr(c))},Sy=()=>!js(document.body,Ie["toast-shown"])&&!js(document.body,Ie["no-backdrop"]),Of=()=>Kt()&&js(Kt(),Ie.toast),ak=()=>Kt().hasAttribute("data-loading"),Bc={previousBodyPadding:null},pi=(i,o)=>{if(i.textContent="",o){const _=new DOMParser().parseFromString(o,"text/html");ir(_.querySelector("head").childNodes).forEach(w=>{i.appendChild(w)}),ir(_.querySelector("body").childNodes).forEach(w=>{i.appendChild(w)})}},js=(i,o)=>{if(!o)return!1;const c=o.split(/\s+/);for(let _=0;_<c.length;_++)if(!i.classList.contains(c[_]))return!1;return!0},lk=(i,o)=>{ir(i.classList).forEach(c=>{!Object.values(Ie).includes(c)&&!Object.values(Nh).includes(c)&&!Object.values(o.showClass).includes(c)&&i.classList.remove(c)})},Mr=(i,o,c)=>{if(lk(i,o),o.customClass&&o.customClass[c]){if(typeof o.customClass[c]!="string"&&!o.customClass[c].forEach)return Ui(`Invalid type of customClass.${c}! Expected string or iterable object, got "${typeof o.customClass[c]}"`);jt(i,o.customClass[c])}},Cy=(i,o)=>{if(!o)return null;switch(o){case"select":case"textarea":case"file":return i.querySelector(`.${Ie.popup} > .${Ie[o]}`);case"checkbox":return i.querySelector(`.${Ie.popup} > .${Ie.checkbox} input`);case"radio":return i.querySelector(`.${Ie.popup} > .${Ie.radio} input:checked`)||i.querySelector(`.${Ie.popup} > .${Ie.radio} input:first-child`);case"range":return i.querySelector(`.${Ie.popup} > .${Ie.range} input`);default:return i.querySelector(`.${Ie.popup} > .${Ie.input}`)}},Mb=i=>{if(i.focus(),i.type!=="file"){const o=i.value;i.value="",i.value=o}},Pb=(i,o,c)=>{!i||!o||(typeof o=="string"&&(o=o.split(/\s+/).filter(Boolean)),o.forEach(_=>{Array.isArray(i)?i.forEach(w=>{c?w.classList.add(_):w.classList.remove(_)}):c?i.classList.add(_):i.classList.remove(_)}))},jt=(i,o)=>{Pb(i,o,!0)},so=(i,o)=>{Pb(i,o,!1)},$s=(i,o)=>{const c=ir(i.childNodes);for(let _=0;_<c.length;_++)if(js(c[_],o))return c[_]},$h=(i,o,c)=>{c===`${parseInt(c)}`&&(c=parseInt(c)),c||parseInt(c)===0?i.style[o]=typeof c=="number"?`${c}px`:c:i.style.removeProperty(o)},ri=(i,o="flex")=>{i.style.display=o},fi=i=>{i.style.display="none"},zb=(i,o,c,_)=>{const w=i.querySelector(o);w&&(w.style[c]=_)},Uf=(i,o,c)=>{o?ri(i,c):fi(i)},yr=i=>!!(i&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)),ck=()=>!yr(Ir())&&!yr(Vs())&&!yr(ja()),Db=i=>i.scrollHeight>i.clientHeight,Lb=i=>{const o=window.getComputedStyle(i),c=parseFloat(o.getPropertyValue("animation-duration")||"0"),_=parseFloat(o.getPropertyValue("transition-duration")||"0");return c>0||_>0},Ay=(i,o=!1)=>{const c=Ff();yr(c)&&(o&&(c.style.transition="none",c.style.width="100%"),setTimeout(()=>{c.style.transition=`width ${i/1e3}s linear`,c.style.width="0%"},10))},uk=()=>{const i=Ff(),o=parseInt(window.getComputedStyle(i).width);i.style.removeProperty("transition"),i.style.width="100%";const c=parseInt(window.getComputedStyle(i).width),_=o/c*100;i.style.removeProperty("transition"),i.style.width=`${_}%`},Bb=()=>typeof window=="undefined"||typeof document=="undefined",hk=100,Tt={},dk=()=>{Tt.previousActiveElement&&Tt.previousActiveElement.focus?(Tt.previousActiveElement.focus(),Tt.previousActiveElement=null):document.body&&document.body.focus()},pk=i=>new Promise(o=>{if(!i)return o();const c=window.scrollX,_=window.scrollY;Tt.restoreFocusTimeout=setTimeout(()=>{dk(),o()},hk),window.scrollTo(c,_)}),fk=`
 <div aria-labelledby="${Ie.title}" aria-describedby="${Ie["html-container"]}" class="${Ie.popup}" tabindex="-1">
   <button type="button" class="${Ie.close}"></button>
   <ul class="${Ie["progress-steps"]}"></ul>
   <div class="${Ie.icon}"></div>
   <img class="${Ie.image}" />
   <h2 class="${Ie.title}" id="${Ie.title}"></h2>
   <div class="${Ie["html-container"]}" id="${Ie["html-container"]}"></div>
   <input class="${Ie.input}" />
   <input type="file" class="${Ie.file}" />
   <div class="${Ie.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${Ie.select}"></select>
   <div class="${Ie.radio}"></div>
   <label for="${Ie.checkbox}" class="${Ie.checkbox}">
     <input type="checkbox" />
     <span class="${Ie.label}"></span>
   </label>
   <textarea class="${Ie.textarea}"></textarea>
   <div class="${Ie["validation-message"]}" id="${Ie["validation-message"]}"></div>
   <div class="${Ie.actions}">
     <div class="${Ie.loader}"></div>
     <button type="button" class="${Ie.confirm}"></button>
     <button type="button" class="${Ie.deny}"></button>
     <button type="button" class="${Ie.cancel}"></button>
   </div>
   <div class="${Ie.footer}"></div>
   <div class="${Ie["timer-progress-bar-container"]}">
     <div class="${Ie["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),mk=()=>{const i=di();return i?(i.remove(),so([document.documentElement,document.body],[Ie["no-backdrop"],Ie["toast-shown"],Ie["has-column"]]),!0):!1},$a=()=>{Tt.currentInstance.resetValidationMessage()},_k=()=>{const i=Kt(),o=$s(i,Ie.input),c=$s(i,Ie.file),_=i.querySelector(`.${Ie.range} input`),w=i.querySelector(`.${Ie.range} output`),A=$s(i,Ie.select),L=i.querySelector(`.${Ie.checkbox} input`),l=$s(i,Ie.textarea);o.oninput=$a,c.onchange=$a,A.onchange=$a,L.onchange=$a,l.oninput=$a,_.oninput=()=>{$a(),w.value=_.value},_.onchange=()=>{$a(),_.nextSibling.value=_.value}},gk=i=>typeof i=="string"?document.querySelector(i):i,yk=i=>{const o=Kt();o.setAttribute("role",i.toast?"alert":"dialog"),o.setAttribute("aria-live",i.toast?"polite":"assertive"),i.toast||o.setAttribute("aria-modal","true")},vk=i=>{window.getComputedStyle(i).direction==="rtl"&&jt(di(),Ie.rtl)},xk=i=>{const o=mk();if(Bb()){zc("SweetAlert2 requires document to initialize");return}const c=document.createElement("div");c.className=Ie.container,o&&jt(c,Ie["no-transition"]),pi(c,fk);const _=gk(i.target);_.appendChild(c),yk(i),vk(_),_k()},ky=(i,o)=>{i instanceof HTMLElement?o.appendChild(i):typeof i=="object"?wk(i,o):i&&pi(o,i)},wk=(i,o)=>{i.jquery?bk(o,i):pi(o,i.toString())},bk=(i,o)=>{if(i.textContent="",0 in o)for(let c=0;c in o;c++)i.appendChild(o[c].cloneNode(!0));else i.appendChild(o.cloneNode(!0))},Gh=(()=>{if(Bb())return!1;const i=document.createElement("div"),o={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd oanimationend",animation:"animationend"};for(const c in o)if(Object.prototype.hasOwnProperty.call(o,c)&&typeof i.style[c]!="undefined")return o[c];return!1})(),Tk=()=>{const i=document.createElement("div");i.className=Ie["scrollbar-measure"],document.body.appendChild(i);const o=i.getBoundingClientRect().width-i.clientWidth;return document.body.removeChild(i),o},Ek=(i,o)=>{const c=Rf(),_=Lc();!o.showConfirmButton&&!o.showDenyButton&&!o.showCancelButton?fi(c):ri(c),Mr(c,o,"actions"),Sk(c,_,o),pi(_,o.loaderHtml),Mr(_,o,"loader")};function Sk(i,o,c){const _=Ir(),w=Vs(),A=ja();Iy(_,"confirm",c),Iy(w,"deny",c),Iy(A,"cancel",c),Ck(_,w,A,c),c.reverseButtons&&(c.toast?(i.insertBefore(A,_),i.insertBefore(w,_)):(i.insertBefore(A,o),i.insertBefore(w,o),i.insertBefore(_,o)))}function Ck(i,o,c,_){if(!_.buttonsStyling)return so([i,o,c],Ie.styled);jt([i,o,c],Ie.styled),_.confirmButtonColor&&(i.style.backgroundColor=_.confirmButtonColor,jt(i,Ie["default-outline"])),_.denyButtonColor&&(o.style.backgroundColor=_.denyButtonColor,jt(o,Ie["default-outline"])),_.cancelButtonColor&&(c.style.backgroundColor=_.cancelButtonColor,jt(c,Ie["default-outline"]))}function Iy(i,o,c){Uf(i,c[`show${wb(o)}Button`],"inline-block"),pi(i,c[`${o}ButtonText`]),i.setAttribute("aria-label",c[`${o}ButtonAriaLabel`]),i.className=Ie[o],Mr(i,c,`${o}Button`),jt(i,c[`${o}ButtonClass`])}function Ak(i,o){typeof o=="string"?i.style.background=o:o||jt([document.documentElement,document.body],Ie["no-backdrop"])}function kk(i,o){o in Ie?jt(i,Ie[o]):(Ui('The "position" parameter is not valid, defaulting to "center"'),jt(i,Ie.center))}function Ik(i,o){if(o&&typeof o=="string"){const c=`grow-${o}`;c in Ie&&jt(i,Ie[c])}}const Mk=(i,o)=>{const c=di();!c||(Ak(c,o.backdrop),kk(c,o.position),Ik(c,o.grow),Mr(c,o,"container"))};var It={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const Pk=["input","file","range","select","radio","checkbox","textarea"],zk=(i,o)=>{const c=Kt(),_=It.innerParams.get(i),w=!_||o.input!==_.input;Pk.forEach(A=>{const L=Ie[A],l=$s(c,L);Bk(A,o.inputAttributes),l.className=L,w&&fi(l)}),o.input&&(w&&Dk(o),Rk(o))},Dk=i=>{if(!Ni[i.input])return zc(`Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "${i.input}"`);const o=Rb(i.input),c=Ni[i.input](o,i);ri(c),setTimeout(()=>{Mb(c)})},Lk=i=>{for(let o=0;o<i.attributes.length;o++){const c=i.attributes[o].name;["type","value","style"].includes(c)||i.removeAttribute(c)}},Bk=(i,o)=>{const c=Cy(Kt(),i);if(!!c){Lk(c);for(const _ in o)c.setAttribute(_,o[_])}},Rk=i=>{const o=Rb(i.input);i.customClass&&jt(o,i.customClass.input)},My=(i,o)=>{(!i.placeholder||o.inputPlaceholder)&&(i.placeholder=o.inputPlaceholder)},Zh=(i,o,c)=>{if(c.inputLabel){i.id=Ie.input;const _=document.createElement("label"),w=Ie["input-label"];_.setAttribute("for",i.id),_.className=w,jt(_,c.customClass.inputLabel),_.innerText=c.inputLabel,o.insertAdjacentElement("beforebegin",_)}},Rb=i=>{const o=Ie[i]?Ie[i]:Ie.input;return $s(Kt(),o)},Ni={};Ni.text=Ni.email=Ni.password=Ni.number=Ni.tel=Ni.url=(i,o)=>(typeof o.inputValue=="string"||typeof o.inputValue=="number"?i.value=o.inputValue:wy(o.inputValue)||Ui(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof o.inputValue}"`),Zh(i,i,o),My(i,o),i.type=o.input,i);Ni.file=(i,o)=>(Zh(i,i,o),My(i,o),i);Ni.range=(i,o)=>{const c=i.querySelector("input"),_=i.querySelector("output");return c.value=o.inputValue,c.type=o.input,_.value=o.inputValue,Zh(c,i,o),i};Ni.select=(i,o)=>{if(i.textContent="",o.inputPlaceholder){const c=document.createElement("option");pi(c,o.inputPlaceholder),c.value="",c.disabled=!0,c.selected=!0,i.appendChild(c)}return Zh(i,i,o),i};Ni.radio=i=>(i.textContent="",i);Ni.checkbox=(i,o)=>{const c=Cy(Kt(),"checkbox");c.value="1",c.id=Ie.checkbox,c.checked=Boolean(o.inputValue);const _=i.querySelector("span");return pi(_,o.inputPlaceholder),i};Ni.textarea=(i,o)=>{i.value=o.inputValue,My(i,o),Zh(i,i,o);const c=_=>parseInt(window.getComputedStyle(_).marginLeft)+parseInt(window.getComputedStyle(_).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const _=parseInt(window.getComputedStyle(Kt()).width),w=()=>{const A=i.offsetWidth+c(i);A>_?Kt().style.width=`${A}px`:Kt().style.width=null};new MutationObserver(w).observe(i,{attributes:!0,attributeFilter:["style"]})}}),i};const Fk=(i,o)=>{const c=Lf();Mr(c,o,"htmlContainer"),o.html?(ky(o.html,c),ri(c,"block")):o.text?(c.textContent=o.text,ri(c,"block")):fi(c),zk(i,o)},Ok=(i,o)=>{const c=Ib();Uf(c,o.footer),o.footer&&ky(o.footer,c),Mr(c,o,"footer")},Uk=(i,o)=>{const c=Ty();pi(c,o.closeButtonHtml),Mr(c,o,"closeButton"),Uf(c,o.showCloseButton),c.setAttribute("aria-label",o.closeButtonAriaLabel)},Nk=(i,o)=>{const c=It.innerParams.get(i),_=jh();if(c&&o.icon===c.icon){Ob(_,o),Fb(_,o);return}if(!o.icon&&!o.iconHtml)return fi(_);if(o.icon&&Object.keys(Nh).indexOf(o.icon)===-1)return zc(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${o.icon}"`),fi(_);ri(_),Ob(_,o),Fb(_,o),jt(_,o.showClass.icon)},Fb=(i,o)=>{for(const c in Nh)o.icon!==c&&so(i,Nh[c]);jt(i,Nh[o.icon]),jk(i,o),Vk(),Mr(i,o,"icon")},Vk=()=>{const i=Kt(),o=window.getComputedStyle(i).getPropertyValue("background-color"),c=i.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let _=0;_<c.length;_++)c[_].style.backgroundColor=o},Ob=(i,o)=>{i.textContent="",o.iconHtml?pi(i,Ub(o.iconHtml)):o.icon==="success"?pi(i,`
      <div class="swal2-success-circular-line-left"></div>
      <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
      <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
      <div class="swal2-success-circular-line-right"></div>
    `):o.icon==="error"?pi(i,`
      <span class="swal2-x-mark">
        <span class="swal2-x-mark-line-left"></span>
        <span class="swal2-x-mark-line-right"></span>
      </span>
    `):pi(i,Ub({question:"?",warning:"!",info:"i"}[o.icon]))},jk=(i,o)=>{if(!!o.iconColor){i.style.color=o.iconColor,i.style.borderColor=o.iconColor;for(const c of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])zb(i,c,"backgroundColor",o.iconColor);zb(i,".swal2-success-ring","borderColor",o.iconColor)}},Ub=i=>`<div class="${Ie["icon-content"]}">${i}</div>`,$k=(i,o)=>{const c=Ab();if(!o.imageUrl)return fi(c);ri(c,""),c.setAttribute("src",o.imageUrl),c.setAttribute("alt",o.imageAlt),$h(c,"width",o.imageWidth),$h(c,"height",o.imageHeight),c.className=Ie.image,Mr(c,o,"image")},Gk=i=>{const o=document.createElement("li");return jt(o,Ie["progress-step"]),pi(o,i),o},Zk=i=>{const o=document.createElement("li");return jt(o,Ie["progress-step-line"]),i.progressStepsDistance&&(o.style.width=i.progressStepsDistance),o},qk=(i,o)=>{const c=kb();if(!o.progressSteps||o.progressSteps.length===0)return fi(c);ri(c),c.textContent="",o.currentProgressStep>=o.progressSteps.length&&Ui("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),o.progressSteps.forEach((_,w)=>{const A=Gk(_);if(c.appendChild(A),w===o.currentProgressStep&&jt(A,Ie["active-progress-step"]),w!==o.progressSteps.length-1){const L=Zk(o);c.appendChild(L)}})},Wk=(i,o)=>{const c=Cb();Uf(c,o.title||o.titleText,"block"),o.title&&ky(o.title,c),o.titleText&&(c.innerText=o.titleText),Mr(c,o,"title")},Xk=(i,o)=>{const c=di(),_=Kt();o.toast?($h(c,"width",o.width),_.style.width="100%",_.insertBefore(Lc(),jh())):$h(_,"width",o.width),$h(_,"padding",o.padding),o.color&&(_.style.color=o.color),o.background&&(_.style.background=o.background),fi(Bf()),Hk(_,o)},Hk=(i,o)=>{i.className=`${Ie.popup} ${yr(i)?o.showClass.popup:""}`,o.toast?(jt([document.documentElement,document.body],Ie["toast-shown"]),jt(i,Ie.toast)):jt(i,Ie.modal),Mr(i,o,"popup"),typeof o.customClass=="string"&&jt(i,o.customClass),o.icon&&jt(i,Ie[`icon-${o.icon}`])},Nb=(i,o)=>{Xk(i,o),Mk(i,o),qk(i,o),Nk(i,o),$k(i,o),Wk(i,o),Uk(i,o),Fk(i,o),Ek(i,o),Ok(i,o),typeof o.didRender=="function"&&o.didRender(Kt())},Rc=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Yk=()=>{ir(document.body.children).forEach(o=>{o===di()||o.contains(di())||(o.hasAttribute("aria-hidden")&&o.setAttribute("data-previous-aria-hidden",o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))})},Vb=()=>{ir(document.body.children).forEach(o=>{o.hasAttribute("data-previous-aria-hidden")?(o.setAttribute("aria-hidden",o.getAttribute("data-previous-aria-hidden")),o.removeAttribute("data-previous-aria-hidden")):o.removeAttribute("aria-hidden")})},jb=["swal-title","swal-html","swal-footer"],Kk=i=>{const o=typeof i.template=="string"?document.querySelector(i.template):i.template;if(!o)return{};const c=o.content;return rI(c),Object.assign(Jk(c),Qk(c),eI(c),tI(c),nI(c),iI(c,jb))},Jk=i=>{const o={};return ir(i.querySelectorAll("swal-param")).forEach(c=>{Ga(c,["name","value"]);const _=c.getAttribute("name");let w=c.getAttribute("value");typeof Dc[_]=="boolean"&&w==="false"&&(w=!1),typeof Dc[_]=="object"&&(w=JSON.parse(w)),o[_]=w}),o},Qk=i=>{const o={};return ir(i.querySelectorAll("swal-button")).forEach(c=>{Ga(c,["type","color","aria-label"]);const _=c.getAttribute("type");o[`${_}ButtonText`]=c.innerHTML,o[`show${wb(_)}Button`]=!0,c.hasAttribute("color")&&(o[`${_}ButtonColor`]=c.getAttribute("color")),c.hasAttribute("aria-label")&&(o[`${_}ButtonAriaLabel`]=c.getAttribute("aria-label"))}),o},eI=i=>{const o={},c=i.querySelector("swal-image");return c&&(Ga(c,["src","width","height","alt"]),c.hasAttribute("src")&&(o.imageUrl=c.getAttribute("src")),c.hasAttribute("width")&&(o.imageWidth=c.getAttribute("width")),c.hasAttribute("height")&&(o.imageHeight=c.getAttribute("height")),c.hasAttribute("alt")&&(o.imageAlt=c.getAttribute("alt"))),o},tI=i=>{const o={},c=i.querySelector("swal-icon");return c&&(Ga(c,["type","color"]),c.hasAttribute("type")&&(o.icon=c.getAttribute("type")),c.hasAttribute("color")&&(o.iconColor=c.getAttribute("color")),o.iconHtml=c.innerHTML),o},nI=i=>{const o={},c=i.querySelector("swal-input");c&&(Ga(c,["type","label","placeholder","value"]),o.input=c.getAttribute("type")||"text",c.hasAttribute("label")&&(o.inputLabel=c.getAttribute("label")),c.hasAttribute("placeholder")&&(o.inputPlaceholder=c.getAttribute("placeholder")),c.hasAttribute("value")&&(o.inputValue=c.getAttribute("value")));const _=i.querySelectorAll("swal-input-option");return _.length&&(o.inputOptions={},ir(_).forEach(w=>{Ga(w,["value"]);const A=w.getAttribute("value"),L=w.innerHTML;o.inputOptions[A]=L})),o},iI=(i,o)=>{const c={};for(const _ in o){const w=o[_],A=i.querySelector(w);A&&(Ga(A,[]),c[w.replace(/^swal-/,"")]=A.innerHTML.trim())}return c},rI=i=>{const o=jb.concat(["swal-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);ir(i.children).forEach(c=>{const _=c.tagName.toLowerCase();o.indexOf(_)===-1&&Ui(`Unrecognized element <${_}>`)})},Ga=(i,o)=>{ir(i.attributes).forEach(c=>{o.indexOf(c.name)===-1&&Ui([`Unrecognized attribute "${c.name}" on <${i.tagName.toLowerCase()}>.`,`${o.length?`Allowed attributes are: ${o.join(", ")}`:"To set the value, use HTML within the element."}`])})};var $b={email:(i,o)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(i)?Promise.resolve():Promise.resolve(o||"Invalid email address"),url:(i,o)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(i)?Promise.resolve():Promise.resolve(o||"Invalid URL")};function oI(i){i.inputValidator||Object.keys($b).forEach(o=>{i.input===o&&(i.inputValidator=$b[o])})}function sI(i){(!i.target||typeof i.target=="string"&&!document.querySelector(i.target)||typeof i.target!="string"&&!i.target.appendChild)&&(Ui('Target parameter is not valid, defaulting to "body"'),i.target="body")}function aI(i){oI(i),i.showLoaderOnConfirm&&!i.preConfirm&&Ui(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),sI(i),typeof i.title=="string"&&(i.title=i.title.split(`
`).join("<br />")),xk(i)}class lI{constructor(o,c){this.callback=o,this.remaining=c,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(o){const c=this.running;return c&&this.stop(),this.remaining+=o,c&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const cI=()=>{Bc.previousBodyPadding===null&&document.body.scrollHeight>window.innerHeight&&(Bc.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Bc.previousBodyPadding+Tk()}px`)},uI=()=>{Bc.previousBodyPadding!==null&&(document.body.style.paddingRight=`${Bc.previousBodyPadding}px`,Bc.previousBodyPadding=null)},hI=()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!js(document.body,Ie.iosfix)){const o=document.body.scrollTop;document.body.style.top=`${o*-1}px`,jt(document.body,Ie.iosfix),pI(),dI()}},dI=()=>{if(!navigator.userAgent.match(/(CriOS|FxiOS|EdgiOS|YaBrowser|UCBrowser)/i)){const o=44;Kt().scrollHeight>window.innerHeight-o&&(di().style.paddingBottom=`${o}px`)}},pI=()=>{const i=di();let o;i.ontouchstart=c=>{o=fI(c)},i.ontouchmove=c=>{o&&(c.preventDefault(),c.stopPropagation())}},fI=i=>{const o=i.target,c=di();return mI(i)||_I(i)?!1:o===c||!Db(c)&&o.tagName!=="INPUT"&&o.tagName!=="TEXTAREA"&&!(Db(Lf())&&Lf().contains(o))},mI=i=>i.touches&&i.touches.length&&i.touches[0].touchType==="stylus",_I=i=>i.touches&&i.touches.length>1,gI=()=>{if(js(document.body,Ie.iosfix)){const i=parseInt(document.body.style.top,10);so(document.body,Ie.iosfix),document.body.style.top="",document.body.scrollTop=i*-1}},Gb=10,yI=i=>{const o=di(),c=Kt();typeof i.willOpen=="function"&&i.willOpen(c);const w=window.getComputedStyle(document.body).overflowY;wI(o,c,i),setTimeout(()=>{vI(o,c)},Gb),Sy()&&(xI(o,i.scrollbarPadding,w),Yk()),!Of()&&!Tt.previousActiveElement&&(Tt.previousActiveElement=document.activeElement),typeof i.didOpen=="function"&&setTimeout(()=>i.didOpen(c)),so(o,Ie["no-transition"])},Zb=i=>{const o=Kt();if(i.target!==o)return;const c=di();o.removeEventListener(Gh,Zb),c.style.overflowY="auto"},vI=(i,o)=>{Gh&&Lb(o)?(i.style.overflowY="hidden",o.addEventListener(Gh,Zb)):i.style.overflowY="auto"},xI=(i,o,c)=>{hI(),o&&c!=="hidden"&&cI(),setTimeout(()=>{i.scrollTop=0})},wI=(i,o,c)=>{jt(i,c.showClass.backdrop),o.style.setProperty("opacity","0","important"),ri(o,"grid"),setTimeout(()=>{jt(o,c.showClass.popup),o.style.removeProperty("opacity")},Gb),jt([document.documentElement,document.body],Ie.shown),c.heightAuto&&c.backdrop&&!c.toast&&jt([document.documentElement,document.body],Ie["height-auto"])},Fc=i=>{let o=Kt();o||new Oy,o=Kt();const c=Lc();Of()?fi(jh()):bI(o,i),ri(c),o.setAttribute("data-loading",!0),o.setAttribute("aria-busy",!0),o.focus()},bI=(i,o)=>{const c=Rf(),_=Lc();!o&&yr(Ir())&&(o=Ir()),ri(c),o&&(fi(o),_.setAttribute("data-button-to-replace",o.className)),_.parentNode.insertBefore(_,o),jt([i,c],Ie.loading)},TI=(i,o)=>{o.input==="select"||o.input==="radio"?kI(i,o):["text","email","number","tel","textarea"].includes(o.input)&&(xy(o.inputValue)||wy(o.inputValue))&&(Fc(Ir()),II(i,o))},EI=(i,o)=>{const c=i.getInput();if(!c)return null;switch(o.input){case"checkbox":return SI(c);case"radio":return CI(c);case"file":return AI(c);default:return o.inputAutoTrim?c.value.trim():c.value}},SI=i=>i.checked?1:0,CI=i=>i.checked?i.value:null,AI=i=>i.files.length?i.getAttribute("multiple")!==null?i.files:i.files[0]:null,kI=(i,o)=>{const c=Kt(),_=w=>MI[o.input](c,Py(w),o);xy(o.inputOptions)||wy(o.inputOptions)?(Fc(Ir()),Uh(o.inputOptions).then(w=>{i.hideLoading(),_(w)})):typeof o.inputOptions=="object"?_(o.inputOptions):zc(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof o.inputOptions}`)},II=(i,o)=>{const c=i.getInput();fi(c),Uh(o.inputValue).then(_=>{c.value=o.input==="number"?parseFloat(_)||0:`${_}`,ri(c),c.focus(),i.hideLoading()}).catch(_=>{zc(`Error in inputValue promise: ${_}`),c.value="",ri(c),c.focus(),i.hideLoading()})},MI={select:(i,o,c)=>{const _=$s(i,Ie.select),w=(A,L,l)=>{const W=document.createElement("option");W.value=l,pi(W,L),W.selected=qb(l,c.inputValue),A.appendChild(W)};o.forEach(A=>{const L=A[0],l=A[1];if(Array.isArray(l)){const W=document.createElement("optgroup");W.label=L,W.disabled=!1,_.appendChild(W),l.forEach(_e=>w(W,_e[1],_e[0]))}else w(_,l,L)}),_.focus()},radio:(i,o,c)=>{const _=$s(i,Ie.radio);o.forEach(A=>{const L=A[0],l=A[1],W=document.createElement("input"),_e=document.createElement("label");W.type="radio",W.name=Ie.radio,W.value=L,qb(L,c.inputValue)&&(W.checked=!0);const ve=document.createElement("span");pi(ve,l),ve.className=Ie.label,_e.appendChild(W),_e.appendChild(ve),_.appendChild(_e)});const w=_.querySelectorAll("input");w.length&&w[0].focus()}},Py=i=>{const o=[];return typeof Map!="undefined"&&i instanceof Map?i.forEach((c,_)=>{let w=c;typeof w=="object"&&(w=Py(w)),o.push([_,w])}):Object.keys(i).forEach(c=>{let _=i[c];typeof _=="object"&&(_=Py(_)),o.push([c,_])}),o},qb=(i,o)=>o&&o.toString()===i.toString(),PI=i=>{const o=It.innerParams.get(i);i.disableButtons(),o.input?Wb(i,"confirm"):Dy(i,!0)},zI=i=>{const o=It.innerParams.get(i);i.disableButtons(),o.returnInputValueOnDeny?Wb(i,"deny"):zy(i,!1)},DI=(i,o)=>{i.disableButtons(),o(Rc.cancel)},Wb=(i,o)=>{const c=It.innerParams.get(i),_=EI(i,c);c.inputValidator?LI(i,_,o):i.getInput().checkValidity()?o==="deny"?zy(i,_):Dy(i,_):(i.enableButtons(),i.showValidationMessage(c.validationMessage))},LI=(i,o,c)=>{const _=It.innerParams.get(i);i.disableInput(),Promise.resolve().then(()=>Uh(_.inputValidator(o,_.validationMessage))).then(A=>{i.enableButtons(),i.enableInput(),A?i.showValidationMessage(A):c==="deny"?zy(i,o):Dy(i,o)})},zy=(i,o)=>{const c=It.innerParams.get(i||globalThis);c.showLoaderOnDeny&&Fc(Vs()),c.preDeny?(It.awaitingPromise.set(i||globalThis,!0),Promise.resolve().then(()=>Uh(c.preDeny(o,c.validationMessage))).then(w=>{w===!1?i.hideLoading():i.closePopup({isDenied:!0,value:typeof w=="undefined"?o:w})}).catch(w=>Hb(i||globalThis,w))):i.closePopup({isDenied:!0,value:o})},Xb=(i,o)=>{i.closePopup({isConfirmed:!0,value:o})},Hb=(i,o)=>{i.rejectPromise(o)},Dy=(i,o)=>{const c=It.innerParams.get(i||globalThis);c.showLoaderOnConfirm&&Fc(),c.preConfirm?(i.resetValidationMessage(),It.awaitingPromise.set(i||globalThis,!0),Promise.resolve().then(()=>Uh(c.preConfirm(o,c.validationMessage))).then(w=>{yr(Bf())||w===!1?i.hideLoading():Xb(i,typeof w=="undefined"?o:w)}).catch(w=>Hb(i||globalThis,w))):Xb(i,o)},BI=(i,o,c)=>{It.innerParams.get(i).toast?RI(i,o,c):(OI(o),UI(o),NI(i,o,c))},RI=(i,o,c)=>{o.popup.onclick=()=>{const _=It.innerParams.get(i);_&&(FI(_)||_.timer||_.input)||c(Rc.close)}},FI=i=>i.showConfirmButton||i.showDenyButton||i.showCancelButton||i.showCloseButton;let Nf=!1;const OI=i=>{i.popup.onmousedown=()=>{i.container.onmouseup=function(o){i.container.onmouseup=void 0,o.target===i.container&&(Nf=!0)}}},UI=i=>{i.container.onmousedown=()=>{i.popup.onmouseup=function(o){i.popup.onmouseup=void 0,(o.target===i.popup||i.popup.contains(o.target))&&(Nf=!0)}}},NI=(i,o,c)=>{o.container.onclick=_=>{const w=It.innerParams.get(i);if(Nf){Nf=!1;return}_.target===o.container&&vy(w.allowOutsideClick)&&c(Rc.backdrop)}},VI=()=>yr(Kt()),Yb=()=>Ir()&&Ir().click(),jI=()=>Vs()&&Vs().click(),$I=()=>ja()&&ja().click(),GI=(i,o,c,_)=>{o.keydownTarget&&o.keydownHandlerAdded&&(o.keydownTarget.removeEventListener("keydown",o.keydownHandler,{capture:o.keydownListenerCapture}),o.keydownHandlerAdded=!1),c.toast||(o.keydownHandler=w=>qI(i,w,_),o.keydownTarget=c.keydownListenerCapture?window:Kt(),o.keydownListenerCapture=c.keydownListenerCapture,o.keydownTarget.addEventListener("keydown",o.keydownHandler,{capture:o.keydownListenerCapture}),o.keydownHandlerAdded=!0)},Ly=(i,o,c)=>{const _=Ey();if(_.length)return o=o+c,o===_.length?o=0:o===-1&&(o=_.length-1),_[o].focus();Kt().focus()},Kb=["ArrowRight","ArrowDown"],ZI=["ArrowLeft","ArrowUp"],qI=(i,o,c)=>{const _=It.innerParams.get(i);!_||(_.stopKeydownPropagation&&o.stopPropagation(),o.key==="Enter"?WI(i,o,_):o.key==="Tab"?XI(o,_):[...Kb,...ZI].includes(o.key)?HI(o.key):o.key==="Escape"&&YI(o,_,c))},WI=(i,o,c)=>{if(!o.isComposing&&o.target&&i.getInput()&&o.target.outerHTML===i.getInput().outerHTML){if(["textarea","file"].includes(c.input))return;Yb(),o.preventDefault()}},XI=(i,o)=>{const c=i.target,_=Ey();let w=-1;for(let A=0;A<_.length;A++)if(c===_[A]){w=A;break}i.shiftKey?Ly(o,w,-1):Ly(o,w,1),i.stopPropagation(),i.preventDefault()},HI=i=>{const o=Ir(),c=Vs(),_=ja();if(![o,c,_].includes(document.activeElement))return;const w=Kb.includes(i)?"nextElementSibling":"previousElementSibling",A=document.activeElement[w];A instanceof HTMLElement&&A.focus()},YI=(i,o,c)=>{vy(o.allowEscapeKey)&&(i.preventDefault(),c(Rc.esc))},KI=i=>typeof i=="object"&&i.jquery,Jb=i=>i instanceof Element||KI(i),JI=i=>{const o={};return typeof i[0]=="object"&&!Jb(i[0])?Object.assign(o,i[0]):["title","html","icon"].forEach((c,_)=>{const w=i[_];typeof w=="string"||Jb(w)?o[c]=w:w!==void 0&&zc(`Unexpected type of ${c}! Expected "string" or "Element", got ${typeof w}`)}),o};function QI(...i){const o=this;return new o(...i)}function eM(i){class o extends this{_main(_,w){return super._main(_,Object.assign({},i,w))}}return o}const tM=()=>Tt.timeout&&Tt.timeout.getTimerLeft(),Qb=()=>{if(Tt.timeout)return uk(),Tt.timeout.stop()},e2=()=>{if(Tt.timeout){const i=Tt.timeout.start();return Ay(i),i}},nM=()=>{const i=Tt.timeout;return i&&(i.running?Qb():e2())},iM=i=>{if(Tt.timeout){const o=Tt.timeout.increase(i);return Ay(o,!0),o}},rM=()=>Tt.timeout&&Tt.timeout.isRunning();let t2=!1;const By={};function oM(i="data-swal-template"){By[i]=this,t2||(document.body.addEventListener("click",sM),t2=!0)}const sM=i=>{for(let o=i.target;o&&o!==document;o=o.parentNode)for(const c in By){const _=o.getAttribute(c);if(_){By[c].fire({template:_});return}}};var aM=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isValidParameter:Tb,isUpdatableParameter:Eb,isDeprecatedParameter:by,argsToParams:JI,getContainer:di,getPopup:Kt,getTitle:Cb,getHtmlContainer:Lf,getImage:Ab,getIcon:jh,getInputLabel:ok,getCloseButton:Ty,getActions:Rf,getConfirmButton:Ir,getDenyButton:Vs,getCancelButton:ja,getLoader:Lc,getFooter:Ib,getTimerProgressBar:Ff,getFocusableElements:Ey,getValidationMessage:Bf,isLoading:ak,isVisible:VI,clickConfirm:Yb,clickDeny:jI,clickCancel:$I,fire:QI,mixin:eM,showLoading:Fc,enableLoading:Fc,getTimerLeft:tM,stopTimer:Qb,resumeTimer:e2,toggleTimer:nM,increaseTimer:iM,isTimerRunning:rM,bindClickHandler:oM});function n2(){const i=It.innerParams.get(this);if(!i)return;const o=It.domCache.get(this);fi(o.loader),Of()?i.icon&&ri(jh()):lM(o),so([o.popup,o.actions],Ie.loading),o.popup.removeAttribute("aria-busy"),o.popup.removeAttribute("data-loading"),o.confirmButton.disabled=!1,o.denyButton.disabled=!1,o.cancelButton.disabled=!1}const lM=i=>{const o=i.popup.getElementsByClassName(i.loader.getAttribute("data-button-to-replace"));o.length?ri(o[0],"inline-block"):ck()&&fi(i.actions)};function cM(i){const o=It.innerParams.get(i||this),c=It.domCache.get(i||this);return c?Cy(c.popup,o.input):null}var qh={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};function i2(i,o,c,_){Of()?o2(i,_):(pk(c).then(()=>o2(i,_)),Tt.keydownTarget.removeEventListener("keydown",Tt.keydownHandler,{capture:Tt.keydownListenerCapture}),Tt.keydownHandlerAdded=!1),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(o.setAttribute("style","display:none !important"),o.removeAttribute("class"),o.innerHTML=""):o.remove(),Sy()&&(uI(),gI(),Vb()),uM()}function uM(){so([document.documentElement,document.body],[Ie.shown,Ie["height-auto"],Ie["no-backdrop"],Ie["toast-shown"]])}function Vf(i){i=fM(i);const o=qh.swalPromiseResolve.get(this),c=dM(this);this.isAwaitingPromise()?i.isDismissed||(r2(this),o(i)):c&&o(i)}function hM(){return!!It.awaitingPromise.get(this)}const dM=i=>{const o=Kt();if(!o)return!1;const c=It.innerParams.get(i);if(!c||js(o,c.hideClass.popup))return!1;so(o,c.showClass.popup),jt(o,c.hideClass.popup);const _=di();return so(_,c.showClass.backdrop),jt(_,c.hideClass.backdrop),mM(i,o,c),!0};function pM(i){const o=qh.swalPromiseReject.get(this);r2(this),o&&o(i)}const r2=i=>{i.isAwaitingPromise()&&(It.awaitingPromise.delete(i),It.innerParams.get(i)||i._destroy())},fM=i=>typeof i=="undefined"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},i),mM=(i,o,c)=>{const _=di(),w=Gh&&Lb(o);typeof c.willClose=="function"&&c.willClose(o),w?_M(i,o,_,c.returnFocus,c.didClose):i2(i,_,c.returnFocus,c.didClose)},_M=(i,o,c,_,w)=>{Tt.swalCloseEventFinishedCallback=i2.bind(null,i,c,_,w),o.addEventListener(Gh,function(A){A.target===o&&(Tt.swalCloseEventFinishedCallback(),delete Tt.swalCloseEventFinishedCallback)})},o2=(i,o)=>{setTimeout(()=>{typeof o=="function"&&o.bind(i.params)(),i._destroy()})};function s2(i,o,c){const _=It.domCache.get(i);o.forEach(w=>{_[w].disabled=c})}function a2(i,o){if(!i)return!1;if(i.type==="radio"){const _=i.parentNode.parentNode.querySelectorAll("input");for(let w=0;w<_.length;w++)_[w].disabled=o}else i.disabled=o}function gM(){s2(this,["confirmButton","denyButton","cancelButton"],!1)}function yM(){s2(this,["confirmButton","denyButton","cancelButton"],!0)}function vM(){return a2(this.getInput(),!1)}function xM(){return a2(this.getInput(),!0)}function wM(i){const o=It.domCache.get(this),c=It.innerParams.get(this);pi(o.validationMessage,i),o.validationMessage.className=Ie["validation-message"],c.customClass&&c.customClass.validationMessage&&jt(o.validationMessage,c.customClass.validationMessage),ri(o.validationMessage);const _=this.getInput();_&&(_.setAttribute("aria-invalid",!0),_.setAttribute("aria-describedby",Ie["validation-message"]),Mb(_),jt(_,Ie.inputerror))}function bM(){const i=It.domCache.get(this);i.validationMessage&&fi(i.validationMessage);const o=this.getInput();o&&(o.removeAttribute("aria-invalid"),o.removeAttribute("aria-describedby"),so(o,Ie.inputerror))}function TM(){return It.domCache.get(this).progressSteps}function EM(i){const o=Kt(),c=It.innerParams.get(this);if(!o||js(o,c.hideClass.popup))return Ui("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const _={};Object.keys(i).forEach(A=>{Eb(A)?_[A]=i[A]:Ui(`Invalid parameter to update: "${A}". Updatable params are listed here: https://github.com/sweetalert2/sweetalert2/blob/master/src/utils/params.js

If you think this parameter should be updatable, request it here: https://github.com/sweetalert2/sweetalert2/issues/new?template=02_feature_request.md`)});const w=Object.assign({},c,_);Nb(this,w),It.innerParams.set(this,w),Object.defineProperties(this,{params:{value:Object.assign({},this.params,i),writable:!1,enumerable:!0}})}function SM(){const i=It.domCache.get(this),o=It.innerParams.get(this);if(!o){l2(this);return}i.popup&&Tt.swalCloseEventFinishedCallback&&(Tt.swalCloseEventFinishedCallback(),delete Tt.swalCloseEventFinishedCallback),Tt.deferDisposalTimer&&(clearTimeout(Tt.deferDisposalTimer),delete Tt.deferDisposalTimer),typeof o.didDestroy=="function"&&o.didDestroy(),CM(this)}const CM=i=>{l2(i),delete i.params,delete Tt.keydownHandler,delete Tt.keydownTarget,delete Tt.currentInstance},l2=i=>{i.isAwaitingPromise()?(Ry(It,i),It.awaitingPromise.set(i,!0)):(Ry(qh,i),Ry(It,i))},Ry=(i,o)=>{for(const c in i)i[c].delete(o)};var c2=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",hideLoading:n2,disableLoading:n2,getInput:cM,close:Vf,isAwaitingPromise:hM,rejectPromise:pM,closePopup:Vf,closeModal:Vf,closeToast:Vf,enableButtons:gM,disableButtons:yM,enableInput:vM,disableInput:xM,showValidationMessage:wM,resetValidationMessage:bM,getProgressSteps:TM,update:EM,_destroy:SM});let Fy;class Oc{constructor(...o){if(typeof window=="undefined")return;Fy=this;const c=Object.freeze(this.constructor.argsToParams(o));Object.defineProperties(this,{params:{value:c,writable:!1,enumerable:!0,configurable:!0}});const _=this._main(this.params);It.promise.set(this,_)}_main(o,c={}){ik(Object.assign({},c,o)),Tt.currentInstance&&(Tt.currentInstance._destroy(),Sy()&&Vb()),Tt.currentInstance=this;const _=kM(o,c);aI(_),Object.freeze(_),Tt.timeout&&(Tt.timeout.stop(),delete Tt.timeout),clearTimeout(Tt.restoreFocusTimeout);const w=IM(this);return Nb(this,_),It.innerParams.set(this,_),AM(this,w,_)}then(o){return It.promise.get(this).then(o)}finally(o){return It.promise.get(this).finally(o)}}const AM=(i,o,c)=>new Promise((_,w)=>{const A=L=>{i.closePopup({isDismissed:!0,dismiss:L})};qh.swalPromiseResolve.set(i,_),qh.swalPromiseReject.set(i,w),o.confirmButton.onclick=()=>PI(i),o.denyButton.onclick=()=>zI(i),o.cancelButton.onclick=()=>DI(i,A),o.closeButton.onclick=()=>A(Rc.close),BI(i,o,A),GI(i,Tt,c,A),TI(i,c),yI(c),MM(Tt,c,A),PM(o,c),setTimeout(()=>{o.container.scrollTop=0})}),kM=(i,o)=>{const c=Kk(i),_=Object.assign({},Dc,o,c,i);return _.showClass=Object.assign({},Dc.showClass,_.showClass),_.hideClass=Object.assign({},Dc.hideClass,_.hideClass),_},IM=i=>{const o={popup:Kt(),container:di(),actions:Rf(),confirmButton:Ir(),denyButton:Vs(),cancelButton:ja(),loader:Lc(),closeButton:Ty(),validationMessage:Bf(),progressSteps:kb()};return It.domCache.set(i,o),o},MM=(i,o,c)=>{const _=Ff();fi(_),o.timer&&(i.timeout=new lI(()=>{c("timer"),delete i.timeout},o.timer),o.timerProgressBar&&(ri(_),setTimeout(()=>{i.timeout&&i.timeout.running&&Ay(o.timer)})))},PM=(i,o)=>{if(!o.toast){if(!vy(o.allowEnterKey))return DM();zM(i,o)||Ly(o,-1,1)}},zM=(i,o)=>o.focusDeny&&yr(i.denyButton)?(i.denyButton.focus(),!0):o.focusCancel&&yr(i.cancelButton)?(i.cancelButton.focus(),!0):o.focusConfirm&&yr(i.confirmButton)?(i.confirmButton.focus(),!0):!1,DM=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};Object.assign(Oc.prototype,c2);Object.assign(Oc,aM);Object.keys(c2).forEach(i=>{Oc[i]=function(...o){if(Fy)return Fy[i](...o)}});Oc.DismissReason=Rc;Oc.version="11.3.3";const Oy=Oc;Oy.default=Oy;var u2={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},h2=Ca.createContext&&Ca.createContext(u2),Gs=globalThis&&globalThis.__assign||function(){return Gs=Object.assign||function(i){for(var o,c=1,_=arguments.length;c<_;c++){o=arguments[c];for(var w in o)Object.prototype.hasOwnProperty.call(o,w)&&(i[w]=o[w])}return i},Gs.apply(this,arguments)},LM=globalThis&&globalThis.__rest||function(i,o){var c={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&o.indexOf(_)<0&&(c[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,_=Object.getOwnPropertySymbols(i);w<_.length;w++)o.indexOf(_[w])<0&&Object.prototype.propertyIsEnumerable.call(i,_[w])&&(c[_[w]]=i[_[w]]);return c};function d2(i){return i&&i.map(function(o,c){return Ca.createElement(o.tag,Gs({key:c},o.attr),d2(o.child))})}function BM(i){return function(o){return Ca.createElement(RM,Gs({attr:Gs({},i.attr)},o),d2(i.child))}}function RM(i){var o=function(c){var _=i.attr,w=i.size,A=i.title,L=LM(i,["attr","size","title"]),l=w||c.size||"1em",W;return c.className&&(W=c.className),i.className&&(W=(W?W+" ":"")+i.className),Ca.createElement("svg",Gs({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},c.attr,_,L,{className:W,style:Gs(Gs({color:i.color||c.color},c.style),i.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),A&&Ca.createElement("title",null,A),i.children)};return h2!==void 0?Ca.createElement(h2.Consumer,null,function(c){return o(c)}):o(u2)}function NM(i){return BM({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 14v8H4a8 8 0 0 1 8-8zm0-1c-3.315 0-6-2.685-6-6s2.685-6 6-6 6 2.685 6 6-2.685 6-6 6zm8.828 7.828L18 23.657l-2.828-2.829a4 4 0 1 1 5.656 0zM18 17a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"}}]}]})(i)}export{BM as G,NM as R,Oy as S,OM as a,UM as b,FM as c,Ca as d,$A as j,yb as m,gp as r};
